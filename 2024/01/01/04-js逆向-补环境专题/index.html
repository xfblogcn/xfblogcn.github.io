<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="xfblog">
    
    <title>
        
            04_JS逆向_补环境专题 |
        
        XFBLOG.CN
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/favicon.webp">
    
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/font/css/fontawesome.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/font/css/regular.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/font/css/solid.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/font/css/brands.min.css">
    
        
            
                
<link rel="stylesheet" href="/css/custom-1.css">

            
        
    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.xml"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"XFBLOG.CN","author":"xfblog","avatar":"/images/avatar.webp","logo":"/images/logo.webp","favicon":"/images/favicon.webp"},"menu":{"home":"/ || fa-solid fa-home","archives":"/archives || fa-solid fa-box-archive","categories":"/categories || fa-solid fa-layer-group","links":"/links || fa-solid fa-link","about":"/about || fa-solid fa-circle-info"},"first_screen":{"enable":true,"background_img":"/images/home_light.webp","background_img_dark":"/images/home_dark.webp","description":null,"hitokoto":false},"social_contact":{"enable":true,"links":{"github":"https://github.com/xfblogcn","weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":true,"hide_header":true},"home":{"announcement":"版权声明：本站所有文章均为 xfblog.cn 小傅原创，请遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。","category":true,"tag":true,"post_datetime":"created","post_datetime_format":"YYYY-MM-DD"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":true,"min2read":true},"datetime_format":"YYYY-MM-DD","copyright_info":true,"share":true,"reward":{"enable":true,"img_link":"/images/zfb.webp","text":"创作不易，打赏随意，您的支持是我更新的动力💪！"}},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"obsidian"},"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":true,"site_uv":false,"site_pv":false,"page_pv":true}},"local_search":{"enable":true,"preload":true},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.36"},"waline":{"server_url":null,"reaction":false,"version":"3.2.1"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":true},"lazyload":{"enable":true},"cdn":{"enable":true,"provider":"jsdelivr"},"pjax":{"enable":true},"footer":{"since":2021,"word_count":false,"site_deploy":{"enable":false,"provider":"github","url":null},"record":{"enable":true,"list":[{"code":"蜀ICP备2021021033号-1","link":"https://beian.miit.gov.cn"},{"code":"川公网安备 51138102000134号","link":"http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51138102000134"}]}},"inject":{"enable":true,"css":["/css/custom-1.css"],"js":["/js/run_time.js","/js/code_click_copy.js","/js/copyrightpro.js"]},"root":"","source_data":{},"version":"4.2.5"}
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"}
    KEEP.language_code_block = {"copy":"复制代码","copied":"已复制","fold":"折叠代码块","folded":"已折叠"}
    KEEP.language_copy_copyright = {"copy":"复制版权信息","copied":"已复制","title":"原文标题","author":"原文作者","link":"原文链接"}
  </script>
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Keep" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/logo.webp">
                </a>
            
            <a class="site-name border-box" href="/">
               XFBLOG.CN
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-home"></i>
                                
                                首页
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                
                                归档
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/categories">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-layer-group"></i>
                                
                                分类
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/links">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-link"></i>
                                
                                友链
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/about">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-circle-info"></i>
                                
                                关于
                                
                            </a>
                            
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="menu-text-color fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-home"></i>
                                </span>
                            
                            首页
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                </span>
                            
                            归档
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/categories">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-layer-group"></i>
                                </span>
                            
                            分类
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/links">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-link"></i>
                                </span>
                            
                            友链
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/about">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-circle-info"></i>
                                </span>
                            
                            关于
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        04_JS逆向_补环境专题
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/avatar.webp">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">xfblog</span>
                                
                                    <span class="author-badge">Lv3</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2024-01-01</span>
            </span>

            
                <span class="meta-info-item post-update-date">
                    <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                    <span class="datetime" data-updated="Wed Nov 27 2024 23:19:31 GMT+0800">2024-11-27</span>
                </span>
            
        

        
            <span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="post-category-ul">
                    
                            <li class="category-item"><a href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a></li>
                        
                    
                </ul>
            </span>
        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/Python/">Python</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E7%88%AC%E8%99%AB/">爬虫</a></li>
                        
                    
                </ul>
            </span>
        

        
        
            <span class="meta-info-item post-wordcount">
                <i class="icon fas fa-file-word"></i>&nbsp;<span>34.5k 字</span>
            </span>
        
        
            <span class="meta-info-item post-min2read">
                <i class="icon fas fa-clock"></i>&nbsp;<span>158 分钟</span>
            </span>
        
        
            <span class="meta-info-item post-pv">
                <i class="icon fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
            </span>
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <h2 id="一、JS-语法基础"><a href="#一、JS-语法基础" class="headerlink" title="一、JS 语法基础"></a>一、JS 语法基础</h2><h3 id="1-基础语法"><a href="#1-基础语法" class="headerlink" title="1. 基础语法"></a>1. 基础语法</h3><ul>
<li><p><strong>null 和 undefined：</strong>null 的类型是对象，即 object。null 和 undefined 都是 false，但是 null 是表示一个**”空”的对象<strong>，转换为数值为 0，而 undefined 是表示一个</strong>“此处无定义”的原始值**，转换为数值为 NaN</p>
</li>
<li><p><strong>NaN：</strong>表示非数字，主要出现在字符串解析成数字出错的场合</p>
<ul>
<li>NaN 不是独立的数据类型，而是一个特殊数值，数据类型为 Number</li>
<li>NaN 不等于任何值，包括其本身</li>
<li>NaN 与任何数（包括自己）的运算，得到的都是 NaN</li>
</ul>
</li>
<li><p><strong>查看类型的运算符：</strong></p>
<ol>
<li><strong>typeof：</strong>返回一个值的数据类型</li>
<li><strong>instanceof：</strong>表示对象是否为某个构造函数的实例</li>
</ol>
</li>
<li><p><strong>布尔值：</strong>在 js 中只有 6 种值 false、undefined、null、0 或 -0、NaN、”” 或 ‘’ 为 false 假，其余均为 true 真</p>
</li>
<li><p><strong>字符串：</strong>可以使用 &#96;&#96; 表示模版字符串，输出多行，其中使用 ${} 可以动态传参</p>
</li>
<li><p><strong>Base64 转码：</strong></p>
<ul>
<li>btoa()：任意值转为 Base64 编码（非 ASCII 码 –&gt; 中文要转码再 base64，en&#x2F;decodeURLComponent）</li>
<li>atob()：Base64 编码转为原来的值</li>
<li>nodejs –&gt; base64 编码：<code>var b64encode = Buffer.from(&#39;JavaScript&#39;).toString(&#39;base64&#39;)</code></li>
<li>nodejs –&gt; base64 解码：<code>var b64decode = Buffer.from(b64encode, &#39;base64&#39;).toString()</code></li>
</ul>
</li>
<li><p><strong>对象：</strong></p>
<ul>
<li>查看对象 obj 的所有属性：Object.keys(obj)</li>
<li><strong>判断属性：obj.hasOwnProperty(‘toString’) 方法用于判断属性 toString 是否为对象自身的属性</strong></li>
<li>属性遍历：for … in 循环可以遍历一个对象的全部属性，包括继承的属性（可以配合 hasOwnProperty）</li>
</ul>
</li>
<li><p><strong>函数：</strong></p>
<ul>
<li><strong>混淆声明方式：</strong><code>var c = New Function(&#39;a&#39;,&#39;b&#39;,&#39;return a+b&#39;); console.log(c(1, 2)); --&gt; 3</code></li>
<li><strong>返回值：</strong>当函数 return 多个值用逗号间隔时，只能成功返回最后一个值（<strong>逗号表达式</strong>，数组&#x2F;对象解决）</li>
</ul>
</li>
<li><p><strong>变量提升：</strong></p>
<ol>
<li><strong>变量提升：</strong>变量使用 var 声明时，js引擎会将变量声明提升到作用域顶部，但不会提升其赋值操作</li>
<li><strong>函数提升：整个函数</strong>都会被提升到作用域顶部。因此，声明的函数可以在其定义之前调用</li>
<li><strong>let 和 const：</strong>与 var 不同，使用 let 和 const 声明的变量被提升后存在**”暂时性死区”**，使用它们之前会抛出 ReferenceError 异常，即在声明之前无法访问这些变量</li>
</ol>
</li>
<li><p><strong>闭包：</strong>闭包就是将函数内部和函数外部连接起来的一座桥梁，可以简单理解为定义在一个函数内部的函数。最大的作用是可以读取外层函数内部的变量，另一个就是让这些变量始终保持在内存中</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 计数器实现，count是f函数内部的一个局部变量，只能被f函数内部的add函数访问。</span><br><span class="line">// 由于count是函数内部的变量，它不会被外部代码直接读取或修改，这种特性确保了变量的封装和数据安全</span><br><span class="line">function f() &#123;</span><br><span class="line">    var count = 0;</span><br><span class="line">    function add() &#123;</span><br><span class="line">        count++</span><br><span class="line">        console.log(count);</span><br><span class="line">    &#125;</span><br><span class="line">    return add;</span><br><span class="line">&#125;</span><br><span class="line">var f2 = f()</span><br><span class="line">f2()  // 1</span><br><span class="line">f2()  // 2</span><br><span class="line">f2()  // 3</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>eval函数：本质是在当前作用域之中注入代码，没有自己的作用域，都是在当前作用域内执行</strong>（混淆常用）</p>
<ul>
<li><strong>别名调用：</strong>为了保证 eval 的别名不影响代码优化，所以 eval 如果别名调用则 eval 内部一律是全局作用域</li>
</ul>
</li>
<li><p><strong>数组：</strong></p>
<ol>
<li>数组也是对象，typeof 类型为 Object，也可以使用 Object.keys(array) 打印出所有元素</li>
<li>数组的 length 属性是可写的，相当于截断，设置为 0 则直接清空数组</li>
<li>可以像对象一样添加键值对，但是不会增加数组 length 长度，也无法通过 arr.length &#x3D; 0 清除掉此键值对</li>
</ol>
</li>
<li><p><strong>异常捕获：</strong>在异常中，<strong>浏览器的异常堆栈信息和 nodejs 的异常堆栈信息可能不一样，也可能成为环境检测点</strong></p>
</li>
</ul>
<h3 id="2-函数的-arguments-对象"><a href="#2-函数的-arguments-对象" class="headerlink" title="2. 函数的 arguments 对象"></a>2. 函数的 arguments 对象</h3><ul>
<li><strong>arguments对象：</strong>在 js 中，函数的形参可通过 arguments 对象获取，该对象包含了传递给函数的所有实参<ul>
<li>通过数组形式输出所有形参：<code>Array.prototype.slice.call(arguments);</code></li>
<li>arguments.callee 属性：返回对应的原函数</li>
</ul>
</li>
<li><strong>对比 python：</strong>在 Python 中，如果函数的定义中没有使用 *args 或 **kwargs，则函数在被调用时实参与形参必须相匹配，否则 python 将引发 TypeError 异常，而 js 不会</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 在函数内部通过 arguments 对象来处理传递的参数</span><br><span class="line">function fun1() &#123;</span><br><span class="line">    console.log(arguments[&#x27;0&#x27;])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fun1(1, 2)  // 1</span><br></pre></td></tr></table></figure>

<h3 id="3-自执行函数"><a href="#3-自执行函数" class="headerlink" title="3. 自执行函数"></a>3. 自执行函数</h3><ul>
<li><strong>注意：</strong>由于 js 代码是可以压缩成一行的，所以自执行方法前的属性或方法必须以顿号结尾，所以通常<strong>在自执行方法前加上强制符（! 或 ~），可以避免其因整体被当作上一个属性或方法的方法调用而抛出的异常</strong></li>
<li><strong>作用：</strong><ol>
<li>不必为函数命名，避免了污染全局变量</li>
<li>自执行函数内部形成了一个单独的作用域，可以封装一些外部无法读取的私有变量</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">!(function () &#123; var a = 1; console.log(a) &#125;)()</span><br><span class="line"></span><br><span class="line">console.log(a);  // ReferenceError: a is not defined</span><br></pre></td></tr></table></figure>

<h3 id="4-原型链与构造函数"><a href="#4-原型链与构造函数" class="headerlink" title="4. 原型链与构造函数"></a>4. 原型链与构造函数</h3><blockquote>
<p><strong>Object 对象：</strong>js 中所有对象都继承自 Object 对象，即对象都是 Object 的实例</p>
<ol>
<li><strong>通过 dir(Object) 可以查看对象的所有自身属性</strong></li>
<li>通过已创建的实例对象 obj 作为模版，使用 <code>var obj2 = Object.create(obj, &#123;b:&#39;123&#39;&#125;)</code> 可以生成新的实例对象，其中 obj2 是继承至 obj 对象，区别是 obj 的原型指向 Object.prototype，而 obj2 的原型指向 create 的第一个参数，如果参数为空对象，则没有原型</li>
</ol>
<p><strong>原型链</strong>：在 js 中每个对象都有自己的原型对象 prototype，<strong>作用是实现继承</strong>。当需要访问一个对象的属性或方法时，js 引擎会首先在该对象本身查找，如果找不到，则会沿着实例的 __proto__ 即构造函数的 prototype 的顺序在原型中往上方查找，直到找到 Object.prototype 为止，找不到则报错或返回 undefined</p>
<p><strong>注意：</strong>__proto__ 和 prototype 本身没有区别，都是原型，只是一个在实例对象上，一个在构造函数上</p>
</blockquote>
<ul>
<li><p><strong>原型对象 Object.prototype 的特点：</strong></p>
<ol>
<li>如果原型对象上的属性是一个引用，那么一个实例改变了引用的属性，就会直接改变原型上此引用的属性</li>
</ol>
</li>
<li><p><strong>constructor 属性：</strong>prototype 对象有一个 constructor 属性，默认指向 prototype 对象所在的构造函数</p>
<ol>
<li><strong>实例的 constructor 属性是构造函数</strong>，即 <code>navigator.constructor == Navigator</code></li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// 简单的过环境检测（不太优雅，不太好用）</span><br><span class="line">var navigator = &#123;&#125;</span><br><span class="line">// console.log(navigator.constructor);</span><br><span class="line">function Navigator() &#123; &#125;</span><br><span class="line">// console.log(Navigator);</span><br><span class="line">var navigator = new Navigator();</span><br><span class="line">// console.log(navigator.constructor.toString());</span><br><span class="line">navigator.constructor.toString = function () &#123;</span><br><span class="line">    return &#x27;function Navigator() &#123; [native code] &#125;&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 简单的过环境检测（优雅的）</span><br><span class="line">function Navigator() &#123; &#125;</span><br><span class="line">Navigator.prototype.constructor.toString = function () &#123;</span><br><span class="line">    return &#x27;function Navigator() &#123; [native code] &#125;&#x27;</span><br><span class="line">&#125;</span><br><span class="line">// 第一种方式</span><br><span class="line">// var navigator = new Navigator();</span><br><span class="line">// 第二种方式（同第三种，不同写法）</span><br><span class="line">// var navigator = &#123;&#125;;</span><br><span class="line">// Object.setPrototypeOf(navigator, Navigator.prototype)</span><br><span class="line">// 第三种方式</span><br><span class="line">var navigator = Object.setPrototypeOf(&#123;&#125;, Navigator.prototype)</span><br><span class="line">console.log(Object.getPrototypeOf(navigator) == Navigator.prototype);  // true</span><br><span class="line"></span><br><span class="line">console.log(navigator.constructor);</span><br><span class="line">console.log(navigator.constructor === Navigator);  // true</span><br><span class="line">console.log(navigator.constructor.toString());</span><br><span class="line"></span><br><span class="line">function checknavigator() &#123;</span><br><span class="line">    return navigator.constructor.toString() === &#x27;function Navigator() &#123; [native code] &#125;&#x27;</span><br><span class="line">&#125;</span><br><span class="line">console.log(checknavigator());  // true</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>构造函数的原型链关系：</strong><ol>
<li>实例的 __proto__ 指向构造函数的 prototype，<code>navigator.__proto__ === Navigator.prototype</code>，这个称为<strong>构造函数的原型对象</strong></li>
<li>构造函数的 __proto__ 指向 Function.prototype（<strong>包括 Function 自己</strong>），即构造函数的 constructor 属性就是 Function，有 <code>Navigator.constructor == Function</code>，得 <code>Navigator.__proto__ === Function.prototype</code>，值为 <code>ƒ () &#123; [native code] &#125;</code>，暂时将 Function 称为<strong>构造器函数</strong></li>
<li>构造器函数的 __proto__ 指向 Object.prototype，但是由于其自己也是构造函数，所以 <code>Function.constructor == Function</code>，即 <code>Navigator.__proto__.__proto__ === Function.__proto__.__proto__. === Object.prototype</code>，<strong>包含了所有对象都继承的方法和属性</strong></li>
</ol>
</li>
</ul>
<h3 id="5-Object-相关重点方法"><a href="#5-Object-相关重点方法" class="headerlink" title="5. Object 相关重点方法"></a>5. Object 相关重点方法</h3><blockquote>
<p><strong>注意：很多方法有两种写法</strong></p>
<ol>
<li><strong>先定义对象，再在第一个参数指定该对象，而后参数对该对象进行操作</strong></li>
<li><strong>定义对象时赋值，赋值为调用该方法，此时第一个参数即为对象的值，而后参数对该对象进行操作</strong></li>
</ol>
</blockquote>
<ul>
<li><p><strong>Object 的静态方法，即部署在 Object 对象自身上的方法：</strong></p>
<ol>
<li><p>Object.keys()：返回对象自身的可枚举属性名组成的数组。只遍历自有属性，且仅返回可枚举的属性名</p>
</li>
<li><p>Object.getOwnPropertyName()：返回对象自身所有属性的属性名，<strong>包括不可枚举属性</strong>，组成一个数组</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const obj = &#123; a: 1 &#125;;</span><br><span class="line">Object.defineProperty(obj, &#x27;b&#x27;, &#123; value: 2, enumerable: false &#125;);</span><br><span class="line">console.log(Object.getOwnPropertyNames(obj)); // [&#x27;a&#x27;, &#x27;b&#x27;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>Object.getOwnPropertyDescriptor(obj, prop)：用于获取对象中某个特定属性的属性描述符</p>
</li>
<li><p><strong>Object.getOwnPropertyDescriptors()：</strong>返回对象自身所有属性的属性描述符对象，包括可否枚举的属性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const obj = &#123; a: 1 &#125;;</span><br><span class="line">Object.defineProperty(obj, &#x27;b&#x27;, &#123; value: 2, enumerable: false &#125;);</span><br><span class="line">console.log(Object.getOwnPropertyDescriptors(obj));</span><br><span class="line">// &#123;</span><br><span class="line">//   a: &#123; value: 1, writable: true, enumerable: true, configurable: true &#125;,</span><br><span class="line">//   b: &#123; value: 2, writable: false, enumerable: false, configurable: false &#125;</span><br><span class="line">// &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Object.defineProperty()：</strong>给对象定义或修改一个属性的属性描述符，通过描述符控制该属性的行为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const obj = &#123;&#125;;</span><br><span class="line">Object.defineProperty(obj, &#x27;a&#x27;, &#123; value: 1, writable: false &#125;);</span><br><span class="line">console.log(obj.a); // 1</span><br><span class="line">obj.a = 2;</span><br><span class="line">console.log(obj.a); // 1 （属性不可写）</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Object.defineProperties()：</strong>一次性定义或修改对象的多个属性及其属性描述符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const obj = &#123;&#125;;</span><br><span class="line">Object.defineProperties(obj, &#123;</span><br><span class="line">  a: &#123; value: 1, writable: true &#125;,</span><br><span class="line">  b: &#123; value: 2, writable: false &#125;</span><br><span class="line">&#125;);</span><br><span class="line">console.log(obj.a); // 1</span><br><span class="line">console.log(obj.b); // 2</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Object.getPrototypeOf() 检测点：</strong>返回指定对象的原型（即 [[Prototype]] 内部属性）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const obj = &#123;&#125;;</span><br><span class="line">const proto = Object.getPrototypeOf(obj);</span><br><span class="line">console.log(proto === Object.prototype); // true</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Object.setPrototypeOf()：</strong>设置指定对象的原型为另一个对象或 null</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const proto = &#123; greet: () =&gt; console.log(&#x27;Hello!&#x27;) &#125;;</span><br><span class="line">const obj = &#123;&#125;;</span><br><span class="line">Object.setPrototypeOf(obj, proto);</span><br><span class="line">obj.greet(); // &#x27;Hello!&#x27;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p><strong>Object 的实例方法：</strong></p>
<ol>
<li><p><strong>Object.prototype.valueOf()：</strong>返回指定对象的原始值。大多数情况下，对于基本对象，这个方法返回对象本身</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let obj = &#123; a: 1 &#125;;</span><br><span class="line">console.log(obj.valueOf());  // 输出：&#123; a: 1 &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Object.prototype.toString()：</strong>返回一个表示对象的字符串。默认情况返回对象的类型信息，由于实例对象可以直接重写此方法来覆盖掉原型上的方法，所以最好直接使用 Object.prototype.toString.call() 方法，可以获取原生的类型判断结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">let obj = &#123; a: 1 &#125;;</span><br><span class="line">console.log(obj.toString());  // 输出：[object Object]</span><br><span class="line"></span><br><span class="line">console.log(Object.prototype.toString.call(123));          // [object Number]</span><br><span class="line">console.log(Object.prototype.toString.call(&#x27;hello&#x27;));      // [object String]</span><br><span class="line">console.log(Object.prototype.toString.call(true));         // [object Boolean]</span><br><span class="line">console.log(Object.prototype.toString.call([]));           // [object Array]</span><br><span class="line">console.log(Object.prototype.toString.call(&#123;&#125;));           // [object Object]</span><br><span class="line">console.log(Object.prototype.toString.call(null));         // [object Null]</span><br><span class="line">console.log(Object.prototype.toString.call(undefined));    // [object Undefined]</span><br><span class="line">console.log(Object.prototype.toString.call(function()&#123;&#125;)); // [object Function]</span><br><span class="line">console.log(Object.prototype.toString.call(/regex/));      // [object RegExp]</span><br></pre></td></tr></table></figure>
</li>
<li><p>Object.prototype.toLocaleString()：类似于 toString()，返回当前对象对应的本地字符串形式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let date = new Date();</span><br><span class="line">console.log(date.toLocaleString());  // 根据本地设置输出日期字符串</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Object.prototype.hasOwnProperty()：</strong>用于检查对象是否具有指定的属性（这个属性不能是从原型链继承的）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let obj = &#123; a: 1 &#125;;</span><br><span class="line">console.log(obj.hasOwnProperty(&#x27;a&#x27;));  // 输出：true</span><br><span class="line">console.log(obj.hasOwnProperty(&#x27;toString&#x27;));  // 输出：false（来自原型链）</span><br></pre></td></tr></table></figure>
</li>
<li><p>Object.prototype.isPrototypeOf()：检查某个对象是否存在于另一个对象的原型链上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function Parent() &#123;&#125;</span><br><span class="line">function Child() &#123;&#125;</span><br><span class="line">Child.prototype = Object.create(Parent.prototype);</span><br><span class="line">let child = new Child();</span><br><span class="line">console.log(Parent.prototype.isPrototypeOf(child));  // 输出：true</span><br></pre></td></tr></table></figure>
</li>
<li><p>Object.prototype.propertylsEnumerable()：用于判断对象的某个属性是否可枚举。不可枚举的则返回 false</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let obj = &#123; a: 1 &#125;;</span><br><span class="line">console.log(obj.propertyIsEnumerable(&#x27;a&#x27;));  // 输出：true</span><br><span class="line">console.log(obj.propertyIsEnumerable(&#x27;toString&#x27;));  // 输出：false（继承的属性不可枚举）</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h3 id="6-常用对象-API"><a href="#6-常用对象-API" class="headerlink" title="6. 常用对象 API"></a>6. 常用对象 API</h3><ul>
<li><p><strong>控制台API：</strong></p>
<ol>
<li><p>inspect(object)：打开相关面板，并选中相应的元素，显示其细节</p>
</li>
<li><p><strong>getEventListeners：</strong>是 Chrome 开发者工具中内置的一个方法，用于获取特定 DOM 元素上注册的所有事件监听器，可以看到这个元素上绑定的事件及其回调函数。每个事件（如 click、keydown）都会作为返回对象的属性名，属性值是一个数组，数组中的每个元素代表绑定在该事件上的回调函数及相关信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// 选择一个按钮元素</span><br><span class="line">var button = document.querySelector(&#x27;button&#x27;);</span><br><span class="line"></span><br><span class="line">// 给按钮添加点击事件和鼠标移动事件</span><br><span class="line">button.addEventListener(&#x27;click&#x27;, () =&gt; console.log(&#x27;Button clicked!&#x27;));</span><br><span class="line">button.addEventListener(&#x27;mousemove&#x27;, () =&gt; console.log(&#x27;Mouse moved!&#x27;));</span><br><span class="line"></span><br><span class="line">getEventListeners(button);</span><br><span class="line">&#123;</span><br><span class="line">  click: [</span><br><span class="line">    &#123;listener: ƒ, useCapture: false, passive: false, once: false, type: &quot;click&quot;&#125;</span><br><span class="line">  ],</span><br><span class="line">  mousemove: [</span><br><span class="line">    &#123;listener: ƒ, useCapture: false, passive: false, once: false, type: &quot;mousemove&quot;&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>keys(object)，values(object)：返回一个数组，包含 object 的所有的键名&#x2F;键值</p>
</li>
<li><p><strong>monitorEvents(object, events)：</strong>用来监听指定对象上发生的某类事件。当某类事件发生时，返回一个 Event 对象，该对象包含该事件的相关信息。使用 unmonitorEvents(object) 方法可以停止监听指定对象上的事件。事件可以分为四大类，每一类都包含一系列具体事件：</p>
<ul>
<li>Mouse 事件：mousedown mouseup click dblclick mousemove mouseover mouseout mousewheel</li>
<li>Key 事件：keydown keyup keypress textinput</li>
<li>Touch 事件：touchstart touchmove touchend touchcancel</li>
<li>Control 事件：resize scroll zoom focus blur select change submit reset</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 监听 document 上的所有鼠标事件</span><br><span class="line">monitorEvents(document, &#x27;mouse&#x27;);</span><br><span class="line">// 停止监听 document 上的所有事件</span><br><span class="line">unmonitorEvents(document);</span><br></pre></td></tr></table></figure>
</li>
<li><p>copy(object)：复制特定 DOM 元素到剪贴板</p>
</li>
<li><p>debugger：断点</p>
</li>
</ol>
</li>
<li><p><strong>console - API：</strong></p>
<ol>
<li>不同日志等级的打印输出：console.log()、info()、debug()、warn()、error()</li>
<li>console.table()：用表格形式打印一些复合类型数据，如对象、数组</li>
<li>console.count()：计数输出多少次</li>
<li>**console.dir()**、dirxml()：打印一个 dom 的对象形式、目录树的形式</li>
<li>console.assert()：主要用于程序运行过程中，进行条件判断，如果不满足条件，则显示一个错误，但不会中断程序执行，可以达到一个提示用户内部状态不正确的作用</li>
<li>console.time()、timeEnd()：用于计时，可以计算出一个操作所花费的准确时间</li>
<li>console.group()、groupEnd()、groupCollapsed()：将显示的信息分组，在输出大量信息时有用</li>
<li>**console.trace()**、clear()：显示当前执行的代码在堆栈中的调用路径、清空控制台输出</li>
</ol>
</li>
</ul>
<h3 id="7-this-–-call、apply-和-bind"><a href="#7-this-–-call、apply-和-bind" class="headerlink" title="7. this –&gt; call、apply 和 bind"></a>7. this –&gt; call、apply 和 bind</h3><blockquote>
<p><strong>this 机制：</strong>在 js 中，this 的指向依赖于<strong>调用函数的上下文</strong>。js 的方法在脱离对象后调用时，其 this 指向默认变为全局对象，这种情况下如果不显式地绑定 this 到正确的对象，则会抛出 TypeError 异常</p>
<p><strong>绑定 this 的方法（call、apply 和 bind）：</strong></p>
<ol>
<li>Function.prototype.call(thisValue, arg1, arg2, …)：函数实例的 call 方法，可以指定函数内部 this 的指向（即函数执行时所在的作用域），然后在所指定的作用域中，调用该函数</li>
<li>Function.prototype.apply(thisValue, [arg1, arg2, ….])：apply 方法的作用与 call 方法类似，也是改变 this 指向，然后再调用该函数。唯一的区别就是，它接收一个数组作为函数执行时的参数</li>
<li>Function.prototype.bind(thisValue, arg1, arg2, …)：用于将函数体内的 this 绑定到某个对象，然后返回一个<strong>新函数</strong></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var d = new Date()</span><br><span class="line">var gettime = d.getTime</span><br><span class="line">gettime() // TypeError: this is not a Date object.</span><br><span class="line">// 当直接引用 d.getTime 时，实际上是将 getTime 函数提取了出来，而它的上下文 (this) 已经不再是 d 对象，而是指向全局对象，因此会导致错误</span><br><span class="line"></span><br><span class="line">/* 解决方法</span><br><span class="line">var d = new Date()</span><br><span class="line">var gettime = d.getTime.bind(d)</span><br><span class="line">console.log(gettime())</span><br><span class="line"></span><br><span class="line">var d = new Date()</span><br><span class="line">var gettime = d.getTime</span><br><span class="line">console.log(gettime.call(d))</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><p><strong>全局上下文：</strong>在全局作用域中，this 通常指向全局对象（在浏览器中为 windows，在 nodejs 中为 global ）</p>
</li>
<li><p><strong>对象方法中的 this：</strong>当 this 在一个对象的方法中使用时，this 指向调用该方法的对象，赋值给另一个对象则指向改变</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const person = &#123;</span><br><span class="line">    name: &#x27;Alice&#x27;,</span><br><span class="line">    sayHello: function() &#123;</span><br><span class="line">        console.log(this.name); // 这里的 `this` 指向 person 对象</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">person.sayHello(); // 输出 &#x27;Alice&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>构造函数中的 this：</strong>在构造函数中，this 指向新创建的实例对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function Person(name) &#123;</span><br><span class="line">    this.name = name;  // `this` 指向当前创建的对象实例</span><br><span class="line">&#125;</span><br><span class="line">const alice = new Person(&#x27;Jack&#x27;);</span><br><span class="line">console.log(alice.name); // 输出 &#x27;=Jack&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>事件处理器中的 this：</strong>在事件处理器中，this 通常指向触发事件的 DOM 元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const button = document.querySelector(&#x27;button&#x27;);</span><br><span class="line">button.addEventListener(&#x27;click&#x27;, function() &#123;</span><br><span class="line">    console.log(this);  // 这里的 `this` 指向触发事件的 button 元素</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>箭头函数中的 this：</strong>箭头函数的 this 与普通函数不同，它不绑定自己的 this，而是从定义时的上下文继承 this</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const person = &#123;</span><br><span class="line">    name: &#x27;haha&#x27;,</span><br><span class="line">    sayHello: () =&gt; &#123;</span><br><span class="line">        console.log(this.name); // 这里的 `this` 指向定义时的上下文，不是 person 对象</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">person.sayHello(); // 输出 undefined，因为箭头函数的 this 不是 person 对象</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="8-ES6语法糖"><a href="#8-ES6语法糖" class="headerlink" title="8. ES6语法糖"></a>8. ES6语法糖</h3><ul>
<li>简易属性和方法表达：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const myname = &#x27;jack&#x27;</span><br><span class="line">const temp = &#123; myname &#125;</span><br><span class="line">console.log(temp); // &#123; myname: &#x27;jack&#x27; &#125;</span><br><span class="line"></span><br><span class="line">const team = &#123;</span><br><span class="line">    dowork() &#123;</span><br><span class="line">        return &#x27;work!&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">console.log(team.dowork()) // work!</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>var、let 和 const：</strong><ol>
<li>let 可以完全取代 var，因为两者语义相同，且 let 没有副作用，也不存在变量提升代码不易读</li>
<li>var 变量定义会挂载到全局对象 window 上，不会被垃圾回收；而 let 和 const 不用担心这个问题</li>
<li>全局常量 const 优于 let，既可以限制值不被修改，也可以提高程序的运行效率（js 编译器优化）</li>
</ol>
</li>
<li><strong>自执行函数：</strong><ul>
<li>箭头函数的 this 与普通函数不同，它不绑定自己的 this，而是从定义时的上下文继承 this</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;jack&quot;);</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line">function Timer() &#123;</span><br><span class="line">    this.s1 = 0;</span><br><span class="line">    this.s2 = 0;</span><br><span class="line">    setInterval(() =&gt; &#123;</span><br><span class="line">        this.s1++</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">    setInterval(function () &#123;</span><br><span class="line">        this.s2++;</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">&#125;</span><br><span class="line">let timer = new Timer();</span><br><span class="line">setInterval(() =&gt; console.log(`s1: $&#123;timer.s1&#125;`), 2000)</span><br><span class="line">setInterval(() =&gt; console.log(`s2: $&#123;timer.s2&#125;`), 2000)</span><br><span class="line">// s1: 1 s2: 0 ---- s1: 3 s2: 0 ---- s1: 5 s2: 0</span><br><span class="line"></span><br><span class="line">var arr = [1, 2, 3].forEach((x) =&gt; &#123;</span><br><span class="line">    console.log(x); // 1 2 3</span><br><span class="line">&#125;)</span><br><span class="line">console.log(arr); // undefined</span><br><span class="line"></span><br><span class="line">var newarr = [1, 2, 3].map((x) =&gt; &#123;</span><br><span class="line">    return x * 2</span><br><span class="line">&#125;)</span><br><span class="line">console.log(newarr); // [ 2, 4, 6 ]</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>CommonJS 模块：</strong><ul>
<li>导出：通过 moudle.exports &#x3D; obj; 导出一个对象，moudle.exports &#x3D; {add, subtract} 导出多个对象</li>
<li>引入：使用 require(‘模块路径’) 来引入模块。单个导出的引入直接调用，多个导出的引入通过对象成员来调用</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function add(a, b) &#123;</span><br><span class="line">    return a + b;</span><br><span class="line">&#125;</span><br><span class="line">module.exports = add;  // 导出单个函数</span><br><span class="line"></span><br><span class="line">const add = require(&#x27;./math&#x27;);  // 引入单个导出的函数</span><br><span class="line">console.log(add(2, 5));  // 输出 7</span><br><span class="line"></span><br><span class="line">function add(a, b) &#123;</span><br><span class="line">    return a + b;</span><br><span class="line">&#125;</span><br><span class="line">function subtract(a, b) &#123;</span><br><span class="line">    return a - b;</span><br><span class="line">&#125;</span><br><span class="line">module.exports = &#123; add, subtract &#125;;  // 导出多个函数</span><br><span class="line"></span><br><span class="line">const math = require(&#x27;./math&#x27;);  // 引入包含多个导出的对象</span><br><span class="line">console.log(math.add(2, 5));  // 输出 7</span><br><span class="line">console.log(math.subtract(5, 2));  // 输出 3</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>计算属性名：</strong>在对象字面量中，可以使用方括号 [] 来动态地计算属性名</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">let boss = &#x27;DTA Boss&#x27;;</span><br><span class="line"></span><br><span class="line">const DTA = &#123;</span><br><span class="line">    &#x27;employee&#x27;: &#x27;bxl&#x27;,</span><br><span class="line">    [boss]: &#x27;xfblog&#x27;,</span><br><span class="line">    [&#x27;do&#x27; + &#x27;work&#x27;]() &#123;</span><br><span class="line">        return &#x27;work&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">console.log(DTA.employee); // bxl</span><br><span class="line">console.log(DTA[&#x27;DTA Boss&#x27;]); // xfblog</span><br><span class="line">console.log(DTA.dowork()); // work</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>对象扩展运算符 … ：</strong>用于取出参数对象的所有可遍历属性，拷贝到当前对象之中，与 Object.assign 作用一样</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const NewDAT1 = &#123; ...DTA &#125;</span><br><span class="line">console.log(NewDAT1); // &#123; employee: &#x27;bxl&#x27;, &#x27;DTA Boss&#x27;: &#x27;xfblog&#x27;, dowork: [Function: dowork] &#125;</span><br><span class="line">const NewDAT2 = Object.assign(&#123;&#125;, DTA)</span><br><span class="line">console.log(NewDAT2); // &#123; employee: &#x27;bxl&#x27;, &#x27;DTA Boss&#x27;: &#x27;xfblog&#x27;, dowork: [Function: dowork] &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>链判断运算符 ?. 和 null 判断运算符 ??：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const person = &#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">        age: &#123;</span><br><span class="line">            sex: 0</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 如果把??换成||，那么前面的值是存在的，但是为0，就会被判断为false，就会输出 1</span><br><span class="line">// ??只有当某个值是null或undefined时，才会输出默认值</span><br><span class="line">console.log(person?.name?.age?.sex ?? &#x27;1&#x27;); // 0</span><br></pre></td></tr></table></figure>

<h2 id="二、JS-语法补充"><a href="#二、JS-语法补充" class="headerlink" title="二、JS 语法补充"></a>二、JS 语法补充</h2><h3 id="1-完全拷贝对象"><a href="#1-完全拷贝对象" class="headerlink" title="1. 完全拷贝对象"></a>1. 完全拷贝对象</h3><blockquote>
<ol>
<li>﻿确保拷贝后的对象，与原对象具有同样的原型</li>
<li>﻿确保拷贝后的对象，与原对象具有同样的实例属性</li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function copyObject(orig) &#123;</span><br><span class="line">    return Object.create(</span><br><span class="line">        Object.getPrototypeOf(orig),</span><br><span class="line">        Object.getOwnPropertyDescriptors(orig)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-内部函数导出"><a href="#2-内部函数导出" class="headerlink" title="2. 内部函数导出"></a>2. 内部函数导出</h3><ul>
<li><strong>目的：</strong>在局部作用域中想要导出一个函数</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var temp;</span><br><span class="line"></span><br><span class="line">!(function () &#123;</span><br><span class="line">    console.log(&quot;自执行方法...&quot;)</span><br><span class="line"></span><br><span class="line">    function test() &#123;</span><br><span class="line">        console.log(&#x27;123&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">    // 将内部函数的引用赋值给全局变量temp</span><br><span class="line">    temp = test</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line">temp()  // 123</span><br></pre></td></tr></table></figure>

<h3 id="3-置空方法"><a href="#3-置空方法" class="headerlink" title="3. 置空方法"></a>3. 置空方法</h3><ul>
<li><strong>置空方法：</strong>在 JavaScript 中，要将一个变量或对象的值置为空（或清空），可以使用不同的方法将其设置为何种类型的空值<ol>
<li><strong>将变量设置为 null 或 undefined：</strong><code>var myVariable = null;</code> 或者 <code>myVariable = undefined;</code></li>
<li><strong>清空数组：</strong><code>var myArray = [];</code> 或者 <code>myArray.length = 0;</code></li>
<li><strong>清空对象：</strong><code>var myObject = &#123;&#125;;</code> 或者删除对象的属性</li>
<li><strong>清空字符串：</strong><code>var myString = &quot;&quot;;</code></li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function hello() &#123;</span><br><span class="line">    console.log(&#x27;hello&#x27;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 置空方法就是给一个方法赋值一个空方法，同时可以接受参数执行一次</span><br><span class="line">setTimeout = function (res) &#123;</span><br><span class="line">    res()</span><br><span class="line">&#125;</span><br><span class="line">setTimeout(hello, 3000)</span><br></pre></td></tr></table></figure>

<h3 id="4-json-数据的处理"><a href="#4-json-数据的处理" class="headerlink" title="4. json 数据的处理"></a>4. json 数据的处理</h3><ul>
<li><strong>js 处理 json 数据的方法：</strong><ul>
<li><strong>JSON.parse()：</strong>用于将 JSON 字符串解析为 JavaScript 对象</li>
<li><strong>JSON.stringify()：</strong>用于将 JavaScript 对象转换为 JSON 字符串</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var jsonString = &#x27;&#123;&quot;key&quot;: &quot;value&quot;, &quot;number&quot;: 42&#125;&#x27;;</span><br><span class="line">console.log(typeof jsonString);  // string</span><br><span class="line"></span><br><span class="line">var jsonObject = JSON.parse(jsonString);</span><br><span class="line">console.log(typeof jsonObject);  // object</span><br><span class="line"></span><br><span class="line">var jsonStrings = JSON.stringify(jsonObject)</span><br><span class="line">console.log(typeof jsonStrings);  // string</span><br></pre></td></tr></table></figure>

<h3 id="5-定时器详解"><a href="#5-定时器详解" class="headerlink" title="5. 定时器详解"></a>5. 定时器详解</h3><blockquote>
<p><strong>运行机制：</strong>定时器的运行机制是将指定的代码移出本轮事件循环，等到下一轮事件循环，再检查是否到了指定时间，如果到了就执行代码，否则继续等待。这意味着指定的回调函数，必须等到本轮事件循环的所有同步任务都执行完，才会开始执行；由于前面的任务到底需要多少时间执行完，是不确定的，所以没有办法保证 setTimeout 和 setInterval 指定的任务一定会按照预定的时间执行。</p>
<p><strong>思考：<code>setTimeout(f, 0)</code> 会立即执行吗？不会，要先执行完同步代码，才会执行异步代码。</strong></p>
</blockquote>
<ul>
<li><p><strong>setTimeout：</strong>用来指定某个函数或某段代码，在多少毫秒之后执行，返回一个整数，表示定时器的编号，可以通过编号取消这个定时器</p>
<ul>
<li><strong>语法：</strong>function setTimeout(callback, ms, …args)</li>
</ul>
<ul>
<li><strong>this 指针：</strong>﻿如果回调函数是对象的方法，那么 setTimeout 使得方法内部的 this 关键字将指向全局环境，而不是定义时所在的那个对象</li>
<li><strong>解决 this 指针指向：</strong>一是在对象的方法调用外层套上一个函数；二是使用 bind 方法直接绑定对应对象</li>
</ul>
</li>
<li><p><strong>setInterval：</strong>用法与 setTimeout 完全一致，区别仅在于 setInterval 指是某个任务每隔一段时间就执行一次，也就是无限次的定时执行</p>
<ul>
<li><strong>注意：</strong>setlnterval 指定的是<strong>开始执行</strong>之间的间隔，并不考虑每次任务执行本身所消耗的时间。因此实际上，两次执行之间的间隔会小于指定的时间。比如，setlnterval 指定每 100ms 执行一次，每次执行需要 5ms，那么第一次执行结束后 95 毫秒，第二次执行就会开始。如果某次执行耗时特别长，超过了间隔时间，那么这一次结束后，下一次执行就会立即开始</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 一定要隔多久执行一次任务，可以使用嵌套 setTimeout</span><br><span class="line">let i = 1;</span><br><span class="line">setTimeout(function f() &#123;</span><br><span class="line">    console.log(123);</span><br><span class="line">    setTimeout(f, 2000);</span><br><span class="line">&#125;, 2000);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>clearTimeout()，clearInterval() 特性：</strong><ul>
<li>setTimeout 和 setlnterval 函数，都返回一个整数值，表示计数器编号。将该整数传入 clearTimeout 和 clearlnterval 函数，就可以取消对应的定时器。<strong>特点就是返回的整数值是连续增大的</strong>，﻿﻿利用这一点，可以写一个函数，取消当前所有的 setTimeout 定时器（可以过一些检测）</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">setInterval(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;叽里呱啦......&quot;);</span><br><span class="line">&#125;, 0);</span><br><span class="line">setInterval(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;叽里呱啦......&quot;);</span><br><span class="line">&#125;, 0);</span><br><span class="line">setInterval(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;叽里呱啦......&quot;);</span><br><span class="line">&#125;, 0);</span><br><span class="line">(function () &#123;</span><br><span class="line">    let gid = setInterval(clearAllTimeouts, 0);</span><br><span class="line">    console.log(gid);</span><br><span class="line">    function clearAllTimeouts() &#123;</span><br><span class="line">        let id = setTimeout(function () &#123; &#125;, 0);</span><br><span class="line">        while (id &gt; 0) &#123;</span><br><span class="line">            if (id !== gid) &#123;</span><br><span class="line">                clearTimeout(id);</span><br><span class="line">            &#125;</span><br><span class="line">            id--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h2 id="三、JS-异步操作"><a href="#三、JS-异步操作" class="headerlink" title="三、JS 异步操作"></a>三、JS 异步操作</h2><blockquote>
<p><strong>背景：</strong>js 是单线程模型，除了一个正在运行的主线程，引擎还提供了一个任务队列（task queue），存储当前需要处理的异步任务</p>
<p><strong>异步：</strong>异步的核心在于不需要等待上一个操作完成才能执行下一个操作，它允许多个操作并发进行。在 js 中，异步处理可以通过 Promise、async&#x2F;await、callback 等实现，特别是在 <strong>Ajax</strong> 请求中，异步处理非常重要</p>
<ul>
<li><strong>传统的回调函数（回调地狱）：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    url: &#x27;https://api.example.com/data1&#x27;,</span><br><span class="line">    success: function(response1) &#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url: &#x27;https://api.example.com/data2&#x27;,</span><br><span class="line">            success: function(response2) &#123;</span><br><span class="line">                console.log(response1, response2);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Promise 链式处理：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">axios.get(&#x27;https://api.example.com/data1&#x27;)</span><br><span class="line">    .then(response1 =&gt; &#123;</span><br><span class="line">        console.log(response1.data);</span><br><span class="line">        return axios.get(&#x27;https://api.example.com/data2&#x27;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(response2 =&gt; &#123;</span><br><span class="line">        console.log(response2.data);</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(error =&gt; &#123;</span><br><span class="line">        console.error(error);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="1-XHR-对象"><a href="#1-XHR-对象" class="headerlink" title="1. XHR 对象"></a>1. XHR 对象</h3><blockquote>
<p><strong>XMLHttpRequest</strong>（简称XHR）：是浏览器中用于与服务器进行交互的API，允许网页在不重新加载页面的情况下请求数据</p>
</blockquote>
<ul>
<li><strong>功能：</strong>提供了基础的异步通信能力，用来发送 HTTP 请求并接收响应，能够异步更新网页内容</li>
<li><strong>特点：</strong><ul>
<li>支持同步和异步请求，但通常使用异步请求</li>
<li>可以发送各种格式的数据，如XML、JSON、文本等</li>
<li>可以监听不同的事件，如 onreadystatechange，当请求状态改变时触发</li>
</ul>
</li>
</ul>
<ul>
<li><strong>缺点：</strong>代码复杂且容易产生回调地狱（嵌套的回调函数），可读性较差</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">function AJAX() &#123;</span><br><span class="line">    this.request = function (method, url, async, string, func) &#123;</span><br><span class="line">        // 创建 XMLHttpRequest 对象</span><br><span class="line">        var xhr = new XMLHttpRequest();</span><br><span class="line">        // 设置请求参数：使用 open 方法设置请求的类型、请求的url、是否异步处理</span><br><span class="line">        xhr.open(method, url, async);</span><br><span class="line">        // 处理状态变化：通过监听 readystatechange 事件，可以获取到 XHR 对象的状态变化</span><br><span class="line">        xhr.onreadystatechange = function () &#123;</span><br><span class="line">            // 处理响应数据：responseText 用于处理文本响应，responseXML 用于处理 XML 响应</span><br><span class="line">            if (xhr.readyState == 4 &amp;&amp; xhr.status == 200) &#123;</span><br><span class="line">                /** readyState</span><br><span class="line">                * 0: 请求（未初始化）还没有调用send()方法</span><br><span class="line">                * 1: 请求连接已建立（载入）已调用send()方法，正在发送请求</span><br><span class="line">                * 2: 请求已接收（载入完成）send()方法执行完成，刚刚接收到全部响应内容</span><br><span class="line">                * 3: 请求处理中（交互）正在解析响应内容</span><br><span class="line">                * 4: 请求已完成（完成）响应内容解析完成</span><br><span class="line">                */</span><br><span class="line">                var responseData = xhr.responseText;</span><br><span class="line">                func(responseData);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        // 发送请求：对于GET请求，不需要传递参数；对于POST请求，可以在 send 方法中传递请求体的数据</span><br><span class="line">        xhr.send(string);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var ajax = new AJAX();</span><br><span class="line">var api_url = &#x27;https://xfblog.cn:5000/test&#x27;;</span><br><span class="line">ajax.request(&#x27;GET&#x27;, api_url, true, &#x27;&#x27;, function (data) &#123;</span><br><span class="line">    console.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="2-ajax-技术"><a href="#2-ajax-技术" class="headerlink" title="2. ajax 技术"></a>2. ajax 技术</h3><blockquote>
<p><strong>AJAX</strong>（Asynchronous JavaScript and XML）<strong>：</strong>是一种用于在网页不刷新或重新加载的情况下，异步获取和发送数据的技术</p>
<p><strong>同源策略：</strong>AJAX 受到同源策略的限制，即只能从相同的协议、域名和端口发起请求</p>
</blockquote>
<ul>
<li><p><strong>功能：</strong>ajax 的核心是 xhr 对象，通过异步的方式与服务器通信，动态更新页面内容</p>
</li>
<li><p><strong>特点：</strong></p>
<ul>
<li>可以加载部分内容，不需要刷新整个页面，从而提高用户体验</li>
<li>不依赖 XML，通常使用 json</li>
</ul>
</li>
<li><p><strong>组成：</strong></p>
<ul>
<li>使用 JavaScript 来操作 XHR 对象进行 HTTP 请求</li>
<li>可以与 HTML、CSS、JavaScript 结合使用，创建动态交互式的 Web 应用</li>
</ul>
</li>
<li><p><strong>缺点：</strong>可能产生回调嵌套问题（回调地狱）</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// jquery 框架中的 $.ajax() 方法</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    // 1. url 请求地址</span><br><span class="line">    url: &#x27;&#x27;,</span><br><span class="line">    // 2. type 请求方式，默认是&#x27;GET&#x27;，常用的还有&#x27;POST&#x27;</span><br><span class="line">    type: &#x27;GET&#x27;,</span><br><span class="line">    // 3. dataType 设置返回的数据格式，常用的是&#x27;json&#x27;格式</span><br><span class="line">    dataType: &#x27;JSON&#x27;,</span><br><span class="line">    // 4. data 设置发送给服务器的数据, 没有参数不需要设置</span><br><span class="line">    data: &#x27;&#x27;,</span><br><span class="line">    // 5. success/done/then 设置请求成功后的回调函数，</span><br><span class="line">    success: function (response) &#123;</span><br><span class="line">        console.log(response);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 6. error/faile 设置请求失败后的回调函数</span><br><span class="line">    error: function () &#123;</span><br><span class="line">        alert(&quot;请求失败，请稍后再试！&quot;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 7. async 设置是否异步，默认值是&#x27;true&#x27;，表示异步，一般不用写</span><br><span class="line">    async: true</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="3-Promise-对象"><a href="#3-Promise-对象" class="headerlink" title="3. Promise 对象"></a>3. Promise 对象</h3><blockquote>
<p><strong>Promise：是一种用来处理异步操作的对象，也是一个构造函数，它代表了一个异步操作的最终完成或失败</strong></p>
<ul>
<li><p><strong>Promise 对象的状态：</strong></p>
<ul>
<li><strong>Pending（进行中）</strong>：等待中，或者进行中，表示还没有得到结果</li>
<li><strong>resolved、Fulfilled（已成功）</strong>：已经完成，表示得到了我们想要的结果，可以继续往下执行</li>
<li><strong>Rejected（已失败）</strong>：得到结果，但是由于结果并非我们所愿，因此拒绝执行</li>
</ul>
</li>
<li><p><strong>状态的变化途径（只有两种）：</strong>从 pedding 未完成到 fulfilled 成功；从 pedding 未完成到 rejected 失败</p>
</li>
</ul>
<p><strong>调用栈与事件循环：</strong>在 js 中，所有的代码执行都是在一个单线程上进行的，这个线程包含了一个调用栈和一个事件循环。调用栈（call stack）用来存储函数调用的栈结构，而事件循环（event loop）则负责处理异步操作和事件处理。当执行一个 Promise 异步操作时，该操作会被推到事件队列中，等待调用栈中的代码执行完成后再执行。这种机制确保了 js 在处理异步操作时不会阻塞其他代码的执行。</p>
<p><strong>微任务执行机制：</strong>Promise 的回调函数不是正常的异步任务，而是 microtask 微任务。微任务的执行时间一定早于正常的回调函数，因为正常异步任务会追加到下一轮事件循环，而微任务会追加到本轮事件循环。所以 .then 回调函数的执行时间一定早于 setTimeout(fn, 0)。</p>
</blockquote>
<ul>
<li><p><strong>基础语法：<code> new Promise(function(resolve, reject) &#123; &#125;);</code></strong></p>
<ol>
<li>Promise 构造函数接受一个函数为参数，函数拥有 resolve 和 reject 两个参数，由 js 引擎提供不用部署</li>
<li>Promise 的参数在构造之后会直接被<strong>异步运行</strong>，即起始函数，异步任务执行成功时调用 resolve 返回结果</li>
<li>Promise 对象的 then 方法用来处理成功时响应的数据，catch 方法用来接受处理失败时响应的数据</li>
</ol>
</li>
<li><p><strong>resolve 函数：</strong>将 Promise 对象的状态设置为成功，从 pending 变为 resolved，在异步操作成功的时候调用，并将异步操作结果作为参数传递出去</p>
</li>
<li><p><strong>reject 函数：</strong>将 Promise 对象的状态设置为失败，从 pending 变为 rejected，在异步操作失败的时候调用，并将异步操作抛出的异常作为参数传递出去</p>
</li>
<li><p><strong>Promise.prototype.then()：</strong>对于 Promise 对象，可以使用 then 方法分别指定 resolved 和 rejected 状态的回调函数</p>
<ul>
<li><p><strong>返回值：</strong>返回一个新的 Promise 实例，所以可以采用链式写法，即 then 方法再调用一个 then 方法</p>
</li>
<li><p><strong>注意：如果 .then 中写了参数而不是函数，则会变成 Promise 穿透</strong></p>
</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">const p = new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    resolve(&quot;成功&quot;);</span><br><span class="line">&#125;);</span><br><span class="line">const results = p.then(</span><br><span class="line">    (res) =&gt; &#123;</span><br><span class="line">        console.log(&quot;第一次:&quot;, res); // 第一次: 成功</span><br><span class="line">        // return 6</span><br><span class="line">        // 这里的是否有返回值决定了第二次 .then 中处理成功的回调函数是否能接收到有效参数</span><br><span class="line">    &#125;,</span><br><span class="line">    (rej) =&gt; &#123;</span><br><span class="line">        console.log(rej); // 不执行</span><br><span class="line">    &#125;</span><br><span class="line">).then(</span><br><span class="line">    (res) =&gt; &#123;</span><br><span class="line">        console.log(&quot;第二次:&quot;, res); // 第二次: undefined</span><br><span class="line">        // 原因：因为第一个 .then 中处理 resolved 状态的回调函数中成功没有给返回值，</span><br><span class="line">        // 所以在第二个 .then 中剥离掉 promise，拿到的 results 就是 undefined</span><br><span class="line"></span><br><span class="line">        console.log(&quot;异步:&quot;, results); // 异步: Promise &#123; &lt;pending&gt; &#125;</span><br><span class="line">        // 原因：因为这里执行时，results 虽然已经定义，但因为 .then 链是异步的，</span><br><span class="line">        // results 还是处于 pending 状态，直到所有的 then 回调都执行完毕后才会变成 fulfilled</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">// 这个是最先打印，所以执行这里的时候，显示还是在 pending 状态</span><br><span class="line">console.log(&quot;单线程:&quot;, results); // 单线程: Promise &#123; &lt;pending&gt; &#125;</span><br><span class="line"></span><br><span class="line">// *********************** Promise 穿透 ************************</span><br><span class="line">const pp = new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    resolve(&quot;成功&quot;);</span><br><span class="line">&#125;);</span><br><span class="line">const result = pp.then(Promise.resolve(&quot;传不过去&quot;)); // 不是函数</span><br><span class="line">result.then((res) =&gt; &#123;</span><br><span class="line">    console.log(res); // 成功</span><br><span class="line">    console.log(result) // Promise &#123; &#x27;成功&#x27; &#125;</span><br><span class="line">&#125;);</span><br><span class="line">// 相当于以下这种写法</span><br><span class="line">pp.then(null).then((res) =&gt; &#123;</span><br><span class="line">    console.log(res); // 成功</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Promise.prototype.catch()：</strong>用于注册在 Promise 对象拒绝（rejected）时的回调函数，同 .then 中的第二个参数的作用，两者可以同时存在，前者捕获异常则后者不会执行<ul>
<li><strong>冒泡性质：</strong>若 .then 中产生异常则能在 .catch 或者下一个 .then 中捕获。.then 的第二个参数和 .catch 本质上是没有区别的，但也需要分场合使用，一般异常用 .catch，拒绝状态用 .then</li>
<li><strong>注意：</strong>异常一旦被捕获，则后面中的 .then 不管多少，都不会执行。一般是在最后写 .catch 去捕获异常，而不会一层层 rejected 回调函数，这样代码可读性更高，且能捕获到上面最先报错的信息</li>
</ul>
</li>
<li><strong>Promise.prototype.finally()：</strong>用于清理和最终处理逻辑，回调函数不接受任何参数，且是否执行与 Promise 状态无关</li>
<li><strong>案例1：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">// 第一层：获取用户信息</span><br><span class="line">function getUserInfo(userId) &#123;</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        // 模拟异步操作，获取用户信息</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            const userInfo = &#123;</span><br><span class="line">                id: userId,</span><br><span class="line">                name: &quot;John Doe&quot;,</span><br><span class="line">                email: &quot;johndoe@example.com&quot;</span><br><span class="line">            &#125;;</span><br><span class="line">            resolve(userInfo);</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 第二层：获取用户订单列表</span><br><span class="line">function getUserOrders(userId) &#123;</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        // 模拟异步操作，获取用户订单列表</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            const orders = [</span><br><span class="line">                &#123;id: 1, product: &quot;Product A&quot;&#125;,</span><br><span class="line">                &#123;id: 2, product: &quot;Product B&quot;&#125;,</span><br><span class="line">                &#123;id: 3, product: &quot;Product C&quot;&#125;</span><br><span class="line">            ];</span><br><span class="line">            resolve(orders);</span><br><span class="line">        &#125;, 2000);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 第三层：获取订单详情</span><br><span class="line">function getOrderDetails(orderId) &#123;</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        // 模拟异步操作，获取订单详情</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            const orderDetails = &#123;</span><br><span class="line">                id: orderId,</span><br><span class="line">                status: &quot;Delivered&quot;,</span><br><span class="line">                address: &quot;123 Main St&quot;</span><br><span class="line">            &#125;;</span><br><span class="line">            resolve(orderDetails);</span><br><span class="line">        &#125;, 1500);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 应用示例</span><br><span class="line">const userId = 123;</span><br><span class="line"></span><br><span class="line">getUserInfo(userId)</span><br><span class="line">    .then(userInfo =&gt; &#123;</span><br><span class="line">        console.log(&quot;User Info:&quot;, userInfo);</span><br><span class="line">        return getUserOrders(userInfo.id);</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(orders =&gt; &#123;</span><br><span class="line">        console.log(&quot;User Orders:&quot;, orders);</span><br><span class="line">        const orderId = orders[0].id;</span><br><span class="line">        return getOrderDetails(orderId);</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(orderDetails =&gt; &#123;</span><br><span class="line">        console.log(&quot;Order Details:&quot;, orderDetails);</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(error =&gt; &#123;</span><br><span class="line">        console.error(&quot;Error:&quot;, error);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">console.log(&quot;后续操作！！！&quot;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>案例2：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">function fetchData(url) &#123;</span><br><span class="line">    return new Promise(function (resolve, reject) &#123;</span><br><span class="line">        var xhr = new XMLHttpRequest();</span><br><span class="line">        xhr.open(&#x27;GET&#x27;, url);</span><br><span class="line">        xhr.onload = function () &#123;</span><br><span class="line">            if (xhr.status === 200) &#123;</span><br><span class="line">                resolve(xhr.responseText);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                reject(Error(xhr.statusText));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        xhr.onerror = function () &#123;</span><br><span class="line">            reject(Error(&#x27;Network Error&#x27;));</span><br><span class="line">        &#125;;</span><br><span class="line">        xhr.send();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 调用fetchData()函数并处理Promise对象的结果</span><br><span class="line">fetchData(&#x27;https://xfblog.cn:5000/test&#x27;).then(function (response) &#123;</span><br><span class="line">    // 如果Promise对象成功解决，执行这里的代码</span><br><span class="line">    var data = JSON.parse(response)</span><br><span class="line">    console.log(&quot;result_data：&quot;, data)</span><br><span class="line"></span><br><span class="line">&#125;).catch(function (error) &#123;</span><br><span class="line">    // 如果Promise对象被拒绝，执行这里的代码</span><br><span class="line">    console.log(&#x27;Error loading data:&#x27;, error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="四、补环境-demo"><a href="#四、补环境-demo" class="headerlink" title="四、补环境 demo"></a>四、补环境 demo</h2><h3 id="1-getOwnPropertyDescriptors"><a href="#1-getOwnPropertyDescriptors" class="headerlink" title="1. getOwnPropertyDescriptors"></a>1. getOwnPropertyDescriptors</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var navigator = &#123;</span><br><span class="line">    &quot;platform&quot;: &quot;MacIntel&quot; // 这样补就是错的，会返回true，因为浏览器上 navigator 的属性都是原型继承来的</span><br><span class="line">&#125;</span><br><span class="line">// function Navigator() &#123; &#125;</span><br><span class="line">// Navigator.prototype.constructor.platform = &quot;MacIntel&quot;</span><br><span class="line">// var navigator = new Navigator();</span><br><span class="line">function decect(r, e) &#123;</span><br><span class="line">    var i = [];</span><br><span class="line">    Object[&quot;getOwnPropertyDescriptor&quot;] &amp;&amp; i[&quot;push&quot;](Object[&quot;getOwnPropertyDescriptor&quot;](r, e));</span><br><span class="line">    Object[&quot;getOwnPropertyDescriptors&quot;] &amp;&amp; i[&quot;push&quot;](!!Object[&quot;getOwnPropertyDescriptors&quot;](r)[e]);</span><br><span class="line">    for (var a = 0; a &lt; i[&quot;length&quot;]; a++) if (i[a]) return true;</span><br><span class="line"></span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line">console.log(decect(navigator, &quot;platform&quot;)); // true</span><br></pre></td></tr></table></figure>

<h3 id="2-hook-Date-伪造时间间隔"><a href="#2-hook-Date-伪造时间间隔" class="headerlink" title="2. hook Date 伪造时间间隔"></a>2. hook Date 伪造时间间隔</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">var timeArray = []</span><br><span class="line">for (let i = 0; i &lt; 100; i++) &#123;</span><br><span class="line">    timeArray.push(Math.random() * 1000)</span><br><span class="line">&#125;</span><br><span class="line">// console.log(timeArray);</span><br><span class="line"></span><br><span class="line">function huakuai() &#123;</span><br><span class="line">    // 闭包，timee 初始化只会执行一次，执行时 Date.prototype 原型还没有被修改</span><br><span class="line">    var timee = new Date().getTime()</span><br><span class="line"></span><br><span class="line">    function slide() &#123;</span><br><span class="line">        console.log(new Date().getTime() - timee);</span><br><span class="line">    &#125;</span><br><span class="line">    return slide</span><br><span class="line">&#125;</span><br><span class="line">var hk = huakuai()</span><br><span class="line"></span><br><span class="line">var now = new Date().getTime();</span><br><span class="line">function go(timeArray) &#123;</span><br><span class="line">    for (let i = 0; i &lt; timeArray.length; i++) &#123;</span><br><span class="line">        Date.prototype.getTime = function () &#123;</span><br><span class="line">            return now + timeArray[i]</span><br><span class="line">        &#125;</span><br><span class="line">        hk()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">go(timeArray)</span><br></pre></td></tr></table></figure>

<h3 id="3-hook-Function-绕过反-hook"><a href="#3-hook-Function-绕过反-hook" class="headerlink" title="3. hook Function 绕过反 hook"></a>3. hook Function 绕过反 hook</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">function Navigator() &#123; &#125;</span><br><span class="line">Navigator.prototype.constructor.toString = function () &#123;</span><br><span class="line">    return &#x27;function Navigator() &#123; [native code] &#125;&#x27;</span><br><span class="line">&#125;</span><br><span class="line">var navigator = new Navigator();</span><br><span class="line"></span><br><span class="line">console.log(Function.prototype.toString.call(navigator.constructor)) // function Navigator()&#123;&#125;</span><br><span class="line">/* 原理：</span><br><span class="line">1. 定义 function Navigator()&#123;&#125; 时，Navigator.prototype.constructor 默认会被设置为 Navigator 本身。</span><br><span class="line">因此，navigator.constructor 是 Navigator，而 navigator.constructor.toString() 调用的默认是 Function.prototype.toString 方法。</span><br><span class="line"></span><br><span class="line">2. 通过重写 Navigator.prototype.constructor.toString 并没有改变 Function.prototype.toString 的默认行为，</span><br><span class="line">而是给 Navigator.prototype.constructor 上定义了一个新的 toString 方法。</span><br><span class="line">这意味着只有在显式调用 navigator.constructor.toString() 时，才会返回 &#x27;function Navigator() &#123; [native code] &#125;&#x27;</span><br><span class="line"></span><br><span class="line">3. Function.prototype.toString.call(navigator.constructor) 实际上调用的是 Function.prototype.toString，</span><br><span class="line">返回的是函数本身的字符串表示形式，不会调用 constructor.toString。</span><br><span class="line">换句话说，Function.prototype.toString 是返回函数定义的原始代码形式，而不是通过 toString 方法定制的结果。</span><br><span class="line">因此，它仍然会返回 function Navigator()&#123;&#125;，这是该函数的默认表示形式</span><br><span class="line"></span><br><span class="line">总结：Function.prototype.toString 是一个内置方法，用于返回函数的代码表示，主要用于调试或显示目的，</span><br><span class="line">它会忽略我们在原型链上手动重写的 toString 方法，直接返回函数的代码结构，并不依赖于 toString 方法的覆盖。</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">var oldtostr = Function.prototype.toString;</span><br><span class="line">Function.prototype.toString = function () &#123;</span><br><span class="line">    var res = oldtostr.call(this);</span><br><span class="line">    if (this.name === &quot;Navigator&quot;) &#123;</span><br><span class="line">        console.log(&quot;原始：&quot; + this.name + &#x27; --&gt; toString：&#x27; + res);</span><br><span class="line">        return &quot;function Navigator() &#123; [native code] &#125;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    return res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function checknavigator() &#123;</span><br><span class="line">    return Function.prototype.toString.call(navigator.constructor) === &#x27;function Navigator() &#123; [native code] &#125;&#x27;</span><br><span class="line">    // return navigator.constructor.toString() === &#x27;function Navigator() &#123; [native code] &#125;&#x27;</span><br><span class="line">&#125;</span><br><span class="line">console.log(checknavigator()); // true</span><br><span class="line">console.log(navigator.constructor.toString()); // function Navigator() &#123; [native code] &#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-hook-indexOf-异常堆栈检测"><a href="#4-hook-indexOf-异常堆栈检测" class="headerlink" title="4. hook indexOf 异常堆栈检测"></a>4. hook indexOf 异常堆栈检测</h3><blockquote>
<p>注意：IndexOf 通常用于对异常堆栈的输出内容的检测，通过 Hook 脚本配合 if 判断入参，修改 indexOf 的返回值即可绕过检测（遇到类似 indexOf 这样常用的检测方法，可以 Hook 其调用，通常会打印出一些检测点）</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">let old_indexOf = String.prototype.indexOf;</span><br><span class="line">String.prototype.indexOf = function (args) &#123;</span><br><span class="line">    let res = old_indexOf.call(this, args);</span><br><span class="line">    console.log(`【 indexOf 】--&gt; &quot;$&#123;this&#125;&quot;.indexOf(&quot;$&#123;args&#125;&quot;) --&gt; $&#123;res&#125;`);</span><br><span class="line">    return res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let old_indexOf = String.prototype.indexOf;</span><br><span class="line">String.prototype.indexOf = function (args) &#123;</span><br><span class="line">    let res = old_indexOf.call(this, args);</span><br><span class="line">    let new_res = undefined;</span><br><span class="line">    if (args == &#x27;flight_touch_react&#x27;) &#123;</span><br><span class="line">        new_res = 1;</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(`【 indexOf 】--&gt; &quot;$&#123;this&#125;&quot;.indexOf(&quot;$&#123;args&#125;&quot;) --&gt; $&#123;res&#125; --&gt; 修改返回值：$&#123;new_res&#125;`);</span><br><span class="line">    return new_res ? new_res : res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">【 indexOf 】--&gt; &quot;ReferenceError: a is not defined</span><br><span class="line">    at _0x210380 (eval at doom (/Users/xfblog/Desktop/study/补环境demo/demo2.js:133:21), &lt;anonymous&gt;:1:21735)</span><br><span class="line">    at doom (/Users/xfblog/Desktop/study/补环境demo/demo2.js:134:16)</span><br><span class="line">    at Object.&lt;anonymous&gt; (/Users/xfblog/Desktop/study/补环境demo/demo2.js:139:11)</span><br><span class="line">    at Module._compile (node:internal/modules/cjs/loader:1546:14)</span><br><span class="line">    at Module._extensions..js (node:internal/modules/cjs/loader:1691:10)</span><br><span class="line">    at Module.load (node:internal/modules/cjs/loader:1317:32)</span><br><span class="line">    at Module._load (node:internal/modules/cjs/loader:1127:12)</span><br><span class="line">    at TracingChannel.traceSync (node:diagnostics_channel:315:14)</span><br><span class="line">    at wrapModuleLoad (node:internal/modules/cjs/loader:217:24)</span><br><span class="line">    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:166:5)&quot;.indexOf(&quot;flight_touch_react&quot;) --&gt; -1 --&gt; 修改返回值：1</span><br></pre></td></tr></table></figure>

<h3 id="5-内置-Symbol-环境检测"><a href="#5-内置-Symbol-环境检测" class="headerlink" title="5. 内置 Symbol 环境检测"></a>5. 内置 Symbol 环境检测</h3><blockquote>
<p><strong>Symbol.toPrimitive：</strong>为对象定义一个<strong>原始值转换</strong>方法。这个方法会在对象参与一些类型转换时被调用，比如在对象与字符串或数字进行相加、比较等操作时，通过 Symbol.toPrimitive 指定的函数可以自定义对象如何转换成原始值</p>
<ol>
<li><strong>字符串上下文</strong>：例如字符串拼接操作 <code>object + &quot;string&quot;</code></li>
<li><strong>数字上下文</strong>：例如数值运算操作 <code>object - 0</code></li>
<li><strong>默认上下文</strong>：例如 <code>alert(object)</code> 或者 <code>object == &quot;value&quot;</code></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const obj = &#123;</span><br><span class="line">  [Symbol.toPrimitive](hint) &#123;</span><br><span class="line">    if (hint === &quot;number&quot;) &#123;</span><br><span class="line">      return 42; // 数字上下文中返回 42</span><br><span class="line">    &#125;</span><br><span class="line">    if (hint === &quot;string&quot;) &#123;</span><br><span class="line">      return &quot;Hello&quot;; // 字符串上下文中返回 &quot;Hello&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    return true; // 默认上下文中返回 true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">console.log(+obj);           // 42，数字上下文</span><br><span class="line">console.log(`$&#123;obj&#125;`);       // &quot;Hello&quot;，字符串上下文</span><br><span class="line">console.log(obj + &quot; world&quot;); // &quot;Hello world&quot;，默认上下文</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br></pre></td><td class="code"><pre><span class="line">/* ================================= 补环境区域 START ================================= */</span><br><span class="line">window = global;</span><br><span class="line">exports = undefined;</span><br><span class="line">// ----------------------------------------------------------------------------------</span><br><span class="line">// navigator[Symbol.toStringTag] --&gt; Navigator.prototype[Symbol.toStringTag] --&gt; &#x27;Navigator&#x27;</span><br><span class="line">// 属性描述符：Object.getOwnPropertyDescriptor(Navigator.prototype, Symbol.toStringTag)</span><br><span class="line">function Navigator() &#123; &#125;</span><br><span class="line">Object.defineProperties(Navigator.prototype, &#123;</span><br><span class="line">	[Symbol.toStringTag]: &#123;</span><br><span class="line">		&quot;value&quot;: &quot;Navigator&quot;,</span><br><span class="line">		&quot;writable&quot;: false,</span><br><span class="line">		&quot;enumerable&quot;: false,</span><br><span class="line">		&quot;configurable&quot;: true</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;);</span><br><span class="line">navigator = new Navigator();</span><br><span class="line"></span><br><span class="line">// window[Symbol.toStringTag] --&gt; Window.prototype[Symbol.toStringTag] --&gt; &#x27;Window&#x27;</span><br><span class="line">Object.defineProperties(global, &#123;</span><br><span class="line">	[Symbol.toStringTag]: &#123;</span><br><span class="line">		&quot;value&quot;: &quot;Window&quot;,</span><br><span class="line">		&quot;writable&quot;: false,</span><br><span class="line">		&quot;enumerable&quot;: false,</span><br><span class="line">		&quot;configurable&quot;: true</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var Document = function () &#123; &#125;</span><br><span class="line">// function Document() &#123; &#125;</span><br><span class="line">Document.prototype[Symbol.toStringTag] = &quot;Document&quot;;</span><br><span class="line">// typeof HTMLDocument --&gt; &#x27;function&#x27;</span><br><span class="line">function HTMLDocument() &#123; &#125;</span><br><span class="line">// HTMLDocument 构造函数的原型并没有自定义的 Symbol.toStringTag 属性，</span><br><span class="line">// 因此 document 对象继承了默认的 Object.prototype.toString，输出为 [object Object]</span><br><span class="line">HTMLDocument.prototype[Symbol.toStringTag] = &quot;HTMLDocument&quot;;</span><br><span class="line"></span><br><span class="line">Object.setPrototypeOf(HTMLDocument.prototype, Document.prototype);</span><br><span class="line">document = Object.setPrototypeOf(&#123;&#125;, HTMLDocument.prototype);</span><br><span class="line">// ----------------------------------------------------------------------------------</span><br><span class="line">!(function getEnvironment(proxyArray) &#123;</span><br><span class="line">	function getObjhandler(proxyName) &#123;</span><br><span class="line">		return &#123;</span><br><span class="line">			get(target, property, receiver) &#123;</span><br><span class="line">				if (target[property] instanceof Object) &#123;</span><br><span class="line">					console.log(`【 get 】--&gt; $&#123;proxyName&#125;.$&#123;String(property)&#125; --&gt; $&#123;typeof target[property]&#125;`);</span><br><span class="line">					return new Proxy(target[property], getObjhandler(`$&#123;proxyName&#125;.$&#123;String(property)&#125;`));</span><br><span class="line">				&#125;</span><br><span class="line">				if (typeof property == &#x27;symbol&#x27;) &#123;</span><br><span class="line">					console.log(`【 get 】--&gt; $&#123;proxyName&#125;.$&#123;String(property)&#125; --&gt; $&#123;target[property]&#125;`);</span><br><span class="line">					return Reflect.get(...arguments);</span><br><span class="line">				&#125;</span><br><span class="line">				console.log(`【 get 】--&gt; $&#123;proxyName&#125;.$&#123;String(property)&#125; --&gt; $&#123;typeof target[property]&#125;`);</span><br><span class="line">				try &#123;</span><br><span class="line">					return Reflect.get(...arguments);</span><br><span class="line">				&#125; catch (error) &#123;</span><br><span class="line">					console.error(`【异常捕获】--&gt; $&#123;proxyName&#125;.$&#123;String(property)&#125; --&gt; $&#123;target[property]&#125;: \n$&#123;error.message&#125; --------`);</span><br><span class="line">					if (property == &quot;userAgent&quot;) &#123;</span><br><span class="line">						return &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot;</span><br><span class="line">					&#125;</span><br><span class="line">					// 根据业务逻辑返回默认值或进行其他处理</span><br><span class="line">					return target[property];  // 或者其他合适的默认值</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			set(target, property, value, receiver) &#123;</span><br><span class="line">				console.log(`【 set 】--&gt; $&#123;proxyName&#125;.$&#123;String(property)&#125; --&gt; $&#123;typeof value&#125; --&gt; $&#123;value&#125;`);</span><br><span class="line">				return Reflect.set(...arguments);</span><br><span class="line">			&#125;,</span><br><span class="line">			has(target, propKey) &#123;</span><br><span class="line">				console.log(`【 has 】--&gt; [$&#123;String(propKey)&#125;] in [$&#123;proxyName&#125;] --&gt; $&#123;Reflect.has(...arguments)&#125;`);</span><br><span class="line">				return Reflect.has(...arguments);</span><br><span class="line">			&#125;,</span><br><span class="line">			deleteProperty(target, propKey) &#123;</span><br><span class="line">				console.log(`【 deleteProperty 】--&gt; delete [$&#123;String(propKey)&#125;] from [$&#123;proxyName&#125;] --&gt; $&#123;Reflect.deleteProperty(...arguments)&#125;`);</span><br><span class="line">				return Reflect.deleteProperty(...arguments);</span><br><span class="line">			&#125;,</span><br><span class="line">			getOwnPropertyDescriptor(target, propKey) &#123;</span><br><span class="line">				console.log(`【 getOwnPropertyDescriptor 】--&gt; ($&#123;proxyName&#125;, &quot;$&#123;String(propKey)&#125;&quot;) --&gt; $&#123;JSON.stringify(Reflect.getOwnPropertyDescriptor(...arguments))&#125;`);</span><br><span class="line">				return Reflect.getOwnPropertyDescriptor(...arguments);</span><br><span class="line">			&#125;,</span><br><span class="line">			defineProperty(target, propKey, propDesc) &#123;</span><br><span class="line">				console.log(`【 defineProperty 】--&gt; $&#123;proxyName&#125;.$&#123;String(propKey)&#125; --&gt; $&#123;JSON.stringify(propDesc)&#125; --&gt; $&#123;Reflect.defineProperty(...arguments)&#125;`);</span><br><span class="line">				return Reflect.defineProperty(...arguments);</span><br><span class="line">			&#125;,</span><br><span class="line">			preventExtensions(target) &#123;</span><br><span class="line">				console.log(`【 preventExtensions 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;Reflect.preventExtensions(...arguments)&#125;`);</span><br><span class="line">				return Reflect.preventExtensions(...arguments);</span><br><span class="line">			&#125;,</span><br><span class="line">			isExtensible(target) &#123;</span><br><span class="line">				console.log(`【 isExtensible 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;Reflect.isExtensible(...arguments)&#125;`);</span><br><span class="line">				return Reflect.isExtensible(...arguments);</span><br><span class="line">			&#125;,</span><br><span class="line">			getPrototypeOf(target) &#123;</span><br><span class="line">				console.log(`【 getPrototypeOf 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;Reflect.getPrototypeOf(...arguments)&#125;`);</span><br><span class="line">				return Reflect.getPrototypeOf(...arguments);</span><br><span class="line">			&#125;,</span><br><span class="line">			setPrototypeOf(target, proto) &#123;</span><br><span class="line">				console.log(`【 setPrototypeOf 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;JSON.stringify(proto)&#125; --&gt; $&#123;Reflect.setPrototypeOf(...arguments)&#125;`);</span><br><span class="line">				return Reflect.setPrototypeOf(...arguments);</span><br><span class="line">			&#125;,</span><br><span class="line">			ownKeys(target) &#123;</span><br><span class="line">				console.log(`【 ownKeys 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;JSON.stringify(Reflect.ownKeys(...arguments))&#125;`);</span><br><span class="line">				return Reflect.ownKeys(...arguments)</span><br><span class="line">			&#125;,</span><br><span class="line">			apply(target, thisArg, args) &#123;</span><br><span class="line">				console.log(`【 apply 】--&gt; $&#123;proxyName&#125;($&#123;args&#125;) --&gt; $&#123;Reflect.apply(...arguments)&#125;`);</span><br><span class="line">				return Reflect.apply(...arguments)</span><br><span class="line">			&#125;,</span><br><span class="line">			construct(target, args) &#123;</span><br><span class="line">				console.log(`【 construct 】--&gt; new Proxy($&#123;args&#125;) --&gt; $&#123;Reflect.construct(...arguments)&#125;`);</span><br><span class="line">				return Reflect.construct(...arguments)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	proxyArray.forEach(proxyName =&gt; &#123;</span><br><span class="line">		globalThis[proxyName] = new Proxy(globalThis[proxyName] || &#123;&#125;, getObjhandler(proxyName))</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;)([&#x27;window&#x27;, &#x27;document&#x27;, &#x27;location&#x27;, &#x27;navigator&#x27;, &#x27;history&#x27;, &#x27;screen&#x27;]);</span><br><span class="line">// window 在经过代理器设置后，转换为了 Proxy 对象，Object.is(window, globalThis) 检测则为 false</span><br><span class="line">globalThis = window;</span><br><span class="line">/* ================================== 补环境区域 END ================================== */</span><br><span class="line"></span><br><span class="line">var _0x4f2a = [&#x27;xZb4mZK4nti1&#x27;, &#x27;mZa3ndy5u0Xgt2nZ&#x27;, &#x27;mti0nJuWmMnHwLDszq&#x27;, &#x27;ExOWmtiZndu2nW&#x27;, &#x27;mJG3mdLHuuDiwNa&#x27;, &#x27;odKRlW&#x27;, &#x27;BMrVD10&#x27;, &#x27;vvzxwfLAywjJza&#x27;, &#x27;qujdrevg&#x27;, &#x27;oeDjvNbuzW&#x27;, &#x27;w29IAMvJDcboyq&#x27;, &#x27;zhrH&#x27;, &#x27;y29Uy2f0&#x27;, &#x27;xZb4mtm0zMnI&#x27;, &#x27;mJroEML4sg0&#x27;, &#x27;mtaXm2n1BwrtuW&#x27;, &#x27;zNvUy3rPB24&#x27;, &#x27;DMLNyxrVCL0&#x27;, &#x27;mtmWotG2vvDAA2Xt&#x27;, &#x27;mdeYmZq1nJC4oq&#x27;, &#x27;ywjJzgvM&#x27;, &#x27;w29IAMvJDcbxAq&#x27;, &#x27;y2HHCKnVzgvbDa&#x27;, &#x27;nJK0uvHZDLfZ&#x27;, &#x27;Dg9tDhjPBMC&#x27;, &#x27;xZb4ntjLowiX&#x27;, &#x27;y2HHCKf0&#x27;, &#x27;BgvUz3rO&#x27;, &#x27;qujdrevgr0HjsG&#x27;, &#x27;mJe0mvP1zufwBq&#x27;, &#x27;ndq0otL5v1DivMC&#x27;, &#x27;z2v0uhjVDg90Eq&#x27;, &#x27;CMfUzg9T&#x27;];</span><br><span class="line">var _0x3b2a2b = _0x5299;</span><br><span class="line">(function (_0x484f5c, _0x4c9781) &#123;</span><br><span class="line">	var _0x5b5144 = _0x5299;</span><br><span class="line">	while (!![]) &#123;</span><br><span class="line">		try &#123;</span><br><span class="line">			var _0x8f4b64 = parseInt(_0x5b5144(0x1d2)) * -parseInt(_0x5b5144(0x1da)) + -parseInt(_0x5b5144(0x1e1)) * parseInt(_0x5b5144(&#x27;0x1cc&#x27;)) + parseInt(_0x5b5144(&#x27;0x1e6&#x27;)) + -parseInt(_0x5b5144(0x1e5)) + -parseInt(_0x5b5144(0x1e0)) + parseInt(_0x5b5144(&#x27;0x1d5&#x27;)) + -parseInt(_0x5b5144(&#x27;0x1e8&#x27;)) * -parseInt(_0x5b5144(0x1d1));</span><br><span class="line">			if (_0x8f4b64 === _0x4c9781) break; else _0x484f5c[&#x27;push&#x27;](_0x484f5c[&#x27;shift&#x27;]());</span><br><span class="line">		&#125; catch (_0x24a143) &#123;</span><br><span class="line">			_0x484f5c[&#x27;push&#x27;](_0x484f5c[&#x27;shift&#x27;]());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;(_0x4f2a, 0xaa618));</span><br><span class="line">var hexcase = 0x0, b64pad = &#x27;&#x27;, chrsz = 0x8;</span><br><span class="line"></span><br><span class="line">function _0x5299(_0x3d96c8, _0x6e00cb) &#123;</span><br><span class="line">	return _0x5299 = function (_0x4f2a0d, _0x52996e) &#123;</span><br><span class="line">		_0x4f2a0d = _0x4f2a0d - 0x1cb;</span><br><span class="line">		var _0x4419a2 = _0x4f2a[_0x4f2a0d];</span><br><span class="line">		if (_0x5299[&#x27;NuRqdF&#x27;] === undefined) &#123;</span><br><span class="line">			var _0x2ee095 = function (_0x3a9367) &#123;</span><br><span class="line">				var _0x134fcb = &#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=&#x27;;</span><br><span class="line">				var _0x398525 = &#x27;&#x27;, _0x52e9b1 = &#x27;&#x27;;</span><br><span class="line">				for (var _0x2f7fc6 = 0x0, _0x55745b, _0x47055a, _0xdf9aa5 = 0x0; _0x47055a = _0x3a9367[&#x27;charAt&#x27;](_0xdf9aa5++); ~_0x47055a &amp;&amp; (_0x55745b = _0x2f7fc6 % 0x4 ? _0x55745b * 0x40 + _0x47055a : _0x47055a, _0x2f7fc6++ % 0x4) ? _0x398525 += String[&#x27;fromCharCode&#x27;](0xff &amp; _0x55745b &gt;&gt; (-0x2 * _0x2f7fc6 &amp; 0x6)) : 0x0) &#123;</span><br><span class="line">					_0x47055a = _0x134fcb[&#x27;indexOf&#x27;](_0x47055a);</span><br><span class="line">				&#125;</span><br><span class="line">				for (var _0x2853cd = 0x0, _0x4b5792 = _0x398525[&#x27;length&#x27;]; _0x2853cd &lt; _0x4b5792; _0x2853cd++) &#123;</span><br><span class="line">					_0x52e9b1 += &#x27;%&#x27; + (&#x27;00&#x27; + _0x398525[&#x27;charCodeAt&#x27;](_0x2853cd)[&#x27;toString&#x27;](0x10))[&#x27;slice&#x27;](-0x2);</span><br><span class="line">				&#125;</span><br><span class="line">				return decodeURIComponent(_0x52e9b1);</span><br><span class="line">			&#125;;</span><br><span class="line">			_0x5299[&#x27;xuuilA&#x27;] = _0x2ee095, _0x3d96c8 = arguments, _0x5299[&#x27;NuRqdF&#x27;] = !![];</span><br><span class="line">		&#125;</span><br><span class="line">		var _0x1b36c9 = _0x4f2a[0x0], _0x7dadab = _0x4f2a0d + _0x1b36c9, _0x1af7e2 = _0x3d96c8[_0x7dadab];</span><br><span class="line">		return !_0x1af7e2 ? (_0x4419a2 = _0x5299[&#x27;xuuilA&#x27;](_0x4419a2), _0x3d96c8[_0x7dadab] = _0x4419a2) : _0x4419a2 = _0x1af7e2, _0x4419a2;</span><br><span class="line">	&#125;, _0x5299(_0x3d96c8, _0x6e00cb);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let lmd5 = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">function core_md5(_0x2f7fc6, _0x55745b) &#123;</span><br><span class="line">	_0x2f7fc6[_0x55745b &gt;&gt; 0x5] |= 0x80 &lt;&lt; _0x55745b % 0x20, _0x2f7fc6[(_0x55745b + 0x40 &gt;&gt;&gt; 0x9 &lt;&lt; 0x4) + 0xe] = _0x55745b;</span><br><span class="line">	var _0x47055a = 0x67452301, _0xdf9aa5 = -0x10325477, _0x2853cd = -0x67452302, _0x4b5792 = 0x10325476;</span><br><span class="line">	for (var _0xc26d62 = 0x0; _0xc26d62 &lt; _0x2f7fc6[&#x27;length&#x27;]; _0xc26d62 += 0x10) &#123;</span><br><span class="line">		var _0x41dc6f = _0x47055a, _0x1477b2 = _0xdf9aa5, _0x1723b5 = _0x2853cd, _0x3f85d4 = _0x4b5792;</span><br><span class="line">		_0x47055a = md5_ff(_0x47055a, _0xdf9aa5, _0x2853cd, _0x4b5792, _0x2f7fc6[_0xc26d62 + 0x0], 0x7, -0x28955b88), _0x4b5792 = md5_ff(_0x4b5792, _0x47055a, _0xdf9aa5, _0x2853cd, _0x2f7fc6[_0xc26d62 + 0x1], 0xc, -0x173848aa), _0x2853cd = md5_ff(_0x2853cd, _0x4b5792, _0x47055a, _0xdf9aa5, _0x2f7fc6[_0xc26d62 + 0x2], 0x11, 0x242070db), _0xdf9aa5 = md5_ff(_0xdf9aa5, _0x2853cd, _0x4b5792, _0x47055a, _0x2f7fc6[_0xc26d62 + 0x3], 0x16, -0x3e423112), _0x47055a = md5_ff(_0x47055a, _0xdf9aa5, _0x2853cd, _0x4b5792, _0x2f7fc6[_0xc26d62 + 0x4], 0x7, -0xa83f051), _0x4b5792 = md5_ff(_0x4b5792, _0x47055a, _0xdf9aa5, _0x2853cd, _0x2f7fc6[_0xc26d62 + 0x5], 0xc, 0x4787c62a), _0x2853cd = md5_ff(_0x2853cd, _0x4b5792, _0x47055a, _0xdf9aa5, _0x2f7fc6[_0xc26d62 + 0x6], 0x11, -0x57cfb9ed), _0xdf9aa5 = md5_ff(_0xdf9aa5, _0x2853cd, _0x4b5792, _0x47055a, _0x2f7fc6[_0xc26d62 + 0x7], 0x16, -0x2b96aff), _0x47055a = md5_ff(_0x47055a, _0xdf9aa5, _0x2853cd, _0x4b5792, _0x2f7fc6[_0xc26d62 + 0x8], 0x7, 0x698098d8), _0x4b5792 = md5_ff(_0x4b5792, _0x47055a, _0xdf9aa5, _0x2853cd, _0x2f7fc6[_0xc26d62 + 0x9], 0xc, -0x74bb0851), _0x2853cd = md5_ff(_0x2853cd, _0x4b5792, _0x47055a, _0xdf9aa5, _0x2f7fc6[_0xc26d62 + 0xa], 0x11, -0xa44f), _0xdf9aa5 = md5_ff(_0xdf9aa5, _0x2853cd, _0x4b5792, _0x47055a, _0x2f7fc6[_0xc26d62 + 0xb], 0x16, -0x76a32842), _0x47055a = md5_ff(_0x47055a, _0xdf9aa5, _0x2853cd, _0x4b5792, _0x2f7fc6[_0xc26d62 + 0xc], 0x7, 0x6b901122), _0x4b5792 = md5_ff(_0x4b5792, _0x47055a, _0xdf9aa5, _0x2853cd, _0x2f7fc6[_0xc26d62 + 0xd], 0xc, -0x2678e6d), _0x2853cd = md5_ff(_0x2853cd, _0x4b5792, _0x47055a, _0xdf9aa5, _0x2f7fc6[_0xc26d62 + 0xe], 0x11, -0x5986bc72), _0xdf9aa5 = md5_ff(_0xdf9aa5, _0x2853cd, _0x4b5792, _0x47055a, _0x2f7fc6[_0xc26d62 + 0xf], 0x16, 0x49b40821), _0x47055a = md5_gg(_0x47055a, _0xdf9aa5, _0x2853cd, _0x4b5792, _0x2f7fc6[_0xc26d62 + 0x1], 0x5, -0x9e1da9e), _0x4b5792 = md5_gg(_0x4b5792, _0x47055a, _0xdf9aa5, _0x2853cd, _0x2f7fc6[_0xc26d62 + 0x6], 0x9, -0x3fbf4cc0), _0x2853cd = md5_gg(_0x2853cd, _0x4b5792, _0x47055a, _0xdf9aa5, _0x2f7fc6[_0xc26d62 + 0xb], 0xe, 0x265e5a51), _0xdf9aa5 = md5_gg(_0xdf9aa5, _0x2853cd, _0x4b5792, _0x47055a, _0x2f7fc6[_0xc26d62 + 0x0], 0x14, -0x16493856), _0x47055a = md5_gg(_0x47055a, _0xdf9aa5, _0x2853cd, _0x4b5792, _0x2f7fc6[_0xc26d62 + 0x5], 0x5, -0x29d0efa3), _0x4b5792 = md5_gg(_0x4b5792, _0x47055a, _0xdf9aa5, _0x2853cd, _0x2f7fc6[_0xc26d62 + 0xa], 0x9, 0x2441453), _0x2853cd = md5_gg(_0x2853cd, _0x4b5792, _0x47055a, _0xdf9aa5, _0x2f7fc6[_0xc26d62 + 0xf], 0xe, -0x275e197f), _0xdf9aa5 = md5_gg(_0xdf9aa5, _0x2853cd, _0x4b5792, _0x47055a, _0x2f7fc6[_0xc26d62 + 0x4], 0x14, -0x182c0438), _0x47055a = md5_gg(_0x47055a, _0xdf9aa5, _0x2853cd, _0x4b5792, _0x2f7fc6[_0xc26d62 + 0x9], 0x5, 0x21e1cde6), _0x4b5792 = md5_gg(_0x4b5792, _0x47055a, _0xdf9aa5, _0x2853cd, _0x2f7fc6[_0xc26d62 + 0xe], 0x9, -0x3cc8f82a), _0x2853cd = md5_gg(_0x2853cd, _0x4b5792, _0x47055a, _0xdf9aa5, _0x2f7fc6[_0xc26d62 + 0x3], 0xe, -0xb2af279), _0xdf9aa5 = md5_gg(_0xdf9aa5, _0x2853cd, _0x4b5792, _0x47055a, _0x2f7fc6[_0xc26d62 + 0x8], 0x14, 0x455a14ed), _0x47055a = md5_gg(_0x47055a, _0xdf9aa5, _0x2853cd, _0x4b5792, _0x2f7fc6[_0xc26d62 + 0xd], 0x5, -0x561c16fb), _0x4b5792 = md5_gg(_0x4b5792, _0x47055a, _0xdf9aa5, _0x2853cd, _0x2f7fc6[_0xc26d62 + 0x2], 0x9, -0x3105c08), _0x2853cd = md5_gg(_0x2853cd, _0x4b5792, _0x47055a, _0xdf9aa5, _0x2f7fc6[_0xc26d62 + 0x7], 0xe, 0x676f02d9), _0xdf9aa5 = md5_gg(_0xdf9aa5, _0x2853cd, _0x4b5792, _0x47055a, _0x2f7fc6[_0xc26d62 + 0xc], 0x14, -0x72d5b376), _0x47055a = md5_hh(_0x47055a, _0xdf9aa5, _0x2853cd, _0x4b5792, _0x2f7fc6[_0xc26d62 + 0x5], 0x4, -0x5c6be), _0x4b5792 = md5_hh(_0x4b5792, _0x47055a, _0xdf9aa5, _0x2853cd, _0x2f7fc6[_0xc26d62 + 0x8], 0xb, -0x788e097f), _0x2853cd = md5_hh(_0x2853cd, _0x4b5792, _0x47055a, _0xdf9aa5, _0x2f7fc6[_0xc26d62 + 0xb], 0x10, 0x6d9d6122), _0xdf9aa5 = md5_hh(_0xdf9aa5, _0x2853cd, _0x4b5792, _0x47055a, _0x2f7fc6[_0xc26d62 + 0xe], 0x17, -0x21ac7f4), _0x47055a = md5_hh(_0x47055a, _0xdf9aa5, _0x2853cd, _0x4b5792, _0x2f7fc6[_0xc26d62 + 0x1], 0x4, -0x5b4115bc), _0x4b5792 = md5_hh(_0x4b5792, _0x47055a, _0xdf9aa5, _0x2853cd, _0x2f7fc6[_0xc26d62 + 0x4], 0xb, 0x4bdecfa9), _0x2853cd = md5_hh(_0x2853cd, _0x4b5792, _0x47055a, _0xdf9aa5, _0x2f7fc6[_0xc26d62 + 0x7], 0x10, -0x944b4a0), _0xdf9aa5 = md5_hh(_0xdf9aa5, _0x2853cd, _0x4b5792, _0x47055a, _0x2f7fc6[_0xc26d62 + 0xa], 0x17, -0x41404390), _0x47055a = md5_hh(_0x47055a, _0xdf9aa5, _0x2853cd, _0x4b5792, _0x2f7fc6[_0xc26d62 + 0xd], 0x4, 0x289b7ec6), _0x4b5792 = md5_hh(_0x4b5792, _0x47055a, _0xdf9aa5, _0x2853cd, _0x2f7fc6[_0xc26d62 + 0x0], 0xb, -0x155ed806), _0x2853cd = md5_hh(_0x2853cd, _0x4b5792, _0x47055a, _0xdf9aa5, _0x2f7fc6[_0xc26d62 + 0x3], 0x10, -0x2b10cf7b), _0xdf9aa5 = md5_hh(_0xdf9aa5, _0x2853cd, _0x4b5792, _0x47055a, _0x2f7fc6[_0xc26d62 + 0x6], 0x17, 0x4881d05), _0x47055a = md5_hh(_0x47055a, _0xdf9aa5, _0x2853cd, _0x4b5792, _0x2f7fc6[_0xc26d62 + 0x9], 0x4, -0x262b2fc7), _0x4b5792 = md5_hh(_0x4b5792, _0x47055a, _0xdf9aa5, _0x2853cd, _0x2f7fc6[_0xc26d62 + 0xc], 0xb, -0x1924661b), _0x2853cd = md5_hh(_0x2853cd, _0x4b5792, _0x47055a, _0xdf9aa5, _0x2f7fc6[_0xc26d62 + 0xf], 0x10, 0x1fa27cf8), _0xdf9aa5 = md5_hh(_0xdf9aa5, _0x2853cd, _0x4b5792, _0x47055a, _0x2f7fc6[_0xc26d62 + 0x2], 0x17, -0x3b53a99b), _0x47055a = md5_ii(_0x47055a, _0xdf9aa5, _0x2853cd, _0x4b5792, _0x2f7fc6[_0xc26d62 + 0x0], 0x6, -0xbd6ddbc), _0x4b5792 = md5_ii(_0x4b5792, _0x47055a, _0xdf9aa5, _0x2853cd, _0x2f7fc6[_0xc26d62 + 0x7], 0xa, 0x432aff97), _0x2853cd = md5_ii(_0x2853cd, _0x4b5792, _0x47055a, _0xdf9aa5, _0x2f7fc6[_0xc26d62 + 0xe], 0xf, -0x546bdc59), _0xdf9aa5 = md5_ii(_0xdf9aa5, _0x2853cd, _0x4b5792, _0x47055a, _0x2f7fc6[_0xc26d62 + 0x5], 0x15, -0x36c5fc7), _0x47055a = md5_ii(_0x47055a, _0xdf9aa5, _0x2853cd, _0x4b5792, _0x2f7fc6[_0xc26d62 + 0xc], 0x6, 0x655b59c3), _0x4b5792 = md5_ii(_0x4b5792, _0x47055a, _0xdf9aa5, _0x2853cd, _0x2f7fc6[_0xc26d62 + 0x3], 0xa, -0x70f3336e), _0x2853cd = md5_ii(_0x2853cd, _0x4b5792, _0x47055a, _0xdf9aa5, _0x2f7fc6[_0xc26d62 + 0xa], 0xf, -0x100b83), _0xdf9aa5 = md5_ii(_0xdf9aa5, _0x2853cd, _0x4b5792, _0x47055a, _0x2f7fc6[_0xc26d62 + 0x1], 0x15, -0x7a7ba22f), _0x47055a = md5_ii(_0x47055a, _0xdf9aa5, _0x2853cd, _0x4b5792, _0x2f7fc6[_0xc26d62 + 0x8], 0x6, 0x6fa87e4f), _0x4b5792 = md5_ii(_0x4b5792, _0x47055a, _0xdf9aa5, _0x2853cd, _0x2f7fc6[_0xc26d62 + 0xf], 0xa, -0x1d31920), _0x2853cd = md5_ii(_0x2853cd, _0x4b5792, _0x47055a, _0xdf9aa5, _0x2f7fc6[_0xc26d62 + 0x6], 0xf, -0x5cfebcec), _0xdf9aa5 = md5_ii(_0xdf9aa5, _0x2853cd, _0x4b5792, _0x47055a, _0x2f7fc6[_0xc26d62 + 0xd], 0x15, 0x4e0811a1), _0x47055a = md5_ii(_0x47055a, _0xdf9aa5, _0x2853cd, _0x4b5792, _0x2f7fc6[_0xc26d62 + 0x4], 0x6, -0x8ac817e), _0x4b5792 = md5_ii(_0x4b5792, _0x47055a, _0xdf9aa5, _0x2853cd, _0x2f7fc6[_0xc26d62 + 0xb], 0xa, -0x42c50dcb), _0x2853cd = md5_ii(_0x2853cd, _0x4b5792, _0x47055a, _0xdf9aa5, _0x2f7fc6[_0xc26d62 + 0x2], 0xf, 0x2ad7d2bb), _0xdf9aa5 = md5_ii(_0xdf9aa5, _0x2853cd, _0x4b5792, _0x47055a, _0x2f7fc6[_0xc26d62 + 0x9], 0x15, -0x14792c6f), _0x47055a = safe_add(_0x47055a, _0x41dc6f), _0xdf9aa5 = safe_add(_0xdf9aa5, _0x1477b2), _0x2853cd = safe_add(_0x2853cd, _0x1723b5), _0x4b5792 = safe_add(_0x4b5792, _0x3f85d4);</span><br><span class="line">	&#125;</span><br><span class="line">	return Array(_0x47055a, _0xdf9aa5, _0x2853cd, _0x4b5792);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function md5_cmn(_0x4fedd5, _0x4ad202, _0x3dab77, _0xe30333, _0x179e32, _0x134940) &#123;</span><br><span class="line">	return safe_add(bit_rol(safe_add(safe_add(_0x4ad202, _0x4fedd5), safe_add(_0xe30333, _0x134940)), _0x179e32), _0x3dab77);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function md5_ff(_0x48dd01, _0x590894, _0x2a8b56, _0x5a1ed7, _0x39782e, _0x1c6730, _0x65ff94) &#123;</span><br><span class="line">	return md5_cmn(_0x590894 &amp; _0x2a8b56 | ~_0x590894 &amp; _0x5a1ed7, _0x48dd01, _0x590894, _0x39782e, _0x1c6730, _0x65ff94);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function md5_gg(_0x38eafa, _0x3c9926, _0x494836, _0x9ba7f5, _0x29faac, _0x4a5104, _0x1a6d52) &#123;</span><br><span class="line">	return md5_cmn(_0x3c9926 &amp; _0x9ba7f5 | _0x494836 &amp; ~_0x9ba7f5, _0x38eafa, _0x3c9926, _0x29faac, _0x4a5104, _0x1a6d52);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function md5_hh(_0x493e8f, _0x241c10, _0x4b56bc, _0x511e91, _0x5cacdb, _0x12d467, _0x19c090) &#123;</span><br><span class="line">	return md5_cmn(_0x241c10 ^ _0x4b56bc ^ _0x511e91, _0x493e8f, _0x241c10, _0x5cacdb, _0x12d467, _0x19c090);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function md5_ii(_0x1e564b, _0x1cb61f, _0x40aea0, _0x1cd8ad, _0x3a955f, _0x527294, _0x2a51ff) &#123;</span><br><span class="line">	return md5_cmn(_0x40aea0 ^ (_0x1cb61f | ~_0x1cd8ad), _0x1e564b, _0x1cb61f, _0x3a955f, _0x527294, _0x2a51ff);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function core_hmac_md5(_0x22b4fd, _0x599a94) &#123;</span><br><span class="line">	var _0x1e547d = _0x5299, _0x3440f1 = str2binl(_0x22b4fd);</span><br><span class="line">	if (_0x3440f1[_0x1e547d(0x1de)] &gt; 0x10) _0x3440f1 = core_md5(_0x3440f1, _0x22b4fd[_0x1e547d(0x1de)] * chrsz);</span><br><span class="line">	var _0x2074c1 = Array(0x10), _0x1a616d = Array(0x10);</span><br><span class="line">	for (var _0x57b248 = 0x0; _0x57b248 &lt; 0x10; _0x57b248++) &#123;</span><br><span class="line">		_0x2074c1[_0x57b248] = _0x3440f1[_0x57b248] ^ 0x36363636, _0x1a616d[_0x57b248] = _0x3440f1[_0x57b248] ^ 0x5c5c5c5c;</span><br><span class="line">	&#125;</span><br><span class="line">	var _0x15a71b = core_md5(_0x2074c1[_0x1e547d(&#x27;0x1cf&#x27;)](str2binl(_0x599a94)), 0x200 + _0x599a94[&#x27;length&#x27;] * chrsz);</span><br><span class="line">	return core_md5(_0x1a616d[_0x1e547d(0x1cf)](_0x15a71b), 0x200 + 0x80);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function safe_add(_0x1d693d, _0x2213b8) &#123;</span><br><span class="line">	var _0xf479d8 = (_0x1d693d &amp; 0xffff) + (_0x2213b8 &amp; 0xffff),</span><br><span class="line">		_0x1654f5 = (_0x1d693d &gt;&gt; 0x10) + (_0x2213b8 &gt;&gt; 0x10) + (_0xf479d8 &gt;&gt; 0x10);</span><br><span class="line">	return _0x1654f5 &lt;&lt; 0x10 | _0xf479d8 &amp; 0xffff;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function bit_rol(_0x582e5a, _0x296943) &#123;</span><br><span class="line">	return _0x582e5a &lt;&lt; _0x296943 | _0x582e5a &gt;&gt;&gt; 0x20 - _0x296943;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function str2binl(_0xb2b531) &#123;</span><br><span class="line">	var _0x49f657 = _0x5299, _0x2694a4 = Array(), _0x3c61d4 = (0x1 &lt;&lt; chrsz) - 0x1;</span><br><span class="line">	for (var _0xcf1ffd = 0x0; _0xcf1ffd &lt; _0xb2b531[_0x49f657(&#x27;0x1de&#x27;)] * chrsz; _0xcf1ffd += chrsz) _0x2694a4[_0xcf1ffd &gt;&gt; 0x5] |= (_0xb2b531[_0x49f657(&#x27;0x1d9&#x27;)](_0xcf1ffd / chrsz) &amp; _0x3c61d4) &lt;&lt; _0xcf1ffd % 0x20;</span><br><span class="line">	return _0x2694a4;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function binl2str(_0x494a15) &#123;</span><br><span class="line">	var _0x21474f = _0x5299, _0x22bebd = &#x27;&#x27;, _0x4ae780 = (0x1 &lt;&lt; chrsz) - 0x1;</span><br><span class="line">	for (var _0x5339a0 = 0x0; _0x5339a0 &lt; _0x494a15[_0x21474f(0x1de)] * 0x20; _0x5339a0 += chrsz) _0x22bebd += String[&#x27;fromCharCo&#x27; + &#x27;de&#x27;](_0x494a15[_0x5339a0 &gt;&gt; 0x5] &gt;&gt;&gt; _0x5339a0 % 0x20 &amp; _0x4ae780);</span><br><span class="line">	return _0x22bebd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function binl2hex(_0x105709) &#123;</span><br><span class="line">	var _0x3e0fbc = _0x5299,</span><br><span class="line">		_0x3090af = hexcase ? _0x3e0fbc(0x1d6) + _0x3e0fbc(0x1cb) : _0x3e0fbc(0x1d6) + _0x3e0fbc(&#x27;0x1d7&#x27;), _0x48992b = &#x27;&#x27;;</span><br><span class="line">	for (var _0x27af63 = 0x0; _0x27af63 &lt; _0x105709[_0x3e0fbc(&#x27;0x1de&#x27;)] * 0x4; _0x27af63++) &#123;</span><br><span class="line">		_0x48992b += _0x3090af[_0x3e0fbc(&#x27;0x1dd&#x27;)](_0x105709[_0x27af63 &gt;&gt; 0x2] &gt;&gt; _0x27af63 % 0x4 * 0x8 + 0x4 &amp; 0xf) + _0x3090af[_0x3e0fbc(&#x27;0x1dd&#x27;)](_0x105709[_0x27af63 &gt;&gt; 0x2] &gt;&gt; _0x27af63 % 0x4 * 0x8 &amp; 0xf);</span><br><span class="line">	&#125;</span><br><span class="line">	return _0x48992b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function binl2b64(_0x1fcb8d) &#123;</span><br><span class="line">	var _0x1f69a8 = _0x5299,</span><br><span class="line">		_0x4b8368 = _0x1f69a8(0x1df) + &#x27;KLMNOPQRST&#x27; + _0x1f69a8(&#x27;0x1eb&#x27;) + &#x27;efghijklmn&#x27; + &#x27;opqrstuvwx&#x27; + _0x1f69a8(0x1e7) + _0x1f69a8(0x1e9),</span><br><span class="line">		_0x37174f = &#x27;&#x27;;</span><br><span class="line">	for (var _0x539d82 = 0x0; _0x539d82 &lt; _0x1fcb8d[_0x1f69a8(0x1de)] * 0x4; _0x539d82 += 0x3) &#123;</span><br><span class="line">		var _0x3a7b6d = (_0x1fcb8d[_0x539d82 &gt;&gt; 0x2] &gt;&gt; 0x8 * (_0x539d82 % 0x4) &amp; 0xff) &lt;&lt; 0x10 | (_0x1fcb8d[_0x539d82 + 0x1 &gt;&gt; 0x2] &gt;&gt; 0x8 * ((_0x539d82 + 0x1) % 0x4) &amp; 0xff) &lt;&lt; 0x8 | _0x1fcb8d[_0x539d82 + 0x2 &gt;&gt; 0x2] &gt;&gt; 0x8 * ((_0x539d82 + 0x2) % 0x4) &amp; 0xff;</span><br><span class="line">		for (var _0x7aed3a = 0x0; _0x7aed3a &lt; 0x4; _0x7aed3a++) &#123;</span><br><span class="line">			if (_0x539d82 * 0x8 + _0x7aed3a * 0x6 &gt; _0x1fcb8d[_0x1f69a8(0x1de)] * 0x20) _0x37174f += b64pad; else _0x37174f += _0x4b8368[_0x1f69a8(&#x27;0x1dd&#x27;)](_0x3a7b6d &gt;&gt; 0x6 * (0x3 - _0x7aed3a) &amp; 0x3f);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return _0x37174f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">window[_0x3b2a2b(&#x27;0x1ce&#x27;)] = function (_0x4ecca8) &#123;</span><br><span class="line">	var _0x5d2d42 = _0x3b2a2b;</span><br><span class="line">	typeof Document !== _0x5d2d42(&#x27;0x1d3&#x27;) &amp;&amp; (Document = function () &#123;</span><br><span class="line">	&#125;);</span><br><span class="line">	try &#123;</span><br><span class="line">		return navigator + &#x27;&#x27; === _0x5d2d42(&#x27;0x1cd&#x27;) + _0x5d2d42(0x1d4)</span><br><span class="line">			&amp;&amp; window[_0x5d2d42(&#x27;0x1db&#x27;)]() === _0x5d2d42(&#x27;0x1d8&#x27;) + _0x5d2d42(&#x27;0x1ea&#x27;)</span><br><span class="line">			&amp;&amp; Object[_0x5d2d42(0x1e2) + &#x27;peOf&#x27;](document) instanceof Document</span><br><span class="line">			&amp;&amp; Object[&#x27;is&#x27;](window, globalThis) ? lmd5[_0x5d2d42(0x1d0)](&#x27;dta&#x27;, _0x4ecca8) : lmd5[_0x5d2d42(0x1e4)](_0x4ecca8);</span><br><span class="line">	&#125; catch (_0x57ab12) &#123;</span><br><span class="line">		return lmd5[&#x27;_0x398525&#x27;](_0x4ecca8);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;, lmd5[_0x3b2a2b(&#x27;0x1dc&#x27;)] = function (_0x4ad119) &#123;</span><br><span class="line">	return binl2hex(core_md5(str2binl(_0x4ad119), _0x4ad119[&#x27;length&#x27;] * chrsz));</span><br><span class="line">&#125;, lmd5[_0x3b2a2b(&#x27;0x1e4&#x27;)] = function (_0x523268) &#123;</span><br><span class="line">	var _0x30c42f = _0x3b2a2b;</span><br><span class="line">	let _0x184fa8 = String(Math[_0x30c42f(0x1e3)]());</span><br><span class="line">	return binl2hex(core_md5(str2binl(_0x184fa8), _0x184fa8[_0x30c42f(&#x27;0x1de&#x27;)] * chrsz));</span><br><span class="line">&#125;, lmd5[_0x3b2a2b(0x1d0)] = function (_0x2d7b8d, _0x2916db) &#123;</span><br><span class="line">	return binl2hex(core_hmac_md5(_0x2d7b8d, _0x2916db));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">console.log(window.dta(&quot;&quot;));</span><br></pre></td></tr></table></figure>

<h2 id="五、补环境-VS-环境检测"><a href="#五、补环境-VS-环境检测" class="headerlink" title="五、补环境 VS 环境检测"></a>五、补环境 VS 环境检测</h2><blockquote>
<p><strong>吐环境脚本使用注意事项：</strong></p>
<ol>
<li>对于初始化过的 navigator、document 等浏览器对象，补环境时不需要 var&#x2F;let 重新声明，而是直接使用</li>
<li>在自执行函数中的补环境脚本需要考虑<strong>函数声明和变量声明的作用域规则</strong>，新版本的吐环境脚本与补环境区域脱离，无需考虑</li>
</ol>
<p><strong>优化版代理器：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/* ================================= 补环境区域 START ================================= */</span><br><span class="line">function getObjhandler(proxyName) &#123; return &#123; get(target, property, receiver) &#123; if (target[property] instanceof Object) &#123; console.log(`【 get 】--&gt; $&#123;proxyName&#125;.$&#123;String(property)&#125; --&gt; $&#123;typeof target[property]&#125;`); return new Proxy(target[property], getObjhandler(`$&#123;proxyName&#125;.$&#123;String(property)&#125;`)) &#125; if (typeof property == &quot;symbol&quot;) &#123; console.log(`【 get 】--&gt; $&#123;proxyName&#125;.$&#123;String(property)&#125; --&gt; $&#123;target[property]&#125;`); return Reflect.get(...arguments) &#125; console.log(`【 get 】--&gt; $&#123;proxyName&#125;.$&#123;String(property)&#125; --&gt; $&#123;typeof target[property]&#125;`); try &#123; return Reflect.get(...arguments) &#125; catch (error) &#123; console.error(`【异常捕获】--&gt; $&#123;proxyName&#125;.$&#123;String(property)&#125; --&gt; $&#123;target[property]&#125;: \n$&#123;error.message&#125; --------`); if (property == &quot;userAgent&quot;) &#123; return &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot; &#125; return target[property] &#125; &#125;, set(target, property, value, receiver) &#123; console.log(`【 set 】--&gt; $&#123;proxyName&#125;.$&#123;String(property)&#125; --&gt; $&#123;typeof value&#125; --&gt; $&#123;value&#125;`); return Reflect.set(...arguments) &#125;, has(target, propKey) &#123; console.log(`【 has 】--&gt; [$&#123;String(propKey)&#125;] in [$&#123;proxyName&#125;] --&gt; $&#123;Reflect.has(...arguments)&#125;`); return Reflect.has(...arguments) &#125;, deleteProperty(target, propKey) &#123; console.log(`【 deleteProperty 】--&gt; delete [$&#123;String(propKey)&#125;] from [$&#123;proxyName&#125;] --&gt; $&#123;Reflect.deleteProperty(...arguments)&#125;`); return Reflect.deleteProperty(...arguments) &#125;, getOwnPropertyDescriptor(target, propKey) &#123; console.log(`【 getOwnPropertyDescriptor 】--&gt; ($&#123;proxyName&#125;, &quot;$&#123;String(propKey)&#125;&quot;) --&gt; $&#123;JSON.stringify(Reflect.getOwnPropertyDescriptor(...arguments))&#125;`); return Reflect.getOwnPropertyDescriptor(...arguments) &#125;, defineProperty(target, propKey, propDesc) &#123; console.log(`【 defineProperty 】--&gt; $&#123;proxyName&#125;.$&#123;String(propKey)&#125; --&gt; $&#123;JSON.stringify(propDesc)&#125; --&gt; $&#123;Reflect.defineProperty(...arguments)&#125;`); return Reflect.defineProperty(...arguments) &#125;, preventExtensions(target) &#123; console.log(`【 preventExtensions 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;Reflect.preventExtensions(...arguments)&#125;`); return Reflect.preventExtensions(...arguments) &#125;, isExtensible(target) &#123; console.log(`【 isExtensible 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;Reflect.isExtensible(...arguments)&#125;`); return Reflect.isExtensible(...arguments) &#125;, getPrototypeOf(target) &#123; console.log(`【 getPrototypeOf 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;Reflect.getPrototypeOf(...arguments)&#125;`); return Reflect.getPrototypeOf(...arguments) &#125;, setPrototypeOf(target, proto) &#123; console.log(`【 setPrototypeOf 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;JSON.stringify(proto)&#125; --&gt; $&#123;Reflect.setPrototypeOf(...arguments)&#125;`); return Reflect.setPrototypeOf(...arguments) &#125;, ownKeys(target) &#123; console.log(`【 ownKeys 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;JSON.stringify(Reflect.ownKeys(...arguments))&#125;`); return Reflect.ownKeys(...arguments) &#125;, apply(target, thisArg, args) &#123; console.log(`【 apply 】--&gt; $&#123;proxyName&#125;($&#123;args&#125;) --&gt; $&#123;Reflect.apply(...arguments)&#125;`); return Reflect.apply(...arguments) &#125;, construct(target, args) &#123; console.log(`【 construct 】--&gt; new Proxy($&#123;args&#125;) --&gt; $&#123;Reflect.construct(...arguments)&#125;`); return Reflect.construct(...arguments) &#125; &#125; &#125;</span><br><span class="line">// ------------------------------------ 初始化环境 -------------------------------------</span><br><span class="line">window = global;</span><br><span class="line">exports = undefined;</span><br><span class="line"></span><br><span class="line">// ------------------------------------ 初始化代理 -------------------------------------</span><br><span class="line">!(function getEnvironment(proxyArray) &#123;</span><br><span class="line">    proxyArray.forEach(proxyName =&gt; &#123;</span><br><span class="line">        globalThis[proxyName] = new Proxy(globalThis[proxyName] || &#123;&#125;, getObjhandler(proxyName))</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)([&#x27;window&#x27;, &#x27;document&#x27;, &#x27;location&#x27;, &#x27;navigator&#x27;, &#x27;history&#x27;, &#x27;screen&#x27;]);</span><br><span class="line">// window 在经过代理器设置后，转换为了 Proxy 对象，Object.is(window, globalThis) 检测则为 false</span><br><span class="line">globalThis = window;</span><br><span class="line">/* ================================== 补环境区域 END ================================== */</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">/* ================================= 补环境区域 START ================================= */</span><br><span class="line">window = global;</span><br><span class="line">exports = undefined;</span><br><span class="line">// ----------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">// ----------------------------------------------------------------------------------</span><br><span class="line">!(function getEnvironment(proxyArray) &#123;</span><br><span class="line">	function getObjhandler(proxyName) &#123;</span><br><span class="line">		return &#123;</span><br><span class="line">			get(target, property, receiver) &#123;</span><br><span class="line">				if (target[property] instanceof Object) &#123;</span><br><span class="line">					console.log(`【 get 】--&gt; $&#123;proxyName&#125;.$&#123;String(property)&#125; --&gt; $&#123;typeof target[property]&#125;`);</span><br><span class="line">					return new Proxy(target[property], getObjhandler(`$&#123;proxyName&#125;.$&#123;String(property)&#125;`));</span><br><span class="line">				&#125;</span><br><span class="line">				if (typeof property == &#x27;symbol&#x27;) &#123;</span><br><span class="line">					console.log(`【 get 】--&gt; $&#123;proxyName&#125;.$&#123;String(property)&#125; --&gt; $&#123;target[property]&#125;`);</span><br><span class="line">					return Reflect.get(...arguments);</span><br><span class="line">				&#125;</span><br><span class="line">				console.log(`【 get 】--&gt; $&#123;proxyName&#125;.$&#123;String(property)&#125; --&gt; $&#123;typeof target[property]&#125;`);</span><br><span class="line">				try &#123;</span><br><span class="line">					return Reflect.get(...arguments);</span><br><span class="line">				&#125; catch (error) &#123;</span><br><span class="line">					console.error(`【异常捕获】--&gt; $&#123;proxyName&#125;.$&#123;String(property)&#125; --&gt; $&#123;target[property]&#125;: \n$&#123;error.message&#125; --------`);</span><br><span class="line">					if (property == &quot;userAgent&quot;) &#123;</span><br><span class="line">						return &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot;</span><br><span class="line">					&#125;</span><br><span class="line">					// 根据业务逻辑返回默认值或进行其他处理</span><br><span class="line">					return target[property];  // 或者其他合适的默认值</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			set(target, property, value, receiver) &#123;</span><br><span class="line">				console.log(`【 set 】--&gt; $&#123;proxyName&#125;.$&#123;String(property)&#125; --&gt; $&#123;typeof value&#125; --&gt; $&#123;value&#125;`);</span><br><span class="line">				return Reflect.set(...arguments);</span><br><span class="line">			&#125;,</span><br><span class="line">			has(target, propKey) &#123;</span><br><span class="line">				console.log(`【 has 】--&gt; [$&#123;String(propKey)&#125;] in [$&#123;proxyName&#125;] --&gt; $&#123;Reflect.has(...arguments)&#125;`);</span><br><span class="line">				return Reflect.has(...arguments);</span><br><span class="line">			&#125;,</span><br><span class="line">			deleteProperty(target, propKey) &#123;</span><br><span class="line">				console.log(`【 deleteProperty 】--&gt; delete [$&#123;String(propKey)&#125;] from [$&#123;proxyName&#125;] --&gt; $&#123;Reflect.deleteProperty(...arguments)&#125;`);</span><br><span class="line">				return Reflect.deleteProperty(...arguments);</span><br><span class="line">			&#125;,</span><br><span class="line">			getOwnPropertyDescriptor(target, propKey) &#123;</span><br><span class="line">				console.log(`【 getOwnPropertyDescriptor 】--&gt; ($&#123;proxyName&#125;, &quot;$&#123;String(propKey)&#125;&quot;) --&gt; $&#123;JSON.stringify(Reflect.getOwnPropertyDescriptor(...arguments))&#125;`);</span><br><span class="line">				return Reflect.getOwnPropertyDescriptor(...arguments);</span><br><span class="line">			&#125;,</span><br><span class="line">			defineProperty(target, propKey, propDesc) &#123;</span><br><span class="line">				console.log(`【 defineProperty 】--&gt; $&#123;proxyName&#125;.$&#123;String(propKey)&#125; --&gt; $&#123;JSON.stringify(propDesc)&#125; --&gt; $&#123;Reflect.defineProperty(...arguments)&#125;`);</span><br><span class="line">				return Reflect.defineProperty(...arguments);</span><br><span class="line">			&#125;,</span><br><span class="line">			preventExtensions(target) &#123;</span><br><span class="line">				console.log(`【 preventExtensions 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;Reflect.preventExtensions(...arguments)&#125;`);</span><br><span class="line">				return Reflect.preventExtensions(...arguments);</span><br><span class="line">			&#125;,</span><br><span class="line">			isExtensible(target) &#123;</span><br><span class="line">				console.log(`【 isExtensible 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;Reflect.isExtensible(...arguments)&#125;`);</span><br><span class="line">				return Reflect.isExtensible(...arguments);</span><br><span class="line">			&#125;,</span><br><span class="line">			getPrototypeOf(target) &#123;</span><br><span class="line">				console.log(`【 getPrototypeOf 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;Reflect.getPrototypeOf(...arguments)&#125;`);</span><br><span class="line">				return Reflect.getPrototypeOf(...arguments);</span><br><span class="line">			&#125;,</span><br><span class="line">			setPrototypeOf(target, proto) &#123;</span><br><span class="line">				console.log(`【 setPrototypeOf 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;JSON.stringify(proto)&#125; --&gt; $&#123;Reflect.setPrototypeOf(...arguments)&#125;`);</span><br><span class="line">				return Reflect.setPrototypeOf(...arguments);</span><br><span class="line">			&#125;,</span><br><span class="line">			ownKeys(target) &#123;</span><br><span class="line">				console.log(`【 ownKeys 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;JSON.stringify(Reflect.ownKeys(...arguments))&#125;`);</span><br><span class="line">				return Reflect.ownKeys(...arguments)</span><br><span class="line">			&#125;,</span><br><span class="line">			apply(target, thisArg, args) &#123;</span><br><span class="line">				console.log(`【 apply 】--&gt; $&#123;proxyName&#125;($&#123;args&#125;) --&gt; $&#123;Reflect.apply(...arguments)&#125;`);</span><br><span class="line">				return Reflect.apply(...arguments)</span><br><span class="line">			&#125;,</span><br><span class="line">			construct(target, args) &#123;</span><br><span class="line">				console.log(`【 construct 】--&gt; new Proxy($&#123;args&#125;) --&gt; $&#123;Reflect.construct(...arguments)&#125;`);</span><br><span class="line">				return Reflect.construct(...arguments)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	proxyArray.forEach(proxyName =&gt; &#123;</span><br><span class="line">		globalThis[proxyName] = new Proxy(globalThis[proxyName] || &#123;&#125;, getObjhandler(proxyName))</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;)([&#x27;window&#x27;, &#x27;document&#x27;, &#x27;location&#x27;, &#x27;navigator&#x27;, &#x27;history&#x27;, &#x27;screen&#x27;]);</span><br><span class="line">// window 在经过代理器设置后，转换为了 Proxy 对象，Object.is(window, globalThis) 检测则为 false</span><br><span class="line">globalThis = window;</span><br><span class="line">/* ================================== 补环境区域 END ================================== */</span><br></pre></td></tr></table></figure>

<h3 id="1-nvm-–-node-版本"><a href="#1-nvm-–-node-版本" class="headerlink" title="1. nvm – node 版本"></a>1. nvm – node 版本</h3><blockquote>
<p><strong>踩坑：Node.js 21 版本以上环境中自带 navigator 对象，会导致补环境过程中一些检测点被忽略（代理对象无法正常吐环境）</strong></p>
<p><strong>解决办法（<code>brew install nvm</code>）：</strong></p>
<ol>
<li>安装指定的 16.x 版本：<code>nvm install 16.20.2</code></li>
<li>设置默认版本：<code>nvm alias default 16.20.2</code></li>
<li>验证当前版本：<code>node -v</code></li>
</ol>
</blockquote>
<ul>
<li><p><strong>node 中 nvm 不能使用：</strong></p>
<ul>
<li>设置 –&gt; Executor Map –&gt; 第一个 settings.json –&gt; which node –&gt; <code>*&quot;javascript&quot;*: &quot;path/node&quot;</code></li>
</ul>
</li>
<li><p><strong>检查 nvm 安装的全局模块路径：</strong></p>
<ol>
<li>查看当前使用的 Node 版本：<code>nvm current</code></li>
<li>查看全局模块安装路径：<code>npm prefix -g</code></li>
<li>查看全局模块目录：<code>ls $(npm prefix -g)/lib/node_modules</code></li>
</ol>
</li>
<li><p><strong>nvm 命令：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">nvm use &lt;version&gt;           ## 切换使用指定的版本node</span><br><span class="line">nvm ls                      ## 列出所有安装的版本</span><br><span class="line">nvm current                 ## 显示当前的版本</span><br><span class="line">nvm ls-remote --lts         ## 查看所有可以安装的LTS版本（长期支持版）</span><br><span class="line">nvm alias default v6.9.0    ## 设定默认的node版本</span><br><span class="line">nvm uninstall v9.5.0        ## 删除指定版本的node 版本</span><br><span class="line"></span><br><span class="line">nvm install 命令 - 安装指定版本nodejs</span><br><span class="line">nvm install 14.5.0 // 安装14.5.0版本node</span><br><span class="line">nvm install latest // 安装最新版本node</span><br><span class="line"></span><br><span class="line">nvm use v12.19.1            ## 使用指定版本</span><br><span class="line">nvm alias default v14.15.1  ## 设置默认版本</span><br><span class="line">nvm run v14.15.1 app.js     ## 使用指定版本运行脚本</span><br><span class="line">nvm uninstall v14.15.1      ## 卸载指定版本</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p><strong>单独安装 node（<a class="link"   href="https://nodejs.org/zh-cn/download/package-manager"  target="_blank" rel="noopener">官方网站<i class="fas fa-external-link-alt"></i></a>）：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">brew install node@18</span><br><span class="line">echo &#x27;export PATH=&quot;/opt/homebrew/opt/node@18/bin:$PATH&quot;&#x27; &gt;&gt; ~/.zshrc</span><br><span class="line">echo &#x27;export LDFLAGS=&quot;-L/opt/homebrew/opt/node@18/lib&quot;&#x27; &gt;&gt; ~/.zshrc</span><br><span class="line">echo &#x27;export CPPFLAGS=&quot;-I/opt/homebrew/opt/node@18/include&quot;&#x27; &gt;&gt; ~/.zshrc</span><br><span class="line">node -v</span><br><span class="line">npm -v</span><br><span class="line"># 设置淘宝源，查看源：npm config get registry</span><br><span class="line">npm config set registry https://registry.npmmirror.com</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="2-Proxy-Reflect-代理"><a href="#2-Proxy-Reflect-代理" class="headerlink" title="2. Proxy|Reflect 代理"></a>2. Proxy|Reflect 代理</h3><blockquote>
<p><strong>Proxy</strong> 是 ES6 引入的一种元编程特性，它允许通过代理对象<strong>拦截</strong>和自定义对原对象的操作行为，例如读写属性、函数调用等；可以在不直接修改对象的情况下”拦截”对对象的操作，并通过自定义行为来处理这些操作。</p>
<p><strong>Reflect</strong> 是 ES6 引入的另一个工具，它提供了一组方法，用来对 js 对象进行默认的操作。可以认为 Reflect 提供了与 Proxy 捕捉器<strong>相对的</strong>“默认行为”，在 Proxy 捕捉器中，常常会结合 Reflect 来调用默认行为。</p>
<p><strong>注意：Proxy 实例也可以作为其他对象的原型对象，可以拦截原型链的访问，并对原型链上属性进行修改</strong></p>
</blockquote>
<ul>
<li><strong>Proxy 基本语法：</strong><code>let proxy = new Proxy(target, handler);</code><ol>
<li>target：想要代理的目标对象（可以是对象、数组、函数等）</li>
<li>handler：一个对象，包含若干”捕捉器”函数，这些函数可以拦截对代理对象的操作</li>
</ol>
</li>
<li><strong>Proxy 支持的 13 种拦截操作：</strong><ol>
<li>**get(target, propKey, receiver)**：拦截对象属性的读取，比如 proxy.foo 和 proxy[‘foo’]</li>
<li>**set(target, propKey, value, receiver)**：拦截对象属性的设置，如 proxy.foo&#x2F;[‘foo’] &#x3D; v，返回布尔值</li>
<li>has(target, propKey)：拦截 propKey in proxy 的操作，返回一个布尔值</li>
<li>deleteProperty(target, propKey)：拦截 delete proxy[propKey] 的操作，返回一个布尔值</li>
<li>ownKeys(target)：拦截 Object.getOwnPropertyNames(proxy)、Object.getOwnPropertySymbols(proxy)、Object.keys(proxy) 和 for…in 循环，返回一个数组。该方法返回目标对象所有自身的属性的属性名，而 Object.keys() 的返回结果仅包括目标对象自身的可遍历属性</li>
<li>getOwnPropertyDescriptor(target, propKey)：拦截 Object.getOwnPropertyDescriptor(proxy, propKey)，返回属性的描述对象</li>
<li>defineProperty(target, propKey, propDesc)：拦截 Object.defineProperty(proxy, propKey, propDesc) 和 Object.defineProperties(proxy, propDescs)，返回一个布尔值</li>
<li>preventExtensions(target)：拦截 Object.preventExtensions(proxy)，返回一个布尔值</li>
<li>getPrototypeOf(target)：拦截 Object.getPrototypeOf(proxy)，返回一个对象</li>
<li>isExtensible(target)：拦截 Object.isExtensible(proxy)，返回一个布尔值</li>
<li>setPrototypeOf(target, proto)：拦截 Object.setPrototypeOf(proxy, proto)，返回一个布尔值</li>
<li>apply(target, object, args)：拦截 Proxy 实例作为函数调用的操作，比如 proxy(…args)、proxy.call(object, …args) 和 proxy.apply(…)</li>
<li>construct(target, args)：拦截 Proxy 实例作为构造函数调用的操作，比如 new proxy(…args)</li>
</ol>
</li>
<li><strong>Reflect 静态方法：</strong><ul>
<li>Reflect.get(target, name, receiver)：查找并返回 target 对象的 name 属性，receiver 绑定 this</li>
<li>Reflect.set(target, name, value, receiver)：设置 target 对象的 name 属性等于 value</li>
<li>Reflect.has(obj, name)：作用对应 python 的 in 运算符</li>
<li>Reflect.deleteProperty(obj, name)：方法等同于 delete obj[name]，用于删除对象的属性</li>
<li>Reflect.construct(target, args)：等同于 new target(…args)，调用构造函数的方法</li>
<li>Reflect.getPrototypeOf(obj)：读取对象的 __proto__ 属性，对应 Object.getPrototypeOf</li>
<li>Reflect.setPrototypeOf(obj, newProto)：设置目标对象的原型，对应 Object.setPrototypeOf</li>
<li>Reflect.apply(func, thisArg, args)：等同于 Function.prototype.apply.call(func, thisArg, args)</li>
<li>Reflect.defineProperty(target, propertyKey, attributes)：等同于 Object.defineProperty</li>
<li>Reflect.getOwnPropertyDescriptor(target, propertyKey)：等同于 Object.getOwnPropertyDescriptor</li>
<li>Reflect.isExtensible(target)：对应 Object.isExtensible 表示当前对象是否可扩展</li>
<li>Reflect.preventExtensions(target)：对应 Object.preventExtensions 让一个对象变为不可扩展，当一个对象被标记为不可扩展后，你不能再向这个对象中添加新的属性，但仍然可以修改或删除现有的属性</li>
<li>Reflect.ownKeys(target)：返回对象的所有属性，可以返回 Symbol 类型</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">!(function getEnvironment(proxyArray) &#123;</span><br><span class="line">    window = global;</span><br><span class="line">    exports = undefined;</span><br><span class="line">    // ============ 脚本仅补了大致环境，需要在此处补其余缺失环境 ============</span><br><span class="line"></span><br><span class="line">    window.aaa = function () &#123; &#125;</span><br><span class="line"></span><br><span class="line">    function getObjhandler(proxyName) &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            get(target, property, receiver) &#123;</span><br><span class="line">                if (target[property] instanceof Object) &#123;</span><br><span class="line">                    console.log(`【 get 】--&gt; $&#123;proxyName&#125;.$&#123;String(property)&#125; --&gt; $&#123;typeof target[property]&#125;`);</span><br><span class="line">                    return new Proxy(target[property], getObjhandler(`$&#123;proxyName&#125;.$&#123;String(property)&#125;`))</span><br><span class="line">                &#125;</span><br><span class="line">                console.log(`【 get 】--&gt; $&#123;proxyName&#125;.$&#123;String(property)&#125; --&gt; $&#123;typeof target[property]&#125;`);</span><br><span class="line">                return Reflect.get(...arguments);</span><br><span class="line">            &#125;,</span><br><span class="line">            set(target, property, value, receiver) &#123;</span><br><span class="line">                console.log(`【 set 】--&gt; $&#123;proxyName&#125;.$&#123;String(property)&#125; --&gt; $&#123;typeof value&#125; --&gt; $&#123;value&#125;`);</span><br><span class="line">                return Reflect.set(...arguments);</span><br><span class="line">            &#125;,</span><br><span class="line">            has(target, propKey) &#123;</span><br><span class="line">                console.log(`【 has 】--&gt; [$&#123;String(propKey)&#125;] in [$&#123;proxyName&#125;] --&gt; $&#123;Reflect.has(...arguments)&#125;`);</span><br><span class="line">                return Reflect.has(...arguments);</span><br><span class="line">            &#125;,</span><br><span class="line">            deleteProperty(target, propKey) &#123;</span><br><span class="line">                console.log(`【 deleteProperty 】--&gt; delete [$&#123;String(propKey)&#125;] from [$&#123;proxyName&#125;] --&gt; $&#123;Reflect.deleteProperty(...arguments)&#125;`);</span><br><span class="line">                return Reflect.deleteProperty(...arguments);</span><br><span class="line">            &#125;,</span><br><span class="line">            getOwnPropertyDescriptor(target, propKey) &#123;</span><br><span class="line">                console.log(`【 getOwnPropertyDescriptor 】--&gt; ($&#123;proxyName&#125;, &quot;$&#123;String(propKey)&#125;&quot;) --&gt; $&#123;JSON.stringify(Reflect.getOwnPropertyDescriptor(...arguments))&#125;`);</span><br><span class="line">                return Reflect.getOwnPropertyDescriptor(...arguments);</span><br><span class="line">            &#125;,</span><br><span class="line">            defineProperty(target, propKey, propDesc) &#123;</span><br><span class="line">                console.log(`【 defineProperty 】--&gt; $&#123;proxyName&#125;.$&#123;String(propKey)&#125; --&gt; $&#123;JSON.stringify(propDesc)&#125; --&gt; $&#123;Reflect.defineProperty(...arguments)&#125;`);</span><br><span class="line">                return Reflect.defineProperty(...arguments);</span><br><span class="line">            &#125;,</span><br><span class="line">            preventExtensions(target) &#123;</span><br><span class="line">                console.log(`【 preventExtensions 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;Reflect.preventExtensions(...arguments)&#125;`);</span><br><span class="line">                return Reflect.preventExtensions(...arguments);</span><br><span class="line">            &#125;,</span><br><span class="line">            isExtensible(target) &#123;</span><br><span class="line">                console.log(`【 isExtensible 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;Reflect.isExtensible(...arguments)&#125;`);</span><br><span class="line">                return Reflect.isExtensible(...arguments);</span><br><span class="line">            &#125;,</span><br><span class="line">            getPrototypeOf(target) &#123;</span><br><span class="line">                console.log(`【 getPrototypeOf 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;JSON.stringify(Reflect.getPrototypeOf(...arguments))&#125;`);</span><br><span class="line">                return Reflect.getPrototypeOf(...arguments);</span><br><span class="line">            &#125;,</span><br><span class="line">            setPrototypeOf(target, proto) &#123;</span><br><span class="line">                console.log(`【 setPrototypeOf 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;JSON.stringify(proto)&#125; --&gt; $&#123;Reflect.setPrototypeOf(...arguments)&#125;`);</span><br><span class="line">                return Reflect.setPrototypeOf(...arguments);</span><br><span class="line">            &#125;,</span><br><span class="line">            ownKeys(target) &#123;</span><br><span class="line">                console.log(`【 ownKeys 】--&gt; $&#123;proxyName&#125; --&gt; $&#123;JSON.stringify(Reflect.ownKeys(...arguments))&#125;`);</span><br><span class="line">                return Reflect.ownKeys(...arguments)</span><br><span class="line">            &#125;,</span><br><span class="line">            apply(target, thisArg, args) &#123;</span><br><span class="line">                console.log(`【 apply 】--&gt; $&#123;proxyName&#125;($&#123;args&#125;) --&gt; $&#123;Reflect.apply(...arguments)&#125;`);</span><br><span class="line">                return Reflect.apply(...arguments)</span><br><span class="line">            &#125;,</span><br><span class="line">            construct(target, args) &#123;</span><br><span class="line">                console.log(`【 construct 】--&gt; new Proxy($&#123;args&#125;) --&gt; $&#123;Reflect.construct(...arguments)&#125;`);</span><br><span class="line">                return Reflect.construct(...arguments)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for (var i = 0; i &lt; proxyArray.length; i++) &#123;</span><br><span class="line">        var proxyName = proxyArray[i];</span><br><span class="line">        global[proxyName] = new Proxy(global[proxyName] || &#123;&#125;, getObjhandler(proxyName));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)([&#x27;window&#x27;, &#x27;document&#x27;, &#x27;location&#x27;, &#x27;navigator&#x27;, &#x27;history&#x27;, &#x27;screen&#x27;]);</span><br><span class="line"></span><br><span class="line">window.aaa.bbb = 666</span><br><span class="line">window.aaa.ccc = 123</span><br><span class="line">&#x27;bbb&#x27; in window.aaa</span><br><span class="line">delete window.aaa.bbb</span><br><span class="line">Object.getOwnPropertyDescriptor(window.aaa, &#x27;ccc&#x27;)</span><br><span class="line">Object.defineProperty(window, &#x27;bbb&#x27;, &#123;</span><br><span class="line">    value: 123,</span><br><span class="line">    writable: true</span><br><span class="line">&#125;)</span><br><span class="line">// Object.preventExtensions(window)</span><br><span class="line">Object.isExtensible(window)</span><br><span class="line">Object.getPrototypeOf(window)</span><br><span class="line">Object.setPrototypeOf(window, &#123;gpt: &#x27;chatgpt&#x27;&#125;)</span><br><span class="line">window.gpt</span><br><span class="line"></span><br><span class="line">window.aaa(1)</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">【 get 】--&gt; window.aaa --&gt; function</span><br><span class="line">【 set 】--&gt; window.aaa.bbb --&gt; number --&gt; 666</span><br><span class="line">【 getOwnPropertyDescriptor 】--&gt; (window.aaa, &quot;bbb&quot;) --&gt; undefined</span><br><span class="line">【 defineProperty 】--&gt; window.aaa.bbb --&gt; &#123;&quot;value&quot;:666,&quot;writable&quot;:true,&quot;enumerable&quot;:true,&quot;configurable&quot;:true&#125; --&gt; true</span><br><span class="line">【 get 】--&gt; window.aaa --&gt; function</span><br><span class="line">【 set 】--&gt; window.aaa.ccc --&gt; number --&gt; 123</span><br><span class="line">【 getOwnPropertyDescriptor 】--&gt; (window.aaa, &quot;ccc&quot;) --&gt; undefined</span><br><span class="line">【 defineProperty 】--&gt; window.aaa.ccc --&gt; &#123;&quot;value&quot;:123,&quot;writable&quot;:true,&quot;enumerable&quot;:true,&quot;configurable&quot;:true&#125; --&gt; true</span><br><span class="line">【 get 】--&gt; window.aaa --&gt; function</span><br><span class="line">【 has 】--&gt; [bbb] in [window.aaa] --&gt; true</span><br><span class="line">【 get 】--&gt; window.aaa --&gt; function</span><br><span class="line">【 deleteProperty 】--&gt; delete [bbb] from [window.aaa] --&gt; true</span><br><span class="line">【 get 】--&gt; window.aaa --&gt; function</span><br><span class="line">【 getOwnPropertyDescriptor 】--&gt; (window.aaa, &quot;ccc&quot;) --&gt; &#123;&quot;value&quot;:123,&quot;writable&quot;:true,&quot;enumerable&quot;:true,&quot;configurable&quot;:true&#125;</span><br><span class="line">【 defineProperty 】--&gt; window.bbb --&gt; &#123;&quot;value&quot;:123,&quot;writable&quot;:true&#125; --&gt; true</span><br><span class="line">【 isExtensible 】--&gt; window --&gt; true</span><br><span class="line">【 getPrototypeOf 】--&gt; window --&gt; &#123;&#125;</span><br><span class="line">【 setPrototypeOf 】--&gt; window --&gt; &#123;&quot;gpt&quot;:&quot;chatgpt&quot;&#125; --&gt; true</span><br><span class="line">【 get 】--&gt; window.gpt --&gt; string</span><br><span class="line">【 get 】--&gt; window.aaa --&gt; function</span><br><span class="line">【 apply 】--&gt; window.aaa(1) --&gt; undefined</span><br><span class="line"> */</span><br></pre></td></tr></table></figure>

<h3 id="3-补环境思路"><a href="#3-补环境思路" class="headerlink" title="3. 补环境思路"></a>3. 补环境思路</h3><ul>
<li><strong>通过 Object.getPrototypeOf 方法检测原型的补法：</strong><ol>
<li>首先确认浏览器中，当前对象的原型类型，<code>typeof HTMLDocument</code> 来确定补原型对象的类型</li>
<li>观察补出来的对象的原型链是否和浏览器中当前对象的原型链一致</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function Document() &#123; &#125;</span><br><span class="line">Document.prototype[Symbol.toStringTag] = &quot;Document&quot;;</span><br><span class="line"></span><br><span class="line">function HTMLDocument() &#123; &#125;</span><br><span class="line">HTMLDocument.prototype[Symbol.toStringTag] = &quot;HTMLDocument&quot;;</span><br><span class="line"></span><br><span class="line">// 将 Document 作为 HTMLDocument 的原型</span><br><span class="line">Object.setPrototypeOf(HTMLDocument.prototype, Document.prototype);</span><br><span class="line"></span><br><span class="line">// 创建 document 对象，并设置它的原型为 HTMLDocument.prototype</span><br><span class="line">const document = Object.setPrototypeOf(&#123;&#125;, HTMLDocument.prototype);</span><br><span class="line"></span><br><span class="line">// 测试原型链</span><br><span class="line">console.log(Object.prototype.toString.call(document)); // [object HTMLDocument]</span><br><span class="line">console.log(Object.getPrototypeOf(document)); // HTMLDocument &#123; [Symbol(Symbol.toStringTag)]: &#x27;HTMLDocument&#x27; &#125;</span><br><span class="line">console.log(Object.getPrototypeOf(Object.getPrototypeOf(document))); // Document &#123; [Symbol(Symbol.toStringTag)]: &#x27;Document&#x27; &#125;</span><br><span class="line">console.log(Object.getPrototypeOf(document) instanceof Document); // true</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>补环境技巧：</strong></p>
<ol>
<li><p>遇到程序卡死不动时，可以直接暂停 debug 调试，即可断点至对应卡死的程序代码</p>
</li>
<li><p>程序中存在 eval 执行的一段代码，可打断点至其调用处，单步调试走进被执行代码；如果代码是被压缩过的，不方便调试，可以将代码抠出来格式化后，替换被执行代码进行调试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;);</span><br><span class="line">const data = fs.readFileSync(&#x27;/Users/xfblog/Desktop/xxx.js&#x27;, &#x27;utf8&#x27;);</span><br><span class="line"></span><br><span class="line">eval(t1000Source) --&gt; eval(data)</span><br></pre></td></tr></table></figure>
</li>
<li><p>pycharm 执行 js 文件有异常断点，可以通过调试自动在 try 中的异常处断下断点，避免错过环境监测</p>
</li>
<li><p><strong>在环境都补完了，却发现还是非正常输出，则需进一步观察具体代码，是否有环境缺漏，例如 <code>typeof</code> 检测对象是不报错的</strong></p>
</li>
</ol>
</li>
<li><p><strong>吐环境异常解决思路：</strong></p>
<ol>
<li><p><strong>无法在一个未定义的对象上设置&#x2F;读取属性：</strong>是因为其调用的对象为 undefined，所以应该补其调用的对象环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TypeError: Cannot read properties of undefined (reading &#x27;indexOf&#x27;)</span><br><span class="line">TypeError: Cannot set properties of undefined (setting &#x27;bbb&#x27;)</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h3 id="4-浏览器复制对象"><a href="#4-浏览器复制对象" class="headerlink" title="4. 浏览器复制对象"></a>4. 浏览器复制对象</h3><blockquote>
<p><strong>原理：</strong>for…in 循环的特点是可以遍历一个对象的<strong>所有可枚举属性</strong>，包括它自身的属性以及从原型链中<strong>继承的属性</strong></p>
</blockquote>
<ul>
<li>在当前浏览器环境下，打开控制台执行脚本，并右键复制 object</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let myobj = &#123;&#125;;</span><br><span class="line">for (let key in navigator) &#123;</span><br><span class="line">    // 只存储自身属性到 obj</span><br><span class="line">    // if (!myobj.hasOwnProperty(key)) &#123;</span><br><span class="line">    //     continue;</span><br><span class="line">    // &#125;</span><br><span class="line">    let value = navigator[key];</span><br><span class="line">    myobj[key] = value;</span><br><span class="line">&#125;</span><br><span class="line">console.log(myobj);</span><br></pre></td></tr></table></figure>

<h3 id="5-浏览器内存漫游定位"><a href="#5-浏览器内存漫游定位" class="headerlink" title="5. 浏览器内存漫游定位"></a>5. 浏览器内存漫游定位</h3><blockquote>
<p><strong>Github 源码地址：</strong><a class="link"   href="https://github.com/JSREI/ast-hook-for-js-RE"  target="_blank" rel="noopener">aHR0cHM6Ly9naXRodWIuY29tL0pTUkVJL2FzdC1ob29rLWZvci1qcy1SRQ&#x3D;&#x3D;<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>快速启动：</strong></p>
<ol>
<li><code>npx node src/proxy-server/proxy-server.js</code></li>
<li><code>npx node src/api-server/api-server.js</code></li>
</ol>
</blockquote>
<ul>
<li><strong>项目安装：</strong><ol>
<li><code>git clone git@github.com:JSREI/ast-hook-for-js-RE.git</code></li>
<li><code>cd ast-hook-for-js-RE</code></li>
<li><code>npm install</code></li>
<li>安装异常：<code>rm -rf node_modules</code>、<code>npm cache verify</code>、<code>npm cache clean --force</code></li>
</ol>
</li>
<li><strong>项目启动：</strong><ol>
<li><code>npx anyproxy ca</code></li>
<li>浏览器打开 <code>http://127.0.0.1:8002/</code>，RootCA 下载根证书</li>
<li>双击证书安装到<strong>系统</strong>，显示简介将其设置为<strong>信任</strong>证书</li>
<li>在项目路径下，开启代理服务 <code>npx node src/proxy-server/proxy-server.js</code></li>
<li>产生了缓存文件夹 <code>js-file-cache</code></li>
<li><strong>浏览器进行代理（Proxy SwitchyOmega）：</strong>添加 127.0.0.1:10086 代理</li>
</ol>
</li>
</ul>
<h3 id="6-EventTarget-API"><a href="#6-EventTarget-API" class="headerlink" title="6. EventTarget API"></a>6. EventTarget API</h3><blockquote>
<p> <strong>EventTarget：</strong>是一个 Web API，几乎所有 DOM 元素（例 div 或 button）都继承自它。通过构造函数 EventTarget()，可以创建一个新的 EventTarget 对象实例，即一个没有 UI 表现的自定义对象，用于处理和触发事件和自定义事件</p>
</blockquote>
<ul>
<li><p><strong>原型方法：</strong></p>
<ol>
<li><strong>EventTarget.addEventListener：</strong>注册事件，在 EventTarget 对象上注册特定事件类型的事件监听器，即事件处理函数</li>
<li><strong>EventTarget.removeEventListener：</strong>注销事件，从 EventTarget 对象中移除指定的事件监听器</li>
<li><strong>EventTarget.dispatchEvent：</strong>触发事件，将 Event 事件分派到此 EventTarget 实例上，返回布尔值表示是否成功触发了事件</li>
</ol>
</li>
<li><p><strong>简单实现：</strong></p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title class_">EventTarget</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">listeners</span> = &#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">EventTarget</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">listeners</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">EventTarget</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">addEventListener</span> = <span class="keyword">function</span> (<span class="params">type, callback</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> (!(type <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">listeners</span>)) &#123;</span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">listeners</span>[type] = [];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">listeners</span>[type].<span class="title function_">push</span>(callback);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">EventTarget</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">removeEventListener</span> = <span class="keyword">function</span> (<span class="params">type, callback</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> (!(type <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">listeners</span>)) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> stack = <span class="variable language_">this</span>.<span class="property">listeners</span>[type];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = stack.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (stack[i] === callback) &#123;</span><br><span class="line">			stack.<span class="title function_">splice</span>(i, <span class="number">1</span>);</span><br><span class="line">			<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">removeEventListener</span>(type, callback);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">EventTarget</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">dispatchEvent</span> = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> (!(event.<span class="property">type</span> <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">listeners</span>)) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> stack = <span class="variable language_">this</span>.<span class="property">listeners</span>[event.<span class="property">type</span>];</span><br><span class="line">	event.<span class="property">target</span> = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = stack.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">		stack[i].<span class="title function_">call</span>(<span class="variable language_">this</span>, event);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="六、Canvas-与验证码专题"><a href="#六、Canvas-与验证码专题" class="headerlink" title="六、Canvas 与验证码专题"></a>六、Canvas 与验证码专题</h2><blockquote>
<p><strong>逆向技巧：</strong>事件监听断点 –&gt; canvas 画布</p>
</blockquote>
<h3 id="1-canvas-绘图操作"><a href="#1-canvas-绘图操作" class="headerlink" title="1. canvas 绘图操作"></a>1. canvas 绘图操作</h3><ul>
<li>在 HTML 中使用 canvas 标签：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 创建一个宽500像素、高400像素的画布，并加上黑色边框</span><br><span class="line">&lt;canvas id=&quot;myCanvas&quot; width=&quot;500&quot; height=&quot;400&quot; style=&quot;border:1px solid #000;&quot;&gt;&lt;/canvas&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>js 获取 canvas 上下文，进行绘图操作：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">const canvas = document.getElementById(&#x27;myCanvas&#x27;);</span><br><span class="line">const ctx = canvas.getContext(&#x27;2d&#x27;); // 获取2D上下文，canvas 有两种上下文类型：2d 和 webgl（3D绘图）</span><br><span class="line"></span><br><span class="line">1. 填充矩形（fillRect）：fillRect(x, y, width, height) 表示在指定位置绘制一个填充的矩形</span><br><span class="line">ctx.fillStyle = &#x27;blue&#x27;; // 设置填充颜色</span><br><span class="line">ctx.fillRect(50, 50, 100, 100); // 在(50, 50)位置绘制100x100的矩形</span><br><span class="line"></span><br><span class="line">2. 绘制矩形边框（strokeRect）</span><br><span class="line">ctx.strokeStyle = &#x27;red&#x27;; // 设置边框颜色</span><br><span class="line">ctx.lineWidth = 5; // 设置边框宽度</span><br><span class="line">ctx.strokeRect(200, 50, 100, 100); // 在(200, 50)位置绘制矩形边框</span><br><span class="line"></span><br><span class="line">3. 清除区域（clearRect）</span><br><span class="line">ctx.clearRect(0, 0, canvas.width, canvas.height); // 清空整个画布</span><br><span class="line"></span><br><span class="line">4. 绘制路径（beginPath、moveTo、lineTo、stroke）</span><br><span class="line">ctx.beginPath(); // 开始新路径</span><br><span class="line">ctx.moveTo(50, 150); // 移动到(50, 150)</span><br><span class="line">ctx.lineTo(200, 150); // 画一条线到(200, 150)</span><br><span class="line">ctx.lineTo(125, 250); // 再画一条线到(125, 250)</span><br><span class="line">ctx.closePath(); // 闭合路径</span><br><span class="line">ctx.stroke(); // 绘制路径</span><br><span class="line"></span><br><span class="line">5. 绘制圆形或弧线（arc）：arc(x, y, radius, startAngle, endAngle, anticlockwise) 方法用于绘制弧线或圆形</span><br><span class="line">ctx.beginPath();</span><br><span class="line">ctx.arc(150, 150, 75, 0, Math.PI * 2, false); // 绘制圆形</span><br><span class="line">ctx.fillStyle = &#x27;green&#x27;;</span><br><span class="line">ctx.fill(); // 填充圆形</span><br><span class="line"></span><br><span class="line">6. 绘制文本（fillText、strokeText）</span><br><span class="line">ctx.font = &#x27;30px Arial&#x27;; // 设置字体</span><br><span class="line">ctx.fillStyle = &#x27;black&#x27;;</span><br><span class="line">ctx.fillText(&#x27;Hello Canvas&#x27;, 50, 300); // 填充文本</span><br><span class="line"></span><br><span class="line">7. 添加图片（drawImage）</span><br><span class="line">const img = new Image();</span><br><span class="line">img.src = &#x27;https://example.com/image.jpg&#x27;;</span><br><span class="line">img.onload = () =&gt; &#123;</span><br><span class="line">  ctx.drawImage(img, 0, 0, 300, 200); // 在画布上绘制图片</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>动画效果：</strong>通过不断清除画布和重绘，可以实现动画效果</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let x = 0;</span><br><span class="line">function animate() &#123;</span><br><span class="line">  ctx.clearRect(0, 0, canvas.width, canvas.height); // 清除画布</span><br><span class="line">  ctx.fillRect(x, 100, 50, 50); // 绘制矩形</span><br><span class="line">  x += 2; // 更新x坐标</span><br><span class="line">  if (x &gt; canvas.width) x = 0; // 重置位置</span><br><span class="line">  requestAnimationFrame(animate); // 循环调用动画</span><br><span class="line">&#125;</span><br><span class="line">animate(); // 启动动画</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>事件交互：</strong>可以给Canvas绑定事件，比如鼠标点击</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">canvas.addEventListener(&#x27;click&#x27;, (event) =&gt; &#123;</span><br><span class="line">  const rect = canvas.getBoundingClientRect(); // 获取画布的位置</span><br><span class="line">  const x = event.clientX - rect.left;</span><br><span class="line">  const y = event.clientY - rect.top;</span><br><span class="line">  console.log(`点击位置: ($&#123;x&#125;, $&#123;y&#125;)`);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="2-hook-canvas-还原方法"><a href="#2-hook-canvas-还原方法" class="headerlink" title="2. hook canvas 还原方法"></a>2. hook canvas 还原方法</h3><blockquote>
<p>在 js 验证码逆向过程中，需要逆向的第一步挑战通常是图片被切割成多个<strong>乱序块</strong>，需要将这些小块按正确顺序拼接成原图（逆向）</p>
<p><strong>还原思路：</strong>验证码通常将一张图片切割为若干块，并打乱顺序组成一张新的图片。乱序图片块通常会以数组或元素列表的形式给出，通过 hook 其还原函数（对应 canvas 中的 drawImage、putImageData 函数），逆向分析还原逻辑完成乱序图片绘制还原</p>
</blockquote>
<ul>
<li><strong>drawIamge：</strong>是用于将图片（或视频帧）绘制到 Canvas 上的重要方法，支持<strong>缩放、裁剪和位移</strong><ul>
<li><code>c.drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);</code></li>
<li>image：要绘制的图像对象</li>
<li>sx, sy：源图像的裁剪起始位置（左上角）</li>
<li>sWidth, sHeight：裁剪区域的宽度和高度</li>
<li>dx, dy：目标画布上的绘制位置（左上角）</li>
<li>dWidth, dHeight：绘制到目标画布上的尺寸</li>
</ul>
</li>
<li><strong>putImageData：</strong>用于将像素数据写入 Canvas 的指定位置，适合进行<strong>图像处理和像素级操作</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 通过打印就可以知道当前主要通过 canvas 的什么函数进行还原的，确定后再 hook + debugger 调试</span><br><span class="line">// 劫持 drawImage 方法</span><br><span class="line">let _drawImage = CanvasRenderingContext2D.prototype.drawImage;</span><br><span class="line">CanvasRenderingContext2D.prototype.drawImage = function (...args) &#123;</span><br><span class="line">    console.log(&quot;【 drawImage 】--&gt;&quot;, args);</span><br><span class="line">    // debugger;</span><br><span class="line">    return _drawImage.apply(this, args);</span><br><span class="line">&#125;;</span><br><span class="line">// 劫持 putImageData 方法</span><br><span class="line">let _putImageData = CanvasRenderingContext2D.prototype.putImageData;</span><br><span class="line">CanvasRenderingContext2D.prototype.putImageData = function (...args) &#123;</span><br><span class="line">    console.log(&quot;【 putImageData 】--&gt;&quot;, args);</span><br><span class="line">    // debugger;</span><br><span class="line">    return _putImageData.apply(this, args);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="3-验证码底图乱序还原"><a href="#3-验证码底图乱序还原" class="headerlink" title="3. 验证码底图乱序还原"></a>3. 验证码底图乱序还原</h3><blockquote>
<p><strong>常见验证码平台：</strong></p>
<ul>
<li>网易易盾（yidun，背景带缺口+缺口）：<a class="link"   href="https://dun.163.com/trial/jigsaw"  target="_blank" rel="noopener">03fff674e9e95e3ac8bfe84466f24c6c<i class="fas fa-external-link-alt"></i></a></li>
<li>顶象（dx，canvas，背景带缺口+缺口）：<a class="link"   href="https://www.dingxiang-inc.com/business/captcha"  target="_blank" rel="noopener">ef51a97e8dfa006dbca1825bae38cf48<i class="fas fa-external-link-alt"></i></a></li>
<li>小盾安全，同盾（td，canvas，背景带缺口+缺口）：<a class="link"   href="https://xiaodun.com/onlineExperience/slidingPuzzle"  target="_blank" rel="noopener">ad4cc66dab6d1618e3ed703379ce2d0b<i class="fas fa-external-link-alt"></i></a></li>
<li>数美（shumei，背景带缺口+缺口）：<a class="link"   href="https://www.ishumei.com/new/product/tw/code"  target="_blank" rel="noopener">70dba825d22eeeb5cec343ec195067e4<i class="fas fa-external-link-alt"></i></a></li>
<li>极验（geetest，canvas，背景带缺口+缺口+完整背景）：<a class="link"   href="https://www.geetest.com/show"  target="_blank" rel="noopener">3281b0760f9fc3cee6e0e2d0a87d5034<i class="fas fa-external-link-alt"></i></a></li>
<li>VAPTCHA（vp，canvas，画轨迹）：<a class="link"   href="https://www.vaptcha.com/?lang=cn&from=0#demo"  target="_blank" rel="noopener">a9e9cdc19da9fd4ba57abecae8ffaced<i class="fas fa-external-link-alt"></i></a></li>
<li>腾讯（tc，背景带缺口+缺口）：<a class="link"   href="https://admin.xiaoe-tech.com/t/login?reg_source=0101&src_page=A#/acount"  target="_blank" rel="noopener">b7d893c351d69c0da5a545cbff1d5520<i class="fas fa-external-link-alt"></i></a></li>
<li>谷歌（hcaptcha，9图找实物）：<a class="link"   href="https://www.google.com/recaptcha/api2/demo"  target="_blank" rel="noopener">e497cdff45d62c05b741c80b38584632<i class="fas fa-external-link-alt"></i></a>，<a class="link"   href="https://www.yescaptcha.com/auth/register"  target="_blank" rel="noopener">定制解决方案<i class="fas fa-external-link-alt"></i></a></li>
</ul>
</blockquote>
<ul>
<li><strong>具体还原思路：</strong><ol>
<li>通过 hook canvas 定位乱序图片还原逻辑，主要逆向还原逻辑中循环对图片进行正确顺序绘制的数组的生成</li>
</ol>
</li>
<li><strong>还原代码逻辑：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">import execjs</span><br><span class="line">import math</span><br><span class="line">from PIL import Image</span><br><span class="line"></span><br><span class="line">def draw_image(canvas, source_img, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight):</span><br><span class="line">    &quot;&quot;&quot;模拟JS中的 c.drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight)</span><br><span class="line">    :param canvas: 在循环开始之前创建一个空的 canvas，以便所有块都在同一个画布上绘制</span><br><span class="line">    :param source_img: 传入源图片对象，避免在每次循环中重新加载图片，提升效率</span><br><span class="line">    :param sx, sy: 源图像的裁剪起始位置（左上角）</span><br><span class="line">    :param sWidth, sHeight: 裁剪区域的宽度和高度</span><br><span class="line">    :param dx, dy: 目标画布上的绘制位置（左上角）</span><br><span class="line">    :param dWidth, dHeight: 绘制到目标画布上的尺寸</span><br><span class="line">    :return: None</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # 裁剪出指定区域 (sx, sy, sx + sWidth, sy + sHeight)</span><br><span class="line">    cropped_img = source_img.crop((sx, sy, sx + sWidth, sy + sHeight))</span><br><span class="line">    # 缩放裁剪后的图像到指定尺寸</span><br><span class="line">    resized_img = cropped_img.resize((dWidth, dHeight))</span><br><span class="line">    # 在目标画布上粘贴缩放后的图像</span><br><span class="line">    canvas.paste(resized_img, (dx, dy))</span><br><span class="line"></span><br><span class="line"># 假设的输入数据</span><br><span class="line">input_image_path = &#x27;./6dfe1f16aa0c4f32be0072c5ca0d2f02.webp&#x27;  # 乱的图片路径</span><br><span class="line"></span><br><span class="line"># 加载原始图片</span><br><span class="line">image = Image.open(input_image_path)</span><br><span class="line">img_width, img_height = image.size  # 获取图片的宽度和高度</span><br><span class="line"></span><br><span class="line"># 创建目标画布，大小与原始图片相同</span><br><span class="line">canvas = Image.new(&#x27;RGBA&#x27;, (img_width, img_height))</span><br><span class="line"></span><br><span class="line"># ---------------- 逆向逻辑：模拟 t 数组和乱序逻辑 ----------------</span><br><span class="line">arr = execjs.compile(open(&#x27;./get_canvas.js&#x27;).read()).call(&#x27;f1&#x27;, &#x27;6dfe1f16aa0c4f32be0072c5ca0d2f02&#x27;)</span><br><span class="line">s = math.floor(400 / len(arr))</span><br><span class="line"></span><br><span class="line">def drow_image(n, r):</span><br><span class="line">    t = n * s</span><br><span class="line">    i = s</span><br><span class="line">    draw_image(canvas, image, t, 0, i, img_height, r * s, 0, i, img_height)</span><br><span class="line"></span><br><span class="line"># 遍历 arr 数组，并在同一个画布上绘制所有块</span><br><span class="line">for index, item in enumerate(arr):</span><br><span class="line">    drow_image(item, index)</span><br><span class="line"></span><br><span class="line"># 最终保存结果</span><br><span class="line">canvas.save(&#x27;./restored-image.png&#x27;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>网页手动提取图片数据：</strong><ol>
<li>分析验证码时，发现其是通过 Canvas 画布生成的，且没有提供 API 接口可以获取图片</li>
<li>通过 <code>document.querySelector(&#39;&#39;).toDataURL()</code> 将 Canvas 内容转换为包含图像数据的 Data URL</li>
<li>通过使用 base64 和 PIL 库来处理包含在 Data URL 中的图像数据，并将其保存为本地文件</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import base64, io</span><br><span class="line">from PIL import Image  # pip install pillow</span><br><span class="line"></span><br><span class="line">bg = &#x27;data:image/png;base64,......JRU5ErkJggg==&#x27;</span><br><span class="line"></span><br><span class="line">images = bg.split(&#x27;,&#x27;)[1]</span><br><span class="line">images = base64.b64decode(images)  # 将base64编码的图像数据解码为二进制数据</span><br><span class="line">images = Image.open(io.BytesIO(images))  # 将二进制数据包装为一个类文件对象</span><br><span class="line">images.save(&#x27;bg.png&#x27;)</span><br></pre></td></tr></table></figure>

<h3 id="4-万能-canvas-底图还原"><a href="#4-万能-canvas-底图还原" class="headerlink" title="4. 万能 canvas 底图还原"></a>4. 万能 canvas 底图还原</h3><blockquote>
<p><strong>安装 <a class="link"   href="https://github.com/Automattic/node-canvas"  target="_blank" rel="noopener">node-canvas<i class="fas fa-external-link-alt"></i></a> 库：</strong></p>
<ol>
<li><code>brew install pkg-config cairo pango libpng jpeg giflib librsvg pixman python-setuptools</code></li>
<li><code>export SDKROOT=$(xcrun --show-sdk-path)</code></li>
<li><code>npm install canvas</code>（项目里安装）</li>
</ol>
</blockquote>
<ul>
<li><strong>Hook 步骤：</strong><ol>
<li>通过快速批量 hook 框架，直接 hook CanvasRenderingContext2D 原型上所有方法，根据日志进行断点跟栈</li>
<li>扣验证码的主体 js 还原部分，直接利用 js 中的 canvas 库进行还原</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const &#123; createCanvas, Image &#125; = require(&#x27;canvas&#x27;);</span><br><span class="line">var CryptoJS = require(&quot;crypto-js&quot;);</span><br><span class="line"></span><br><span class="line">const canvas = createCanvas(400, 200);</span><br><span class="line">const ctx = canvas.getContext(&#x27;2d&#x27;);</span><br><span class="line"></span><br><span class="line">// Draw cat with lime helmet</span><br><span class="line">function main() &#123;</span><br><span class="line">    let image = new Image()</span><br><span class="line">    image.src = &quot;data:image/png;base64,xxxxxx...&quot;</span><br><span class="line"></span><br><span class="line">    // 主体还原逻辑</span><br><span class="line">    ctx.drawImage(image, 50, 0, 70, 70)</span><br><span class="line"></span><br><span class="line">    return canvas.toDataURL()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-滑动距离-distance-识别"><a href="#5-滑动距离-distance-识别" class="headerlink" title="5. 滑动距离 distance 识别"></a>5. 滑动距离 distance 识别</h3><ul>
<li><strong>计算方法：</strong><ol>
<li><strong>GitHub 基于人工智能的深度网络训练模型 ddddocr 开源库：</strong><a class="link"   href="https://github.com/sml2h3/ddddocr"  target="_blank" rel="noopener">f70901e4adbfaa715cd0753e2adf6bea<i class="fas fa-external-link-alt"></i></a></li>
<li><strong>第三方打码平台（<a class="link"   href="https://www.jfbym.com/demo.html"  target="_blank" rel="noopener">云码<i class="fas fa-external-link-alt"></i></a>）：</strong>通过完整图片与缺失滑块的图片进行像素对比（图片 –&gt; 矩阵 –&gt; 像素点）</li>
<li><strong>边缘检测算法：</strong>OpenCV 识别滑动距离</li>
</ol>
</li>
<li><strong>边缘检测算法：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line">from PIL import Image</span><br><span class="line">from pathlib import Path</span><br><span class="line"></span><br><span class="line">def imshow(img, winname=&#x27;test&#x27;, delay=0):</span><br><span class="line">    &quot;&quot;&quot;使用OpenCV显示图片&quot;&quot;&quot;</span><br><span class="line">    cv2.imshow(winname, img)</span><br><span class="line">    cv2.waitKey(delay)</span><br><span class="line">    cv2.destroyAllWindows()</span><br><span class="line"></span><br><span class="line">def cv2_open(img, flag=None):</span><br><span class="line">    &quot;&quot;&quot;将不同类型的图片统一转换为OpenCV格式&quot;&quot;&quot;</span><br><span class="line">    if isinstance(img, bytes):</span><br><span class="line">        img = cv2.imdecode(np.frombuffer(img, dtype=np.uint8), 1)</span><br><span class="line">    elif isinstance(img, (str, Path)):</span><br><span class="line">        img = cv2.imread(str(img))</span><br><span class="line">    elif isinstance(img, np.ndarray):</span><br><span class="line">        img = img</span><br><span class="line">    elif isinstance(img, Image.Image):</span><br><span class="line">        img = cv2.cvtColor(np.asarray(img), cv2.COLOR_RGB2BGR)</span><br><span class="line">    else:</span><br><span class="line">        raise ValueError(f&#x27;无法解析的图片类型: &#123;type(img)&#125;&#x27;)</span><br><span class="line">    if flag is not None:</span><br><span class="line">        img = cv2.cvtColor(img, flag)</span><br><span class="line">    return img</span><br><span class="line"></span><br><span class="line">def get_distance(bg_img, slice_img):</span><br><span class="line">    &quot;&quot;&quot;核心逻辑，完成背景图与滑块之间的匹配计算&quot;&quot;&quot;</span><br><span class="line">    # 读取两张图片，在读取图像的同时进行灰度转换</span><br><span class="line">    tp_gray = cv2_open(slice_img, flag=cv2.COLOR_BGR2GRAY)</span><br><span class="line">    bg_gray = cv2_open(bg_img, flag=cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line">    # 对背景图进行非局部均值去噪，能够同时保留边缘和细节</span><br><span class="line">    bg_shift = cv2.fastNlMeansDenoising(bg_gray, None, h=10, templateWindowSize=7, searchWindowSize=21)</span><br><span class="line">    # 边缘检测</span><br><span class="line">    tp_gray = cv2.Canny(tp_gray, 255, 255)</span><br><span class="line">    bg_gray = cv2.Canny(bg_shift, 255, 255)</span><br><span class="line"></span><br><span class="line">    # 模板匹配</span><br><span class="line">    result = cv2.matchTemplate(bg_gray, tp_gray, cv2.TM_CCOEFF_NORMED)</span><br><span class="line">    min_val, max_val, min_loc, max_loc = cv2.minMaxLoc(result)  # 解析匹配结果</span><br><span class="line">    # if save_path or im_show:</span><br><span class="line">    #     # 需要绘制的方框高度和宽度</span><br><span class="line">    #     tp_height, tp_width = tp_gray.shape[:2]</span><br><span class="line">    #     # 矩形左上角点位置</span><br><span class="line">    #     x, y = max_loc</span><br><span class="line">    #     # 矩形右下角点位置</span><br><span class="line">    #     _x, _y = x + tp_width, y + tp_height</span><br><span class="line">    #     # 绘制矩形</span><br><span class="line">    #     bg_img = cv2_open(bg_img)</span><br><span class="line">    #     cv2.rectangle(bg_img, (x, y), (_x, _y), (0, 0, 255), 2)</span><br><span class="line">    #     # 保存缺口识别结果到背景图</span><br><span class="line">    #     if save_path:</span><br><span class="line">    #         save_path = Path(save_path).resolve()</span><br><span class="line">    #         save_path = save_path.parent / f&quot;&#123;save_path.stem&#125;&#123;save_path.suffix&#125;&quot;</span><br><span class="line">    #         save_path = save_path.__str__()</span><br><span class="line">    #         cv2.imwrite(save_path, bg_img)</span><br><span class="line">    #     # 显示缺口识别结果</span><br><span class="line">    #     if im_show:</span><br><span class="line">    #         imshow(bg_img)</span><br><span class="line">    return max_loc[0]</span><br><span class="line"></span><br><span class="line">with open(&quot;./bg_img.png&quot;, &quot;rb&quot;) as f:</span><br><span class="line">    bg_img = f.read()</span><br><span class="line">with open(&quot;./slider_img.webp&quot;, &quot;rb&quot;) as f:</span><br><span class="line">    slice_img = f.read()</span><br><span class="line">distance = get_distance(bg_img, slice_img)</span><br><span class="line">print(distance)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>边缘检测算法详解：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line">from PIL import Image</span><br><span class="line">from pathlib import Path</span><br><span class="line"></span><br><span class="line">def imshow(img, winname=&#x27;test&#x27;, delay=0):</span><br><span class="line">    &quot;&quot;&quot;使用OpenCV显示图片&quot;&quot;&quot;</span><br><span class="line">    cv2.imshow(winname, img)</span><br><span class="line">    cv2.waitKey(delay)  # 等待按键</span><br><span class="line">    cv2.destroyAllWindows()</span><br><span class="line"></span><br><span class="line">def pil_to_cv2(img):</span><br><span class="line">    &quot;&quot;&quot;PIL图像转为OpenCV格式&quot;&quot;&quot;</span><br><span class="line">    img = cv2.cvtColor(np.asarray(img), cv2.COLOR_RGB2BGR)</span><br><span class="line">    return img</span><br><span class="line"></span><br><span class="line">def bytes_to_cv2(img):</span><br><span class="line">    &quot;&quot;&quot;将二进制图片转换为OpenCV格式&quot;&quot;&quot;</span><br><span class="line">    img_buffer_np = np.frombuffer(img, dtype=np.uint8)</span><br><span class="line">    img_np = cv2.imdecode(img_buffer_np, 1)</span><br><span class="line">    return img_np</span><br><span class="line"></span><br><span class="line">def cv2_open(img, flag=None):</span><br><span class="line">    &quot;&quot;&quot;将不同类型的图片统一转换为OpenCV格式&quot;&quot;&quot;</span><br><span class="line">    if isinstance(img, bytes):</span><br><span class="line">        img = bytes_to_cv2(img)</span><br><span class="line">    elif isinstance(img, (str, Path)):</span><br><span class="line">        img = cv2.imread(str(img))</span><br><span class="line">    elif isinstance(img, np.ndarray):</span><br><span class="line">        img = img</span><br><span class="line">    elif isinstance(img, Image.Image):</span><br><span class="line">        img = pil_to_cv2(img)</span><br><span class="line">    else:</span><br><span class="line">        raise ValueError(f&#x27;无法解析的图片类型: &#123;type(img)&#125;&#x27;)</span><br><span class="line">    if flag is not None:</span><br><span class="line">        img = cv2.cvtColor(img, flag)</span><br><span class="line">    return img</span><br><span class="line"></span><br><span class="line"># 第一步：读取图片并展示原图</span><br><span class="line">with open(&quot;./DXCaptcha_20241028/bg_img.png&quot;, &quot;rb&quot;) as f:</span><br><span class="line">    bg_img = f.read()</span><br><span class="line">with open(&quot;./DXCaptcha_20241028/slider_img.webp&quot;, &quot;rb&quot;) as f:</span><br><span class="line">    slice_img = f.read()</span><br><span class="line"></span><br><span class="line">bg = cv2_open(bg_img)</span><br><span class="line">tp = cv2_open(slice_img)</span><br><span class="line"></span><br><span class="line"># 展示背景图和滑块图</span><br><span class="line">print(&quot;展示原始背景图：&quot;)</span><br><span class="line">imshow(bg, &#x27;Background&#x27;)</span><br><span class="line">print(&quot;展示原始滑块图：&quot;)</span><br><span class="line">imshow(tp, &#x27;Slider&#x27;)</span><br><span class="line"></span><br><span class="line"># 第二步：将两张图片都转为灰度图</span><br><span class="line">tp_gray = cv2.cvtColor(tp, cv2.COLOR_BGR2GRAY)</span><br><span class="line">bg_gray = cv2.cvtColor(bg, cv2.COLOR_BGR2GRAY)</span><br><span class="line"># 展示灰度化后的图片</span><br><span class="line">print(&quot;展示灰度滑块图：&quot;)</span><br><span class="line">imshow(tp_gray, &#x27;Gray Slider&#x27;)  # 展示灰度滑块</span><br><span class="line">imshow(bg_gray, &#x27;Gray Background&#x27;)  # 展示灰度背景</span><br><span class="line"></span><br><span class="line"># 第三步：对背景灰度图进行非局部均值去噪，能够同时保留边缘和细节</span><br><span class="line">bg_shift = cv2.fastNlMeansDenoising(bg_gray, None, h=10, templateWindowSize=7, searchWindowSize=21)</span><br><span class="line"># 对背景图进行金字塔均值漂移滤波处理</span><br><span class="line"># bg_shift = cv2.pyrMeanShiftFiltering(bg_img, 5, 50)</span><br><span class="line"># 对背景图进行高斯滤波处理</span><br><span class="line"># bg_shift = cv2.GaussianBlur(bg_img, (5, 5), 0)</span><br><span class="line">print(&quot;展示滤波后的背景图：&quot;)</span><br><span class="line">imshow(bg_shift, &#x27;Filtered Background&#x27;)</span><br><span class="line"></span><br><span class="line">def trackbar(x):</span><br><span class="line">    &quot;&quot;&quot;使用 OpenCV 创建一个窗口，并在该窗口中添加两个滑动条（trackbars），用于调整 Canny 边缘检测算法的阈值&quot;&quot;&quot;</span><br><span class="line">    test1 = cv2.getTrackbarPos(&quot;test1&quot;, &quot;cannyTest&quot;)</span><br><span class="line">    test2 = cv2.getTrackbarPos(&quot;test2&quot;, &quot;cannyTest&quot;)</span><br><span class="line">    canny_img1 = cv2.Canny(tp_gray, test1, test2)</span><br><span class="line">    canny_img2 = cv2.Canny(bg_shift, test1, test2)</span><br><span class="line">    cv2.imshow(&quot;canny_img1&quot;, canny_img1)</span><br><span class="line">    cv2.imshow(&quot;canny_img2&quot;, canny_img2)</span><br><span class="line"></span><br><span class="line">cv2.namedWindow(&#x27;cannyTest&#x27;)</span><br><span class="line">cv2.createTrackbar(&quot;test1&quot;, &quot;cannyTest&quot;, 0, 255, trackbar)</span><br><span class="line">cv2.createTrackbar(&quot;test2&quot;, &quot;cannyTest&quot;, 0, 255, trackbar)</span><br><span class="line"></span><br><span class="line"># 第四步：对滤波后的背景图和滑块进行边缘检测并展示</span><br><span class="line">tp_edge = cv2.Canny(tp_gray, 255, 255)</span><br><span class="line">bg_edge = cv2.Canny(bg_shift, 255, 255)</span><br><span class="line">print(&quot;展示滑块边缘检测结果：&quot;)</span><br><span class="line">imshow(tp_edge, &#x27;Slider Edge&#x27;)</span><br><span class="line">print(&quot;展示背景图边缘检测结果：&quot;)</span><br><span class="line">imshow(bg_edge, &#x27;Background Edge&#x27;)</span><br><span class="line"></span><br><span class="line"># 第五步：使用模板匹配，并展示匹配结果</span><br><span class="line">result = cv2.matchTemplate(bg_edge, tp_edge, cv2.TM_CCOEFF_NORMED)</span><br><span class="line">min_val, max_val, min_loc, max_loc = cv2.minMaxLoc(result)</span><br><span class="line"></span><br><span class="line"># 标出匹配位置</span><br><span class="line">x, y = max_loc</span><br><span class="line">tp_height, tp_width = tp_gray.shape[:2]</span><br><span class="line">cv2.rectangle(bg, (x, y), (x + tp_width, y + tp_height), (0, 0, 255), 2)</span><br><span class="line"></span><br><span class="line">print(f&quot;匹配到的位置：x=&#123;x&#125;, y=&#123;y&#125;&quot;)</span><br><span class="line">print(&quot;展示匹配后的背景图：&quot;)</span><br><span class="line">imshow(bg, &#x27;Matched Background&#x27;)</span><br></pre></td></tr></table></figure>

<h3 id="6-鼠标轨迹-track-生成"><a href="#6-鼠标轨迹-track-生成" class="headerlink" title="6. 鼠标轨迹 track 生成"></a>6. 鼠标轨迹 track 生成</h3><blockquote>
<p>基于贝塞尔曲线生成轨迹可以参考：<a class="link"   href="https://github.com/2833844911/gurs"  target="_blank" rel="noopener">fa5294b67caaf91f4de8d6ed551a810e<i class="fas fa-external-link-alt"></i></a></p>
<p>使用 tanh 和 arctan 函数整合生成轨迹可以参考：<a class="link"   href="https://www.52pojie.cn/forum.php?mod=viewthread&tid=1162979"  target="_blank" rel="noopener">7a15c1aca3c556ac8b660040c6811234<i class="fas fa-external-link-alt"></i></a></p>
</blockquote>
<ul>
<li><strong>轨迹生成算法 new：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br><span class="line">1687</span><br><span class="line">1688</span><br><span class="line">1689</span><br><span class="line">1690</span><br><span class="line">1691</span><br><span class="line">1692</span><br><span class="line">1693</span><br><span class="line">1694</span><br><span class="line">1695</span><br><span class="line">1696</span><br><span class="line">1697</span><br><span class="line">1698</span><br><span class="line">1699</span><br><span class="line">1700</span><br><span class="line">1701</span><br><span class="line">1702</span><br><span class="line">1703</span><br><span class="line">1704</span><br><span class="line">1705</span><br><span class="line">1706</span><br><span class="line">1707</span><br><span class="line">1708</span><br><span class="line">1709</span><br><span class="line">1710</span><br><span class="line">1711</span><br><span class="line">1712</span><br><span class="line">1713</span><br><span class="line">1714</span><br><span class="line">1715</span><br><span class="line">1716</span><br><span class="line">1717</span><br><span class="line">1718</span><br><span class="line">1719</span><br><span class="line">1720</span><br><span class="line">1721</span><br><span class="line">1722</span><br><span class="line">1723</span><br><span class="line">1724</span><br><span class="line">1725</span><br><span class="line">1726</span><br><span class="line">1727</span><br><span class="line">1728</span><br><span class="line">1729</span><br><span class="line">1730</span><br><span class="line">1731</span><br><span class="line">1732</span><br><span class="line">1733</span><br><span class="line">1734</span><br><span class="line">1735</span><br><span class="line">1736</span><br><span class="line">1737</span><br><span class="line">1738</span><br><span class="line">1739</span><br><span class="line">1740</span><br><span class="line">1741</span><br><span class="line">1742</span><br><span class="line">1743</span><br><span class="line">1744</span><br><span class="line">1745</span><br><span class="line">1746</span><br><span class="line">1747</span><br><span class="line">1748</span><br><span class="line">1749</span><br><span class="line">1750</span><br><span class="line">1751</span><br><span class="line">1752</span><br><span class="line">1753</span><br><span class="line">1754</span><br><span class="line">1755</span><br><span class="line">1756</span><br><span class="line">1757</span><br><span class="line">1758</span><br><span class="line">1759</span><br><span class="line">1760</span><br><span class="line">1761</span><br><span class="line">1762</span><br><span class="line">1763</span><br><span class="line">1764</span><br><span class="line">1765</span><br><span class="line">1766</span><br><span class="line">1767</span><br><span class="line">1768</span><br><span class="line">1769</span><br><span class="line">1770</span><br><span class="line">1771</span><br><span class="line">1772</span><br><span class="line">1773</span><br><span class="line">1774</span><br><span class="line">1775</span><br><span class="line">1776</span><br><span class="line">1777</span><br><span class="line">1778</span><br><span class="line">1779</span><br><span class="line">1780</span><br><span class="line">1781</span><br><span class="line">1782</span><br><span class="line">1783</span><br><span class="line">1784</span><br><span class="line">1785</span><br><span class="line">1786</span><br><span class="line">1787</span><br><span class="line">1788</span><br><span class="line">1789</span><br><span class="line">1790</span><br><span class="line">1791</span><br><span class="line">1792</span><br><span class="line">1793</span><br><span class="line">1794</span><br><span class="line">1795</span><br><span class="line">1796</span><br><span class="line">1797</span><br><span class="line">1798</span><br><span class="line">1799</span><br><span class="line">1800</span><br><span class="line">1801</span><br><span class="line">1802</span><br><span class="line">1803</span><br><span class="line">1804</span><br><span class="line">1805</span><br><span class="line">1806</span><br><span class="line">1807</span><br><span class="line">1808</span><br><span class="line">1809</span><br><span class="line">1810</span><br><span class="line">1811</span><br><span class="line">1812</span><br><span class="line">1813</span><br><span class="line">1814</span><br><span class="line">1815</span><br><span class="line">1816</span><br><span class="line">1817</span><br><span class="line">1818</span><br><span class="line">1819</span><br><span class="line">1820</span><br><span class="line">1821</span><br><span class="line">1822</span><br><span class="line">1823</span><br><span class="line">1824</span><br><span class="line">1825</span><br><span class="line">1826</span><br><span class="line">1827</span><br><span class="line">1828</span><br><span class="line">1829</span><br><span class="line">1830</span><br><span class="line">1831</span><br><span class="line">1832</span><br><span class="line">1833</span><br><span class="line">1834</span><br><span class="line">1835</span><br><span class="line">1836</span><br><span class="line">1837</span><br><span class="line">1838</span><br><span class="line">1839</span><br><span class="line">1840</span><br><span class="line">1841</span><br><span class="line">1842</span><br><span class="line">1843</span><br><span class="line">1844</span><br><span class="line">1845</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">import math</span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line">trail_1 = [</span><br><span class="line">    [</span><br><span class="line">        9,</span><br><span class="line">        1,</span><br><span class="line">        111</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        13,</span><br><span class="line">        1,</span><br><span class="line">        121</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        19,</span><br><span class="line">        1,</span><br><span class="line">        126</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        28,</span><br><span class="line">        1,</span><br><span class="line">        136</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        36,</span><br><span class="line">        1,</span><br><span class="line">        146</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        49,</span><br><span class="line">        1,</span><br><span class="line">        153</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        61,</span><br><span class="line">        1,</span><br><span class="line">        163</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        75,</span><br><span class="line">        -2,</span><br><span class="line">        171</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        86,</span><br><span class="line">        -2,</span><br><span class="line">        180</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        96,</span><br><span class="line">        -4,</span><br><span class="line">        190</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        104,</span><br><span class="line">        -4,</span><br><span class="line">        198</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        114,</span><br><span class="line">        -5,</span><br><span class="line">        204</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        122,</span><br><span class="line">        -5,</span><br><span class="line">        214</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        128,</span><br><span class="line">        -6,</span><br><span class="line">        222</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        134,</span><br><span class="line">        -7,</span><br><span class="line">        230</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        139,</span><br><span class="line">        -7,</span><br><span class="line">        242</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        143,</span><br><span class="line">        -7,</span><br><span class="line">        246</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        147,</span><br><span class="line">        -8,</span><br><span class="line">        253</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        151,</span><br><span class="line">        -8,</span><br><span class="line">        266</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        155,</span><br><span class="line">        -8,</span><br><span class="line">        272</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        158,</span><br><span class="line">        -8,</span><br><span class="line">        292</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        161,</span><br><span class="line">        -9,</span><br><span class="line">        299</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        165,</span><br><span class="line">        -9,</span><br><span class="line">        303</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        168,</span><br><span class="line">        -10,</span><br><span class="line">        306</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        171,</span><br><span class="line">        -10,</span><br><span class="line">        313</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        176,</span><br><span class="line">        -10,</span><br><span class="line">        322</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        179,</span><br><span class="line">        -10,</span><br><span class="line">        330</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        184,</span><br><span class="line">        -11,</span><br><span class="line">        341</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        188,</span><br><span class="line">        -11,</span><br><span class="line">        355</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        191,</span><br><span class="line">        -11,</span><br><span class="line">        361</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        194,</span><br><span class="line">        -11,</span><br><span class="line">        367</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        196,</span><br><span class="line">        -11,</span><br><span class="line">        375</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        198,</span><br><span class="line">        -12,</span><br><span class="line">        384</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        201,</span><br><span class="line">        -12,</span><br><span class="line">        393</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        203,</span><br><span class="line">        -12,</span><br><span class="line">        401</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        206,</span><br><span class="line">        -12,</span><br><span class="line">        412</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        208,</span><br><span class="line">        -12,</span><br><span class="line">        420</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        211,</span><br><span class="line">        -13,</span><br><span class="line">        430</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        214,</span><br><span class="line">        -13,</span><br><span class="line">        437</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        215,</span><br><span class="line">        -13,</span><br><span class="line">        448</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        218,</span><br><span class="line">        -13,</span><br><span class="line">        454</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        220,</span><br><span class="line">        -13,</span><br><span class="line">        465</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        223,</span><br><span class="line">        -13,</span><br><span class="line">        473</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        225,</span><br><span class="line">        -13,</span><br><span class="line">        485</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        227,</span><br><span class="line">        -13,</span><br><span class="line">        497</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        228,</span><br><span class="line">        -14,</span><br><span class="line">        505</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        229,</span><br><span class="line">        -14,</span><br><span class="line">        516</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        231,</span><br><span class="line">        -14,</span><br><span class="line">        525</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        232,</span><br><span class="line">        -14,</span><br><span class="line">        534</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        233,</span><br><span class="line">        -14,</span><br><span class="line">        540</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        235,</span><br><span class="line">        -14,</span><br><span class="line">        551</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        237,</span><br><span class="line">        -14,</span><br><span class="line">        562</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        239,</span><br><span class="line">        -14,</span><br><span class="line">        573</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        240,</span><br><span class="line">        -14,</span><br><span class="line">        583</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        241,</span><br><span class="line">        -14,</span><br><span class="line">        588</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        243,</span><br><span class="line">        -14,</span><br><span class="line">        612</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        244,</span><br><span class="line">        -14,</span><br><span class="line">        621</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        245,</span><br><span class="line">        -14,</span><br><span class="line">        632</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        247,</span><br><span class="line">        -14,</span><br><span class="line">        638</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        248,</span><br><span class="line">        -14,</span><br><span class="line">        653</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        249,</span><br><span class="line">        -14,</span><br><span class="line">        661</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        250,</span><br><span class="line">        -14,</span><br><span class="line">        673</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        251,</span><br><span class="line">        -14,</span><br><span class="line">        684</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        252,</span><br><span class="line">        -14,</span><br><span class="line">        696</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        253,</span><br><span class="line">        -14,</span><br><span class="line">        709</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        254,</span><br><span class="line">        -14,</span><br><span class="line">        727</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        255,</span><br><span class="line">        -14,</span><br><span class="line">        740</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        256,</span><br><span class="line">        -14,</span><br><span class="line">        762</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        256,</span><br><span class="line">        -15,</span><br><span class="line">        785</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        257,</span><br><span class="line">        -15,</span><br><span class="line">        809</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        258,</span><br><span class="line">        -15,</span><br><span class="line">        836</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        259,</span><br><span class="line">        -15,</span><br><span class="line">        864</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        260,</span><br><span class="line">        -15,</span><br><span class="line">        875</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        261,</span><br><span class="line">        -15,</span><br><span class="line">        899</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        262,</span><br><span class="line">        -15,</span><br><span class="line">        950</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        263,</span><br><span class="line">        -15,</span><br><span class="line">        969</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        264,</span><br><span class="line">        -15,</span><br><span class="line">        983</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        265,</span><br><span class="line">        -15,</span><br><span class="line">        1016</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        266,</span><br><span class="line">        -15,</span><br><span class="line">        1035</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        267,</span><br><span class="line">        -15,</span><br><span class="line">        1057</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        268,</span><br><span class="line">        -15,</span><br><span class="line">        1069</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        269,</span><br><span class="line">        -15,</span><br><span class="line">        1102</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        270,</span><br><span class="line">        -15,</span><br><span class="line">        1244</span><br><span class="line">    ]</span><br><span class="line">]</span><br><span class="line">trail_2 = [</span><br><span class="line">    [</span><br><span class="line">        11,</span><br><span class="line">        0,</span><br><span class="line">        140</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        13,</span><br><span class="line">        0,</span><br><span class="line">        147</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        16,</span><br><span class="line">        0,</span><br><span class="line">        158</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        19,</span><br><span class="line">        0,</span><br><span class="line">        168</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        21,</span><br><span class="line">        0,</span><br><span class="line">        177</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        24,</span><br><span class="line">        -1,</span><br><span class="line">        184</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        27,</span><br><span class="line">        -1,</span><br><span class="line">        193</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        30,</span><br><span class="line">        -1,</span><br><span class="line">        202</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        32,</span><br><span class="line">        -1,</span><br><span class="line">        213</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        34,</span><br><span class="line">        -1,</span><br><span class="line">        217</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        37,</span><br><span class="line">        -1,</span><br><span class="line">        228</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        38,</span><br><span class="line">        -1,</span><br><span class="line">        235</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        41,</span><br><span class="line">        -1,</span><br><span class="line">        249</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        43,</span><br><span class="line">        -1,</span><br><span class="line">        261</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        45,</span><br><span class="line">        -2,</span><br><span class="line">        270</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        47,</span><br><span class="line">        -2,</span><br><span class="line">        282</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        49,</span><br><span class="line">        -2,</span><br><span class="line">        293</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        50,</span><br><span class="line">        -2,</span><br><span class="line">        301</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        51,</span><br><span class="line">        -2,</span><br><span class="line">        312</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        53,</span><br><span class="line">        -2,</span><br><span class="line">        322</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        54,</span><br><span class="line">        -2,</span><br><span class="line">        332</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        56,</span><br><span class="line">        -2,</span><br><span class="line">        342</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        58,</span><br><span class="line">        -2,</span><br><span class="line">        352</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        60,</span><br><span class="line">        -2,</span><br><span class="line">        362</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        62,</span><br><span class="line">        -2,</span><br><span class="line">        374</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        65,</span><br><span class="line">        -2,</span><br><span class="line">        384</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        66,</span><br><span class="line">        -2,</span><br><span class="line">        392</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        68,</span><br><span class="line">        -2,</span><br><span class="line">        399</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        69,</span><br><span class="line">        -2,</span><br><span class="line">        409</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        71,</span><br><span class="line">        -2,</span><br><span class="line">        422</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        73,</span><br><span class="line">        -2,</span><br><span class="line">        428</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        74,</span><br><span class="line">        -2,</span><br><span class="line">        436</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        76,</span><br><span class="line">        -2,</span><br><span class="line">        447</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        77,</span><br><span class="line">        -2,</span><br><span class="line">        452</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        79,</span><br><span class="line">        -2,</span><br><span class="line">        466</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        82,</span><br><span class="line">        -2,</span><br><span class="line">        476</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        83,</span><br><span class="line">        -2,</span><br><span class="line">        485</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        85,</span><br><span class="line">        -2,</span><br><span class="line">        495</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        86,</span><br><span class="line">        -2,</span><br><span class="line">        506</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        87,</span><br><span class="line">        -2,</span><br><span class="line">        515</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        88,</span><br><span class="line">        -2,</span><br><span class="line">        523</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        90,</span><br><span class="line">        -2,</span><br><span class="line">        542</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        91,</span><br><span class="line">        -2,</span><br><span class="line">        549</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        93,</span><br><span class="line">        -2,</span><br><span class="line">        562</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        94,</span><br><span class="line">        -2,</span><br><span class="line">        568</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        95,</span><br><span class="line">        -2,</span><br><span class="line">        586</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        96,</span><br><span class="line">        -2,</span><br><span class="line">        604</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        97,</span><br><span class="line">        -2,</span><br><span class="line">        630</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        98,</span><br><span class="line">        -2,</span><br><span class="line">        640</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        99,</span><br><span class="line">        -2,</span><br><span class="line">        661</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        100,</span><br><span class="line">        -2,</span><br><span class="line">        680</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        101,</span><br><span class="line">        -2,</span><br><span class="line">        708</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        102,</span><br><span class="line">        -2,</span><br><span class="line">        728</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        103,</span><br><span class="line">        -2,</span><br><span class="line">        756</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        104,</span><br><span class="line">        -2,</span><br><span class="line">        782</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        105,</span><br><span class="line">        -2,</span><br><span class="line">        804</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        106,</span><br><span class="line">        -2,</span><br><span class="line">        821</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        107,</span><br><span class="line">        -2,</span><br><span class="line">        862</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        108,</span><br><span class="line">        -2,</span><br><span class="line">        890</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        109,</span><br><span class="line">        -2,</span><br><span class="line">        927</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        110,</span><br><span class="line">        -2,</span><br><span class="line">        951</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        111,</span><br><span class="line">        -2,</span><br><span class="line">        1029</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        112,</span><br><span class="line">        -2,</span><br><span class="line">        1052</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        113,</span><br><span class="line">        -2,</span><br><span class="line">        1095</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        114,</span><br><span class="line">        -2,</span><br><span class="line">        1112</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        115,</span><br><span class="line">        -2,</span><br><span class="line">        1135</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        116,</span><br><span class="line">        -2,</span><br><span class="line">        1213</span><br><span class="line">    ]</span><br><span class="line">]</span><br><span class="line">trail_3 = [</span><br><span class="line">    [</span><br><span class="line">        13,</span><br><span class="line">        0,</span><br><span class="line">        86</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        18,</span><br><span class="line">        -1,</span><br><span class="line">        96</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        22,</span><br><span class="line">        -1,</span><br><span class="line">        102</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        28,</span><br><span class="line">        -1,</span><br><span class="line">        114</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        33,</span><br><span class="line">        -2,</span><br><span class="line">        120</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        38,</span><br><span class="line">        -2,</span><br><span class="line">        125</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        43,</span><br><span class="line">        -2,</span><br><span class="line">        139</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        47,</span><br><span class="line">        -3,</span><br><span class="line">        149</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        51,</span><br><span class="line">        -3,</span><br><span class="line">        156</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        55,</span><br><span class="line">        -3,</span><br><span class="line">        164</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        58,</span><br><span class="line">        -3,</span><br><span class="line">        172</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        60,</span><br><span class="line">        -4,</span><br><span class="line">        179</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        63,</span><br><span class="line">        -4,</span><br><span class="line">        186</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        65,</span><br><span class="line">        -4,</span><br><span class="line">        195</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        68,</span><br><span class="line">        -4,</span><br><span class="line">        204</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        70,</span><br><span class="line">        -4,</span><br><span class="line">        217</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        72,</span><br><span class="line">        -4,</span><br><span class="line">        221</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        75,</span><br><span class="line">        -4,</span><br><span class="line">        232</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        77,</span><br><span class="line">        -5,</span><br><span class="line">        239</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        78,</span><br><span class="line">        -5,</span><br><span class="line">        251</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        81,</span><br><span class="line">        -5,</span><br><span class="line">        257</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        82,</span><br><span class="line">        -5,</span><br><span class="line">        269</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        84,</span><br><span class="line">        -6,</span><br><span class="line">        276</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        85,</span><br><span class="line">        -6,</span><br><span class="line">        284</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        86,</span><br><span class="line">        -6,</span><br><span class="line">        292</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        87,</span><br><span class="line">        -6,</span><br><span class="line">        305</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        88,</span><br><span class="line">        -6,</span><br><span class="line">        312</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        89,</span><br><span class="line">        -6,</span><br><span class="line">        323</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        90,</span><br><span class="line">        -6,</span><br><span class="line">        340</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        91,</span><br><span class="line">        -6,</span><br><span class="line">        362</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        92,</span><br><span class="line">        -6,</span><br><span class="line">        370</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        93,</span><br><span class="line">        -6,</span><br><span class="line">        391</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        94,</span><br><span class="line">        -6,</span><br><span class="line">        401</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        96,</span><br><span class="line">        -6,</span><br><span class="line">        417</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        97,</span><br><span class="line">        -6,</span><br><span class="line">        438</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        98,</span><br><span class="line">        -6,</span><br><span class="line">        464</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        99,</span><br><span class="line">        -6,</span><br><span class="line">        487</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        100,</span><br><span class="line">        -6,</span><br><span class="line">        501</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        101,</span><br><span class="line">        -6,</span><br><span class="line">        521</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        102,</span><br><span class="line">        -6,</span><br><span class="line">        548</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        103,</span><br><span class="line">        -6,</span><br><span class="line">        565</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        104,</span><br><span class="line">        -6,</span><br><span class="line">        590</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        105,</span><br><span class="line">        -6,</span><br><span class="line">        642</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        106,</span><br><span class="line">        -6,</span><br><span class="line">        688</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        107,</span><br><span class="line">        -6,</span><br><span class="line">        721</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        108,</span><br><span class="line">        -6,</span><br><span class="line">        735</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        109,</span><br><span class="line">        -6,</span><br><span class="line">        770</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        110,</span><br><span class="line">        -6,</span><br><span class="line">        832</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        111,</span><br><span class="line">        -6,</span><br><span class="line">        857</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        112,</span><br><span class="line">        -6,</span><br><span class="line">        887</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        113,</span><br><span class="line">        -6,</span><br><span class="line">        902</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        114,</span><br><span class="line">        -6,</span><br><span class="line">        923</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        115,</span><br><span class="line">        -6,</span><br><span class="line">        950</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        115,</span><br><span class="line">        -5,</span><br><span class="line">        999</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        116,</span><br><span class="line">        -5,</span><br><span class="line">        1008</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        117,</span><br><span class="line">        -5,</span><br><span class="line">        1034</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        118,</span><br><span class="line">        -5,</span><br><span class="line">        1081</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        118,</span><br><span class="line">        -4,</span><br><span class="line">        1089</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        119,</span><br><span class="line">        -4,</span><br><span class="line">        1100</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        120,</span><br><span class="line">        -4,</span><br><span class="line">        1122</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        121,</span><br><span class="line">        -4,</span><br><span class="line">        1159</span><br><span class="line">    ]</span><br><span class="line">]</span><br><span class="line">trail_4 = [</span><br><span class="line">    [</span><br><span class="line">        9,</span><br><span class="line">        0,</span><br><span class="line">        136</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        14,</span><br><span class="line">        -1,</span><br><span class="line">        143</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        17,</span><br><span class="line">        -1,</span><br><span class="line">        152</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        22,</span><br><span class="line">        -2,</span><br><span class="line">        161</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        29,</span><br><span class="line">        -2,</span><br><span class="line">        169</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        35,</span><br><span class="line">        -2,</span><br><span class="line">        177</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        41,</span><br><span class="line">        -3,</span><br><span class="line">        186</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        51,</span><br><span class="line">        -3,</span><br><span class="line">        200</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        58,</span><br><span class="line">        -3,</span><br><span class="line">        206</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        69,</span><br><span class="line">        -4,</span><br><span class="line">        212</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        77,</span><br><span class="line">        -4,</span><br><span class="line">        220</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        87,</span><br><span class="line">        -4,</span><br><span class="line">        231</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        95,</span><br><span class="line">        -4,</span><br><span class="line">        237</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        105,</span><br><span class="line">        -4,</span><br><span class="line">        245</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        114,</span><br><span class="line">        -4,</span><br><span class="line">        254</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        120,</span><br><span class="line">        -4,</span><br><span class="line">        266</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        124,</span><br><span class="line">        -4,</span><br><span class="line">        271</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        128,</span><br><span class="line">        -4,</span><br><span class="line">        285</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        131,</span><br><span class="line">        -4,</span><br><span class="line">        295</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        133,</span><br><span class="line">        -4,</span><br><span class="line">        302</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        135,</span><br><span class="line">        -4,</span><br><span class="line">        308</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        136,</span><br><span class="line">        -4,</span><br><span class="line">        316</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        137,</span><br><span class="line">        -4,</span><br><span class="line">        324</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        138,</span><br><span class="line">        -4,</span><br><span class="line">        335</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        139,</span><br><span class="line">        -4,</span><br><span class="line">        340</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        141,</span><br><span class="line">        -4,</span><br><span class="line">        353</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        142,</span><br><span class="line">        -4,</span><br><span class="line">        362</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        143,</span><br><span class="line">        -4,</span><br><span class="line">        372</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        144,</span><br><span class="line">        -4,</span><br><span class="line">        387</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        145,</span><br><span class="line">        -4,</span><br><span class="line">        389</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        146,</span><br><span class="line">        -4,</span><br><span class="line">        406</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        147,</span><br><span class="line">        -4,</span><br><span class="line">        425</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        148,</span><br><span class="line">        -4,</span><br><span class="line">        455</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        149,</span><br><span class="line">        -4,</span><br><span class="line">        466</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        150,</span><br><span class="line">        -4,</span><br><span class="line">        483</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        150,</span><br><span class="line">        -5,</span><br><span class="line">        492</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        151,</span><br><span class="line">        -5,</span><br><span class="line">        499</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        150,</span><br><span class="line">        -5,</span><br><span class="line">        1202</span><br><span class="line">    ]</span><br><span class="line">]</span><br><span class="line">trail_5 = [</span><br><span class="line">    [</span><br><span class="line">        8,</span><br><span class="line">        -1,</span><br><span class="line">        128</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        12,</span><br><span class="line">        -2,</span><br><span class="line">        137</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        15,</span><br><span class="line">        -2,</span><br><span class="line">        145</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        19,</span><br><span class="line">        -2,</span><br><span class="line">        156</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        22,</span><br><span class="line">        -4,</span><br><span class="line">        160</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        26,</span><br><span class="line">        -4,</span><br><span class="line">        174</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        29,</span><br><span class="line">        -5,</span><br><span class="line">        178</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        32,</span><br><span class="line">        -5,</span><br><span class="line">        187</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        35,</span><br><span class="line">        -5,</span><br><span class="line">        198</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        37,</span><br><span class="line">        -5,</span><br><span class="line">        207</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        38,</span><br><span class="line">        -6,</span><br><span class="line">        212</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        40,</span><br><span class="line">        -6,</span><br><span class="line">        222</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        43,</span><br><span class="line">        -7,</span><br><span class="line">        230</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        44,</span><br><span class="line">        -7,</span><br><span class="line">        240</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        48,</span><br><span class="line">        -8,</span><br><span class="line">        250</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        50,</span><br><span class="line">        -8,</span><br><span class="line">        256</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        53,</span><br><span class="line">        -8,</span><br><span class="line">        266</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        56,</span><br><span class="line">        -9,</span><br><span class="line">        274</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        60,</span><br><span class="line">        -9,</span><br><span class="line">        281</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        64,</span><br><span class="line">        -10,</span><br><span class="line">        292</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        69,</span><br><span class="line">        -10,</span><br><span class="line">        302</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        73,</span><br><span class="line">        -10,</span><br><span class="line">        310</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        78,</span><br><span class="line">        -11,</span><br><span class="line">        319</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        83,</span><br><span class="line">        -12,</span><br><span class="line">        327</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        88,</span><br><span class="line">        -12,</span><br><span class="line">        336</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        92,</span><br><span class="line">        -13,</span><br><span class="line">        343</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        97,</span><br><span class="line">        -13,</span><br><span class="line">        352</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        100,</span><br><span class="line">        -13,</span><br><span class="line">        359</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        103,</span><br><span class="line">        -13,</span><br><span class="line">        367</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        106,</span><br><span class="line">        -13,</span><br><span class="line">        375</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        108,</span><br><span class="line">        -13,</span><br><span class="line">        386</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        111,</span><br><span class="line">        -13,</span><br><span class="line">        393</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        112,</span><br><span class="line">        -13,</span><br><span class="line">        402</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        115,</span><br><span class="line">        -13,</span><br><span class="line">        411</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        117,</span><br><span class="line">        -13,</span><br><span class="line">        422</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        118,</span><br><span class="line">        -13,</span><br><span class="line">        428</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        120,</span><br><span class="line">        -13,</span><br><span class="line">        438</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        122,</span><br><span class="line">        -13,</span><br><span class="line">        444</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        123,</span><br><span class="line">        -13,</span><br><span class="line">        456</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        125,</span><br><span class="line">        -13,</span><br><span class="line">        465</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        126,</span><br><span class="line">        -13,</span><br><span class="line">        472</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        127,</span><br><span class="line">        -13,</span><br><span class="line">        479</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        129,</span><br><span class="line">        -13,</span><br><span class="line">        490</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        131,</span><br><span class="line">        -13,</span><br><span class="line">        501</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        133,</span><br><span class="line">        -13,</span><br><span class="line">        512</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        135,</span><br><span class="line">        -13,</span><br><span class="line">        524</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        137,</span><br><span class="line">        -13,</span><br><span class="line">        529</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        139,</span><br><span class="line">        -13,</span><br><span class="line">        541</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        140,</span><br><span class="line">        -13,</span><br><span class="line">        550</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        142,</span><br><span class="line">        -13,</span><br><span class="line">        562</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        143,</span><br><span class="line">        -13,</span><br><span class="line">        576</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        144,</span><br><span class="line">        -13,</span><br><span class="line">        589</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        145,</span><br><span class="line">        -13,</span><br><span class="line">        595</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        147,</span><br><span class="line">        -13,</span><br><span class="line">        608</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        148,</span><br><span class="line">        -13,</span><br><span class="line">        618</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        149,</span><br><span class="line">        -13,</span><br><span class="line">        631</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        151,</span><br><span class="line">        -14,</span><br><span class="line">        644</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        152,</span><br><span class="line">        -14,</span><br><span class="line">        664</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        153,</span><br><span class="line">        -14,</span><br><span class="line">        673</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        155,</span><br><span class="line">        -14,</span><br><span class="line">        694</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        156,</span><br><span class="line">        -14,</span><br><span class="line">        706</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        157,</span><br><span class="line">        -14,</span><br><span class="line">        721</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        158,</span><br><span class="line">        -14,</span><br><span class="line">        731</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        159,</span><br><span class="line">        -14,</span><br><span class="line">        742</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        160,</span><br><span class="line">        -14,</span><br><span class="line">        759</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        161,</span><br><span class="line">        -14,</span><br><span class="line">        774</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        162,</span><br><span class="line">        -14,</span><br><span class="line">        799</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        163,</span><br><span class="line">        -14,</span><br><span class="line">        815</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        164,</span><br><span class="line">        -14,</span><br><span class="line">        839</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        165,</span><br><span class="line">        -14,</span><br><span class="line">        853</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        166,</span><br><span class="line">        -14,</span><br><span class="line">        870</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        167,</span><br><span class="line">        -14,</span><br><span class="line">        899</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        168,</span><br><span class="line">        -14,</span><br><span class="line">        920</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        169,</span><br><span class="line">        -14,</span><br><span class="line">        940</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        170,</span><br><span class="line">        -14,</span><br><span class="line">        956</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        171,</span><br><span class="line">        -14,</span><br><span class="line">        977</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        172,</span><br><span class="line">        -14,</span><br><span class="line">        998</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        173,</span><br><span class="line">        -14,</span><br><span class="line">        1106</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        174,</span><br><span class="line">        -14,</span><br><span class="line">        1129</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        175,</span><br><span class="line">        -14,</span><br><span class="line">        1182</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        175,</span><br><span class="line">        -13,</span><br><span class="line">        1191</span><br><span class="line">    ]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">def show_plt():</span><br><span class="line">    &quot;&quot;&quot;遍历并绘制五组轨迹数据&quot;&quot;&quot;</span><br><span class="line">    for i in range(1, 6):</span><br><span class="line">        trail_list = eval(f&quot;trail_&#123;i&#125;&quot;)  # 动态获取不同轨迹变量</span><br><span class="line">        print(f&quot;trail_&#123;i&#125;&quot;)</span><br><span class="line"></span><br><span class="line">        # 初始化 X, Y, T 轴数据列表</span><br><span class="line">        x_trail = []</span><br><span class="line">        y_trail = []</span><br><span class="line">        t_trail = []</span><br><span class="line"></span><br><span class="line">        # 遍历单条轨迹中的所有点</span><br><span class="line">        for trail in trail_list:</span><br><span class="line">            x, y, t = trail  # 分别解包 x, y, t 坐标值</span><br><span class="line">            x_trail.append(x)</span><br><span class="line">            y_trail.append(y)</span><br><span class="line">            t_trail.append(t)</span><br><span class="line"></span><br><span class="line">        # 打印 X 轴变化差异</span><br><span class="line">        print(np.diff(x_trail))</span><br><span class="line">        plt.plot(t_trail, x_trail)  # 绘制 T-X 曲线</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"># show_plt()</span><br><span class="line"></span><br><span class="line">def easeOutQuint(x):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    缓动函数：用来生成平滑的运动曲线。</span><br><span class="line">    公式：f(x) = 1 - (1 - x)^5</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    return 1 - math.pow(1 - x, 5)</span><br><span class="line"></span><br><span class="line">def get_trail(move_distance, show=False):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    根据传入的距离生成模拟的轨迹数据。</span><br><span class="line">    :param move_distance: 运动的距离</span><br><span class="line">    :param show: 是否展示轨迹波动曲线</span><br><span class="line">    :return: 包含 [x, y, t] 坐标的轨迹列表</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __set_pt_time(_dist):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        计算每个轨迹点的时间，并随机生成运动和停止阶段的时间点。</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        if _dist &lt; 100:</span><br><span class="line">            __need_time = int(random.uniform(500, 1500))  # 短距离所需时间</span><br><span class="line">        else:</span><br><span class="line">            __need_time = int(random.uniform(1000, 2000))  # 长距离所需时间</span><br><span class="line"></span><br><span class="line">        __end_pt_time = []  # 结束阶段的时间点列表</span><br><span class="line">        __move_pt_time = []  # 运动阶段的时间点列表</span><br><span class="line">        __pos_z = []  # 所有时间点的最终列表</span><br><span class="line"></span><br><span class="line">        # 计算运动阶段所需时间</span><br><span class="line">        total_move_time = __need_time * random.uniform(0.8, 0.9)</span><br><span class="line">        start_point_time = random.uniform(110, 200)  # 起始点时间</span><br><span class="line">        __start_pt_time = [int(start_point_time)]  # 起始阶段时间列表</span><br><span class="line"></span><br><span class="line">        sum_move_time = 0  # 运动时间累计</span><br><span class="line"></span><br><span class="line">        _tmp_total_move_time = total_move_time</span><br><span class="line">        while True:</span><br><span class="line">            delta_time = random.uniform(15, 20)  # 随机时间间隔</span><br><span class="line">            if _tmp_total_move_time &lt; delta_time:</span><br><span class="line">                break</span><br><span class="line"></span><br><span class="line">            sum_move_time += delta_time</span><br><span class="line">            _tmp_total_move_time -= delta_time</span><br><span class="line">            __move_pt_time.append(int(start_point_time + sum_move_time))</span><br><span class="line"></span><br><span class="line">        # 将剩余的运动时间添加为最后一个点时间</span><br><span class="line">        last_pt_time = __move_pt_time[-1]</span><br><span class="line">        __move_pt_time.append(int(last_pt_time + _tmp_total_move_time))</span><br><span class="line"></span><br><span class="line">        # 计算停止阶段的时间点</span><br><span class="line">        sum_end_time = start_point_time + total_move_time</span><br><span class="line">        other_point_time = __need_time - sum_end_time</span><br><span class="line">        end_first_ptime = other_point_time / 2</span><br><span class="line"></span><br><span class="line">        while True:</span><br><span class="line">            delta_time = random.uniform(110, 200)</span><br><span class="line">            if end_first_ptime - delta_time &lt;= 0:</span><br><span class="line">                break</span><br><span class="line"></span><br><span class="line">            end_first_ptime -= delta_time</span><br><span class="line">            sum_end_time += delta_time</span><br><span class="line">            __end_pt_time.append(int(sum_end_time))</span><br><span class="line"></span><br><span class="line">        __end_pt_time.append(int(sum_end_time + (other_point_time / 2 + end_first_ptime)))</span><br><span class="line"></span><br><span class="line">        # 合并所有时间点</span><br><span class="line">        __pos_z.extend(__start_pt_time)</span><br><span class="line">        __pos_z.extend(__move_pt_time)</span><br><span class="line">        __pos_z.extend(__end_pt_time)</span><br><span class="line"></span><br><span class="line">        return __pos_z</span><br><span class="line"></span><br><span class="line">    def __get_pos_y(point_count):</span><br><span class="line">        &quot;&quot;&quot;生成 Y 轴的轨迹点，用于模拟垂直方向的随机运动&quot;&quot;&quot;</span><br><span class="line">        _pos_y = []</span><br><span class="line">        start_y = random.randint(-1, 1)  # 起始 Y 坐标</span><br><span class="line">        end_y = random.randint(-13, -5)  # 结束 Y 坐标</span><br><span class="line">        y_values = np.linspace(start_y, end_y, point_count)  # 在起始和结束之间均匀分布</span><br><span class="line"></span><br><span class="line">        for val in y_values:</span><br><span class="line">            _pos_y.append(int(val))</span><br><span class="line"></span><br><span class="line">        return _pos_y</span><br><span class="line"></span><br><span class="line">    # 获取时间列表和轨迹长度</span><br><span class="line">    time_list = __set_pt_time(move_distance)</span><br><span class="line">    trail_length = len(time_list)</span><br><span class="line"></span><br><span class="line">    # 根据缓动函数生成 X 轴轨迹</span><br><span class="line">    t = np.linspace(-0.5, 1, trail_length)  # 时间范围</span><br><span class="line">    mult = move_distance / 7.59375  # 距离缩放系数</span><br><span class="line">    x = [int(mult * (easeOutQuint(i) + 6.59375)) for i in t]  # 计算 X 坐标</span><br><span class="line"></span><br><span class="line">    # 生成 Y 轴轨迹</span><br><span class="line">    y = __get_pos_y(trail_length)</span><br><span class="line"></span><br><span class="line">    # 添加高斯噪声，模拟波动</span><br><span class="line">    delta_pt = abs(np.random.normal(scale=3, size=trail_length))</span><br><span class="line">    for index in range(len(delta_pt)):</span><br><span class="line">        change_x = int(x[index] + delta_pt[index])</span><br><span class="line">        if index + 1 &lt; trail_length and x[index + 1] &gt; change_x:</span><br><span class="line">            x[index] = change_x</span><br><span class="line"></span><br><span class="line">    # 如果需要展示轨迹波动图</span><br><span class="line">    if show:</span><br><span class="line">        delta_t = [i for i in range(trail_length)]</span><br><span class="line">        plt.plot(delta_t, delta_pt, color=&#x27;green&#x27;)</span><br><span class="line">        plt.show()</span><br><span class="line"></span><br><span class="line">    # 打印轨迹的总位移</span><br><span class="line">    print(x[-1] - x[0])</span><br><span class="line"></span><br><span class="line">    # 返回轨迹结果 [x, y, t]</span><br><span class="line">    result = [[x[i], y[i], time_list[i]] for i in range(trail_length)]</span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line">def showeaseOutQuint(distance):</span><br><span class="line">    &quot;&quot;&quot;绘制缓动函数曲线，展示距离随时间变化的轨迹&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def func(x):</span><br><span class="line">        return 1 - pow(1 - x, 5) + 6.59375</span><br><span class="line"></span><br><span class="line">    print(func(-0.5), func(1))  # 打印函数在边界点的值</span><br><span class="line"></span><br><span class="line">    # 生成曲线数据</span><br><span class="line">    x = np.linspace(-0.5, 1, 70)</span><br><span class="line">    y = [distance / 7.59375 * func(i) for i in x]</span><br><span class="line"></span><br><span class="line">    # 加入随机波动</span><br><span class="line">    delta_pt = abs(np.random.normal(scale=1.1, size=70))</span><br><span class="line">    for index in range(len(delta_pt)):</span><br><span class="line">        change_y = int(x[index] + delta_pt[index])</span><br><span class="line">        if index + 1 &lt; 70 and y[index + 1] &gt; change_y:</span><br><span class="line">            y[index] += change_y</span><br><span class="line"></span><br><span class="line">    # 绘制曲线</span><br><span class="line">    t = np.linspace(100, 1200, 70)</span><br><span class="line">    plt.plot(t, y)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    # 示例：生成随机距离的轨迹并打印</span><br><span class="line">    distance = 100</span><br><span class="line">    result = get_trail(random.randint(100, 200), False)</span><br><span class="line">    print(result)</span><br><span class="line">    &quot;&quot;&quot;        </span><br><span class="line">    1. 收集轨迹</span><br><span class="line">    2. 画出轨迹图像 找缓动函数相同形状</span><br><span class="line">    3. 绘制缓动函数 找到符合形状的作用域</span><br><span class="line">    4. 找到作用域内最大值 最小值 上下移动 *距离系数</span><br><span class="line">    5. 替换时间（t）轴为自己的</span><br><span class="line">    6. 高斯函数增加波动</span><br><span class="line">    7. 细节修改 x轴 t轴 np.diff对比</span><br><span class="line">    &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>轨迹生成算法1：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line"></span><br><span class="line">def get_slide_track1(self, distance):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    根据滑动距离生成滑动轨迹</span><br><span class="line">    :param distance: 需要滑动的距离</span><br><span class="line">    :return: 滑动轨迹&lt;type &#x27;list&#x27;&gt;: [[x,y,t], ...]</span><br><span class="line">        x: 已滑动的横向距离</span><br><span class="line">        y: 已滑动的纵向距离, 除起点外, 均为0</span><br><span class="line">        t: 滑动过程消耗的时间, 单位: 毫秒</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __ease_out_expo(sep):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        缓动函数 easeOutExpo</span><br><span class="line">        参考：https://easings.net/zh-cn#easeOutExpo</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        if sep == 1:</span><br><span class="line">            return 1</span><br><span class="line">        else:</span><br><span class="line">            return 1 - pow(2, -10 * sep)</span><br><span class="line"></span><br><span class="line">    if not isinstance(distance, int) or distance &lt; 0:</span><br><span class="line">        raise ValueError(f&quot;distance类型必须是大于等于0的整数: distance: &#123;distance&#125;, type: &#123;type(distance)&#125;&quot;)</span><br><span class="line">    # 初始化轨迹列表</span><br><span class="line">    slide_track = [</span><br><span class="line">        [random.randint(-50, -10), random.randint(-50, -10), 0],</span><br><span class="line">        [0, 0, 0],</span><br><span class="line">    ]</span><br><span class="line">    # 共记录count次滑块位置信息</span><br><span class="line">    count = 30 + int(distance / 2)</span><br><span class="line">    # 初始化滑动时间</span><br><span class="line">    t = random.randint(50, 100)</span><br><span class="line">    # 记录上一次滑动的距离</span><br><span class="line">    _x = 0</span><br><span class="line">    _y = 0</span><br><span class="line">    for i in range(count):</span><br><span class="line">        # 已滑动的横向距离</span><br><span class="line">        x = round(__ease_out_expo(i / count) * distance)</span><br><span class="line">        # 滑动过程消耗的时间</span><br><span class="line">        t += random.randint(10, 20)</span><br><span class="line">        if x == _x:</span><br><span class="line">            continue</span><br><span class="line">        slide_track.append([x, _y, t])</span><br><span class="line">        _x = x</span><br><span class="line">    slide_track.append(slide_track[-1])</span><br><span class="line"></span><br><span class="line">    logger.info(f&quot;生成轨迹：&#123;slide_track&#125;&quot;)</span><br><span class="line">    return slide_track</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>轨迹生成算法2：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line"></span><br><span class="line">def get_slide_track2(self, x):</span><br><span class="line">    # 初始化轨迹列表</span><br><span class="line">    slide_track = [</span><br><span class="line">        [random.randint(-50, -20), random.randint(-50, -10), 0],</span><br><span class="line">        [0, 0, 0],</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    if x &lt; 100:</span><br><span class="line">        move_section = 1  # 如果移动距离小于100 那么move次数为x加上 7到20之间的数</span><br><span class="line">    else:</span><br><span class="line">        move_section = 2  # 如果移动距离小于100 那么move次数为x加上 2乘 7到20之间的数</span><br><span class="line"></span><br><span class="line">    up_down = random.randint(0, 1)  # 确定一个方向 x大于0或x小于0</span><br><span class="line">    y = 0  # 数组的y值</span><br><span class="line">    time = random.randint(0, 10)  # 初始时间 即为第二个数组的时间  后续时间累加操作就可以了</span><br><span class="line">    count = 0</span><br><span class="line">    flag = 0</span><br><span class="line">    repetition = int(x / 4)  # 重复x出现的个数</span><br><span class="line">    frist_count = random.randint(6, 10)  # 前面y为0的数组个数</span><br><span class="line">    for i in range(x * random.randint(move_section * 7, move_section * 21)):  # move_section 在这里起作用</span><br><span class="line">        if i + 1 &gt; x:  # 如果i+1要等于x 或者小于x 但这里基本上都是等于x</span><br><span class="line">            break</span><br><span class="line">        if up_down == 0:  # up_down如果大于0 那么这个轨迹就是y增轨迹</span><br><span class="line">            if i &gt; frist_count:</span><br><span class="line">                if count == 0:</span><br><span class="line">                    y += random.randint(0, 1)</span><br><span class="line">                    count += 1</span><br><span class="line">                if flag &gt; random.randint(8, 10):</span><br><span class="line">                    count = 0</span><br><span class="line">                    flag = 0</span><br><span class="line">                if i + 1 &gt; int(x / 5) * 4:</span><br><span class="line">                    time += random.randint(20, 70)</span><br><span class="line">                elif i + 1 &gt; x - 3:</span><br><span class="line">                    time += random.randint(80, 180)</span><br><span class="line">                else:</span><br><span class="line">                    time += random.randint(0, 5)</span><br><span class="line">                slide_track.append([i + 1, y, time])</span><br><span class="line">                flag += 1</span><br><span class="line">                if random.randint(0, 1):</span><br><span class="line">                    if repetition:</span><br><span class="line">                        slide_track.append([i + 1, y, time + random.randint(0, 3)])</span><br><span class="line">                        flag += 1</span><br><span class="line">                        repetition -= 1</span><br><span class="line">            else:  # 前面几个数组y都为0</span><br><span class="line">                time += random.randint(0, 5)</span><br><span class="line">                slide_track.append([i + 1, y, time])</span><br><span class="line">                if random.randint(0, 1):</span><br><span class="line">                    if repetition:</span><br><span class="line">                        slide_track.append([i + 1, y, time + random.randint(0, 3)])</span><br><span class="line">                        repetition -= 1</span><br><span class="line"></span><br><span class="line">        if up_down == 1:  # up_down如果小于0 那么这个轨迹就是y减轨迹</span><br><span class="line">            if i &gt; frist_count:</span><br><span class="line">                if count == 0:</span><br><span class="line">                    y -= random.randint(0, 1)</span><br><span class="line">                    count += 1</span><br><span class="line">                if flag &gt; random.randint(8, 10):</span><br><span class="line">                    count = 0</span><br><span class="line">                    flag = 0</span><br><span class="line">                if i + 1 &gt; int(x / 5) * 4:</span><br><span class="line">                    time += random.randint(7, 40)</span><br><span class="line">                elif i + 1 &gt; x - 3:</span><br><span class="line">                    time += random.randint(80, 180)</span><br><span class="line">                else:</span><br><span class="line">                    time += random.randint(0, 5)</span><br><span class="line">                slide_track.append([i + 1, y, time])</span><br><span class="line">                flag += 1</span><br><span class="line">                if random.randint(0, 1):</span><br><span class="line">                    if repetition:</span><br><span class="line">                        slide_track.append([i + 1, y, time + random.randint(0, 3)])</span><br><span class="line">                        flag += 1</span><br><span class="line">                        repetition -= 1</span><br><span class="line">            else:</span><br><span class="line">                time += random.randint(0, 5)</span><br><span class="line">                slide_track.append([i + 1, y, time])</span><br><span class="line">                if random.randint(0, 1):</span><br><span class="line">                    if repetition:</span><br><span class="line">                        slide_track.append([i + 1, y, time + random.randint(0, 3)])</span><br><span class="line">                        repetition -= 1</span><br><span class="line"></span><br><span class="line">    print(f&quot;生成轨迹成功：&#123;slide_track&#125;\n&quot;)</span><br><span class="line">    return slide_track</span><br></pre></td></tr></table></figure>

<h3 id="7-验证码参数补环境思路"><a href="#7-验证码参数补环境思路" class="headerlink" title="7. 验证码参数补环境思路"></a>7. 验证码参数补环境思路</h3><blockquote>
<p><strong>验证码常规反反爬流程：</strong></p>
<ol>
<li>初始化一个对象</li>
<li>启动监听事件</li>
<li>滑动触发事件，执行监听事件的方法（例：往数组里 push 加密值）</li>
<li>滑动完将值导出</li>
</ol>
<p><strong>补环境核心思路：</strong>在定位至加密位置后，首先需要明确参数所属对象，根据参数所属对象，考虑两种黑盒调用方法</p>
<ol>
<li>直接通过 window.aaa 全局导出</li>
<li>通过<strong>参数所属对象</strong>导出方法，需要先定位对象开启监听鼠标事件的地方，找到对象声明的位置并断点，注入 hook 脚本 <code>Object = function()&#123;debugger;&#125;</code>（<strong>注入在方法声明之后，对象 new Object 之前</strong>），在 js 中执行监听鼠标事件代码从而开始补环境</li>
</ol>
</blockquote>
<ul>
<li><p><strong>关于 EventTarget 事件的环境：</strong></p>
<ul>
<li><p>代理器不仅仅只是可以用来代理浏览器内置对象，在补环境中遇到补对象时，想要看到对象上所需要或使用到的环境，可以直接使用代理器代理当前对象，即 <code>return new Proxy(&#123;&#125;, getObjhandler(params))</code>，以吐出当前对象身上的环境</p>
</li>
<li><p>当遇到 addEventListener、removeEventListener 和 dispatchEvent API 时，应该考虑在当前对象上补 EventTarget 原型，同时代理当前对象，即可吐出事件相关的环境（完整执行代码，即可在<strong>事件保存对象</strong>中获取到当前环境中监听的具体事件）</p>
</li>
<li><p>需要按照<strong>事件触发顺序</strong>进行模拟，在浏览器中通过手动对<strong>这一组事件</strong>添加监听事件，并触发事件，按照事件顺序在本地模拟事件对象，并进行代理后在对应对象上触发事件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">document.addEventListener(&quot;mousedown&quot;, function (e) &#123; console.log(e.type) &#125;);</span><br><span class="line">document.addEventListener(&quot;mousemove&quot;, function (e) &#123; console.log(e.type) &#125;);</span><br><span class="line">document.addEventListener(&quot;mouseup&quot;, function (e) &#123; console.log(e.type) &#125;);</span><br><span class="line"></span><br><span class="line">var xxx1 = &#123;</span><br><span class="line">    type: &quot;mousedown&quot;,</span><br><span class="line">    clientX: 0,</span><br><span class="line">    clientY: 0</span><br><span class="line">&#125;</span><br><span class="line">var xxx2 = &#123;</span><br><span class="line">    type: &quot;mousemove&quot;,</span><br><span class="line">    clientX: 0,</span><br><span class="line">    clientY: 0</span><br><span class="line">&#125;</span><br><span class="line">var xxx3 = &#123;</span><br><span class="line">    type: &quot;mouseup&quot;,</span><br><span class="line">    clientX: 0,</span><br><span class="line">    clientY: 0</span><br><span class="line">&#125;</span><br><span class="line">xxx1 = new Proxy(xxx1, getObjhandler(&quot;mousedown&quot;))</span><br><span class="line">xxx2 = new Proxy(xxx2, getObjhandler(&quot;mousemove&quot;))</span><br><span class="line">xxx3 = new Proxy(xxx3, getObjhandler(&quot;mouseup&quot;))</span><br><span class="line">myslideVerify.dispatchEvent(xxx1)</span><br><span class="line">myslideVerify.dispatchEvent(xxx2)</span><br><span class="line">myslideVerify.dispatchEvent(xxx3)</span><br></pre></td></tr></table></figure>
</li>
<li><p>最后一步，校验完轨迹后面还会有其他环境监测，所以需要去浏览器拿一套真实轨迹，暂时模拟，<strong>循环触发在滑块对象上</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// https://www.geetest.com/demo/slide-float.html</span><br><span class="line">dom = document.querySelector(&#x27;.geetest_slider_button&#x27;);</span><br><span class="line">track = [];</span><br><span class="line">dom.addEventListener(&quot;mousedown&quot;, function (e) &#123;</span><br><span class="line">    track.push(&#123;</span><br><span class="line">        type: e.type,</span><br><span class="line">        clientX: e.clientX,</span><br><span class="line">        clientY: e.clientY</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">dom.addEventListener(&quot;mousemove&quot;, function (e) &#123;</span><br><span class="line">    track.push(&#123;</span><br><span class="line">        type: e.type,</span><br><span class="line">        clientX: e.clientX,</span><br><span class="line">        clientY: e.clientY</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">dom.addEventListener(&quot;mouseup&quot;, function (e) &#123;</span><br><span class="line">    track.push(&#123;</span><br><span class="line">        type: e.type,</span><br><span class="line">        clientX: e.clientX,</span><br><span class="line">        clientY: e.clientY</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">console.log(&quot;获取轨迹数组:&quot;, track);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="七、验证码逆向实战"><a href="#七、验证码逆向实战" class="headerlink" title="七、验证码逆向实战"></a>七、验证码逆向实战</h2><h3 id="1-极验3代滑块"><a href="#1-极验3代滑块" class="headerlink" title="1. 极验3代滑块"></a>1. 极验3代滑块</h3><blockquote>
<p><strong>请求接口逻辑分析（<a class="link"   href="https://www.geetest.com/demo/slide-float.html"  target="_blank" rel="noopener">测试网站<i class="fas fa-external-link-alt"></i></a>）：</strong></p>
<ol>
<li><strong>register-slide：</strong>携带时间戳，返回 challenge 和 gt 值</li>
<li><strong>gettype.php：</strong>携带 gt 值，返回一堆 js 文件地址</li>
<li><strong>get.php：</strong>携带 <strong>w1</strong>、challenge、gt 参数，返回带有 c 和 s 的数据</li>
<li><strong>ajax.php：</strong>携带 <strong>w2</strong>、challenge、gt 参数，返回滑块类型</li>
<li><strong>get.php：</strong>携带 challenge、gt 等多个参数，返回重要数据，包含新的 challenge、s 值和图片请求地址</li>
<li><strong>ajax.php：</strong>携带 <strong>w3</strong>、新challenge、gt 参数，返回验证成功数据</li>
</ol>
<p><strong>注意：极验必须严格按顺序请求每一次接口，哪怕返回的数据没有用，否则后续请求就会有响应错误的问题</strong></p>
<p><strong><span style="color:red;">逆向 w 值：极验 3 代中，需逆向的 w1 和 w2 参数，可置空，可固定，也可能要 js 生成，具体网站具体分析</span></strong></p>
</blockquote>
<ul>
<li><p><strong>突破策略：</strong></p>
<ol>
<li>验证码存在多个请求接口，<strong>在最终进行验证的接口载荷中通常存在一个需要逆向的加密验证 w 参数</strong>，可以通过启动器定位文件，搜索关键字 “w”，一般需要<strong>对源文件 AST 普通解混淆</strong>后替换文件，定位加密位置</li>
<li>逆向参数通常采用<strong>全扣代码补环境</strong>，<strong>所有方法都可以通过全局对象导出（不能直接导出的，可能是因为导出的对象小了，要往大里导，或者需要细扣代码）</strong>，也可能是因为<strong>存在环境检测</strong>，主要使用脚本补环境，因为环境不多，也可以使用 v_jstools 工具生成临时环境</li>
<li>其中 w3 参数中的滑块移动距离、轨迹加密参数，都是栈堆的上一帧传过来的，需要在上一个栈分析</li>
<li>对于携带 callback 载荷数据的接口返回的 jsonp 格式数据，<strong>一定不要为了方便获取 json 数据直接去掉 callback 参数，因为 callback 也是验证参数之一</strong>，使用正则表达式即可</li>
</ol>
</li>
<li><p><strong>细节避坑总结：</strong></p>
<ol>
<li><strong>关于 challenge 和 s 值：</strong>在第 2 次请求 get.php 接口后，响应会返回新的 challenge 值和 s 值，在后续请求 ajax.php 校验接口时，需要携带的 ch 值和逆向 w3 参数中所使用到的所有 ch 值，都必须是最新的</li>
<li><strong>关于 w3 中的 passtime 数据：</strong>不管是极验几代，逆向 w 时都有个 passtime 参与计算。这个值有两种情况：如果是滑块，则是滑动所用时间，即轨迹的最后一个时间值 **<code>track[track.length - 1][2]</code>**；除了滑块的其他情况，可以写死，也可以随机生成一个值  <strong><code>Math.floor((Math.random()*500) + 4000)</code></strong></li>
<li><strong>关于 w 中的随机变化字符串：</strong>不管是极验几代，都会有一个 16 位随机字符串参与了 w 的加密计算，这个随机字符串一般都会用到两次，这两次要保证是一样的才行</li>
<li><strong>关于缺口识别距离：</strong>滑块距离通常不是从最左边开始的，前面会有几个像素的空白距离，所以<strong>实际 distance &#x3D; 缺口识别距离 - 空白距离</strong>（要不要减去这个值、减去多少，具体网址具体分析）</li>
<li><strong>关于时间间隔：</strong>三代里面，整个流程走得太快了也不行，需要在生成 w 值之后，随机停留个 2 秒左右，例如三代的点选（文字点选、图标点选、语序点选、空间推理）</li>
<li><strong>关于 w2 中的 captcha_token 值：</strong>如果替换文件被检测出来，则返回的 captcha_token 是异常的，会导致一直验证失败</li>
</ol>
</li>
<li><p><strong>极验常见错误返回信息：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// challenge 不对</span><br><span class="line">geetest_xxxxxxxxxxxxx(&#123;&quot;status&quot;: &quot;error&quot;, &quot;error&quot;: &quot;illegal challenge&quot;, &quot;user_error&quot;: &quot;网络不给力&quot;, &quot;error_code&quot;: &quot;error_23&quot;&#125;)</span><br><span class="line">// w 生成不对</span><br><span class="line">geetest_xxxxxxxxxxxxx(&#123;&quot;status&quot;: &quot;error&quot;, &quot;error&quot;: &quot;param decrypt error&quot;, &quot;user_error&quot;: &quot;网络不给力&quot;, &quot;error_code&quot;: &quot;error_03&quot;&#125;)</span><br><span class="line">// 滑动验证没有轨迹</span><br><span class="line">geetest_xxxxxxxxxxxxx(&#123;&quot;status&quot;: &quot;error&quot;, &quot;error&quot;: &quot;not proof&quot;, &quot;user_error&quot;: &quot;网络不给力&quot;, &quot;error_code&quot;: &quot;error_21&quot;&#125;)</span><br><span class="line">// 轨迹、缺口距离、参数问题</span><br><span class="line">geetest_xxxxxxxxxxxxx(&#123;&quot;success&quot;: 0, &quot;message&quot;: &quot;fail&quot;&#125;)  // 缺口距离，轨迹生成问题</span><br><span class="line">geetest_xxxxxxxxxxxxx(&#123;&quot;success&quot;: 0, &quot;message&quot;: &quot;forbidden&quot;&#125;)  // 其余接口 w 参数问题</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-极验3代点选"><a href="#2-极验3代点选" class="headerlink" title="2. 极验3代点选"></a>2. 极验3代点选</h3><blockquote>
<p><strong>点选的请求接口逻辑：</strong>与滑块一致</p>
<p><strong>点选的核心处理逻辑：</strong></p>
<ol>
<li>通过云码识别验证码，得到文字坐标信息，并可以通过多组坐标变化数据，利用 chatgpt 生成坐标算法</li>
<li>w3 参数的逆向中，主要是对验证码图片中的文字坐标的验证，其余鼠标移动轨迹和鼠标点击的坐标信息均未验证，使用一组固定的真实数据模拟即可</li>
</ol>
<p><strong>确认点击的初始坐标位置：</strong>事件监听器断点 –&gt; 鼠标 –&gt; click，断点中 offsetX 和 offsetY 即为点击坐标信息</p>
</blockquote>
<ul>
<li><p><strong>细节避坑总结：</strong></p>
<ol>
<li><p><strong>关于时间间隔：</strong>三代里面，整个流程走得太快了也不行，需要在生成 w 值之后，随机停留个 2 秒左右，例如三代的点选（文字点选、图标点选、语序点选、空间推理），会返回以下错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geetest_xxxxxx(&#123;&quot;status&quot;: &quot;success&quot;, &quot;data&quot;: &#123;&quot;result&quot;: &quot;fail&quot;, &quot;msg&quot;: [&quot;duration short&quot;]&#125;&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h2 id="八、常用-Hook-脚本"><a href="#八、常用-Hook-脚本" class="headerlink" title="八、常用 Hook 脚本"></a>八、常用 Hook 脚本</h2><blockquote>
<p><strong>常用 Hook 脚本：<a class="link"   href="https://www.cnblogs.com/xiaoweigege/p/14954648.html"  target="_blank" rel="noopener">https://www.cnblogs.com/xiaoweigege/p/14954648.html<i class="fas fa-external-link-alt"></i></a></strong></p>
<p><strong>什么是Hook技术？</strong></p>
<ul>
<li>Hook（钩子）是一种软件开发中使用的技术，其目的是截获、修改或扩展程序或系统的行为，优点是可以在不修改原始代码的情况下改变程序的行为（<strong>js逆向中通过在关键点插入钩子，进行代码调试或分析</strong>）</li>
</ul>
<p><strong>Hook技术实现的必要条件：</strong></p>
<ol>
<li>客户端拥有 JavaScript 的最高解释权，可以控制 js 的执行环境，拥有运行时（动态）修改代码的能力</li>
<li>JavaScript 的弱类型特性，其中 <strong>类型间的隐式转换</strong> 和 <strong>变量重定义</strong> 的特性都为 Hook 提供了灵活性</li>
</ol>
<p><strong>注意：只有当被 Hook 函数和无限 debugger 在同一个作用域时，才能 Hook 成功并访问到函数的局部变量</strong></p>
<p><strong>作用（js 逆向中）：</strong>同DOM、XHR断点一样是用于确定加密位置，但使用 hook 调试可能得到的位置更近</p>
</blockquote>
<h3 id="1-hook-Storage"><a href="#1-hook-Storage" class="headerlink" title="1. hook Storage"></a>1. hook Storage</h3><ul>
<li><strong>对 Storage 对象的 setItem 方法进行 Hook：</strong>包括 localStorage 和 sessionStorage</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let old_setItem = Storage.prototype.setItem;</span><br><span class="line">Storage.prototype.setItem = function (key, value) &#123;</span><br><span class="line">    console.log(this, key, value);</span><br><span class="line">    debugger;</span><br><span class="line">    return old_setItem.call(this, key, value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-hook-eval"><a href="#2-hook-eval" class="headerlink" title="2. hook eval"></a>2. hook eval</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">let old_eval = eval;</span><br><span class="line">eval = function (code) &#123;</span><br><span class="line">    console.log(&quot;执行代码:&quot;, code);</span><br><span class="line">    debugger;</span><br><span class="line">    return old_eval(code);</span><br><span class="line">&#125;</span><br><span class="line">let oldtostr = Function.prototype.toString;</span><br><span class="line">Function.prototype.toString = function () &#123;</span><br><span class="line">    res = oldtostr.call(this);</span><br><span class="line">    if (this.name == &#x27;eval&#x27;) &#123;</span><br><span class="line">        console.log(&quot;原始：&quot; + this.name + &#x27; --&gt; toString：&#x27; + res);</span><br><span class="line">        return &quot;function eval() &#123; [native code] &#125;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    return res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-hook-全局属性"><a href="#3-hook-全局属性" class="headerlink" title="3. hook 全局属性"></a>3. hook 全局属性</h3><ul>
<li><strong>思路：</strong>对于一些将加密参数挂载到 window 全局对象上的属性，可以直接通过 hook 属性定义实现快速定位加密堆栈</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(function () &#123;</span><br><span class="line">    var _xxx = window.xxx;</span><br><span class="line">    Object.defineProperty(window, &#x27;xxx&#x27;, &#123;</span><br><span class="line">        set: function (new_xxx) &#123;</span><br><span class="line">            debugger;</span><br><span class="line">            _xxx = new_xxx;</span><br><span class="line">        &#125;,</span><br><span class="line">        get: function () &#123;</span><br><span class="line">            return _xxx;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h3 id="4-hook-XHR-open"><a href="#4-hook-XHR-open" class="headerlink" title="4. hook XHR open"></a>4. hook XHR open</h3><ul>
<li><strong>拦截方法：<code>window.XMLHttpRequest.prototype.open(method, url, async)</code></strong><ul>
<li><strong>作用：</strong>是 XMLHttpRequest 对象的原型链上的方法之一，用于初始化一个 XMLHttpRequest 请求</li>
<li><strong>参数method：</strong>表示 HTTP 请求的方法，如 “GET”、”POST” 等</li>
<li><strong>参数url：</strong>请求的 URL 地址</li>
<li><strong>参数async：</strong>是否使用异步方式发送请求，默认为 true（即异步）</li>
</ul>
</li>
<li><strong>查询字符串参数被加密：</strong>由于查询字符串参数是网址 URL 的一部分，所以初始化 XMLHttpRequest 请求时，参数 url 中一定会包含这个被加密的查询字符串参数（<a class="link"   href="https://www.qimai.cn"  target="_blank" rel="noopener">测试网站<i class="fas fa-external-link-alt"></i></a>）</li>
<li><strong>apply作用：</strong>调用原始的 open 方法，并且确保在特定的上下文（window.XMLHttpRequest.prototype）中执行，即确保了调用的是期望的函数，是自己定义的open，而不是其他可能存在的同名方法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(function () &#123;</span><br><span class="line">    var open = window.XMLHttpRequest.prototype.open;</span><br><span class="line">    window.XMLHttpRequest.prototype.open = function (method, url, async) &#123;</span><br><span class="line">        if (url.indexOf(&#x27;analysis&#x27;) != -1) &#123;</span><br><span class="line">            debugger</span><br><span class="line">        &#125;</span><br><span class="line">        return open.apply(this, arguments);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h3 id="5-hook-json"><a href="#5-hook-json" class="headerlink" title="5. hook json"></a>5. hook json</h3><blockquote>
<p><strong>原理：在 HTTP 请求和响应中，数据通常以字符串的形式传输</strong></p>
<ul>
<li><p><strong>JSON.stringify()：</strong>将 JavaScript 对象转换为 JSON 字符串。对于 POST 请求而言，携带的参数通常会被转换为字符串，并放置在请求体中，将其作为请求体的一部分发送给服务器，这个过程被称为<strong>序列化</strong>，所以一定会<strong>在发送请求前</strong>将携带的参数对象转换为字符串</p>
</li>
<li><p><strong>JSON.parse()：</strong>将 JSON 字符串解析为 JavaScript 对象。<strong>服务器所返回是加密的字符串数据</strong>，所以一定需要<strong>在接受响应数据后</strong>对数据进行解密，再将解密后的字符串解析为 js 对象，目的是确保在客户端中以 js 对象的形式可用，以便在客户端中展示</p>
</li>
</ul>
</blockquote>
<ul>
<li><p><strong>拦截方法：<code>JSON.parse()</code>、<code>JSON.stringify()</code></strong></p>
</li>
<li><p><strong>响应数据被加密：</strong></p>
<ol>
<li>通过 Hook 技术拦截 <strong><code>JSON.parse</code></strong> 的调用，监视 <strong><code>JSON.parse()</code></strong> 的参数即加密数据的变化，<strong>既调试至明文数据出现时向上跟一个栈后分析代码，也可以调试至密文数据出现时向下调试</strong>（<a class="link"   href="https://fanyi.youdao.com/index.html#/"  target="_blank" rel="noopener">测试网站<i class="fas fa-external-link-alt"></i></a>）</li>
<li>通过 <strong>XHR 断点定位</strong>解密位置，原理是因为在 ajax 调用时，发送请求 send 之前，会通过 <strong>success: 、.then、done</strong> 方法设置请求成功后的回调函数，则可以定位到数据解密的位置（<a class="link"   href="https://www.endata.com.cn/BoxOffice/BO/Month/oneMonth.html"  target="_blank" rel="noopener">测试网站<i class="fas fa-external-link-alt"></i></a>）</li>
<li><strong>响应数据加密只可能通过对称加密算法或非对称加密算法，</strong>因为哈希算法是不可逆的，只有对称与非对称算法是可逆的，所以可以通过**搜索关键字 <code>decrypt</code>、<code>decrypt(</code>、<code>des</code> <strong>定位解密，</strong><code>encrypt</code>**定位加密</li>
</ol>
</li>
<li><p><strong>请求载荷参数加密：</strong>通过 Hook 技术拦截 <strong><code>JSON.stringify</code></strong> 的调用，监视 <strong><code>JSON.stringify()</code></strong> 的参数即加密数据的变化，向上跟栈找到参数加密的位置，<strong>在参数生成的位置打上断点调试</strong>（<a class="link"   href="https://www.hh1024.com/#/ranklist/ranklist"  target="_blank" rel="noopener">测试网站<i class="fas fa-external-link-alt"></i></a>）</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(function () &#123;</span><br><span class="line">    var _parse = JSON.parse;</span><br><span class="line">    JSON.parse = function (params) &#123;</span><br><span class="line">        console.log(&quot;解析数据:&quot;, params);</span><br><span class="line">        // 这里可以添加其他逻辑比如 debugger</span><br><span class="line">        debugger</span><br><span class="line">        return _parse(params);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h3 id="6-hook-cookie"><a href="#6-hook-cookie" class="headerlink" title="6. hook cookie"></a>6. hook cookie</h3><ul>
<li><strong>拦截方法：<code>Object.defineProperty(obj, prop, descriptor)</code></strong><ul>
<li><strong>作用：</strong>用于定义或修改（替换）对象的属性，并返回此对象</li>
<li><strong>参数obj：</strong>目标对象</li>
<li><strong>参数prop：</strong>目标对象的要定义或修改的属性</li>
<li><strong>参数descriptor：</strong>描述符对象，可以指定属性的值、可写性等，还可以定义 setter 和 getter 方法</li>
</ul>
</li>
<li><strong>cookies被加密：</strong>注意 cookie 是属于 document 对象的属性，即 **<code>document.cookie</code>**。通过 Hook 技术拦截前需要先清除浏览器Cookie（<a class="link"   href="http://q.10jqka.com.cn/"  target="_blank" rel="noopener">测试网站<i class="fas fa-external-link-alt"></i></a>）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(function () &#123;</span><br><span class="line">    var cookie_data = document.cookie;</span><br><span class="line">    Object.defineProperty(document, &#x27;cookie&#x27;, &#123;</span><br><span class="line">        set: function (new_cookie) &#123;</span><br><span class="line">            // 判断设置的cookie中是否存在被加密值的键，存在返回下标，不存在返回-1</span><br><span class="line">            if (new_cookie.indexOf(&#x27;v&#x27;) != -1) &#123;</span><br><span class="line">                debugger</span><br><span class="line">            &#125;</span><br><span class="line">            cookie_data = new_cookie;</span><br><span class="line">        &#125;,</span><br><span class="line">        get: function () &#123;</span><br><span class="line">            return cookie_data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h3 id="7-hook-请求-响应拦截器"><a href="#7-hook-请求-响应拦截器" class="headerlink" title="7. hook 请求&#x2F;响应拦截器"></a>7. hook 请求&#x2F;响应拦截器</h3><blockquote>
<p><strong>引入：</strong>当通过 XHR open Hook 定位加密时，<strong>跟栈到了异步帧</strong>，此时则需要考虑通过寻找 拦截器 去定位加密</p>
<p><strong>调试思路：</strong></p>
<ol>
<li><strong>思路1 - 找响应拦截器：</strong>调试目的是寻找加密位置，而加密位置是在请求拦截器中，但请求拦截器又在异步中，<strong>通过 Hook XHR open 发起请求的 debugger 处开始调试，此时加密参数已经生成，说明是已经经过了请求拦截器，</strong>此时无法再通过调试进入异步代码中的请求拦截器了，但是可以根据请求拦截器和响应拦截器通常<strong>成对出现</strong>的规则，通过定位响应拦截器，从而找到请求拦截器（<strong>注意并不是所有网站都有拦截器的，但是只要有拦截器，那么 Hook XHR open 并往下调试一定会经过响应拦截器</strong>）</li>
<li><strong>思路2 - 找请求拦截器：</strong>从异步帧的上一帧开始往下调试，此时参数还没有被加密，所以只需一步步调试就可以进入到异步代码中的请求拦截器（<strong>调试过程中时刻观察数据值是否被加密，确定加密位置</strong>）</li>
</ol>
<p><strong>js加载执行方式：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">加载js --&gt; 触发请求接口(ajax) --&gt; 构造请求对象 --&gt;【请求拦截器】--&gt; 发送XHR请求(Hook XHR open) --&gt; 返回数据 --&gt;【响应拦截器】</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><p><strong>请求拦截器：</strong>在实际请求被发送之前修改请求的配置，包括添加认证信息、修改请求头、请求参数<strong>加密</strong>等</p>
</li>
<li><p><strong>响应拦截器：</strong>在接收到服务器响应后，结果返回之前修改响应的数据，包括数据格式化处理、参数<strong>解密</strong>等</p>
</li>
<li><p><strong>注意：拦截器不是 Hook 代码段，而是通过请求的 XHR open Hook 进行 debugger 调试跟栈，定位拦截器</strong></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">var axios = require(&#x27;axios&#x27;)</span><br><span class="line"></span><br><span class="line">// 请求拦截器</span><br><span class="line">axios.interceptors.request.use(function (config) &#123;</span><br><span class="line">    console.log(&#x27;请求拦截器 成功&#x27;);</span><br><span class="line">    // 加密逻辑</span><br><span class="line">    config.headers[&#x27;sign&#x27;] = &#x27;fkehdjfsdjfiowhek&#x27;;</span><br><span class="line">    return config;</span><br><span class="line">&#125;, function (error) &#123;</span><br><span class="line">    console.log(&#x27;请求拦截器 失败&#x27;);</span><br><span class="line">    return Promise.reject(error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 响应拦截器</span><br><span class="line">axios.interceptors.response.use(function (response) &#123;</span><br><span class="line">    console.log(&#x27;响应拦截器 成功&#x27;);</span><br><span class="line">    // 解密逻辑</span><br><span class="line">    return response;</span><br><span class="line">&#125;, function (error) &#123;</span><br><span class="line">    console.log(&#x27;响应拦截器 失败&#x27;);</span><br><span class="line">    return Promise.reject(error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//发送请求</span><br><span class="line">axios.get(&#x27;http://httpbin.org/get&#x27;).then(res =&gt; console.log(res))</span><br></pre></td></tr></table></figure>

<h3 id="8-hook-XHR-headers"><a href="#8-hook-XHR-headers" class="headerlink" title="8. hook XHR headers"></a>8. hook XHR headers</h3><ul>
<li><strong>拦截方法：<code>window.XMLHttpRequest.prototype.setRequestHeader(key, value)</code></strong><ul>
<li><strong>作用：</strong>是 XMLHttpRequest 对象的原型链上的方法之一，用于设置 HTTP 请求的头部信息</li>
<li><strong>参数key：</strong>表示要设置的 HTTP 头部的名称</li>
<li><strong>参数value：</strong>表示要设置的 HTTP 头部的值</li>
</ul>
</li>
<li><strong>headers参数值被加密：注意 setRequestHeader 方法是在 open 之后、send 之前调用的</strong>（<a class="link"   href="https://www.qimai.cn"  target="_blank" rel="noopener">测试网站<i class="fas fa-external-link-alt"></i></a>）</li>
<li><strong>headers参数键值都被加密：</strong>由于此时参数的键名也被加密了，所以无法通过 Hook 关键字定位了，只能直接 Hook setRequestHeader，但是这将会 Hook 到全部的参数信息，可以<strong>调试至加密参数出现后再跟栈定位</strong>（也可以通过<strong>XHR断点定位</strong>加密位置，因为 <strong>setRequestHeader 方法是在 open 之后、send 之前调用的</strong>，<a class="link"   href="https://www.qcc.com/web/search?key=%E4%B8%87%E8%BE%BE%E9%9B%86%E5%9B%A2"  target="_blank" rel="noopener">测试网站<i class="fas fa-external-link-alt"></i></a>）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(function () &#123;</span><br><span class="line">    var org = window.XMLHttpRequest.prototype.setRequestHeader;</span><br><span class="line">    window.XMLHttpRequest.prototype.setRequestHeader = function (key, value) &#123;</span><br><span class="line">        if (key == &#x27;&#x27;) &#123;</span><br><span class="line">            debugger</span><br><span class="line">        &#125;</span><br><span class="line">        return org.apply(this, arguments);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h3 id="9-快速批量-hook-碰撞"><a href="#9-快速批量-hook-碰撞" class="headerlink" title="9. 快速批量 hook 碰撞"></a>9. 快速批量 hook 碰撞</h3><ul>
<li><strong>快速 hook 框架：</strong>快速调用 hook 方法实现 hook，同时伪造函数 toString：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">// 保护伪造函数toString</span><br><span class="line">(() =&gt; &#123;</span><br><span class="line">    const $toString = Function.toString</span><br><span class="line">    const random_toString_symbol = Symbol(&#x27;(&#x27;.concat(&#x27;&#x27;, &#x27;)_&#x27;, (Math.random()) + &#x27;&#x27;).toString(36))</span><br><span class="line">    const myToString = function () &#123;</span><br><span class="line">        return typeof this === &#x27;function&#x27; &amp;&amp; this[random_toString_symbol] || $toString.call(this)</span><br><span class="line">    &#125;</span><br><span class="line">    function set_native(func, key, value) &#123;</span><br><span class="line">        Object.defineProperty(func, key, &#123;</span><br><span class="line">            enumerable: false,</span><br><span class="line">            configurable: true,</span><br><span class="line">            writable: true,</span><br><span class="line">            value: value</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    delete Function.prototype.toString</span><br><span class="line">    set_native(Function.prototype, &quot;toString&quot;, myToString)</span><br><span class="line">    set_native(Function.prototype.toString, random_toString_symbol, &quot;function toString() &#123; [native code] &#125;&quot;)</span><br><span class="line">    globalThis.func_set_native = (func) =&gt; &#123;</span><br><span class="line">        random_toString_symbol</span><br><span class="line">        set_native(func, random_toString_symbol, `function $&#123;func.name || &#x27;&#x27;&#125;() &#123; [native code] &#125;`)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).call(this);</span><br><span class="line"></span><br><span class="line">// hook 函数实现</span><br><span class="line">Function.prototype.hook = function (</span><br><span class="line">    context = globalThis,</span><br><span class="line">    functionName,  // 匿名函数需要指定和 上下文的调用对象 一样的名称</span><br><span class="line">    onEnter = (ctx, funcname, mythis) =&gt; console.log(`【$&#123;funcname&#125;】onEnter --&gt;`, mythis, ctx.args),</span><br><span class="line">    onLeave = (retval, funcname) =&gt; console.log(`【$&#123;funcname&#125;】onLeave --&gt;`, retval),</span><br><span class="line">) &#123;</span><br><span class="line">    const targetFunction = this;</span><br><span class="line">    const originalName = targetFunction.name || functionName;</span><br><span class="line">    if (!originalName) &#123;</span><br><span class="line">        console.error(&quot;hook function name is empty!&quot;);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 创建 hook 封装函数</span><br><span class="line">    const hookedFunction = function (...args) &#123;</span><br><span class="line">        const ctx = &#123; args &#125;;  // 参数上下文</span><br><span class="line">        onEnter(ctx, originalName, this);</span><br><span class="line"></span><br><span class="line">        // 调用原始函数并捕获返回值，这里的 this -&gt; window 全局对象</span><br><span class="line">        const retval = targetFunction.apply(this, ctx.args);</span><br><span class="line">        return onLeave(retval, originalName) || retval;  // 调用离开钩子，并检查是否更改返回值</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // 将原始函数伪装成原生格式</span><br><span class="line">    Object.defineProperty(hookedFunction, &quot;name&quot;, &#123; value: originalName &#125;);</span><br><span class="line">    func_set_native(hookedFunction);</span><br><span class="line"></span><br><span class="line">    // 将 hooked 函数绑定到指定上下文</span><br><span class="line">    context[originalName] = hookedFunction;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// ------------------ 测试代码 ------------------</span><br><span class="line">// btoa.hook(undefined, undefined, window);</span><br><span class="line">// btoa(&quot;123&quot;);</span><br><span class="line"></span><br><span class="line">// JSON.stringify.hook(undefined, undefined, JSON);</span><br><span class="line">// JSON.stringify(&#123;&#125;);</span><br><span class="line"></span><br><span class="line">// var bbb = &#123;&#125;;</span><br><span class="line">// bbb.b = function (s) &#123; return s + 1 &#125;;</span><br><span class="line">// bbb.b.hook(undefined, undefined, bbb, &quot;b&quot;);</span><br><span class="line">// bbb.b(123)</span><br><span class="line"></span><br><span class="line">// 在快速 hook 框架的基础上，实现对某些 API 批量添加 hook 方法</span><br><span class="line">let String_hook_Array = Object.getOwnPropertyDescriptors(String)</span><br><span class="line">let String_prototype_hook_Array = Object.getOwnPropertyDescriptors(String.prototype)</span><br><span class="line"></span><br><span class="line">for (const key in String_hook_Array) &#123;</span><br><span class="line">    let value = String_hook_Array[key]</span><br><span class="line">    if (value[&quot;writable&quot;] &amp;&amp; typeof value.value === &quot;function&quot;) &#123;</span><br><span class="line">        console.log(key);</span><br><span class="line">        value.value.hook(String);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">for (const key in String_prototype_hook_Array) &#123;</span><br><span class="line">    let value = String_prototype_hook_Array[key]</span><br><span class="line">    if (value[&quot;writable&quot;] &amp;&amp; typeof value.value === &quot;function&quot;</span><br><span class="line">        &amp;&amp; key !== &quot;toString&quot; &amp;&amp; key !== &quot;concat&quot;</span><br><span class="line">    ) &#123;</span><br><span class="line">        console.log(key);</span><br><span class="line">        value.value.hook(String.prototype);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">console.log(&quot;enum hook start&quot;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>完整框架：在快速 hook 框架的基础上，实现对某些 API 批量添加 hook 方法</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">// 保护伪造函数toString</span><br><span class="line">(() =&gt; &#123;</span><br><span class="line">    const $toString = Function.toString</span><br><span class="line">    const random_toString_symbol = Symbol(&#x27;(&#x27;.concat(&#x27;&#x27;, &#x27;)_&#x27;, (Math.random()) + &#x27;&#x27;).toString(36))</span><br><span class="line">    const myToString = function () &#123;</span><br><span class="line">        return typeof this === &#x27;function&#x27; &amp;&amp; this[random_toString_symbol] || $toString.call(this)</span><br><span class="line">    &#125;</span><br><span class="line">    function set_native(func, key, value) &#123;</span><br><span class="line">        Object.defineProperty(func, key, &#123;</span><br><span class="line">            enumerable: false,</span><br><span class="line">            configurable: true,</span><br><span class="line">            writable: true,</span><br><span class="line">            value: value</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    delete Function.prototype.toString</span><br><span class="line">    set_native(Function.prototype, &quot;toString&quot;, myToString)</span><br><span class="line">    set_native(Function.prototype.toString, random_toString_symbol, &quot;function toString() &#123; [native code] &#125;&quot;)</span><br><span class="line">    globalThis.func_set_native = (func) =&gt; &#123;</span><br><span class="line">        random_toString_symbol</span><br><span class="line">        set_native(func, random_toString_symbol, `function $&#123;func.name || &#x27;&#x27;&#125;() &#123; [native code] &#125;`)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).call(this);</span><br><span class="line"></span><br><span class="line">// hook 函数实现</span><br><span class="line">Function.prototype.hook = function (</span><br><span class="line">    context = globalThis,</span><br><span class="line">    functionName,  // 匿名函数需要指定和 上下文的调用对象 一样的名称</span><br><span class="line">    onEnter = (ctx, funcname, mythis) =&gt; console.log(`【$&#123;funcname&#125;】onEnter --&gt;`, mythis, ctx.args),</span><br><span class="line">    onLeave = (retval, funcname) =&gt; console.log(`【$&#123;funcname&#125;】onLeave --&gt;`, retval),</span><br><span class="line">) &#123;</span><br><span class="line">    const targetFunction = this;</span><br><span class="line">    const originalName = targetFunction.name || functionName;</span><br><span class="line">    if (!originalName) &#123;</span><br><span class="line">        console.error(&quot;hook function name is empty!&quot;);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 创建 hook 封装函数</span><br><span class="line">    const hookedFunction = function (...args) &#123;</span><br><span class="line">        const ctx = &#123; args &#125;;  // 参数上下文</span><br><span class="line">        onEnter(ctx, originalName, this);</span><br><span class="line"></span><br><span class="line">        // 调用原始函数并捕获返回值，这里的 this -&gt; window 全局对象</span><br><span class="line">        const retval = targetFunction.apply(this, ctx.args);</span><br><span class="line">        return onLeave(retval, originalName) || retval;  // 调用离开钩子，并检查是否更改返回值</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // 将原始函数伪装成原生格式</span><br><span class="line">    Object.defineProperty(hookedFunction, &quot;name&quot;, &#123; value: originalName &#125;);</span><br><span class="line">    func_set_native(hookedFunction);</span><br><span class="line"></span><br><span class="line">    // 将 hooked 函数绑定到指定上下文</span><br><span class="line">    context[originalName] = hookedFunction;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 实现黑名单、白名单，快速 Hook 框架</span><br><span class="line">function batchHook(HookObj, BlackList = [], WhiteList = []) &#123;</span><br><span class="line">    // 确保 BlackList 和 WhiteList 是数组</span><br><span class="line">    function startHook(Descriptors, HookObj) &#123;</span><br><span class="line">        for (const descriptorsKey in Descriptors) &#123;</span><br><span class="line">            let value = Descriptors[descriptorsKey]</span><br><span class="line">            let rawFunc = value[&quot;value&quot;]</span><br><span class="line">            if (</span><br><span class="line">                typeof rawFunc === &quot;function&quot;</span><br><span class="line">                &amp;&amp; value[&quot;writable&quot;]</span><br><span class="line">                &amp;&amp; !BlackList.includes(descriptorsKey)</span><br><span class="line">                &amp;&amp; (WhiteList.length ? WhiteList.includes(descriptorsKey) : true)</span><br><span class="line">            ) &#123;</span><br><span class="line">                console.log(descriptorsKey);</span><br><span class="line">                rawFunc.hook(HookObj);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let HookObjDescriptors = Object.getOwnPropertyDescriptors(HookObj);</span><br><span class="line">    startHook(HookObjDescriptors, HookObj);</span><br><span class="line"></span><br><span class="line">    // 如果对象有原型链，处理原型链上的方法</span><br><span class="line">    if (HookObj.prototype) &#123;</span><br><span class="line">        let HookObjPrototypeDescriptors = Object.getOwnPropertyDescriptors(HookObj.prototype);</span><br><span class="line">        startHook(HookObjPrototypeDescriptors, HookObj.prototype);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// -------- 实例测试 --------</span><br><span class="line">// batchHook(String, [&quot;toString&quot;, &quot;concat&quot;], [&quot;fromCharCode&quot;]);</span><br><span class="line">batchHook(String, [&quot;toString&quot;, &quot;concat&quot;]);</span><br></pre></td></tr></table></figure>

<h2 id="九、Hook-反调试绕过"><a href="#九、Hook-反调试绕过" class="headerlink" title="九、Hook 反调试绕过"></a>九、Hook 反调试绕过</h2><h3 id="1-保护-console-API"><a href="#1-保护-console-API" class="headerlink" title="1. 保护 console API"></a>1. 保护 console API</h3><blockquote>
<p><strong>防止反调试置空 console 相关 API：</strong>锁定 console 对象中的可写且可配置的属性，防止它们在运行时被修改</p>
<p>油猴脚本需要在最早时机进行注入：<code>// @run-at       document-start</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">console.clear = function () &#123; &#125;;</span><br><span class="line">Object.getOwnPropertyNames(console).forEach(key =&gt; &#123;</span><br><span class="line">    const descriptor = Object.getOwnPropertyDescriptor(console, key);</span><br><span class="line">    if (descriptor.writable &amp;&amp; descriptor.configurable) &#123;</span><br><span class="line">        Object.defineProperty(console, key, &#123;</span><br><span class="line">            value: console[key],</span><br><span class="line">            configurable: false,</span><br><span class="line">            writable: false,</span><br><span class="line">            enumerable: true</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="2-引入-Symbol-对象"><a href="#2-引入-Symbol-对象" class="headerlink" title="2. 引入 Symbol 对象"></a>2. 引入 Symbol 对象</h3><blockquote>
<p>Symbol 是 ES6 引入的一种基本数据类型，表示独一无二的标识符。与其他数据类型不同的是，Symbol 值是唯一的，不能与其他值相等，哪怕是两个具有相同描述的 Symbol（常用于在对象中添加私有属性或方法，以避免命名冲突）</p>
</blockquote>
<ul>
<li><p>Symbol 对象用法：</p>
<ol>
<li><p><strong>创建 Symbol：</strong>创建 Symbol 时，可以传入一个可选的字符串作为描述，便于调试时识别。每次创建的 Symbol 值都是独一无二的，即使描述相同，也不会相等</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const sym1 = Symbol(&#x27;description&#x27;);</span><br><span class="line">const sym2 = Symbol(&#x27;description&#x27;);</span><br><span class="line"></span><br><span class="line">console.log(sym1 === sym2); // false，每个 Symbol 都是唯一的</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>使用 Symbol 作为对象的键：</strong>Symbol 经常被用作对象的键，适合表示私有属性，因为它们不会在普通的对象遍历（如 for…in、Object.keys）中出现。由于 mySymbol 的唯一性，这种做法避免了与其他键名冲突的问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const mySymbol = Symbol(&#x27;myKey&#x27;);</span><br><span class="line">const obj = &#123;</span><br><span class="line">    [mySymbol]: &#x27;Symbol value&#x27;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">console.log(obj[mySymbol]); // &quot;Symbol value&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>全局 Symbol 注册表：</strong>通过<code>Symbol.for</code>和<code>Symbol.keyFor</code>，可以创建和使用全局注册的 Symbol。<code>Symbol.for</code>会先在全局注册表中查找是否已有该描述的 Symbol，如果有则返回这个已存在的 Symbol，否则创建一个新的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const globalSym1 = Symbol.for(&#x27;sharedKey&#x27;);</span><br><span class="line">const globalSym2 = Symbol.for(&#x27;sharedKey&#x27;);</span><br><span class="line"></span><br><span class="line">console.log(globalSym1 === globalSym2); // true，共享全局 Symbol</span><br><span class="line">console.log(Symbol.keyFor(globalSym1)); // &#x27;sharedKey&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>内置 Symbol：</strong>js 提供了一些内置 Symbol，用于修改对象的默认行为。这些内置 Symbol 都存储在 Symbol 对象中</p>
<ul>
<li><strong>Symbol.iterator</strong>：使对象可被迭代</li>
<li><strong><span style="color:red;">Symbol.toStringTag：更改对象在 <code>Object.prototype.toString</code> 中的返回类型</span></strong></li>
<li><strong>Symbol.hasInstance</strong>：自定义 <code>instanceof</code> 行为</li>
<li><strong>Symbol.toPrimitive</strong>：自定义对象转换为原始类型值</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 使用`Symbol.iterator`使对象可被`for...of`迭代</span><br><span class="line">const myIterable = &#123;</span><br><span class="line">    [Symbol.iterator]: function* () &#123;</span><br><span class="line">        yield 1;</span><br><span class="line">        yield 2;</span><br><span class="line">        yield 3;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">for (let value of myIterable) &#123;</span><br><span class="line">    console.log(value); // 1, 2, 3</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>特点和注意事项：</p>
<ul>
<li><strong>唯一性</strong>：每个 Symbol 值都是独一无二的</li>
<li><strong>不可隐式转换为字符串</strong>：Symbol 不能与字符串直接拼接</li>
<li><strong>不可枚举</strong>：Symbol 键的属性不会出现在普通的遍历（如<code>for...in</code>、<code>Object.keys</code>）中。可以使用 <code>Object.getOwnPropertySymbols</code> 来获取对象中的 Symbol 属性</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const sym = Symbol(&#x27;desc&#x27;);</span><br><span class="line">console.log(&#x27;Symbol is &#x27; + sym); // 报错，不能隐式转换为字符串</span><br><span class="line">console.log(`Symbol is $&#123;String(sym)&#125;`); // 可以通过 String() 显式转换</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h3 id="3-伪造函数-toString"><a href="#3-伪造函数-toString" class="headerlink" title="3. 伪造函数 toString"></a>3. 伪造函数 toString</h3><blockquote>
<p>使用油猴脚本最好删除<strong>严格模式：</strong><code>&#39;use strict&#39;;</code></p>
<p><strong>Symbol.toStringTag：</strong>是一个特殊的内置 Symbol，在 js 中用于控制对象在 <strong><code>Object.prototype.toString.call()</code></strong> 中的显示标签。它允许你自定义对象的 <code>[object ...]</code> 格式，从而更改 <code>Object.prototype.toString()</code> 方法返回的对象类型描述</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Object.prototype.toString.call(navigator); // &#x27;[object Navigator]&#x27;</span><br><span class="line">Navigator.prototype[Symbol.toStringTag]; // &#x27;Navigator&#x27;</span><br><span class="line"></span><br><span class="line">const myObject = &#123;</span><br><span class="line">[Symbol.toStringTag]: &#x27;MyCustomObject&#x27;</span><br><span class="line">&#125;;</span><br><span class="line">console.log(Object.prototype.toString.call(myObject)); // &quot;[object MyCustomObject]&quot;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><strong>Function 和 Object 的关系：</strong>Function 是 Object 的一个子类型，所有的函数实际上也是对象。这两种 toString 方法的不同之处在于，它们分别适用于不同类型的对象并且返回不同的格式</p>
<ol>
<li><p><strong><code>Function.prototype.toString</code>：</strong>用于<strong>函数对象</strong>，返回函数的源码字符串</p>
<ul>
<li>当一个函数调用时，会得到类似 <code>&quot;function funcnName() &#123; [native code] &#125;&quot;</code> 的字符串</li>
<li>Function.prototype.toString.call(Navigator) 返回的是 “function Navigator() { [native code] }”，表示 Navigator 是一个函数对象，并且其实现是<strong>原生代码</strong></li>
</ul>
</li>
</ol>
<ul>
<li><strong>注意：</strong>这个方法专门针对函数类型，如果你调用非函数对象，会抛出错误</li>
</ul>
<ol start="2">
<li><strong><code>Object.prototype.toString</code>：</strong>是一种通用的类型检测方法，适用于所有对象类型，包括<strong>基本类型的包装对象</strong></li>
</ol>
<ul>
<li>调用时会返回 <code>&quot;[object Type]&quot;</code> 格式的字符串，Type 表示对象的类型</li>
<li>Object.prototype.toString.call(Navigator) 返回 “[object Function]”，说明 Navigator 是一个函数对象</li>
</ul>
</blockquote>
<ul>
<li><strong>使用 Symbol 和 Object.defineProperty 来伪装函数的原生 toString 实现（等价于 hook Function 绕过反 hook 的通用版）：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">// 保护伪造函数 toString</span><br><span class="line">(() =&gt; &#123;</span><br><span class="line">    // 1. 保存原始的 Function.toString 方法引用，确保在重新定义后依然可以调用原始方法</span><br><span class="line">    const $toString = Function.toString</span><br><span class="line"></span><br><span class="line">    // 2. 使用 Symbol 创建唯一标识符 myFunction_toString_symbol，用于标记伪装的 toString 输出</span><br><span class="line">    const myFunction_toString_symbol = Symbol(&#x27;(&#x27;.concat(&#x27;&#x27;, &#x27;)_&#x27;, (Math.random()) + &#x27;&#x27;).toString(36))</span><br><span class="line"></span><br><span class="line">    // 3. 定义自定义的 myToString 方法</span><br><span class="line">    const myToString = function () &#123;</span><br><span class="line">        // 如果 this 是一个函数且包含 myFunction_toString_symbol 属性，则返回伪装字符串</span><br><span class="line">        return typeof this === &#x27;function&#x27; &amp;&amp; this[myFunction_toString_symbol] || $toString.call(this)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 4. 定义 set_native 方法，通过 Object.defineProperty 设置不可枚举的属性</span><br><span class="line">    function set_native(func, key, value) &#123;</span><br><span class="line">        Object.defineProperty(func, key, &#123;</span><br><span class="line">            enumerable: false,   // 不可枚举，外部代码无法轻易遍历到</span><br><span class="line">            configurable: true,  // 可配置，允许删除或修改</span><br><span class="line">            writable: true,      // 可写，允许重新赋值</span><br><span class="line">            value: value</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 5. 删除原有的 Function.prototype.toString 方法</span><br><span class="line">    delete Function.prototype.toString</span><br><span class="line"></span><br><span class="line">    // 6. 将自定义的 myToString 方法设为新的 Function.prototype.toString 方法</span><br><span class="line">    set_native(Function.prototype, &quot;toString&quot;, myToString)</span><br><span class="line"></span><br><span class="line">    // 7. 给 toString 方法设置 myFunction_toString_symbol 属性，伪装输出为“原生代码”样式</span><br><span class="line">    set_native(Function.prototype.toString, myFunction_toString_symbol, &quot;function toString() &#123; [native code] &#125;&quot;)</span><br><span class="line"></span><br><span class="line">    // 8. 定义辅助函数 func_set_native，用于动态设置任意函数的伪装 toString 输出</span><br><span class="line">    globalThis.func_set_native = (func) =&gt; &#123;</span><br><span class="line">        // 动态设置传入函数的 myFunction_toString_symbol 属性，使其 toString 输出伪装为“原生代码”样式</span><br><span class="line">        set_native(func, myFunction_toString_symbol, `function $&#123;func.name || &#x27;&#x27;&#125;() &#123; [native code] &#125;`)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).call(this)</span><br></pre></td></tr></table></figure>

<h3 id="4-定时器-debugger"><a href="#4-定时器-debugger" class="headerlink" title="4. 定时器 debugger"></a>4. 定时器 debugger</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">// hook 定时器函数 替换debugger</span><br><span class="line">var teshu_setInterval = setInterval;</span><br><span class="line">var teshu_setTimeout = setTimeout;</span><br><span class="line"></span><br><span class="line">setInterval = function setInterval(code, time) &#123;</span><br><span class="line">    code = code.toString().replace(/debugger/, &quot;&quot;).replace(/function\s*\(\)/, &quot;function aaa()&quot;);</span><br><span class="line">    let result = teshu_setInterval(new Function(code), time);</span><br><span class="line">    console.log(&quot;setInterval: --&gt; &quot;, code, time, result);</span><br><span class="line">    return result;</span><br><span class="line">&#125;;</span><br><span class="line">setTimeout = function setTimeout(code, time) &#123;</span><br><span class="line">    code = code.toString().replace(/debugger/, &quot;&quot;).replace(/function\s*\(\)/, &quot;function aaa()&quot;);</span><br><span class="line">    let result = teshu_setTimeout(new Function(code), time);</span><br><span class="line">    console.log(&quot;setTimeout: --&gt; &quot;, code, time, result);</span><br><span class="line">    return result;</span><br><span class="line">&#125;;</span><br><span class="line">// 其中 result 就是定时器编号，在打印出定时器编号后，可以直接通过 clearTimeout 或 clearInterval 清除定时器</span><br><span class="line"></span><br><span class="line">// 保护伪造函数toString</span><br><span class="line">(() =&gt; &#123;</span><br><span class="line">    const $toString = Function.toString</span><br><span class="line">    const random_toString_symbol = Symbol(&#x27;(&#x27;.concat(&#x27;&#x27;, &#x27;)_&#x27;, (Math.random()) + &#x27;&#x27;).toString(36))</span><br><span class="line">    const myToString = function () &#123;</span><br><span class="line">        return typeof this === &#x27;function&#x27; &amp;&amp; this[random_toString_symbol] || $toString.call(this)</span><br><span class="line">    &#125;</span><br><span class="line">    function set_native(func, key, value) &#123;</span><br><span class="line">        Object.defineProperty(func, key, &#123;</span><br><span class="line">            enumerable: false,</span><br><span class="line">            configurable: true,</span><br><span class="line">            writable: true,</span><br><span class="line">            value: value</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    delete Function.prototype.toString</span><br><span class="line">    set_native(Function.prototype, &quot;toString&quot;, myToString)</span><br><span class="line">    set_native(Function.prototype.toString, random_toString_symbol, &quot;function toString() &#123; [native code] &#125;&quot;)</span><br><span class="line">    globalThis.func_set_native = (func) =&gt; &#123;</span><br><span class="line">        random_toString_symbol</span><br><span class="line">        set_native(func, random_toString_symbol, `function $&#123;func.name || &#x27;&#x27;&#125;() &#123; [native code] &#125;`)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).call(this);</span><br><span class="line"></span><br><span class="line">func_set_native(setInterval);</span><br><span class="line">func_set_native(setTimeout);</span><br></pre></td></tr></table></figure>

<h3 id="5-constructor-debugger"><a href="#5-constructor-debugger" class="headerlink" title="5. constructor debugger"></a>5. constructor debugger</h3><blockquote>
<p><strong>主要拦截 <code>new Function(&quot;debugger&quot;)</code> 这种方式的调用，即通过构造器无线动态构造 debugger 函数的情况</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let _constructor = constructor;</span><br><span class="line">Function.prototype.constructor = function (s) &#123;</span><br><span class="line">    if (s == &quot;debugger&quot;) &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">    return _constructor(s);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="6-反-debugger-案例"><a href="#6-反-debugger-案例" class="headerlink" title="6. 反 debugger 案例"></a>6. 反 debugger 案例</h3><ul>
<li>检测网站：<a class="link"   href="https://blog.aepkill.com/demos/devtools-detector/"  target="_blank" rel="noopener">34d2d58d6573507b88bfe5df7d651599<i class="fas fa-external-link-alt"></i></a>，网站源码：<a class="link"   href="https://github.com/AEPKILL/devtools-detector/tree/master/src/checkers"  target="_blank" rel="noopener">1ffd91d5ec85d5e6d3ab008d32241280<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// 油猴脚本注入反定时器 debugger 脚本即可</span><br></pre></td></tr></table></figure>

<h2 id="十、逆向技巧专题"><a href="#十、逆向技巧专题" class="headerlink" title="十、逆向技巧专题"></a>十、逆向技巧专题</h2><blockquote>
<p><strong>基础爬虫知识：</strong></p>
<ul>
<li>通过浏览器直接访问的方式无法发送 get 以外的请求</li>
<li>实现 post 请求时，参数 data 和 headers 尽量都使用关键字实参，如果 data 中携带的某一字段值为空，则需使用空字符串””代替，而不是 None</li>
<li>请求移动端获取的数据接口时，请求头的 user-agent 也一定要用移动端的</li>
</ul>
<p><strong>请求参数最终是以 Content-Type 字段确定参数类型的：</strong></p>
<ul>
<li><strong>get请求[查询字符串参数]：</strong>显现的，需要通过 request.get() 方法中的 params 参数传递，可以不完整</li>
<li><strong>post请求[表单数据]：</strong>隐藏的，需要通过 request.post() 方法中的 data 参数传递，必须完整</li>
<li><strong>post请求[请求载荷]：</strong>隐藏的，需要通过 request.post() 方法中的 json 参数传递，必须完整</li>
<li><strong>post请求[请求载荷] + <code>&quot;Content-Type&quot;: &quot;application/octet-stream&quot;</code>：</strong>需要 request.post() 方法的 data 参数<strong>传递 bytes 类型数据</strong></li>
</ul>
<p><strong><span style="color:red;">查询字符串参数构建（url 后缀）：</span></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import urllib.parse</span><br><span class="line"></span><br><span class="line">urllib.parse.urlencode(params)  # key1=value1&amp;key2=value2&amp;key3=value3</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="1-特殊逆向代码"><a href="#1-特殊逆向代码" class="headerlink" title="1. 特殊逆向代码"></a>1. 特殊逆向代码</h3><ul>
<li><p><strong>逗号表达式（最后一个逗号的值）：</strong></p>
<ul>
<li><strong>用法：</strong>逗号分隔，按照从左到右的顺序执行其中的每个子表达式，但返回值是最后一个子表达式的值</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(0, i[jt])((0, i[qt])(a, d))  // 等价于i[jt](i[qt](a, d))</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>导出模块中的默认成员（对象、函数、类等）：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 这里 export default 导出了一个包含两个方法的对象</span><br><span class="line">// 由于 js 的特性，第二个 newGuid 的定义会覆盖第一个，因为它们都使用相同的名称</span><br><span class="line">// 这个方法接受一个名为 format 的参数</span><br><span class="line">export default &#123;</span><br><span class="line">    newGuid()&#123;</span><br><span class="line">        return Guid.NewGuid().ToString(&#x27;N&#x27;).toUpperCase();</span><br><span class="line">    &#125;,</span><br><span class="line">    newGuid(format)&#123;</span><br><span class="line">        return Guid.NewGuid().ToString(format);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>函数return的是逗号表达式：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var s, u = (s = null, function () &#123;</span><br><span class="line">        return s || (s = function () &#123;</span><br><span class="line">            var e, t, n, r, i = null;</span><br><span class="line">            return i || (t = new RegExp(&quot;\\u200c&quot;, &quot;g&quot;),</span><br><span class="line">                n = new RegExp(&quot;\\u200d&quot;, &quot;g&quot;),</span><br><span class="line">                r = new RegExp(&quot;.&#123;8&#125;&quot;, &quot;g&quot;),</span><br><span class="line">                e = &quot;asdasdasd&quot;,</span><br><span class="line">                i = &#123;key: o.enc.Utf8.parse(e)&#125;),</span><br><span class="line">                i  // 逗号表达式</span><br><span class="line">        &#125;()),</span><br><span class="line">            s  // 逗号表达式</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>return另一个对象，直接赋值此对象即可：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function() &#123;</span><br><span class="line">    return new d</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>自执行入口模块的webpack（全自执行）：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">var protobuf_min = &#123;</span><br><span class="line">    exports: &#123;&#125;  // 创建一个对象用于存储模块的导出内容</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">(function (module) &#123;</span><br><span class="line">    // 定义一个立即执行函数，传入一个参数 module</span><br><span class="line"></span><br><span class="line">    !function (g) &#123;</span><br><span class="line">        var r, e, t, i;</span><br><span class="line"></span><br><span class="line">        r = &#123;  // webpack的模块</span><br><span class="line">            1: [&#x27;&#x27;],</span><br><span class="line">            2: [&#x27;&#x27;],</span><br><span class="line">            3: [&#x27;&#x27;],</span><br><span class="line">            // ......</span><br><span class="line">            39: [&#x27;&#x27;]</span><br><span class="line">        &#125;,</span><br><span class="line">            e = &#123;&#125;,</span><br><span class="line">            t = [16],</span><br><span class="line"></span><br><span class="line">            i = function t(n) &#123;</span><br><span class="line">                // 定义一个递归函数 i，接受一个参数 n</span><br><span class="line">                var o = e[n];</span><br><span class="line">                // 从 e 对象中获取键为 n 的值</span><br><span class="line">                return o || r[n][0].call(o = e[n] = &#123;</span><br><span class="line">                    exports: &#123;&#125;</span><br><span class="line">                &#125;, t, o, o.exports),</span><br><span class="line">                    // 如果 o 不存在，调用 r[n][0] 函数，并将其返回值赋给 o</span><br><span class="line">                    o.exports</span><br><span class="line">                // 返回 o 对象的 exports 属性</span><br><span class="line">            &#125;(t[0]),</span><br><span class="line">            // 调用 i 函数，传入参数 t[0]，并将结果赋给 i</span><br><span class="line"></span><br><span class="line">            i.util.global.protobuf = i,</span><br><span class="line">            // 将 i 对象赋给 i.util.global.protobuf 属性</span><br><span class="line"></span><br><span class="line">        module &amp;&amp; module.exports &amp;&amp; (module.exports = i);</span><br><span class="line">        // 如果 module 和 module.exports 存在，则将 i 对象赋给 module.exports</span><br><span class="line">    &#125;();</span><br><span class="line"></span><br><span class="line">&#125;)(protobuf_min);  // 将 protobuf_min 作为参数传入外层的立即执行函数</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-定位加密总结"><a href="#2-定位加密总结" class="headerlink" title="2. 定位加密总结"></a>2. 定位加密总结</h3><blockquote>
<p><strong>注意：调试时需要调试至需要逆向的参数或数据对应的密文数据出现时，即正确的密文出现时再跟栈</strong></p>
<ul>
<li>其中<strong>响应数据加密：</strong>可以调试至明文数据出现时<strong>向上跟一个栈后分析代码，解密逻辑一般在 JSON.parse 附近或里面</strong>。也可以调试至密文数据出现时<strong>向下调试</strong>（不建议），观察数据什么时候变成明文</li>
<li><strong>注意：不能调试至明文数据出现时，不向上跟栈而直接向下调试</strong>，因为这可能存在解密后的数据重新复制给了加密变量的情况，导致无法观察到密文数据，也就无法判断解密逻辑存在于哪里</li>
<li>其中<strong>参数加密：</strong>如果参数被赋值给了另一个变量，那么应该去找那个变量的赋值位置，例 **<code>wo=&quot;X-Tingyun&quot;</code>**，则需要找 wo 的赋值位置即是 X-Tingyun 的赋值位置 <strong><code>t.addHeader(wo, i)</code></strong></li>
</ul>
</blockquote>
<ul>
<li><strong><span style="color:red;">根据加密数据分析+搜索关键字定位：</span></strong></li>
</ul>
<img    
                       lazyload
                       alt="image"
                       data-src="https://osswcf.oss-cn-shanghai.aliyuncs.com/2024/01/1705927789-ee046979a73c226.png"
                         style="width:80%;margin:0 auto;"
                 >

<ul>
<li><strong><span style="color:red;">响应数据加密：</span></strong><ol>
<li><strong>Hook JSON.parse(parmas)：</strong>监视参数 parmas 的变化</li>
<li><strong>XHR 断点</strong>：ajax 调用时会通过 <strong>success、then、done</strong> 设置处理（解密）响应数据的回调函数</li>
</ol>
</li>
<li><strong><span style="color:red;">查询字符串参数加密：</span></strong><ol>
<li><strong>Hook XHR open</strong>：open 方法的参数 url 中包含被加密的查询字符串参数</li>
</ol>
</li>
<li><strong><span style="color:red;">表单数据&#x2F;请求载荷参数加密：</span></strong><ol>
<li><strong>Hook JSON.stringify(parmas)：</strong>监视参数 parmas 的变化，<strong>调试至正确的密文数据出现时跟栈</strong></li>
</ol>
</li>
<li><strong><span style="color:red;">请求头headers中参数加密：</span></strong><ol>
<li><strong>Hook XHR setRequestHeader：</strong>setRequestHeader是在 open 方法之后、send 方法之前调用的</li>
<li><strong><span style="color:red;">参数的key和value都被加密：</span><strong>此时无法再 Hook 关键字了，只能直接 Hook 整个 setRequestHeader，但是这将会 Hook 到全部的参数信息，可以</strong>调试至需要的密文数据出现后再跟栈</strong></li>
<li><strong>XHR断点：</strong>setRequestHeader 方法是在 open 之后、send 之前调用的</li>
</ol>
</li>
<li><strong><span style="color:red;">cookies加密：</span></strong><ol>
<li><strong>Hook Object.defineProperty：</strong>Hook 前需要先清除浏览器Cookie</li>
</ol>
</li>
</ul>
<h3 id="3-调试问题记录"><a href="#3-调试问题记录" class="headerlink" title="3. 调试问题记录"></a>3. 调试问题记录</h3><ul>
<li><strong>代码在 js 中调用正常，在 python 调用异常：</strong><ol>
<li><strong>考虑是否是 python 获取的数据有问题</strong>，可以将数据拿到 js 代码运行一下，如果有问题可以跟网页上的数据对比一下，看看是否是因为被反爬了服务器返回了假数据</li>
<li><strong>考虑是否是传递的参数格式有问题：</strong>同样是将对象转换成字符串，<strong>最大的区别就是 JSON.stringify 不会对非 ASCII 字符进行编码处理；而 json.dumps 会使用 ASCII 编码来处理非ASCII字符（如汉字）</strong>。在通过 python 调用 js 并传递请求参数过去加密时，应该在 python 中通过 json.dumps 方法进行转换后再传递；而不是直接传递过去，再在 js 中通过 JSON.stringify 方法进行转换，这样才能保证最终在 python 中对数据 api 发起请求时所携带的请求参数格式和加密的请求参数格式一致</li>
<li><strong>考虑是否是传递数据的字符串两端有引号： <code>json.dumps(params).strip(&#39;&quot;&#39;)</code></strong></li>
<li><strong>考虑是否是传递数据的字符串中有”美化”空格：<code>json.dumps(params).replace(&#39; &#39;, &#39;&#39;)</code></strong></li>
<li><strong>确保在 js 代码中使用的数据是对象而不是字符串：</strong>直接在加密逻辑的函数内部进行 <strong><code>JSON.parse</code></strong> 转换</li>
</ol>
</li>
<li><strong>解决无法正常使用开发者工具：</strong><ol>
<li>观察页面特征：页面跳转对应关键字<code>window.location</code>，页面关闭对应关键字<code>window.close()</code></li>
<li>观察控制台面板特征：输出”控制台数据已被清除”或 “undefine”，对应关键字<code>console.clear()</code></li>
<li><strong>解决：</strong>使用无痕浏览器打开网站（<strong>避免插件 js 文件过多</strong>），开启 “<strong>源代码&#x2F;来源</strong>“ 面板右侧 “<strong>事件监听器断点</strong>“ 的 “<strong>脚本</strong>“，这可以断住网站加载执行的每一个 js 脚本，进行调试和搜索特征对应的关键字，定位到位置后进行”<strong>替换内容</strong>“</li>
<li><strong>如果网站通过页面大小尺寸检测开发者工具是否打开：</strong>可以直接抽离开发者工具</li>
</ol>
</li>
</ul>
<h3 id="4-代码调试专题"><a href="#4-代码调试专题" class="headerlink" title="4. 代码调试专题"></a>4. 代码调试专题</h3><blockquote>
<p><strong>明确：</strong>首先一定要先明确自己需要加密或解密的数据，在跟栈过程中要时刻观察数据值的变化以确定位置</p>
<p><strong>分析：分析加密时一定要先去校验这个参数是否需要逆向，可能不携带也能请求成功（通常指请求头参数）</strong></p>
<p><strong>注意：<span style="color:red;">JavaScript 中的对象是动态的，可以先定义后逐步赋值</span></strong></p>
</blockquote>
<ul>
<li><strong>调试技巧：</strong><ol>
<li><strong>栈堆的帧对应代码作用域，必须确保使用 Hook 时和无限 debugger 在同一个作用域</strong>，才能 Hook 成功</li>
<li>断点调试时，断点的位置非常重要，<strong>不要断在还没有调用的函数中</strong>，函数内部要断在一定会走的逻辑</li>
<li>调试方法时<strong>先看返回值</strong>，逻辑代码中要分析出无效逻辑，只读代码走的部分，<strong>补代码时与网页保持一致</strong></li>
<li><strong>考虑一长串数据是不是固定值</strong>，先直接搜索数据确定是否是写死数据，搜不到则需要找到数据生成位置，打上断点进行调试，如果走不进断点，则说明数据是<strong>页面刷新时生成的</strong>，且只生成一次。如果是常量，则可以直接写死，不影响加密结果；如果是对象（<strong>webpack</strong>），则可以直接将整个对象（<strong>加载器</strong>）拿下来</li>
<li><strong>在调试至异步栈的上一帧观察数据时</strong>，需要先观察数据是否是在异步栈之前就已经被加密过了，而不是在异步中加密的，<strong>此时不能直接观察</strong>，而是打上断点重新请求调试观察，避免作用域问题导致数据不准确</li>
<li>在 XHR 断点定位调试中，如果要找 ajax 的回调函数，那么在跟栈时<strong>注意观察在调用 ajax 的帧的附近的一两个栈</strong>，避免找错真正调用 ajax 的栈</li>
<li><strong>观察接口的启动器中是否有异步的代码</strong>，如果没有异步，那么通过XHR断点是方便跟栈定位到加密位置的</li>
<li>在对称加密算法中，<strong>key 和 iv 一定是固定的</strong>，因为对称加密算法加密和解密必须使用相同的密钥</li>
<li>在 RSA 非对称加密中，<strong>公钥</strong>也有可能不是直接写死在代码中，而是<strong>从请求另一个接口的响应中获取</strong></li>
</ol>
</li>
<li><strong>补代码技巧：</strong><ol>
<li>遇到非 window 对象调用方法，或者在 <strong>new</strong> 一个非 window 对象时，并且进入被调用方法内部看到 <strong>this</strong> 调用，此时可以将整个”类”对象的定义扣下来，而不单独扣某个函数，<strong>包括附近用到这个”类”的所有自执行方法，自执行方法也可以为对象<span style="color:red;">动态赋值</span></strong></li>
<li>遵守从里到外逐层加密的原则，贴着函数找数据生成的位置，如果<strong>和实际生成的数据的不一致</strong>，那可能是在函数外面的下面进行了二次**<span style="color:red;">动态赋值</span><strong>，而函数调用在赋值之后导致的（</strong>在数据生成位置打断点调试**）</li>
<li><strong>自执行方法为形参赋值</strong>，导致找不到对象e的生成位置，例 <strong><code>(function(e)&#123;&#125;).call(this, n(&quot;b639&quot;))</code></strong></li>
<li>补代码时<strong>无效逻辑代码和异常捕获代码都要删除，补的每段代码的位置一定要和浏览器保持一致</strong></li>
<li>找到网站的加密算法，<strong>一定要对比它是不是一个标准的加密算法</strong>，可以加密同样的值进行对比</li>
<li><strong>时间戳：</strong>要确保各参数使用的时间戳一致，还要确保 python 和 js 使用的是同一时间戳（<strong>注意长度相同</strong>）</li>
<li><strong>遇到 <code>window.属性</code> 赋值位置找不到（常量）</strong>，可以在源代码搜索，大概率存在于<strong>首页</strong> document 文档中</li>
<li><strong>遇到 <code>window.方法</code> 在环境中报错（方法）</strong>，直接补环境，也可能是 node 中本身就有的方法（<strong>atob</strong>）</li>
<li><strong>遇到 window 中的环境在 node 中没有</strong>，可以直接让包含环境的那块代码的结果与浏览器保持一致即可</li>
</ol>
</li>
</ul>
<h3 id="5-Webpack专题"><a href="#5-Webpack专题" class="headerlink" title="5. Webpack专题"></a>5. Webpack专题</h3><ol>
<li>如果遇到 <strong>obj.func</strong> 的代码，但是<strong>方法的属性 name 值与 func 不一致</strong>，这可能是因为 webpack 打包后改变了函数调用的名称，此时可以先找一下 obj 的生成。或者直接进入函数，看函数是否是在 webpack 打包后的模块（**<code>function(e, t, n)&#123;&#125;</code>**）中，此时也应该找 obj 的生成，不建议直接扣函数</li>
<li><strong>就算方法的 name 值与 func 一致</strong>，由于 webpack 常见，也应该注意 obj 的生成是否是 webpack 格式</li>
<li><strong>加载器和模块都补完的情况下代码仍然报 call 错误，</strong>可能是由于加载器没有接受模块形参，需要手动补上</li>
<li><strong>加载器执行模块后程序无法退出，</strong>可能是因为加载器内使用了定时器无限执行，可以<strong>置空定时器方法</strong>解决</li>
<li>在导出加载器时，<strong>一定要注释掉加载器自己调用的模块</strong>，否则会调用很多无用模块</li>
</ol>
<h3 id="6-OB混淆专题"><a href="#6-OB混淆专题" class="headerlink" title="6. OB混淆专题"></a>6. OB混淆专题</h3><ol>
<li>扣代码时，后面跟括号的则是方法，<strong>中括号内的属性可以直接还原</strong>，而外层的整体的方法需要扣</li>
<li><strong>请求头中 Content-Type 值为 octet-stream，表示请求携带的数据类型是通用的二进制流媒体类型，需post请求传递 bytes 类型数据，即<code>requests.post(url..., data=bytes(b_data[&#39;data&#39;])</code></strong></li>
<li>补混淆代码时，其结果生成的数据与网页不一致，那么说明补代码时，<strong>缺少了重构数组的自执行方法</strong></li>
<li><strong>代码阻塞不执行：</strong>有两种可能，说明存在检测代码格式化，<strong>需要压缩混淆代码</strong>，也有可能是存在定时器</li>
</ol>
<h3 id="7-jsvmp技术专题"><a href="#7-jsvmp技术专题" class="headerlink" title="7. jsvmp技术专题"></a>7. jsvmp技术专题</h3><ol>
<li><strong>jsvmp代码一般采用全扣，通过日志断点（插桩）或者条件断点调试代码，从而补环境还原算法</strong></li>
<li><strong>断点调试：</strong>jsvmp代码只在页面刷新时加载一次，调试时需要刷新网页才能走进断点（<strong>当断点无法进入时，第一要考虑是否是断点位置错误，一行中有多个断点位置的可能，可能断点的位置逻辑并没有走；第二要考虑是否断点位置的数据已经生成了，需要刷新网页重新生成</strong>）</li>
<li><strong>补环境后无报错，但数据不对（1）：</strong>在调用解释器识别字节码时，往往<strong>在字节码参数后面，还会跟上环境检测的代码参数</strong>，此时需要修改检测条件模拟浏览器环境（例 exports、module）</li>
</ol>
<h3 id="8-补环境专题"><a href="#8-补环境专题" class="headerlink" title="8. 补环境专题"></a>8. 补环境专题</h3><ol>
<li><strong>吐环境脚本不吐环境：</strong>可能是 console.log 被置空，可以将其在吐环境脚本中赋值给其他变量，并替换使用</li>
<li><strong>吐环境脚本使用：</strong>全局导出数据时，<strong>get 总发生在 set 之前</strong>，说明可能在 set 时<strong>存在定时器</strong>，去掉定时器即可</li>
<li><strong>导出方法技巧：如果方法不好导出，那就调试，与浏览器同步调试，看哪个参数或返回值与浏览器不一致</strong></li>
<li><strong>遇到异常报错 ReferenceError: xxx is not defined：</strong>最重要的是和网页保持一致，先确定 xxx 在网页中是什么，是对象则补空对象，是函数则补空函数（补空的前提是对整体代码，对数据无影响）</li>
<li><strong>遇到异常报错 TypeError: Cannot read properties of undefined (reading ‘xxx’)：</strong>无法读取未定义的属性或方法。如果是 js 内置属性，那么则需要补调用它的对象值；如果是环境属性不存在，则直接补对应网页一致的属性值；如果是解密方法不存在，且环境已经补好，则说明还存在环境检测没有处理</li>
<li><strong>遇到异常报错 TypeError: Cannot set properties of undefined (setting ‘display’)：</strong>无法设置属性值 display，在 css 中通过 style 样式设置其属性，所以补环境 <code>&#123;return &#123;style: &#123;display: &#123;&#125;&#125;&#125;&#125;</code></li>
<li><strong>补环境后无报错，但数据不对（2）：</strong>对于吐环境脚本中属性值类型为 undefined 的环境，可能还需要进一步与网页环境值保持一致。其中对于关键环境，例如 cookie、userAgent 等，可能存在在代码中对环境值进行置空或修改的情况，此时可以打印具体环境值进行确定，并通过在所有代码后方补关键环境解决</li>
<li><strong>补环境后无报错，但数据不对（3）：</strong>可能存在环境检测中的 toString 检测，可搜索 <code>native code</code> 或 <code>toString</code> 关键字确定代码中是否有 toString 检测</li>
</ol>
<h3 id="9-Cookie反爬专题"><a href="#9-Cookie反爬专题" class="headerlink" title="9. Cookie反爬专题"></a>9. Cookie反爬专题</h3><blockquote>
<p><strong>重点：<span style="color:red;">Cookie反爬中，生成 Cookie 的代码文件是动态的，每一次请求所返回的代码都不一样，下断点后刷新网页，断点便不再是原始代码位置，此时可以替换文件下断点解决问题</span></strong></p>
</blockquote>
<ol>
<li><strong>在每一次断点调试前，一定要清空 Cookie 值，因为如果 Cookie 一直不失效，可能就一直进入无法断点</strong></li>
<li><strong>HttpOnly属性：</strong>当服务器在设置 Cookie 时将 HTTPOnly 属性设为 true 时，意味着该 Cookie 将不能被 JavaScript 脚本访问，仅能在 HTTP 请求中被发送到服务器端（<strong>即该 Cookie 只能在服务器响应中设置</strong>）</li>
<li>网络面板的 Cookie 日志中，<strong>请求 Cookie</strong> 对应请求头中携带的 Cookie，<strong>响应 Cookie</strong> 对应服务器响应设置的 Cookie 或服务器响应的 js 代码生成的 Cookie</li>
<li><strong>在测试补瑞数环境时，meat 标签 content 属性、自执行 js 函数，外链 js 代码，都必须实时，且缺一不可</strong></li>
</ol>

                    
                </div>

                
                        
<div class="post-copyright-info-container border-box">
    <div class="copyright-info-content border-box">
        <div class="copyright-info-top border-box">
            <div class="copyright-post-title border-box text-ellipsis">
                04_JS逆向_补环境专题
            </div>

            <div class="copyright-post-link border-box text-ellipsis">
                2024/01/01/04-js逆向-补环境专题/
            </div>
        </div>

        <div class="copyright-info-bottom border-box">
            <div class="copyright-post-author bottom-item">
                <div class="type">
                    作者
                </div>
                <div class="content">xfblog</div>
            </div>

            <div class="post-time bottom-item">
                <div class="type">
                    发布于
                </div>
                <div class="content">2024-01-01 00:00</div>
            </div>


            <div class="post-license bottom-item">
                <div class="type">
                    许可
                </div>
                <div class="content tooltip" data-tooltip-content="CC BY-NC-SA 4.0">
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" target="_blank">
                        
                            <i class="fa-brands fa-creative-commons"></i>
                            <i class="fa-brands fa-creative-commons-by"></i>
                            <i class="fa-brands fa-creative-commons-nc"></i>
                            <i class="fa-brands fa-creative-commons-sa"></i>
                        
                    </a>
                </div>
            </div>
        </div>

        <i class="copyright-bg fa-solid fa-copyright"></i>
    </div>
    <div class="copy-copyright-info flex-center tooltip" data-tooltip-content="复制版权信息" data-tooltip-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/Python/">Python</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E7%88%AC%E8%99%AB/">爬虫</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                            <div class="post-share-container border-box">
    <ul class="share-list-wrap border-box">
        <li class="qq share-item border-box flex-center tooltip"
            data-tooltip-content="分享到 QQ"
        >
            <i class="fa-brands fa-qq"></i>
        </li>
        <li class="wechat share-item border-box flex-center tooltip tooltip-img"
            data-tooltip-content="分享到微信"
            data-tooltip-img-tip="微信扫一扫"
            data-tooltip-img-style="background-color: #fff; top: -10px; padding: 0.6rem 0.6rem 0.1rem 0.6rem;"
        >
            <i class="fa-brands fa-weixin"></i>
        </li>
        <li class="weibo share-item border-box flex-center tooltip"
            data-tooltip-content="分享到微博"
        >
            <i class="fa-brands fa-weibo"></i>
        </li>
    </ul>
</div>

                        
                    </div>
                </div>

                
                    

<div class="reward-author-container border-box flex-center">
    <div class="reward-btn border-box flex-center tooltip tooltip-img"
            data-tooltip-img-url="/images/zfb.webp"
            data-tooltip-img-trigger="click"
            data-tooltip-img-style="top: -6px;"
    >
        <i class="fa-solid fa-gift"></i>&nbsp;创作不易，打赏随意，您的支持是我更新的动力💪！
    </div>
</div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/2024/01/15/05-js%E9%80%86%E5%90%91-%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/"
                                   title="05_JS逆向_加密算法"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">05_JS逆向_加密算法</span>
                                        <span class="post-nav-item">上一篇</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2023/12/01/ubuntu-18-04-6%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"
                                   title="03_Python_ubuntu安装配置"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">03_Python_ubuntu安装配置</span>
                                        <span class="post-nav-item">下一篇</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
            <div class="pc-post-toc right-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81JS-%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80"><span class="nav-text">一、JS 语法基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95"><span class="nav-text">1. 基础语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%87%BD%E6%95%B0%E7%9A%84-arguments-%E5%AF%B9%E8%B1%A1"><span class="nav-text">2. 函数的 arguments 对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%87%AA%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="nav-text">3. 自执行函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%8E%9F%E5%9E%8B%E9%93%BE%E4%B8%8E%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="nav-text">4. 原型链与构造函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-Object-%E7%9B%B8%E5%85%B3%E9%87%8D%E7%82%B9%E6%96%B9%E6%B3%95"><span class="nav-text">5. Object 相关重点方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E5%B8%B8%E7%94%A8%E5%AF%B9%E8%B1%A1-API"><span class="nav-text">6. 常用对象 API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-this-%E2%80%93-call%E3%80%81apply-%E5%92%8C-bind"><span class="nav-text">7. this –&gt; call、apply 和 bind</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-ES6%E8%AF%AD%E6%B3%95%E7%B3%96"><span class="nav-text">8. ES6语法糖</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81JS-%E8%AF%AD%E6%B3%95%E8%A1%A5%E5%85%85"><span class="nav-text">二、JS 语法补充</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AE%8C%E5%85%A8%E6%8B%B7%E8%B4%9D%E5%AF%B9%E8%B1%A1"><span class="nav-text">1. 完全拷贝对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%86%85%E9%83%A8%E5%87%BD%E6%95%B0%E5%AF%BC%E5%87%BA"><span class="nav-text">2. 内部函数导出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%BD%AE%E7%A9%BA%E6%96%B9%E6%B3%95"><span class="nav-text">3. 置空方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-json-%E6%95%B0%E6%8D%AE%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-text">4. json 数据的处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%AE%9A%E6%97%B6%E5%99%A8%E8%AF%A6%E8%A7%A3"><span class="nav-text">5. 定时器详解</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81JS-%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C"><span class="nav-text">三、JS 异步操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-XHR-%E5%AF%B9%E8%B1%A1"><span class="nav-text">1. XHR 对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-ajax-%E6%8A%80%E6%9C%AF"><span class="nav-text">2. ajax 技术</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-Promise-%E5%AF%B9%E8%B1%A1"><span class="nav-text">3. Promise 对象</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E8%A1%A5%E7%8E%AF%E5%A2%83-demo"><span class="nav-text">四、补环境 demo</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-getOwnPropertyDescriptors"><span class="nav-text">1. getOwnPropertyDescriptors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-hook-Date-%E4%BC%AA%E9%80%A0%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94"><span class="nav-text">2. hook Date 伪造时间间隔</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-hook-Function-%E7%BB%95%E8%BF%87%E5%8F%8D-hook"><span class="nav-text">3. hook Function 绕过反 hook</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-hook-indexOf-%E5%BC%82%E5%B8%B8%E5%A0%86%E6%A0%88%E6%A3%80%E6%B5%8B"><span class="nav-text">4. hook indexOf 异常堆栈检测</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%86%85%E7%BD%AE-Symbol-%E7%8E%AF%E5%A2%83%E6%A3%80%E6%B5%8B"><span class="nav-text">5. 内置 Symbol 环境检测</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E8%A1%A5%E7%8E%AF%E5%A2%83-VS-%E7%8E%AF%E5%A2%83%E6%A3%80%E6%B5%8B"><span class="nav-text">五、补环境 VS 环境检测</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-nvm-%E2%80%93-node-%E7%89%88%E6%9C%AC"><span class="nav-text">1. nvm – node 版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Proxy-Reflect-%E4%BB%A3%E7%90%86"><span class="nav-text">2. Proxy|Reflect 代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%A1%A5%E7%8E%AF%E5%A2%83%E6%80%9D%E8%B7%AF"><span class="nav-text">3. 补环境思路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%A4%8D%E5%88%B6%E5%AF%B9%E8%B1%A1"><span class="nav-text">4. 浏览器复制对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%86%85%E5%AD%98%E6%BC%AB%E6%B8%B8%E5%AE%9A%E4%BD%8D"><span class="nav-text">5. 浏览器内存漫游定位</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-EventTarget-API"><span class="nav-text">6. EventTarget API</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81Canvas-%E4%B8%8E%E9%AA%8C%E8%AF%81%E7%A0%81%E4%B8%93%E9%A2%98"><span class="nav-text">六、Canvas 与验证码专题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-canvas-%E7%BB%98%E5%9B%BE%E6%93%8D%E4%BD%9C"><span class="nav-text">1. canvas 绘图操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-hook-canvas-%E8%BF%98%E5%8E%9F%E6%96%B9%E6%B3%95"><span class="nav-text">2. hook canvas 还原方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%AA%8C%E8%AF%81%E7%A0%81%E5%BA%95%E5%9B%BE%E4%B9%B1%E5%BA%8F%E8%BF%98%E5%8E%9F"><span class="nav-text">3. 验证码底图乱序还原</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E4%B8%87%E8%83%BD-canvas-%E5%BA%95%E5%9B%BE%E8%BF%98%E5%8E%9F"><span class="nav-text">4. 万能 canvas 底图还原</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%BB%91%E5%8A%A8%E8%B7%9D%E7%A6%BB-distance-%E8%AF%86%E5%88%AB"><span class="nav-text">5. 滑动距离 distance 识别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E9%BC%A0%E6%A0%87%E8%BD%A8%E8%BF%B9-track-%E7%94%9F%E6%88%90"><span class="nav-text">6. 鼠标轨迹 track 生成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E9%AA%8C%E8%AF%81%E7%A0%81%E5%8F%82%E6%95%B0%E8%A1%A5%E7%8E%AF%E5%A2%83%E6%80%9D%E8%B7%AF"><span class="nav-text">7. 验证码参数补环境思路</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E9%AA%8C%E8%AF%81%E7%A0%81%E9%80%86%E5%90%91%E5%AE%9E%E6%88%98"><span class="nav-text">七、验证码逆向实战</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%9E%81%E9%AA%8C3%E4%BB%A3%E6%BB%91%E5%9D%97"><span class="nav-text">1. 极验3代滑块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%9E%81%E9%AA%8C3%E4%BB%A3%E7%82%B9%E9%80%89"><span class="nav-text">2. 极验3代点选</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AB%E3%80%81%E5%B8%B8%E7%94%A8-Hook-%E8%84%9A%E6%9C%AC"><span class="nav-text">八、常用 Hook 脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-hook-Storage"><span class="nav-text">1. hook Storage</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-hook-eval"><span class="nav-text">2. hook eval</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-hook-%E5%85%A8%E5%B1%80%E5%B1%9E%E6%80%A7"><span class="nav-text">3. hook 全局属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-hook-XHR-open"><span class="nav-text">4. hook XHR open</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-hook-json"><span class="nav-text">5. hook json</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-hook-cookie"><span class="nav-text">6. hook cookie</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-hook-%E8%AF%B7%E6%B1%82-%E5%93%8D%E5%BA%94%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="nav-text">7. hook 请求&#x2F;响应拦截器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-hook-XHR-headers"><span class="nav-text">8. hook XHR headers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-%E5%BF%AB%E9%80%9F%E6%89%B9%E9%87%8F-hook-%E7%A2%B0%E6%92%9E"><span class="nav-text">9. 快速批量 hook 碰撞</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%9D%E3%80%81Hook-%E5%8F%8D%E8%B0%83%E8%AF%95%E7%BB%95%E8%BF%87"><span class="nav-text">九、Hook 反调试绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%BF%9D%E6%8A%A4-console-API"><span class="nav-text">1. 保护 console API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%BC%95%E5%85%A5-Symbol-%E5%AF%B9%E8%B1%A1"><span class="nav-text">2. 引入 Symbol 对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E4%BC%AA%E9%80%A0%E5%87%BD%E6%95%B0-toString"><span class="nav-text">3. 伪造函数 toString</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%AE%9A%E6%97%B6%E5%99%A8-debugger"><span class="nav-text">4. 定时器 debugger</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-constructor-debugger"><span class="nav-text">5. constructor debugger</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E5%8F%8D-debugger-%E6%A1%88%E4%BE%8B"><span class="nav-text">6. 反 debugger 案例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E3%80%81%E9%80%86%E5%90%91%E6%8A%80%E5%B7%A7%E4%B8%93%E9%A2%98"><span class="nav-text">十、逆向技巧专题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%89%B9%E6%AE%8A%E9%80%86%E5%90%91%E4%BB%A3%E7%A0%81"><span class="nav-text">1. 特殊逆向代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AE%9A%E4%BD%8D%E5%8A%A0%E5%AF%86%E6%80%BB%E7%BB%93"><span class="nav-text">2. 定位加密总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%B0%83%E8%AF%95%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95"><span class="nav-text">3. 调试问题记录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E4%BB%A3%E7%A0%81%E8%B0%83%E8%AF%95%E4%B8%93%E9%A2%98"><span class="nav-text">4. 代码调试专题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-Webpack%E4%B8%93%E9%A2%98"><span class="nav-text">5. Webpack专题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-OB%E6%B7%B7%E6%B7%86%E4%B8%93%E9%A2%98"><span class="nav-text">6. OB混淆专题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-jsvmp%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98"><span class="nav-text">7. jsvmp技术专题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-%E8%A1%A5%E7%8E%AF%E5%A2%83%E4%B8%93%E9%A2%98"><span class="nav-text">8. 补环境专题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-Cookie%E5%8F%8D%E7%88%AC%E4%B8%93%E9%A2%98"><span class="nav-text">9. Cookie反爬专题</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
    Copyright&nbsp;&copy;&nbsp;<span>2021</span>&nbsp;-&nbsp;2024&nbsp;<a href="https://xfblog.cn/" target="_self">小傅博客</a>&nbsp;-&nbsp;All&nbsp;rights&nbsp;reserved.&nbsp;&nbsp;&nbsp;&nbsp;
    
            <!-- &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">xfblog</a> -->
        
    </div>

    <!-- <div class="theme-info info-item">
        由&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;驱动&nbsp;&&nbsp;主题&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div> -->

    

    

    
        <div class="record-info info-item">
            
                
                    <div class="record-item border-box">
                        <a class=""
                           target="_blank"
                           href="https://beian.miit.gov.cn"
                        >
                            蜀ICP备2021021033号-1
                        </a>
                    </div>
                
            
                
                    <div class="record-item border-box">
                        <a class=""
                           target="_blank"
                           href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51138102000134"
                        >
                            川公网安备 51138102000134号
                        </a>
                    </div>
                
            
        </div>&nbsp;&nbsp;&nbsp;&nbsp;
    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81JS-%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80"><span class="nav-text">一、JS 语法基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95"><span class="nav-text">1. 基础语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%87%BD%E6%95%B0%E7%9A%84-arguments-%E5%AF%B9%E8%B1%A1"><span class="nav-text">2. 函数的 arguments 对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%87%AA%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="nav-text">3. 自执行函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%8E%9F%E5%9E%8B%E9%93%BE%E4%B8%8E%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="nav-text">4. 原型链与构造函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-Object-%E7%9B%B8%E5%85%B3%E9%87%8D%E7%82%B9%E6%96%B9%E6%B3%95"><span class="nav-text">5. Object 相关重点方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E5%B8%B8%E7%94%A8%E5%AF%B9%E8%B1%A1-API"><span class="nav-text">6. 常用对象 API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-this-%E2%80%93-call%E3%80%81apply-%E5%92%8C-bind"><span class="nav-text">7. this –&gt; call、apply 和 bind</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-ES6%E8%AF%AD%E6%B3%95%E7%B3%96"><span class="nav-text">8. ES6语法糖</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81JS-%E8%AF%AD%E6%B3%95%E8%A1%A5%E5%85%85"><span class="nav-text">二、JS 语法补充</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AE%8C%E5%85%A8%E6%8B%B7%E8%B4%9D%E5%AF%B9%E8%B1%A1"><span class="nav-text">1. 完全拷贝对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%86%85%E9%83%A8%E5%87%BD%E6%95%B0%E5%AF%BC%E5%87%BA"><span class="nav-text">2. 内部函数导出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%BD%AE%E7%A9%BA%E6%96%B9%E6%B3%95"><span class="nav-text">3. 置空方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-json-%E6%95%B0%E6%8D%AE%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-text">4. json 数据的处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%AE%9A%E6%97%B6%E5%99%A8%E8%AF%A6%E8%A7%A3"><span class="nav-text">5. 定时器详解</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81JS-%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C"><span class="nav-text">三、JS 异步操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-XHR-%E5%AF%B9%E8%B1%A1"><span class="nav-text">1. XHR 对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-ajax-%E6%8A%80%E6%9C%AF"><span class="nav-text">2. ajax 技术</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-Promise-%E5%AF%B9%E8%B1%A1"><span class="nav-text">3. Promise 对象</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E8%A1%A5%E7%8E%AF%E5%A2%83-demo"><span class="nav-text">四、补环境 demo</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-getOwnPropertyDescriptors"><span class="nav-text">1. getOwnPropertyDescriptors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-hook-Date-%E4%BC%AA%E9%80%A0%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94"><span class="nav-text">2. hook Date 伪造时间间隔</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-hook-Function-%E7%BB%95%E8%BF%87%E5%8F%8D-hook"><span class="nav-text">3. hook Function 绕过反 hook</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-hook-indexOf-%E5%BC%82%E5%B8%B8%E5%A0%86%E6%A0%88%E6%A3%80%E6%B5%8B"><span class="nav-text">4. hook indexOf 异常堆栈检测</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%86%85%E7%BD%AE-Symbol-%E7%8E%AF%E5%A2%83%E6%A3%80%E6%B5%8B"><span class="nav-text">5. 内置 Symbol 环境检测</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E8%A1%A5%E7%8E%AF%E5%A2%83-VS-%E7%8E%AF%E5%A2%83%E6%A3%80%E6%B5%8B"><span class="nav-text">五、补环境 VS 环境检测</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-nvm-%E2%80%93-node-%E7%89%88%E6%9C%AC"><span class="nav-text">1. nvm – node 版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Proxy-Reflect-%E4%BB%A3%E7%90%86"><span class="nav-text">2. Proxy|Reflect 代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%A1%A5%E7%8E%AF%E5%A2%83%E6%80%9D%E8%B7%AF"><span class="nav-text">3. 补环境思路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%A4%8D%E5%88%B6%E5%AF%B9%E8%B1%A1"><span class="nav-text">4. 浏览器复制对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%86%85%E5%AD%98%E6%BC%AB%E6%B8%B8%E5%AE%9A%E4%BD%8D"><span class="nav-text">5. 浏览器内存漫游定位</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-EventTarget-API"><span class="nav-text">6. EventTarget API</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81Canvas-%E4%B8%8E%E9%AA%8C%E8%AF%81%E7%A0%81%E4%B8%93%E9%A2%98"><span class="nav-text">六、Canvas 与验证码专题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-canvas-%E7%BB%98%E5%9B%BE%E6%93%8D%E4%BD%9C"><span class="nav-text">1. canvas 绘图操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-hook-canvas-%E8%BF%98%E5%8E%9F%E6%96%B9%E6%B3%95"><span class="nav-text">2. hook canvas 还原方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%AA%8C%E8%AF%81%E7%A0%81%E5%BA%95%E5%9B%BE%E4%B9%B1%E5%BA%8F%E8%BF%98%E5%8E%9F"><span class="nav-text">3. 验证码底图乱序还原</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E4%B8%87%E8%83%BD-canvas-%E5%BA%95%E5%9B%BE%E8%BF%98%E5%8E%9F"><span class="nav-text">4. 万能 canvas 底图还原</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%BB%91%E5%8A%A8%E8%B7%9D%E7%A6%BB-distance-%E8%AF%86%E5%88%AB"><span class="nav-text">5. 滑动距离 distance 识别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E9%BC%A0%E6%A0%87%E8%BD%A8%E8%BF%B9-track-%E7%94%9F%E6%88%90"><span class="nav-text">6. 鼠标轨迹 track 生成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E9%AA%8C%E8%AF%81%E7%A0%81%E5%8F%82%E6%95%B0%E8%A1%A5%E7%8E%AF%E5%A2%83%E6%80%9D%E8%B7%AF"><span class="nav-text">7. 验证码参数补环境思路</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E9%AA%8C%E8%AF%81%E7%A0%81%E9%80%86%E5%90%91%E5%AE%9E%E6%88%98"><span class="nav-text">七、验证码逆向实战</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%9E%81%E9%AA%8C3%E4%BB%A3%E6%BB%91%E5%9D%97"><span class="nav-text">1. 极验3代滑块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%9E%81%E9%AA%8C3%E4%BB%A3%E7%82%B9%E9%80%89"><span class="nav-text">2. 极验3代点选</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AB%E3%80%81%E5%B8%B8%E7%94%A8-Hook-%E8%84%9A%E6%9C%AC"><span class="nav-text">八、常用 Hook 脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-hook-Storage"><span class="nav-text">1. hook Storage</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-hook-eval"><span class="nav-text">2. hook eval</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-hook-%E5%85%A8%E5%B1%80%E5%B1%9E%E6%80%A7"><span class="nav-text">3. hook 全局属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-hook-XHR-open"><span class="nav-text">4. hook XHR open</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-hook-json"><span class="nav-text">5. hook json</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-hook-cookie"><span class="nav-text">6. hook cookie</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-hook-%E8%AF%B7%E6%B1%82-%E5%93%8D%E5%BA%94%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="nav-text">7. hook 请求&#x2F;响应拦截器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-hook-XHR-headers"><span class="nav-text">8. hook XHR headers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-%E5%BF%AB%E9%80%9F%E6%89%B9%E9%87%8F-hook-%E7%A2%B0%E6%92%9E"><span class="nav-text">9. 快速批量 hook 碰撞</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%9D%E3%80%81Hook-%E5%8F%8D%E8%B0%83%E8%AF%95%E7%BB%95%E8%BF%87"><span class="nav-text">九、Hook 反调试绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%BF%9D%E6%8A%A4-console-API"><span class="nav-text">1. 保护 console API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%BC%95%E5%85%A5-Symbol-%E5%AF%B9%E8%B1%A1"><span class="nav-text">2. 引入 Symbol 对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E4%BC%AA%E9%80%A0%E5%87%BD%E6%95%B0-toString"><span class="nav-text">3. 伪造函数 toString</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%AE%9A%E6%97%B6%E5%99%A8-debugger"><span class="nav-text">4. 定时器 debugger</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-constructor-debugger"><span class="nav-text">5. constructor debugger</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E5%8F%8D-debugger-%E6%A1%88%E4%BE%8B"><span class="nav-text">6. 反 debugger 案例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E3%80%81%E9%80%86%E5%90%91%E6%8A%80%E5%B7%A7%E4%B8%93%E9%A2%98"><span class="nav-text">十、逆向技巧专题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%89%B9%E6%AE%8A%E9%80%86%E5%90%91%E4%BB%A3%E7%A0%81"><span class="nav-text">1. 特殊逆向代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AE%9A%E4%BD%8D%E5%8A%A0%E5%AF%86%E6%80%BB%E7%BB%93"><span class="nav-text">2. 定位加密总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%B0%83%E8%AF%95%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95"><span class="nav-text">3. 调试问题记录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E4%BB%A3%E7%A0%81%E8%B0%83%E8%AF%95%E4%B8%93%E9%A2%98"><span class="nav-text">4. 代码调试专题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-Webpack%E4%B8%93%E9%A2%98"><span class="nav-text">5. Webpack专题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-OB%E6%B7%B7%E6%B7%86%E4%B8%93%E9%A2%98"><span class="nav-text">6. OB混淆专题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-jsvmp%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98"><span class="nav-text">7. jsvmp技术专题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-%E8%A1%A5%E7%8E%AF%E5%A2%83%E4%B8%93%E9%A2%98"><span class="nav-text">8. 补环境专题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-Cookie%E5%8F%8D%E7%88%AC%E4%B8%93%E9%A2%98"><span class="nav-text">9. Cookie反爬专题</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>





<!-- common js -->
<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/toggle-theme.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/code-block.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/libs/anime.min.js"></script>

<!-- local search -->

    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/local-search.js"></script>


<!-- lazyload -->

    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/lazyload.js"></script>


<div class="pjax">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/post/post-helper.js"></script>

        <!-- toc -->
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/post/toc.js"></script>
        

        <!-- copyright-info -->
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/post/copyright-info.js"></script>
        

        <!-- share -->
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/post/share.js"></script>
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->

    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart()
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd()
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'))
            KEEP.initExecute()
        });
    });
</script>




    
        
            
<script class="custom-inject-js" src="/js/run_time.js" data-pjax></script>

        
    
        
            
<script class="custom-inject-js" src="/js/code_click_copy.js" data-pjax></script>

        
    
        
            
<script class="custom-inject-js" src="/js/copyrightpro.js" data-pjax></script>

        
    

</body>
</html>
