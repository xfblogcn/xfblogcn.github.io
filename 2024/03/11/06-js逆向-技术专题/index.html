<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="xfblog">
    
    <title>
        
            06_JS逆向_技术专题 |
        
        XFBLOG.CN
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/favicon.webp">
    
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/font/css/fontawesome.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/font/css/regular.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/font/css/solid.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/font/css/brands.min.css">
    
        
            
                
<link rel="stylesheet" href="/css/custom-1.css">

            
        
    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.xml"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"XFBLOG.CN","author":"xfblog","avatar":"/images/avatar.webp","logo":"/images/logo.webp","favicon":"/images/favicon.webp"},"menu":{"home":"/ || fa-solid fa-home","archives":"/archives || fa-solid fa-box-archive","categories":"/categories || fa-solid fa-layer-group","links":"/links || fa-solid fa-link","about":"/about || fa-solid fa-circle-info"},"first_screen":{"enable":true,"background_img":"/images/home_light.webp","background_img_dark":"/images/home_dark.webp","description":null,"hitokoto":false},"social_contact":{"enable":true,"links":{"github":"https://github.com/xfblogcn","weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":true,"hide_header":true},"home":{"announcement":"版权声明：本站所有文章均为 xfblog.cn 小傅原创，请遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。","category":true,"tag":true,"post_datetime":"created","post_datetime_format":"YYYY-MM-DD"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":true,"min2read":true},"datetime_format":"YYYY-MM-DD","copyright_info":true,"share":true,"reward":{"enable":true,"img_link":"/images/zfb.webp","text":"创作不易，打赏随意，您的支持是我更新的动力💪！"}},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"obsidian"},"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":true,"site_uv":false,"site_pv":false,"page_pv":true}},"local_search":{"enable":true,"preload":true},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.36"},"waline":{"server_url":null,"reaction":false,"version":"3.2.1"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":true},"lazyload":{"enable":true},"cdn":{"enable":true,"provider":"jsdelivr"},"pjax":{"enable":true},"footer":{"since":2021,"word_count":false,"site_deploy":{"enable":false,"provider":"github","url":null},"record":{"enable":true,"list":[{"code":"蜀ICP备2021021033号-1","link":"https://beian.miit.gov.cn"},{"code":"川公网安备 51138102000134号","link":"http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51138102000134"}]}},"inject":{"enable":true,"css":["/css/custom-1.css"],"js":["/js/run_time.js","/js/code_click_copy.js","/js/copyrightpro.js"]},"root":"","source_data":{},"version":"4.2.5"}
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"}
    KEEP.language_code_block = {"copy":"复制代码","copied":"已复制","fold":"折叠代码块","folded":"已折叠"}
    KEEP.language_copy_copyright = {"copy":"复制版权信息","copied":"已复制","title":"原文标题","author":"原文作者","link":"原文链接"}
  </script>
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Keep" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/logo.webp">
                </a>
            
            <a class="site-name border-box" href="/">
               XFBLOG.CN
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-home"></i>
                                
                                首页
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                
                                归档
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/categories">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-layer-group"></i>
                                
                                分类
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/links">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-link"></i>
                                
                                友链
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/about">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-circle-info"></i>
                                
                                关于
                                
                            </a>
                            
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="menu-text-color fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-home"></i>
                                </span>
                            
                            首页
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                </span>
                            
                            归档
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/categories">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-layer-group"></i>
                                </span>
                            
                            分类
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/links">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-link"></i>
                                </span>
                            
                            友链
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/about">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-circle-info"></i>
                                </span>
                            
                            关于
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        06_JS逆向_技术专题
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/avatar.webp">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">xfblog</span>
                                
                                    <span class="author-badge">Lv3</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2024-03-11</span>
            </span>

            
                <span class="meta-info-item post-update-date">
                    <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                    <span class="datetime" data-updated="Wed Nov 27 2024 16:23:37 GMT+0800">2024-11-27</span>
                </span>
            
        

        
            <span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="post-category-ul">
                    
                            <li class="category-item"><a href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a></li>
                        
                    
                </ul>
            </span>
        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/Python/">Python</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E7%88%AC%E8%99%AB/">爬虫</a></li>
                        
                    
                </ul>
            </span>
        

        
        
            <span class="meta-info-item post-wordcount">
                <i class="icon fas fa-file-word"></i>&nbsp;<span>22.4k 字</span>
            </span>
        
        
            <span class="meta-info-item post-min2read">
                <i class="icon fas fa-clock"></i>&nbsp;<span>93 分钟</span>
            </span>
        
        
            <span class="meta-info-item post-pv">
                <i class="icon fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
            </span>
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <h2 id="一、Webpack专题"><a href="#一、Webpack专题" class="headerlink" title="一、Webpack专题"></a>一、Webpack专题</h2><blockquote>
<p><strong>Webpack：</strong>Webpack 是一个开源的 JavaScript 模块打包工具。它将应用程序的所有资源均视为模块，并通过依赖关系将它们打包成一个或多个最终的静态 js 资源文件，并且可以在浏览器中加载执行。Webpack的主要特点包括<strong>模块化</strong>、代码分割、<strong>加载器</strong>和插件系统等。</p>
<p><strong>加载器（loaders）：</strong>虽然 Webpack 以 JavaScript 为主要的处理对象，但在构建过程中，它会通过加载器处理和支持多种其他类型的文件，加载器可以将非 JavaScript 文件转换为 Webpack 可以理解的模块形式。</p>
<p><strong>页面特征：</strong>如果一个页面的 document 文档大多都是由 script 标签构成，那么大概率是 webpack 打包模式</p>
</blockquote>
<h4 id="1-加载器"><a href="#1-加载器" class="headerlink" title="1. 加载器"></a>1. 加载器</h4><ul>
<li><strong>原型方法：</strong></li>
</ul>
<p>方法</p>
<p>说明</p>
<p>语法</p>
<p>EventTarget.addEventListener</p>
<p>注册事件，在 EventTarget 上注册特定事件类型的事件处理程序</p>
<p><code>target.addEventListener(type, listener, options);</code></p>
<p>EventTarget.removeEventListener</p>
<p>注销事件，移除 EventTarget 中事件侦听器</p>
<p><code>target.removeEventListener(type, listener, options);</code></p>
<p>EventTarget.dispatchEvent</p>
<p>触发事件，将事件分派到此 EventTarget 中</p>
<p><code>let isSuccessful = target.dispatchEvent(event);</code></p>
<hr>
<blockquote>
<p><strong><a class="link"   target="_blank" rel="noopener" href="https://36kr.com/" >测试网站1<i class="fas fa-external-link-alt"></i></a>、<a class="link"   target="_blank" rel="noopener" href="https://kuajing.pinduoduo.com/login" >测试网站2<i class="fas fa-external-link-alt"></i></a>、<a class="link"   target="_blank" rel="noopener" href="https://fse.agilestudio.cn/search?keyword=happy" >测试网站3<i class="fas fa-external-link-alt"></i></a></strong></p>
</blockquote>
<ul>
<li><strong>基本格式：<code>!function(&quot;形参&quot;)&#123;&quot;加载器&quot;&#125;([&quot;实参模块&quot;]);</code></strong></li>
<li><strong>注意：</strong>加载器有时存在于 html 的 script 标签中，一样的提取，找到正确的 script 标签中的加载器即可</li>
<li><strong>核心代码：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">!function (e) &#123;</span><br><span class="line">    var c = &#123;&#125;; // 存储已加载的模块信息</span><br><span class="line"></span><br><span class="line">    // 用于加载和执行模块，形参 t 表示模块的索引</span><br><span class="line">    function n(t) &#123;</span><br><span class="line">        // 创建一个模块对象，用于存储模块信息和导出</span><br><span class="line">        var a = c[t] = &#123;</span><br><span class="line">            i: t,</span><br><span class="line">            l: !1,      // 模块是否已加载的标志，初始为false</span><br><span class="line">            exports: &#123;&#125; // 模块的导出对象</span><br><span class="line">        &#125;;</span><br><span class="line">        console.log(t); // 打印出所需要使用的所有模块的索引</span><br><span class="line"></span><br><span class="line">        // 调用模块对应的函数，传入模块对象和导出对象，并执行模块代码</span><br><span class="line">        return e[t].call(a.exports, a, a.exports, n),</span><br><span class="line">            a.l = !0,   // 将模块标记为已加载</span><br><span class="line">            a.exports   // 返回模块的导出对象</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    n.m = e; // 存储模块源代码数组，在网页中包含所有的模块，包括动态加载的模块</span><br><span class="line"></span><br><span class="line">    // 加载并执行入口模块</span><br><span class="line">    n(0);</span><br><span class="line">&#125;([ // 数组形式</span><br><span class="line">    function () &#123;</span><br><span class="line">        console.log(111);</span><br><span class="line">    &#125;,</span><br><span class="line">    function () &#123;</span><br><span class="line">        console.log(222);</span><br><span class="line">    &#125;</span><br><span class="line">]); // 输出：0 111</span><br><span class="line"></span><br><span class="line">/* 对象格式</span><br><span class="line">&#123;</span><br><span class="line">    0: function () &#123;</span><br><span class="line">        console.log(111);</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x27;1&#x27;: function () &#123;</span><br><span class="line">        console.log(222);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<h4 id="2-动态加载模块"><a href="#2-动态加载模块" class="headerlink" title="2. 动态加载模块"></a>2. 动态加载模块</h4><ul>
<li><strong>动态加载原理：</strong><ol>
<li><strong>webpackJsonpCallback()：</strong>是 webpack 在运行时动态加载模块时的回调函数，用于动态加载模块</li>
<li><strong>定义 window.webpackJsonp 为全局变量：</strong>用于存储需要在运行时动态导入的模块</li>
<li><strong>重写 window.webpackJsonp.push() 方法：</strong>将数组的 push() 方法重写为 webpackJsonpCallback() 方法，这意味着实际运行时执行的是 webpackJsonpCallback() 方法</li>
</ol>
</li>
<li><strong>window[“webpackJsonp”].push() 的参数：</strong><ol>
<li><strong>参数1：</strong>模块的 ID，用于标识唯一的模块</li>
<li><strong>参数2：</strong>一个数组或者对象，其中定义了大量的函数，即<strong>动态加载的模块</strong></li>
<li><strong>参数3：</strong>要调用的函数，是可选的</li>
</ol>
</li>
<li><strong>遇到模块动态加载的处理方式（<a class="link"   target="_blank" rel="noopener" href="https://jzsc.mohurd.gov.cn/data/company" >测试网站<i class="fas fa-external-link-alt"></i></a>）：</strong><ol>
<li><strong>有加载器但无模块。</strong>全局搜索加载器中 window[“webpackJsonp”] 的 <strong>webpackJsonp 关键字</strong>，可能找到多个<strong>动态加载模块</strong>，在每一个中搜索需要的<strong>起始模块</strong>，存在则将<strong>参数2</strong>中的所有模块复制使用</li>
<li><strong>有模块但无加载器。</strong>全局搜索定义的用于存储动态导入模块的<strong>变量名</strong>，因为在加载器中需要动态导入模块，<strong>一定需要引用其值</strong>，将其 push 方法为新变量 bind，为加载器添加需要使用的模块</li>
<li><strong>参数2中的模块以数组的形式存在时</strong>。如果不想全扣，就可以<strong>通过 <code>页面调用加载器名称.m[模块编号]</code> 直接定位方法位置</strong>，但是断点作用域需要在某一个加载器调用处断点并刷新网页后的断点作用域才可以</li>
<li><strong>简单粗暴：找不到谁就直接在谁脸上打断点，刷新网页重新加载直接断住，加载器或者模块都能直接找到</strong></li>
</ol>
</li>
</ul>
<h2 id="二、OB混淆专题"><a href="#二、OB混淆专题" class="headerlink" title="二、OB混淆专题"></a>二、OB混淆专题</h2><blockquote>
<p><strong>混淆：</strong>混淆是一种通过修改代码结构、变量名和逻辑，使得源代码在保持原有功能的同时，变得难以阅读和理解的技术。混淆的目的是增加代码的复杂性，这有助于提高软件的安全性，防止恶意用户或恶意软件对程序进行逆向工程，获取敏感信息或发现潜在的漏洞。</p>
<p><strong>ob混淆（Obfuscation）的两个版本（<a class="link"   target="_blank" rel="noopener" href="https://obfuscator.io/" >官方网址<i class="fas fa-external-link-alt"></i></a>）：</strong></p>
<ol>
<li><strong>旧版的 ob 混淆：由一个 大数组 + 移位自执行函数 + 解密函数组成</strong><ul>
<li>_0x2755 是大数组变量名，它的元素<strong>全都是字面量</strong></li>
<li>它后面是一个自执行函数，其目的是<strong>改变各个元素的位置</strong></li>
<li>紧接着是一个<strong>解密函数</strong>，它调用的时候，元素位置已经改变，因此需要一起抠才能正常解密</li>
</ul>
</li>
<li><strong>新版的 ob 混淆：由一个 大数组函数 + 移位自执行函数 + 解密函数组成</strong><ul>
<li>a0_0x4bdb 是大数组函数名，它返回的是一个大数组，数组的元素<strong>全都是字面量</strong></li>
<li>紧接着是一个<strong>解密函数</strong>，它调用的时候，元素位置已经改变，因此需要一起抠才能正常解密</li>
<li>它后面是一个自执行函数，其目的是<strong>改变各个元素的位置</strong></li>
</ul>
</li>
</ol>
<p><strong>注意：某些自执行函数或解密函数包含了代码格式化检测，因此在运行的时候需要进行压缩处理，否则卡死</strong></p>
</blockquote>
<h4 id="1-ob混淆技术"><a href="#1-ob混淆技术" class="headerlink" title="1. ob混淆技术"></a>1. ob混淆技术</h4><ul>
<li><p><strong>代码压缩：</strong>移除代码中的空格、换行和注释，以减小文件大小。不仅减小加载时间，还增加代码的阅读难度</p>
</li>
<li><p><strong>变量混淆</strong>：将带有含意的变量名、方法名、常量名随机变为无意义的类乱码字符串，使其难以理解或追踪</p>
</li>
<li><p><strong>字符串混淆：</strong>将字符串阵列化集中放置，对字符串进行加密或编码，使代码中无明文字符串，避免搜索定位</p>
</li>
<li><p><strong>属性加密：</strong>针对 JavaScript 对象的属性进行加密转化，隐藏代码之间的调用关系</p>
</li>
<li><p><strong>控制流平坦化：</strong>改变程序的控制流结构，打乱函数原有代码执行流程及函数调用关系，使代码逻变得混乱无序</p>
</li>
<li><p><strong>僵尸代码：</strong>在程序中插入一些无实际作用的代码片段，不影响程序的正常执行，进一步使代码混乱</p>
</li>
<li><p><strong>调试保护：</strong>基于调试器特性对当前环境进行检验，加入强制 debugger 语句，使代码在调试模式下难以被分析</p>
</li>
<li><p><strong>多态变异：</strong>使得程序的相同功能在不同的执行时刻产生不同的形式，杜绝代码被动态分析调试</p>
</li>
<li><p><strong>锁定域名：</strong>一种反调试技术，通过检测程序是否在特定的域名下运行，以防止在非授权的环境中分析程序</p>
</li>
<li><p><strong>反格式化：</strong>如果对 JavaScript 代码进行格式化，则无法执行，导致浏览器或程序假死</p>
</li>
<li><p><strong>特殊编码：</strong>将代码完全编码为人不可读的代码，如特殊表情符号、重复相同单词、定制的编码算法等等</p>
</li>
</ul>
<h4 id="2-ob混淆结构"><a href="#2-ob混淆结构" class="headerlink" title="2. ob混淆结构"></a>2. ob混淆结构</h4><blockquote>
<p><strong>注意：ob混淆后的每个部分的顺序不一定按正常排序，并且也不是每个ob混淆的代码都包括完整的五部分</strong></p>
<p><strong>混淆特点总结：</strong></p>
<ol>
<li>一般由一个大数组或者含有大数组的函数、一个自执行函数、解密函数和加密后真实函数四部分组成</li>
<li>函数名和变量名通常以 <code>_0x</code> 或者 <code>0x</code> 开头，后接 1~6 位数字或字母组成</li>
<li>自执行函数，进行移位操作，有明显的 push、shift 关键字</li>
</ol>
</blockquote>
<ol>
<li><strong>定义一个数组：</strong><ul>
<li>定义一个包含混淆代码片段的数组，可能包含被混淆的变量、函数和其他代码元素。也可以再次混淆到看不出是一个数组，数组的位置不一定在第一行，复杂点的混淆会把这个数组放在比较隐藏的位置</li>
</ul>
</li>
<li><strong>重构数组：</strong><ul>
<li>混淆器可能会对数组进行重构，改变其中的元素顺序，增加数组的维度或者使用其他技术使得数组更难以直接理解。为了防止内存泄漏，<strong>不建议格式化这部分代码</strong></li>
</ul>
</li>
<li><strong>自解密函数：</strong><ul>
<li>此部分通常包含一个用于解密数组中的代码片段的函数。这个函数可能包括解密算法、控制流混淆等，以还原数组中的原始代码。为了防止内存泄漏，<strong>不建议格式化这部分代码</strong></li>
</ul>
</li>
<li><strong>真实代码：</strong><ul>
<li>整个ob混淆的难度取决于此部分，这是混淆后代码的真实功能实现。混淆器可能会将原始代码与混淆代码混合在一起，以增加分析者的困惑。<strong>分析代码就是为了找出这一部分</strong></li>
</ul>
</li>
<li><strong>可以删除的垃圾代码：</strong><ul>
<li>为增加混淆度，混淆器可能会在代码中插入一些无用的垃圾代码，主要由<strong>控制流平坦化+无限debugger自执行函数+死代码注入</strong>构成，一般不涉及业务逻辑，可以直接删除但也要具体分析后删除</li>
</ul>
</li>
</ol>
<h4 id="3-ob混淆实现"><a href="#3-ob混淆实现" class="headerlink" title="3. ob混淆实现"></a>3. ob混淆实现</h4><blockquote>
<p><strong>安装ob混淆库：<code>npm install javascript-obfuscator -s</code></strong></p>
</blockquote>
<ul>
<li><strong>JavaScript 实现 OB混淆（<a class="link"   target="_blank" rel="noopener" href="https://bz.zzzmh.cn/index" >测试网站1<i class="fas fa-external-link-alt"></i></a>、<a class="link"   target="_blank" rel="noopener" href="http://www.spolicy.com/" >测试网站2<i class="fas fa-external-link-alt"></i></a>）：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">const OB = require(&#x27;javascript-obfuscator&#x27;);</span><br><span class="line"></span><br><span class="line">const sourceCode = `</span><br><span class="line">function hi() &#123;</span><br><span class="line">  console.log(&quot;Hello World!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">hi();</span><br><span class="line">`;</span><br><span class="line"></span><br><span class="line">const options = &#123;</span><br><span class="line">    compact: true, // 启用压缩</span><br><span class="line">    controlFlowFlattening: true, // 控制流 平坦化</span><br><span class="line">    controlFlowFlatteningThreshold: 0.75, // 控制流平坦化阈值</span><br><span class="line">    deadCodeInjection: true, // 使死代码注入</span><br><span class="line">    deadCodeInjectionThreshold: 0.4, // 死代码注入阈值</span><br><span class="line">    identifierNamesGenerator: &#x27;hexadecimal&#x27;, // 生成标识符的方式</span><br><span class="line">    log: false, // 关闭日志</span><br><span class="line">    rotateStringArray: true, // 旋转字符串数组</span><br><span class="line">    selfDefending: true, // 启用自我防御</span><br><span class="line">    stringArray: true, // 启用字符串数组</span><br><span class="line">    stringArrayThreshold: 0.75, // 字符串数组阈值</span><br><span class="line">    // domainLock: [&#x27;example.com&#x27;], // 锁定域名</span><br><span class="line">    debugProtection: true, // 调试保护</span><br><span class="line">    disableConsoleOutput: true, // 禁用控制台输出</span><br><span class="line">    unicodeEscapeSequence: false, // 禁用 Unicode 转义序列</span><br><span class="line">    rotateUnicodeArray: true, // 旋转 Unicode 数组</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const obCode = OB.obfuscate(sourceCode, options).getObfuscatedCode();</span><br><span class="line"></span><br><span class="line">console.log(obCode);</span><br></pre></td></tr></table></figure>

<h4 id="4-问题记录"><a href="#4-问题记录" class="headerlink" title="4. 问题记录"></a>4. 问题记录</h4><p><img  
                       lazyload
                       alt="image"
                       data-src="https://osswcf.oss-cn-shanghai.aliyuncs.com/2024/02/1707204284-886a90804a72fc6.jpg"
                       
                 ></p>
<ul>
<li><strong>问题：</strong>混淆代码格式化后报错</li>
<li><strong>解决：</strong>通过<a class="link"   target="_blank" rel="noopener" href="https://www.jsjiami.com/jiemi.html" >压缩网站<i class="fas fa-external-link-alt"></i></a>压缩代码</li>
</ul>
<h2 id="三、RPC技术专题"><a href="#三、RPC技术专题" class="headerlink" title="三、RPC技术专题"></a>三、RPC技术专题</h2><h4 id="1-websocket协议"><a href="#1-websocket协议" class="headerlink" title="1. websocket协议"></a>1. websocket协议</h4><blockquote>
<p><strong>WebSocket协议（WS）：</strong>是一种在客户端和服务器之间实现实时双向通信的网络协议，基于单个 TCP 连接进行双工通信。与传统的 HTTP 协议不同，WebSocket 提供了一个持久性的连接，避免了在每次通信时重新建立连接的开销。同时其允许服务器主动向客户端推送数据，而不需要客户端先发起请求。</p>
<p><strong>特点：</strong></p>
<ol>
<li><strong>全双工通信：</strong>允许在客户端和服务器之间进行双向实时通信，可以同时发送和接收数据</li>
<li><strong>持久连接：</strong>WebSocket 连接一旦建立，可以持续存在，而不需要在每次通信时重新建立连接</li>
<li><strong>低延迟：</strong>相较 HTTP 轮询和长轮询等传统技术，WebSocket 通信具有更低的延迟，因为连接是持久性的</li>
<li><strong>轻量级头部：</strong>WebSocket 头部相对较小，减少了通信时的数据开销</li>
</ol>
</blockquote>
<ul>
<li><strong>实现原理：</strong><ul>
<li><strong>握手阶段（Handshake）：</strong>客户端发送一个 HTTP 请求，其中包含 WebSocket 协议版本和一些附加信息.服务器接收请求后，如果支持 WebSocket，会回复一个 HTTP 101 状态码，表示协议切换。握手成功后，协议升级完成，连接从 HTTP 协议切换到 WebSocket 协议。</li>
<li><strong>数据帧（Frame）：</strong>WebSocket 通信使用数据帧来传输信息。数据帧可以是文本、二进制数据或控制帧（用于控制连接状态）。数据帧的结构包括帧头和帧数据，帧头包含了一些控制位和长度信息。</li>
<li><strong>保持连接：</strong>一旦 WebSocket 连接建立，客户端和服务器可以通过发送帧来保持连接状态。服务器可以主动向客户端发送数据，而不需要等待客户端的请求。</li>
<li><strong>关闭连接：</strong>通过特殊的控制帧可以实现连接的安全关闭。客户端或服务器可以发送帧来表示关闭连接的意图，对方收到后可以做出相应的处理。</li>
<li><strong>安全性：</strong>WebSocket 可以通过安全套接字层（WebSocket Secure，wss:&#x2F;&#x2F;）进行加密，类似于 HTTPS，这确保了通过 WebSockets 传输的数据的机密性和完整性。</li>
</ul>
</li>
<li><strong>客户端（浏览器js）实现：<a class="link"   target="_blank" rel="noopener" href="https://jzsc.mohurd.gov.cn/data/company" >测试网站<i class="fas fa-external-link-alt"></i></a></strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">!(function () &#123;</span><br><span class="line">    // 通过flag标记用来判断是否已创建套接字</span><br><span class="line">    if (window.flag) &#123;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // 创建 WebSocket 实例连接到指定服务器地址</span><br><span class="line">        const websocket = new WebSocket(&#x27;ws://127.0.0.1:8080&#x27;)</span><br><span class="line">        window.flag = true;</span><br><span class="line">        // 接收到服务端数据的回调方法</span><br><span class="line">        websocket.onmessage = function (event) &#123;</span><br><span class="line">            let data = event.data;</span><br><span class="line">            // 对接收到的数据进行处理（解密）</span><br><span class="line">            let res = b(data)</span><br><span class="line">            // 发送处理后的数据回服务器</span><br><span class="line">            websocket.send(res)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;())</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>服务端（本地python）实现方式：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import websockets</span><br><span class="line">import asyncio</span><br><span class="line"></span><br><span class="line"># get_data函数，通过requests请求密文数据并返回</span><br><span class="line"></span><br><span class="line">async def echo(websocket):</span><br><span class="line">    for i in range(1, 3):</span><br><span class="line">        data = get_data(i)</span><br><span class="line">        await websocket.send(data)</span><br><span class="line"></span><br><span class="line">async def recv_msg(websocket):</span><br><span class="line">    while True:</span><br><span class="line">        res = await websocket.recv()</span><br><span class="line">        print(res)</span><br><span class="line"></span><br><span class="line">async def main_logic(websocket, path):</span><br><span class="line">    await echo(websocket)</span><br><span class="line">    await recv_msg(websocket)</span><br><span class="line"></span><br><span class="line">ws_server = websockets.serve(main_logic, &#x27;127.0.0.1&#x27;, 8080)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(ws_server)</span><br><span class="line">loop.run_forever()  # 用于运行一个异步事件循环，使其一直运行下去。实现保持长连接</span><br></pre></td></tr></table></figure>

<h4 id="2-RPC技术"><a href="#2-RPC技术" class="headerlink" title="2. RPC技术"></a>2. RPC技术</h4><blockquote>
<p><strong>RPC（Remote Procedure Call）：</strong>是一种用于实现远程通信的协议和编程模型。它允许在客户端调用远程服务器上的某个函数或过程时，不需要显式编写网络通信代码，由 RPC 框架负责处理网络通信的细节，包括序列化参数、发送请求、接收响应，处理异常等，就像调用本地过程一样调用远程过程。</p>
<p><strong>作用：</strong>在逆向中，将浏览器和本地视为客户端和服务器，二者通过 RPC 框架基于 websocket 协议通信，由 RPC 与浏览器通信实现加密，本地再与 RPC 通信得到加密结果。通过 RPC 技术在浏览器中将加密逻辑暴露，在本地直接调用浏览器中对应的加密函数，从而直接得到加密结果，省去大量逆向调试时间。</p>
<p><strong>注意：</strong>使用 RPC 也需要先定位加密位置，通过在加密处上面注入脚本、替换文件和刷新网页，使得脚本生效</p>
</blockquote>
<ul>
<li>**<a class="link"   target="_blank" rel="noopener" href="https://sekiro.iinti.cn/sekiro-doc/" >Sekiro-RPC<i class="fas fa-external-link-alt"></i></a>**：<ol>
<li>进入sekiro-open-demo文件夹，运行<code>bin/sekiro.sh</code>，注意需要 java 环境</li>
<li>客户端环境代码：<a class="link"   target="_blank" rel="noopener" href="http://file.virjar.com/sekiro_web_client.js?_=123" ><i class="fas fa-external-link-alt"></i></a><a class="link"   target="_blank" rel="noopener" href="http://file.virjar.com/sekiro_web_client.js?_=123" >http://file.virjar.com/sekiro_web_client.js?_&#x3D;123<i class="fas fa-external-link-alt"></i></a></li>
<li>查看分组列表API：<a class="link"   target="_blank" rel="noopener" href="http://127.0.0.1:5612/business-demo/groupList" ><i class="fas fa-external-link-alt"></i></a><a class="link"   target="_blank" rel="noopener" href="http://127.0.0.1:5612/business-demo/groupList" >http://127.0.0.1:5612/business-demo/groupList<i class="fas fa-external-link-alt"></i></a></li>
<li>查看队列状态API：<a class="link"   target="_blank" rel="noopener" href="http://127.0.0.1:5612/business-demo/clientQueue?group=rpc-test" ><i class="fas fa-external-link-alt"></i></a><a class="link"   target="_blank" rel="noopener" href="http://127.0.0.1:5612/business-demo/clientQueue?group=rpc-test" >http://127.0.0.1:5612/business-demo/clientQueue?group=rpc-test<i class="fas fa-external-link-alt"></i></a></li>
<li><strong>调用返回数据API：<code>http://127.0.0.1:5612/business-demo/invoke?group=&#123;&#125;&amp;action=&#123;&#125;</code></strong></li>
</ol>
</li>
<li><strong>客户端实现参数：</strong><ul>
<li><strong>group（业务类型）：</strong>表示业务的分类或接口组，可以根据业务类型将客户端划分到不同的组</li>
<li><strong>SekiroClient（服务提供者客户端）</strong>：创建客户端实例，负责将本地（浏览器）的方法注册为远程操作</li>
<li><strong>clientId：</strong>客户端的唯一标识符，以便服务端能够识别和跟踪不同的客户端</li>
<li><strong>registerAction（业务接口）：</strong>业务接口注册，客户端在指定的 group 下可注册不同的远程 Action 操作</li>
<li><strong>request：</strong>是服务端传递给远程操作的请求对象，包含了请求的参数信息等</li>
<li><strong>resolve：</strong>一个回调函数，用于在远程操作执行成功时将结果返回给客户端</li>
<li><strong>reject：</strong>一个回调函数，用于在远程操作执行失败时返回错误信息给客户端</li>
</ul>
</li>
</ul>
<h4 id="3-RPC逆向中实现"><a href="#3-RPC逆向中实现" class="headerlink" title="3. RPC逆向中实现"></a>3. RPC逆向中实现</h4><ul>
<li><strong>浏览器加密位置注入代码（注意提前开启RPC服务器）：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">!(function () &#123;</span><br><span class="line">    // 客户端环境代码......</span><br><span class="line"></span><br><span class="line">    if (window.flag) &#123;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        function guid() &#123;</span><br><span class="line">            function S4() &#123;</span><br><span class="line">                return (((1 + Math.random()) * 0x10000)  0).toString(16).substring(1);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            return (S4() + S4() + &quot;-&quot; + S4() + &quot;-&quot; + S4() + &quot;-&quot; + S4() + &quot;-&quot; + S4() + S4() + S4());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        var client = new SekiroClient(&quot;ws://127.0.0.1:5612/business-demo/register?group=rpc-test&amp;clientId=&quot; + guid());</span><br><span class="line">        window.flag = true;</span><br><span class="line"></span><br><span class="line">        client.registerAction(&quot;test-1&quot;, function (request, resolve, reject) &#123;</span><br><span class="line">            data = request[&#x27;data&#x27;]</span><br><span class="line">            resolve(&#123;&#x27;decrypt_data&#x27;: b(data), &#x27;cookie&#x27;: document.cookie&#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>本地python代码调用接口获取客户端数据：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    &quot;group&quot;: &quot;rpc-test&quot;,</span><br><span class="line">    &quot;action&quot;: &quot;test-1&quot;,</span><br><span class="line">&#125;</span><br><span class="line">response = requests.post(&quot;http://127.0.0.1:5612/business-demo/invoke&quot;, data=data)</span><br><span class="line">print(response.json())</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>客户端环境代码（<a class="link"   target="_blank" rel="noopener" href="http://file.virjar.com/sekiro_web_client.js?_=123" ><i class="fas fa-external-link-alt"></i></a><a class="link"   target="_blank" rel="noopener" href="http://file.virjar.com/sekiro_web_client.js?_=123" >http://file.virjar.com/sekiro_web_client.js?_&#x3D;123<i class="fas fa-external-link-alt"></i></a>）：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">  Copyright (C) 2020 virjar &lt;virjar@virjar.com&gt; for https://github.com/virjar/sekiro</span><br><span class="line"></span><br><span class="line">  Redistribution and use in source and binary forms, with or without</span><br><span class="line">  modification, are permitted provided that the following conditions are met:</span><br><span class="line"></span><br><span class="line">    * Redistributions of source code must retain the above copyright</span><br><span class="line">      notice, this list of conditions and the following disclaimer.</span><br><span class="line">    * Redistributions in binary form must reproduce the above copyright</span><br><span class="line">      notice, this list of conditions and the following disclaimer in the</span><br><span class="line">      documentation and/or other materials provided with the distribution.</span><br><span class="line"></span><br><span class="line">  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span><br><span class="line">  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span><br><span class="line">  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span><br><span class="line">  ARE DISCLAIMED. IN NO EVENT SHALL &lt;COPYRIGHT HOLDER&gt; BE LIABLE FOR ANY</span><br><span class="line">  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span><br><span class="line">  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span><br><span class="line">  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span><br><span class="line">  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span><br><span class="line">  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF</span><br><span class="line">  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">function SekiroClient(wsURL) &#123;</span><br><span class="line">    this.wsURL = wsURL;</span><br><span class="line">    this.handlers = &#123;&#125;;</span><br><span class="line">    this.socket = &#123;&#125;;</span><br><span class="line">    this.base64 = false;</span><br><span class="line">    // check</span><br><span class="line">    if (!wsURL) &#123;</span><br><span class="line">        throw new Error(&#x27;wsURL can not be empty!!&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">    this.webSocketFactory = this.resolveWebSocketFactory();</span><br><span class="line">    this.connect()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SekiroClient.prototype.resolveWebSocketFactory = function () &#123;</span><br><span class="line">    if (typeof window === &#x27;object&#x27;) &#123;</span><br><span class="line">        var theWebSocket = window.WebSocket ? window.WebSocket : window.MozWebSocket;</span><br><span class="line">        return function (wsURL) &#123;</span><br><span class="line"></span><br><span class="line">            function WindowWebSocketWrapper(wsURL) &#123;</span><br><span class="line">                this.mSocket = new theWebSocket(wsURL);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            WindowWebSocketWrapper.prototype.close = function () &#123;</span><br><span class="line">                this.mSocket.close();</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            WindowWebSocketWrapper.prototype.onmessage = function (onMessageFunction) &#123;</span><br><span class="line">                this.mSocket.onmessage = onMessageFunction;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            WindowWebSocketWrapper.prototype.onopen = function (onOpenFunction) &#123;</span><br><span class="line">                this.mSocket.onopen = onOpenFunction;</span><br><span class="line">            &#125;;</span><br><span class="line">            WindowWebSocketWrapper.prototype.onclose = function (onCloseFunction) &#123;</span><br><span class="line">                this.mSocket.onclose = onCloseFunction;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            WindowWebSocketWrapper.prototype.send = function (message) &#123;</span><br><span class="line">                this.mSocket.send(message);</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            return new WindowWebSocketWrapper(wsURL);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if (typeof weex === &#x27;object&#x27;) &#123;</span><br><span class="line">        // this is weex env : https://weex.apache.org/zh/docs/modules/websockets.html</span><br><span class="line">        try &#123;</span><br><span class="line">            console.log(&quot;test webSocket for weex&quot;);</span><br><span class="line">            var ws = weex.requireModule(&#x27;webSocket&#x27;);</span><br><span class="line">            console.log(&quot;find webSocket for weex:&quot; + ws);</span><br><span class="line">            return function (wsURL) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    ws.close();</span><br><span class="line">                &#125; catch (e) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">                ws.WebSocket(wsURL, &#x27;&#x27;);</span><br><span class="line">                return ws;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (e) &#123;</span><br><span class="line">            console.log(e);</span><br><span class="line">            //ignore</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //TODO support ReactNative</span><br><span class="line">    if (typeof WebSocket === &#x27;object&#x27;) &#123;</span><br><span class="line">        return function (wsURL) &#123;</span><br><span class="line">            return new theWebSocket(wsURL);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // weex 鍜� PC鐜鐨剋ebsocket API涓嶅畬鍏ㄤ竴鑷达紝鎵€浠ュ仛浜嗘娊璞″吋瀹�</span><br><span class="line">    throw new Error(&quot;the js environment do not support websocket&quot;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">SekiroClient.prototype.connect = function () &#123;</span><br><span class="line">    console.log(&#x27;sekiro: begin of connect to wsURL: &#x27; + this.wsURL);</span><br><span class="line">    var _this = this;</span><br><span class="line">    // 涓峜heck close锛岃</span><br><span class="line">    // if (this.socket &amp;&amp; this.socket.readyState === 1) &#123;</span><br><span class="line">    //     this.socket.close();</span><br><span class="line">    // &#125;</span><br><span class="line">    try &#123;</span><br><span class="line">        this.socket = this.webSocketFactory(this.wsURL);</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">        console.log(&quot;sekiro: create connection failed,reconnect after 2s&quot;);</span><br><span class="line">        setTimeout(function () &#123;</span><br><span class="line">            _this.connect()</span><br><span class="line">        &#125;, 2000)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    this.socket.onmessage(function (event) &#123;</span><br><span class="line">        _this.handleSekiroRequest(event.data)</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    this.socket.onopen(function (event) &#123;</span><br><span class="line">        console.log(&#x27;sekiro: open a sekiro client connection&#x27;)</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    this.socket.onclose(function (event) &#123;</span><br><span class="line">        console.log(&#x27;sekiro: disconnected ,reconnection after 2s&#x27;);</span><br><span class="line">        setTimeout(function () &#123;</span><br><span class="line">            _this.connect()</span><br><span class="line">        &#125;, 2000)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">SekiroClient.prototype.handleSekiroRequest = function (requestJson) &#123;</span><br><span class="line">    console.log(&quot;receive sekiro request: &quot; + requestJson);</span><br><span class="line">    var request = JSON.parse(requestJson);</span><br><span class="line">    var seq = request[&#x27;__sekiro_seq__&#x27;];</span><br><span class="line"></span><br><span class="line">    if (!request[&#x27;action&#x27;]) &#123;</span><br><span class="line">        this.sendFailed(seq, &#x27;need request param &#123;action&#125;&#x27;);</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line">    var action = request[&#x27;action&#x27;];</span><br><span class="line">    if (!this.handlers[action]) &#123;</span><br><span class="line">        this.sendFailed(seq, &#x27;no action handler: &#x27; + action + &#x27; defined&#x27;);</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var theHandler = this.handlers[action];</span><br><span class="line">    var _this = this;</span><br><span class="line">    try &#123;</span><br><span class="line">        theHandler(request, function (response) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                _this.sendSuccess(seq, response)</span><br><span class="line">            &#125; catch (e) &#123;</span><br><span class="line">                _this.sendFailed(seq, &quot;e:&quot; + e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, function (errorMessage) &#123;</span><br><span class="line">            _this.sendFailed(seq, errorMessage)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">        console.log(&quot;error: &quot; + e);</span><br><span class="line">        _this.sendFailed(seq, &quot;:&quot; + e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">SekiroClient.prototype.sendSuccess = function (seq, response) &#123;</span><br><span class="line">    var responseJson;</span><br><span class="line">    if (typeof response == &#x27;string&#x27;) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            responseJson = JSON.parse(response);</span><br><span class="line">        &#125; catch (e) &#123;</span><br><span class="line">            responseJson = &#123;&#125;;</span><br><span class="line">            responseJson[&#x27;data&#x27;] = response;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else if (typeof response == &#x27;object&#x27;) &#123;</span><br><span class="line">        responseJson = response;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        responseJson = &#123;&#125;;</span><br><span class="line">        responseJson[&#x27;data&#x27;] = response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (typeof response == &#x27;string&#x27;) &#123;</span><br><span class="line">        responseJson = &#123;&#125;;</span><br><span class="line">        responseJson[&#x27;data&#x27;] = response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (Array.isArray(responseJson)) &#123;</span><br><span class="line">        responseJson = &#123;</span><br><span class="line">            data: responseJson,</span><br><span class="line">            code: 0</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (responseJson[&#x27;code&#x27;]) &#123;</span><br><span class="line">        responseJson[&#x27;code&#x27;] = 0;</span><br><span class="line">    &#125; else if (responseJson[&#x27;status&#x27;]) &#123;</span><br><span class="line">        responseJson[&#x27;status&#x27;] = 0;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        responseJson[&#x27;status&#x27;] = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    responseJson[&#x27;__sekiro_seq__&#x27;] = seq;</span><br><span class="line">    var responseText = JSON.stringify(responseJson);</span><br><span class="line">    console.log(&quot;response :&quot; + responseText);</span><br><span class="line"></span><br><span class="line">    if (responseText.length &lt; 1024 * 6) &#123;</span><br><span class="line">        this.socket.send(responseText);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (this.base64) &#123;</span><br><span class="line">        responseText = this.base64Encode(responseText)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //澶ф姤鏂囪鍒嗘浼犺緭</span><br><span class="line">    var segmentSize = 1024 * 5;</span><br><span class="line">    var i = 0, totalFrameIndex = Math.floor(responseText.length / segmentSize) + 1;</span><br><span class="line"></span><br><span class="line">    for (; i &lt; totalFrameIndex; i++) &#123;</span><br><span class="line">        var frameData = JSON.stringify(&#123;</span><br><span class="line">                __sekiro_frame_total: totalFrameIndex,</span><br><span class="line">                __sekiro_index: i,</span><br><span class="line">                __sekiro_seq__: seq,</span><br><span class="line">                __sekiro_base64: this.base64,</span><br><span class="line">                __sekiro_is_frame: true,</span><br><span class="line">                __sekiro_content: responseText.substring(i * segmentSize, (i + 1) * segmentSize)</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">        console.log(&quot;frame: &quot; + frameData);</span><br><span class="line">        this.socket.send(frameData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">SekiroClient.prototype.sendFailed = function (seq, errorMessage) &#123;</span><br><span class="line">    if (typeof errorMessage != &#x27;string&#x27;) &#123;</span><br><span class="line">        errorMessage = JSON.stringify(errorMessage);</span><br><span class="line">    &#125;</span><br><span class="line">    var responseJson = &#123;&#125;;</span><br><span class="line">    responseJson[&#x27;message&#x27;] = errorMessage;</span><br><span class="line">    responseJson[&#x27;status&#x27;] = -1;</span><br><span class="line">    responseJson[&#x27;__sekiro_seq__&#x27;] = seq;</span><br><span class="line">    var responseText = JSON.stringify(responseJson);</span><br><span class="line">    console.log(&quot;sekiro: response :&quot; + responseText);</span><br><span class="line">    this.socket.send(responseText)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">SekiroClient.prototype.registerAction = function (action, handler) &#123;</span><br><span class="line">    if (typeof action !== &#x27;string&#x27;) &#123;</span><br><span class="line">        throw new Error(&quot;an action must be string&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if (typeof handler !== &#x27;function&#x27;) &#123;</span><br><span class="line">        throw new Error(&quot;a handler must be function&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(&quot;sekiro: register action: &quot; + action);</span><br><span class="line">    this.handlers[action] = handler;</span><br><span class="line">    return this;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">SekiroClient.prototype.encodeWithBase64 = function () &#123;</span><br><span class="line">    this.base64 = arguments &amp;&amp; arguments.length &gt; 0 &amp;&amp; arguments[0];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">SekiroClient.prototype.base64Encode = function (s) &#123;</span><br><span class="line">    if (arguments.length !== 1) &#123;</span><br><span class="line">        throw &quot;SyntaxError: exactly one argument required&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    s = String(s);</span><br><span class="line">    if (s.length === 0) &#123;</span><br><span class="line">        return s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function _get_chars(ch, y) &#123;</span><br><span class="line">        if (ch &lt; 0x80) y.push(ch);</span><br><span class="line">        else if (ch &lt; 0x800) &#123;</span><br><span class="line">            y.push(0xc0 + ((ch &gt;&gt; 6) &amp; 0x1f));</span><br><span class="line">            y.push(0x80 + (ch &amp; 0x3f));</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            y.push(0xe0 + ((ch &gt;&gt; 12) &amp; 0xf));</span><br><span class="line">            y.push(0x80 + ((ch &gt;&gt; 6) &amp; 0x3f));</span><br><span class="line">            y.push(0x80 + (ch &amp; 0x3f));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var _PADCHAR = &quot;=&quot;,</span><br><span class="line">        _ALPHA = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;,</span><br><span class="line">        _VERSION = &quot;1.1&quot;;//Mr. Ruan fix to 1.1 to support asian char(utf8)</span><br><span class="line"></span><br><span class="line">    //s = _encode_utf8(s);</span><br><span class="line">    var i,</span><br><span class="line">        b10,</span><br><span class="line">        y = [],</span><br><span class="line">        x = [],</span><br><span class="line">        len = s.length;</span><br><span class="line">    i = 0;</span><br><span class="line">    while (i &lt; len) &#123;</span><br><span class="line">        _get_chars(s.charCodeAt(i), y);</span><br><span class="line">        while (y.length &gt;= 3) &#123;</span><br><span class="line">            var ch1 = y.shift();</span><br><span class="line">            var ch2 = y.shift();</span><br><span class="line">            var ch3 = y.shift();</span><br><span class="line">            b10 = (ch1 &lt;&lt; 16)  (ch2 &lt;&lt; 8)  ch3;</span><br><span class="line">            x.push(_ALPHA.charAt(b10 &gt;&gt; 18));</span><br><span class="line">            x.push(_ALPHA.charAt((b10 &gt;&gt; 12) &amp; 0x3F));</span><br><span class="line">            x.push(_ALPHA.charAt((b10 &gt;&gt; 6) &amp; 0x3f));</span><br><span class="line">            x.push(_ALPHA.charAt(b10 &amp; 0x3f));</span><br><span class="line">        &#125;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    switch (y.length) &#123;</span><br><span class="line">        case 1:</span><br><span class="line">            var ch = y.shift();</span><br><span class="line">            b10 = ch &lt;&lt; 16;</span><br><span class="line">            x.push(_ALPHA.charAt(b10 &gt;&gt; 18) + _ALPHA.charAt((b10 &gt;&gt; 12) &amp; 0x3F) + _PADCHAR + _PADCHAR);</span><br><span class="line">            break;</span><br><span class="line"></span><br><span class="line">        case 2:</span><br><span class="line">            var ch1 = y.shift();</span><br><span class="line">            var ch2 = y.shift();</span><br><span class="line">            b10 = (ch1 &lt;&lt; 16)  (ch2 &lt;&lt; 8);</span><br><span class="line">            x.push(_ALPHA.charAt(b10 &gt;&gt; 18) + _ALPHA.charAt((b10 &gt;&gt; 12) &amp; 0x3F) + _ALPHA.charAt((b10 &gt;&gt; 6) &amp; 0x3f) + _PADCHAR);</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return x.join(&quot;&quot;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="4-油猴工具插件"><a href="#4-油猴工具插件" class="headerlink" title="4. 油猴工具插件"></a>4. 油猴工具插件</h4><blockquote>
<p><strong>Tampermonkey油猴：</strong>是一款浏览器扩展程序，用于管理和运行用户脚本。它最初是为Google Chrome设计的，但后来也支持了其他主流浏览器，如Mozilla Firefox、Microsoft Edge、Safari等。Tampermonkey的主要功能是允许用户自定义网页上的行为，通过运行脚本来修改、增强或自动化网页功能（<a class="link"   target="_blank" rel="noopener" href="https://greasyfork.org/zh-CN" >油猴脚本搜索<i class="fas fa-external-link-alt"></i></a>）</p>
<p><strong>注意：使用油猴注入脚本时，例如通过 RPC 技术逆向加密时，要注意导出的方法或属性必须是全局作用域的</strong></p>
</blockquote>
<ul>
<li><strong>@name：</strong><ul>
<li>作用：指定用户脚本的名称</li>
<li>示例：<code>@name My Awesome Script</code></li>
</ul>
</li>
<li><strong>@namespace：</strong><ul>
<li>作用：定义用户脚本的命名空间，确保脚本名称的唯一性</li>
<li>示例：<code>@namespace http://www.example.com/</code></li>
</ul>
</li>
<li><strong>@version：</strong><ul>
<li>作用：指定用户脚本的版本号，用于跟踪脚本的更新</li>
<li>示例：<code>@version 1.0</code></li>
</ul>
</li>
<li><strong>@description：</strong><ul>
<li>作用：提供用户脚本的简要描述，描述脚本的功能和用途</li>
<li>示例：<code>@description Adds a download button to images on example.com</code></li>
</ul>
</li>
<li><strong>@author：</strong><ul>
<li>作用：指定用户脚本的作者</li>
<li>示例：<code>@author Your Name</code></li>
</ul>
</li>
<li><strong>@match：</strong><ul>
<li>作用：定义用户脚本要运行的网页地址（URL匹配模式）。只有匹配的页面才会执行脚本</li>
<li>示例：<code>@match https://www.example.com/*</code></li>
</ul>
</li>
<li><strong>@include：</strong><ul>
<li>作用：类似于@match，定义用户脚本要运行的网页地址。可以使用通配符</li>
<li>示例：<code>@include https://www.example.com/*</code></li>
</ul>
</li>
<li><strong>@icon：</strong><ul>
<li>作用：指定用户脚本在 Tampermonkey 管理界面中显示的图标</li>
<li>示例：<code>@icon https://www.example.com/icon.png</code></li>
</ul>
</li>
<li><strong>@grant：</strong><ul>
<li>作用：定义用户脚本需要的权限。常见值包括 none、GM_addStyle、GM_xmlhttpRequest 等</li>
<li>示例：<code>@grant GM_addStyle</code></li>
</ul>
</li>
<li><strong>@require：</strong><ul>
<li>作用：声明用户脚本所依赖的外部 javascript 脚本。确保这些脚本在当前脚本执行之前加载</li>
<li>示例：<code>@require https://code.jquery.com/jquery-3.6.4.min.js</code></li>
</ul>
</li>
<li><strong>@run-at：</strong><ul>
<li>作用：指定用户脚本的执行时机。可选值包括 document-start、document-end 和 document-idle。</li>
<li>示例：<code>@run-at document-end</code></li>
</ul>
</li>
</ul>
<h2 id="四、JSVMP技术专题"><a href="#四、JSVMP技术专题" class="headerlink" title="四、JSVMP技术专题"></a>四、JSVMP技术专题</h2><blockquote>
<p><strong>JSVMP（Virtual Machine based code Protection for JavaScript）：</strong>在JavaScript代码保护过程中引入代码虚拟化思想，通过 JS 加密实现源代码的虚拟化过程，将目标代码通过 JS 加密转换成自定义的字节码，这些字节码只有特殊的解释器才能识别，从而隐藏目标代码的关键逻辑。</p>
<p><strong>JS虚拟化基本保护过程：</strong>JS虚拟化保护通常以二进制可执行程序为保护目标，其核心是用自定义的虚拟指令模拟替换目标程序指令，并编码成特殊的<strong>字节码</strong>和特殊的<strong>虚拟解释器</strong>嵌入到目标文件中，在运行时虚拟解释器调度特殊的解释程序，才能解释自定义字节码并最终还原源码的功能。由于虚拟化保护在带来高强度的保护效果的同时也会带来较大的性能开销，所以通常JS虚拟化主要用于保护关键代码段。</p>
<p><strong>JSVMP大致架构：</strong>服务器端读取 JavaScript 代码 —&gt; 词法分析 —&gt; 语法分析 —&gt; 生成AST语法树 —&gt; 生成私有指令 —&gt; 生成对应私有解释器，将私有指令加密与私有解释器发送给浏览器，然后一边解释，一边执行</p>
<p><img  
                       lazyload
                       alt="image"
                       data-src="https://osswcf.oss-cn-shanghai.aliyuncs.com/2024/03/1710164925-69bb447e98dbb4b.png"
                       
                 ></p>
<p><strong>JSVMP的三种逆向方法：</strong>RPC远程调用，补环境，日志断点还原算法。其中日志断点也称为<strong>插桩</strong>，找到关键位置，输出关键参数的日志信息，从结果往上倒推生成逻辑，以达到算法还原的目的。</p>
</blockquote>
<h4 id="1-日志插桩原理"><a href="#1-日志插桩原理" class="headerlink" title="1. 日志插桩原理"></a>1. 日志插桩原理</h4><ul>
<li><strong>jsvmp 的程序运行逻辑：</strong><ol>
<li><strong>指令集和栈操作</strong>：<strong>jsvmp 的核心运行逻辑通过一系列指令来实现</strong>，每个指令对应特定的逻辑操作，<strong>主要通过栈（stack）操作来实现</strong>，这些指令组成一个指令集，用于执行 js 代码</li>
<li><strong>指令循环</strong>：由于有很多指令需要逐一执行，<strong>jsvmp 需要使用一个循环结构 ( for ) 来逐步执行每个指令</strong>。这意味着每个指令在循环中都会被处理和执行</li>
</ol>
</li>
<li><strong>细化指令执行过程：</strong><ul>
<li><strong>复杂性增加</strong>：<strong>jsvmp 会将每个操作细化到单独的指令</strong>。例如一个简单的字符串 “Drt342&#x3D;” 的生成过程，字符 D 可能需要运行 10 个指令（10条 if 语句）才可以生成。那就需要将这10个指令的逻辑反推出来，以理解和生成字符 D，以此类推，每个字符都需要详细分析和反推相应的指令逻辑</li>
</ul>
</li>
<li><strong>日志还原算法：</strong><ol>
<li><strong>日志输出和栈实现：</strong>在 jsvmp 中，<strong>日志通常指的是程序执行过程中的输出栈</strong>。这些栈是通常是通过 array 数组来实现的。在实际案例中，可以将每个 if-else 分支代码块视为一个指令，这些指令在栈中操作数组</li>
<li><strong>分支记录：</strong>通过记录每个 if-else 分支的执行情况，可以还原指令的执行过程。这有助于理解程序的执行逻辑和栈的变化情况</li>
</ol>
</li>
<li><strong>日志插桩技术：</strong><ol>
<li><strong>关键位置插桩：</strong>插桩一定是在所有循环中插桩，单个大循环则看其有几个大的 if 语句决定插桩个数，多个大循环则需在每个大循环中插桩，因为指令是基于循环运行的</li>
<li><strong>索引定位：</strong>仅仅输出数组内容可能不够精确，为了更好地定位每个指令的执行位置，需要在日志中打印一些索引值。这些索引值可以帮助定位特定指令的执行位置，从而更准确地分析和还原执行过程</li>
</ol>
</li>
</ul>
<h4 id="2-条件断点定位"><a href="#2-条件断点定位" class="headerlink" title="2. 条件断点定位"></a>2. 条件断点定位</h4><blockquote>
<p><strong>特点：条件断点和日志断点配合使用，是因为 jsvmp 通常是在一条语句反复无限生成结果值</strong></p>
<p><strong>在调试跟栈过程中：</strong></p>
<ol>
<li><strong>观察是否存在 jsvmp 结构（大量 if-else 分支，内部数组操作，外部嵌套循环）</strong></li>
<li><strong>还有个特点是在 jsvmp 的栈中看不到数据</strong></li>
<li><strong>如果是 jsvmp 结构，则考虑是否是在此处通过 jsvmp 指令生成的加密值</strong></li>
</ol>
</blockquote>
<ul>
<li><strong>分析过程：</strong><ol>
<li>先下日志断点，观察日志中是否有目标加密数据的生成，同时分析加密数据的特征、长度等</li>
<li>再下条件断点，根据加密数据的特征进行条件断点，便能在每次调试过程中精准定位具体加密位置</li>
</ol>
</li>
</ul>
<h4 id="3-jsvmp纯算实现"><a href="#3-jsvmp纯算实现" class="headerlink" title="3. jsvmp纯算实现"></a>3. jsvmp纯算实现</h4><blockquote>
<p><strong>日志插桩代码：主要记录和分析栈（数组）的操作，每个 if-else 分支代码块可以视为一个独立的指令</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;位置 1&quot;, &quot;索引m&quot;, m, &quot;索引r&quot;, r, &quot;值p: &quot;, JSON.stringify(p, function(key, value) &#123;if (value == window) &#123;return undefined&#125; return value&#125;)</span><br><span class="line"></span><br><span class="line">&quot;位置 2&quot;, &quot;索引m&quot;, m, &quot;索引r&quot;, r, &quot;值p: &quot;, JSON.stringify(p, function(key, value) &#123;if (value == window) &#123;return undefined&#125; return value&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>纯算法实现注意点（<a class="link"   target="_blank" rel="noopener" href="https://www.douyin.com/" >测试网站<i class="fas fa-external-link-alt"></i></a>）：</strong></p>
<ol>
<li>定位至加密位置，观察分析加密位置附近代码，<strong>是否存在大量的 if-else 语句或由数组推动的代码结构</strong>，合理考虑 jsvmp 情况，那么外层一定存在 for 循环用于逐步执行所有的 if-else 分支</li>
<li><strong>在加密位置向下调试走出当前 lf-else 分支，通常可以回到 for 循环推动指令执行的语句位置，其外层的函数便是 jsvmp 的虚拟解释器，函数实参便是被编码成的特殊字节码</strong></li>
<li>在正确位置日志插桩，若输出日志含有报错信息，首先在控制台输出加密位置对象中的加密值，然后复制其加密值在当前日志中搜索，如果存在则日志无误，右击另存为日志文件，在本地分析</li>
</ol>
</blockquote>
<ul>
<li><p><strong>重点技巧：</strong></p>
<ol>
<li><strong>调试：</strong>日志断点和条件分析断点通常下在<strong>重点条件增改处</strong>，例如 i[r++]、switch(i[r++]) 处</li>
<li><strong>凡是涉及由 i[r++] 参与计算生成的值，一般都是固定的，可以观察同样索引位置以确定其是否变化。也存在特殊情况，例如连续有大段数据都是固定的，那么数据可能在很前面就已经生成过的，这种情况只能多注意，应该多多观察整体日志大概哪些位置输出了关于什么的值，有个基础印象才能更准确的还原</strong></li>
<li>如果一个数据，是在另一个数组里面取的，那说明定位的地方并不是数据生成的位置（<strong>思维误区：会认为需要去找这个数组中这个数据怎么生成的</strong>），应该直接搜索数据第一次出现的地方，才是数据生成的位置</li>
<li>对于有些数据中需要还原大量的单个数据，可以直接打印两份日志进行比对，从而分析出固定与动态数据（如果一组数据多次调试都是相同数据，那么直接拿下来即可）</li>
</ol>
</li>
<li><p><strong>重点思路：</strong></p>
<ol>
<li>使用固定的算法生成固定的数组，再用一定的算法打乱数组顺序，最后去取数组中的元素，那么这个数组的整个生成到使用过程都是固定的，则<strong>最好的处理就是以调用顺序手动还原为一个新数组</strong></li>
</ol>
</li>
</ul>
<h2 id="五、补环境专题"><a href="#五、补环境专题" class="headerlink" title="五、补环境专题"></a>五、补环境专题</h2><h4 id="1-环境检测"><a href="#1-环境检测" class="headerlink" title="1. 环境检测"></a>1. 环境检测</h4><blockquote>
<p><strong>环境检测的缘由：</strong>在于浏览器和 Node.js 之间存在的差异。差异导致了在 Node.js 环境下无法执行专为浏览器设计的 JavaScript 代码。通常 js 代码会根据浏览器的特定属性判断是否在正确的浏览器环境中执行，如果不是正确的浏览器环境，代码可能无法返回正确的数据信息。</p>
<p><strong>补环境重点之导出关键方法为全局方法：通过 window.aaa 直接将方法赋值全局对象，后续可直接调用</strong></p>
</blockquote>
<ul>
<li><strong>常见环境检测：</strong><ol>
<li><strong>检测 exports 对象差异：</strong>在 Node.js 中 exports 是一个用于模块导出的对象，而在浏览器中是undefined（<code>&quot;undefined&quot; != typeof exports ? exports : void 0</code>）</li>
<li><strong>检测全局对象差异：</strong>在浏览器中的全局对象是 window，而在 Node.js 中的全局对象是 global（<code>&quot;undefined&quot; == typeof window ? global : window</code>）</li>
</ol>
</li>
<li><strong>常见环境检测的方法：</strong><ul>
<li><strong>通过 IF 判断语句走错误环境逻辑：</strong>使代码在 node 环境下走与浏览器不一致的逻辑分支，从而返回误差数据（<strong>解决：补完整环境，或者分析网页走的逻辑，与网页保持一致</strong>）</li>
<li><strong>通过 try 异常捕获不存在的环境：</strong>使代码缺少环境也不报错，从而逆向结果错误，返回错误数据（<strong>解决：直接输出异常的内容，根据异常补完整环境，或者直接把异常捕获的代码删除，将错误暴露出来</strong>）</li>
</ul>
</li>
</ul>
<h4 id="2-吐环境脚本"><a href="#2-吐环境脚本" class="headerlink" title="2. 吐环境脚本"></a>2. 吐环境脚本</h4><blockquote>
<p><strong>Proxy对象：</strong>Proxy 是 JavaScript 中的内置对象，用于代理另一个对象并允许拦截和自定义该对象上的操作。</p>
<p><strong>原理：</strong>Proxy 可以理解为在目标对象之前设一层<strong>拦截</strong>，外界对该对象的访问，都必须通过这层拦截，并且可以对外界的访问进行过滤和修改，即用于<strong>代理</strong>一个对象的某些操作。</p>
</blockquote>
<ul>
<li><strong>new Proxy(target, handler)：</strong>创建 Proxy 对象<ul>
<li><strong>参数target：</strong>被代理的目标对象</li>
<li><strong>参数handler：</strong>一个对象，其属性是用于定制拦截行为的方法</li>
</ul>
</li>
<li>**get(target, prop, receiver)**：拦截属性的读取操作<ul>
<li><strong>target</strong>：目标对象</li>
<li><strong>prop</strong>：属性名</li>
<li><strong>receiver</strong>：最初被调用的对象，通常是Proxy或继承Proxy的对象</li>
</ul>
</li>
<li>**set(target, prop, value, receiver)**：拦截属性的赋值操作<ul>
<li><strong>target</strong>：目标对象</li>
<li><strong>prop</strong>：属性名</li>
<li><strong>value</strong>：新的属性值</li>
<li><strong>receiver</strong>：最初被调用的对象，通常是Proxy或继承Proxy的对象</li>
</ul>
</li>
<li><strong>Reflect.set(target, propertyKey, value[, receiver])：</strong>设置指定对象的属性值，返回布尔值表示是否成功<ul>
<li><strong>target</strong>：目标对象</li>
<li><strong>propertyKey</strong>：要设置值的属性键</li>
<li><strong>value</strong>：要设置的新值</li>
<li><strong>receiver</strong>（可选）：如果提供，那么它会成为setter调用的this值</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">!(function getEnvironment(proxyArray) &#123;</span><br><span class="line">    window = global;</span><br><span class="line">    // 解决基本环境检测</span><br><span class="line">    // delete global;</span><br><span class="line">    // delete Buffer;</span><br><span class="line">    exports = undefined;</span><br><span class="line">    nullfunc = function (res) &#123; console.log(&quot;当前调用函数&quot;, &quot;参数为:&quot;, res); &#125;;</span><br><span class="line">    // 脚本仅帮助补了大致环境，需要在此处补其余缺失环境</span><br><span class="line"></span><br><span class="line">    for (var i = 0; i &lt; proxyArray.length; i++) &#123;</span><br><span class="line">        var proxyName = proxyArray[i];</span><br><span class="line">        var handler = `</span><br><span class="line">            &#123;</span><br><span class="line">                get: function(target, property, receiver) &#123;</span><br><span class="line">                    console.log(&quot;方法：get&quot;, &quot;  $&#123;proxyName&#125;&quot;+&quot;.&quot;+String(property), &quot;  属性值类型:&quot;, typeof target[property]);</span><br><span class="line">                    return target[property];</span><br><span class="line">                &#125;,</span><br><span class="line">                set: function(target, property, value, receiver) &#123;</span><br><span class="line">                    console.log(&quot;方法：SET&quot;, &quot;  $&#123;proxyName&#125;&quot;+&quot;.&quot;+String(property), &quot;  属性值类型:&quot;, typeof value);</span><br><span class="line">                    return Reflect.set(...arguments);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        `;</span><br><span class="line">        eval(`$&#123;proxyName&#125; = (function () &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                $&#123;proxyName&#125;;</span><br><span class="line">                return new Proxy($&#123;proxyName&#125;, $&#123;handler&#125;);</span><br><span class="line">            &#125; catch (e) &#123;</span><br><span class="line">                $&#123;proxyName&#125; = &#123;&#125;;</span><br><span class="line">                return new Proxy($&#123;proxyName&#125;, $&#123;handler&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)()`);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)([&#x27;window&#x27;, &#x27;document&#x27;, &#x27;location&#x27;, &#x27;navigator&#x27;, &#x27;history&#x27;, &#x27;screen&#x27;]);</span><br></pre></td></tr></table></figure>

<h4 id="3-selenium补环境"><a href="#3-selenium补环境" class="headerlink" title="3. selenium补环境"></a>3. selenium补环境</h4><blockquote>
<p>Selenium拥有最真实的浏览器环境，因为其本质就是将 js 代码通过浏览器去执行。其具体补环境步骤如下：</p>
<ul>
<li>创建一个本地 html 文件，将 js 代码写入，同时将需要调用的方法通过 window 对象导出为全局的，之后使用 selenium 请求此文件地址，并返回浏览器对象，再通过浏览器对象执行 js 代码调用方法即可</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from selenium import webdriver</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">PRO_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line">def driver_sig(html_file):</span><br><span class="line">    option = webdriver.ChromeOptions()</span><br><span class="line">    option.add_argument(&#x27;--disable-blink-features=AutomationControlled&#x27;)</span><br><span class="line">    option.add_argument(&#x27;headless&#x27;)</span><br><span class="line">    driver = webdriver.Chrome(executable_path=&#x27;/Users/xfblog/Downloads/chrome-mac-arm64&#x27;, options=option)</span><br><span class="line">    driver.get(PRO_DIR + &#x27;\\&#x27; + html_file)</span><br><span class="line"></span><br><span class="line">    return driver</span><br><span class="line"></span><br><span class="line">html_file = &#x27;index.html&#x27;</span><br><span class="line">driv = driver_sig(html_file)</span><br><span class="line"></span><br><span class="line">print(driv.execute_script(&#x27;return window.aaa()&#x27;))</span><br></pre></td></tr></table></figure>

<h4 id="4-flask实现接口"><a href="#4-flask实现接口" class="headerlink" title="4. flask实现接口"></a>4. flask实现接口</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">from selenium import webdriver</span><br><span class="line">import os</span><br><span class="line">from flask import Flask, jsonify</span><br><span class="line"></span><br><span class="line">PRO_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line">def driver_sig(html_file):</span><br><span class="line">    option = webdriver.ChromeOptions()</span><br><span class="line">    option.add_argument(&#x27;--disable-blink-features=AutomationControlled&#x27;)</span><br><span class="line">    option.add_argument(&#x27;headless&#x27;)</span><br><span class="line">    driver = webdriver.Chrome(options=option)</span><br><span class="line">    driver.get(PRO_DIR + &#x27;\\&#x27; + html_file)</span><br><span class="line"></span><br><span class="line">    return driver</span><br><span class="line"></span><br><span class="line">html_file = &#x27;index.html&#x27;</span><br><span class="line">driv = driver_sig(html_file)</span><br><span class="line"></span><br><span class="line"># 创建 Flask 应用实例</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"># 定义路由和视图函数（指定了该路由能够处理来自&#x27;/&#x27;路径的GET和POST请求）</span><br><span class="line">@app.route(&#x27;/&#x27;, methods=[&#x27;get&#x27;, &#x27;post&#x27;])</span><br><span class="line">def hello():</span><br><span class="line">    context = &#123;</span><br><span class="line">        # 加载本地地址 生成cookie值</span><br><span class="line">        &#x27;v&#x27;: driv.execute_script(&#x27;return window.aaa()&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">    # 返回cookie值（jsonify函数用于将Python对象转换为JSON格式的响应）</span><br><span class="line">    return jsonify(context=context)</span><br><span class="line"></span><br><span class="line"># 启动应用</span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<h4 id="5-jsdom补环境"><a href="#5-jsdom补环境" class="headerlink" title="5. jsdom补环境"></a>5. jsdom补环境</h4><blockquote>
<p><strong>jsdom：</strong>是一个 JavaScript 库，用于在 Node.js 环境中模拟 DOM（文档对象模型）。DOM 是浏览器中用于表示网页结构的标准 API，它允许 js 代码与网页的结构、内容进行交互。但在 Node.js 中，由于没有浏览器环境，因此没有原生的 DOM API，所以使用 jsdom 在 Node.js 中模拟类似于浏览器环境中的 DOM API。</p>
</blockquote>
<ul>
<li><p>**环境安装：<code>npm install jsdom --save</code>、<code>npm install canvas --save</code>**（可能安装错误，<a class="link"   target="_blank" rel="noopener" href="https://github.com/jsdom/jsdom/wiki/jsdom-%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3" >官网下载<i class="fas fa-external-link-alt"></i></a>）</p>
</li>
<li><p><strong>基本使用：</strong></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const jsdom = require(&quot;jsdom&quot;);</span><br><span class="line">const &#123;JSDOM&#125; = jsdom;</span><br><span class="line">const dom = new JSDOM();</span><br><span class="line">window = global;</span><br><span class="line">location = dom.window.location;</span><br><span class="line">navigator = dom.window.navigator;</span><br><span class="line">document = dom.window.document;</span><br><span class="line">location.href = &#x27;https://www.toutiao.com/&#x27;</span><br><span class="line">location.protocol = &#x27;https:&#x27;</span><br><span class="line">document.cookie=&#x27;......&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="6-原型检测"><a href="#6-原型检测" class="headerlink" title="6. 原型检测"></a>6. 原型检测</h4><blockquote>
<p><strong>JavaScript 的原型（prototype）：</strong>每个 JavaScript 对象都有一个原型（prototype），原型是一个对象，其他对象可以通过它实现属性和方法的继承。当创建一个新对象时，JavaScript 会为其自动关联一个原型对象。这个原型对象包含一组属性和方法，新对象可以通过原型链继承这些属性和方法。</p>
<ol>
<li><strong>原型链（Prototype Chain）</strong>：每个对象都有一个原型。 如果一个对象的原型不是 null，那么它的原型也有一个原型，以此类推，形成了一条链，即原型链。<strong>原型链的作用是实现继承，</strong> 当需要访问一个对象的属性或方法时，JavaScript 引擎会首先在该对象本身查找，如果找不到，就会去它的<strong>隐式原型</strong>中查找，以此类推，直到找到或者到达原型链的末端。</li>
<li><strong>构造函数（Constructor）</strong>：构造函数是用来创建对象的函数。在 JavaScript 中，任何一个函数都可以成为构造函数，只要使用 new 关键字来调用它。当你使用 new 关键字来调用一个函数时，JavaScript 会创建一个新对象，并将这个新对象的原型指向构造函数的 prototype 属性（类一样）。</li>
<li><strong>原型对象（Prototype Object）</strong>：每个函数都有一个特殊的属性为 prototype，即原型对象。原型对象通常包含共享的属性和方法，这些属性和方法可以被该函数创建的所有实例对象共享。</li>
<li><strong>__proto__ 属性</strong>：每个实例对象都有一个与之关联的原型对象，可以通过 __proto__ 属性直接访问实例对象的原型。注意，__proto__ 属性是非标准的，在生产代码中，可以使用 <code>Object.getPrototypeOf()</code> 和 <code>Object.setPrototypeOf()</code> 来获取和设置原型。</li>
</ol>
<ul>
<li><p><strong>隐式原型：</strong>通过实例对象的 __proto__ 属性获取的原型</p>
</li>
<li><p><strong>显式原型：</strong>直接通过构造函数或类的 prototype 属性获取的原型</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function Person(name, age) &#123;</span><br><span class="line">    this.name = name;</span><br><span class="line">    this.age = age;</span><br><span class="line">&#125;</span><br><span class="line">// 在构造函数的原型对象上定义一个方法</span><br><span class="line">Person.prototype.sayHello = function () &#123;</span><br><span class="line">    console.log(&quot;Hello, my name is &quot; + this.name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var person = new Person(&quot;Alice&quot;, 30);</span><br><span class="line">console.log(Person.prototype);</span><br><span class="line">console.log(person.__proto__);</span><br><span class="line">console.log(Person.prototype === person.__proto__);  // true</span><br><span class="line"></span><br><span class="line">// 这里 person 实例对象的原型链为：</span><br><span class="line">// person -&gt; Person.prototype -&gt; Object.prototype -&gt; null</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><strong>原型检测方法（用法一致）：</strong><ul>
<li><strong>hasOwnProperty(prop)：</strong>检查对象是否具有指定名称的自身属性（非原型上的属性），返回布尔值。</li>
<li><strong>Object.getOwnPropertyDescriptor(obj, prop)：</strong>用于获取指定对象的指定属性（即直接存在于对象上而不在对象的原型链中的属性）的属性描述符。属性描述符是一个对象，包含了该属性的配置信息。</li>
</ul>
</li>
<li><strong>原型检测之补属性：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 补隐式原型</span><br><span class="line">var navigator = &#123;&#125;;</span><br><span class="line">navigator.__proto__.userAgent = &#x27;My_userAgent&#x27;;</span><br><span class="line">res1 = Object.getOwnPropertyDescriptor(navigator, &#x27;userAgent&#x27;);</span><br><span class="line">console.log(res1); // undefined，与浏览器一致</span><br><span class="line">console.log(navigator.userAgent); // My_userAgent</span><br><span class="line"></span><br><span class="line">// 补显式原型</span><br><span class="line">var Navigator = function () &#123;&#125;;</span><br><span class="line">Navigator.prototype = &#123;userAgent: &#x27;My_userAgent&#x27;&#125;;</span><br><span class="line">navigator = new Navigator();</span><br><span class="line">res2 = Object.getOwnPropertyDescriptor(navigator, &#x27;userAgent&#x27;);</span><br><span class="line">console.log(res2); // undefined，与浏览器一致</span><br><span class="line">console.log(navigator.userAgent); // My_userAgent</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>原型检测之补方法：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 补方法原型</span><br><span class="line">// 首先确定浏览器中，方法在原型的哪一层，通过以下方法检测</span><br><span class="line">// Object.getOwnPropertyDescriptor(document.__proto__.__proto__, &#x27;createElement&#x27;)</span><br><span class="line">// document.__proto__.__proto__：Document &#123;...&#125;</span><br><span class="line">// document.__proto__：HTMLDocument &#123;......&#125;</span><br><span class="line"></span><br><span class="line">var Document1 = function () &#123;&#125;</span><br><span class="line">Object.defineProperty(Document1.prototype, &#x27;createElement&#x27;, &#123;</span><br><span class="line">    &quot;writable&quot;: true,</span><br><span class="line">    &quot;enumerable&quot;: true,</span><br><span class="line">    &quot;configurable&quot;: true,</span><br><span class="line">    &quot;value&quot;: function createElement() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">var HTMLDocument1 = function () &#123;&#125;</span><br><span class="line">Object.setPrototypeOf(HTMLDocument1.prototype, Document1.prototype)</span><br><span class="line">var document1 = new HTMLDocument1();</span><br><span class="line"></span><br><span class="line">res = Object.getOwnPropertyDescriptor(document1.__proto__.__proto__, &#x27;createElement&#x27;)</span><br><span class="line">console.log(res);</span><br><span class="line">console.log(document1.__proto__.__proto__);</span><br></pre></td></tr></table></figure>

<h4 id="7-toString检测"><a href="#7-toString检测" class="headerlink" title="7. toString检测"></a>7. toString检测</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// toString检测</span><br><span class="line">document = &#123;&#125;</span><br><span class="line">document.createElement = function () &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 网页上输出 function createElement() &#123; [native code] &#125;</span><br><span class="line">document.createElement.toString = function () &#123;</span><br><span class="line">    return &#x27;function createElement() &#123; [native code] &#125;&#x27;</span><br><span class="line">&#125;</span><br><span class="line">console.log(document.createElement.toString());</span><br></pre></td></tr></table></figure>

<h4 id="8-vm2框架补环境"><a href="#8-vm2框架补环境" class="headerlink" title="8. vm2框架补环境"></a>8. vm2框架补环境</h4><blockquote>
<p><strong>vm2框架：</strong>VM2 是一个基于 Node.js 的 JavaScript 沙箱库，用于在一个安全的环境中执行 JavaScript 代码，提供了一种隔离 JavaScript 代码执行的方式，可以防止恶意代码对系统造成损害。</p>
<p><strong>作用：</strong>vm2 提供了一个干净独立的沙盒环境，提供测试，打造了一个真实的浏览器环境，可以用于逆向环境</p>
<p><strong>框架配置：</strong></p>
<ol>
<li><code>npm install vm2</code></li>
<li><code>arch -arm64 brew install pkg-config cairo pango jpeg giflib librsvg</code></li>
<li><code>npm install canvas</code></li>
</ol>
</blockquote>
<ul>
<li><strong>vm2框架使用教程：</strong><ol>
<li><strong>run&#x2F;run.js：</strong>需要补环境的代码，即逆向代码（<strong>其中需要导出关键方法为 window 全局方法</strong>）</li>
<li><strong>run&#x2F;lastDeal.js：</strong>调用 window 全局方法</li>
<li><strong>config&#x2F;config.js：</strong>全局对象的某些基础属性配置（location.href、navigator.userAgent、cookie等）</li>
<li><strong>&#x2F;main.js：</strong>主函数调用，保证逆向代码 run.js 文件路径配置正确</li>
<li><strong>tools&#x2F;printLog.js（可选）</strong>：日志文件路径 filePath 配置（<strong>可以在 run&#x2F;log.txt 查看吐的环境</strong>）</li>
</ol>
</li>
</ul>
<h2 id="六、Cookie反爬专题"><a href="#六、Cookie反爬专题" class="headerlink" title="六、Cookie反爬专题"></a>六、Cookie反爬专题</h2><h4 id="1-服务器cookie响应"><a href="#1-服务器cookie响应" class="headerlink" title="1. 服务器cookie响应"></a>1. 服务器cookie响应</h4><blockquote>
<p><strong>加密原理：</strong>当第一次向服务器发送请求时，服务器可以在响应头部返回一个名为 “Set-Cookie” 的标头，以便在浏览器中设置 Cookie 信息。在后续请求时， 携带第一次服务器响应设置的 Cookie 信息，服务器就可以根据 Cookie 辨别用户身份或者其他相关信息，并作出正确的数据响应（<a class="link"   target="_blank" rel="noopener" href="http://www.zjmazhang.gov.cn/hdjlpt/published?via=pc" >测试网站<i class="fas fa-external-link-alt"></i></a>）</p>
</blockquote>
<ul>
<li><strong>特点：</strong>HttpOnly 属性值均设置为 ture，此时浏览器将禁止 js 脚本访问该 Cookie，所以 document.cookie 值为空，同时无法通过 Hook 技术截停 Cookie 值的设置过程，因为 Cookie 信息是由服务器响应设置的</li>
<li><strong>策略：</strong>无需逆向，需要先请求一次（通常是首页），获取服务器响应设置的 Cookie 信息，再携带此 Cookie 信息进行后续请求，便可得到正确的响应数据</li>
</ul>
<h4 id="2-阿里系cookie逆向"><a href="#2-阿里系cookie逆向" class="headerlink" title="2. 阿里系cookie逆向"></a>2. 阿里系cookie逆向</h4><blockquote>
<p><strong>加密原理：</strong>服务器返回一段 js 代码，在浏览器端解析并执行该代码以生成并加密 Cookie 信息（<a class="link"   target="_blank" rel="noopener" href="https://xueqiu.com/today" >测试网站<i class="fas fa-external-link-alt"></i></a>）</p>
</blockquote>
<ul>
<li><strong>特点：</strong>Cookie 信息中包含 <code>acw_sc__v2</code>、<code>acw_tc</code> 等键</li>
<li><strong>策略：</strong>利用油猴 Hook cookie 跟栈分析，清除 Cookie 值后有无限 debugger，注入清除 debugger 脚本即可</li>
</ul>
<h4 id="3-加速乐cookie逆向"><a href="#3-加速乐cookie逆向" class="headerlink" title="3. 加速乐cookie逆向"></a>3. 加速乐cookie逆向</h4><blockquote>
<p><strong>加密原理：</strong>服务器返回一段 js 代码，在浏览器端解析并执行该代码以生成并加密 Cookie 信息（<a class="link"   target="_blank" rel="noopener" href="https://www.mafengwo.cn/i/5376978.html" >测试网站<i class="fas fa-external-link-alt"></i></a>）</p>
</blockquote>
<ul>
<li><p><strong>调用 go 函数的传参：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">go(JSON.stringify(&#123;</span><br><span class="line">  &quot;bts&quot;: [&quot;1711334369.4480yZ3&quot;, &quot;EP4CKCu%2F8NldIzY3skErDc%3D&quot;],</span><br><span class="line">  &quot;chars&quot;: &quot;RGIskbUPRtOQFuGagnFfMv&quot;,</span><br><span class="line">  &quot;ct&quot;: &quot;d7d6440c2122453ff8cced0b6f90de01402adf19&quot;,</span><br><span class="line">  &quot;ha&quot;: &quot;sha1&quot;,</span><br><span class="line">  &quot;is&quot;: true,</span><br><span class="line">  &quot;tn&quot;: &quot;__jsl_clearance_s&quot;,</span><br><span class="line">  &quot;vt&quot;: &quot;3600&quot;,</span><br><span class="line">  &quot;wt&quot;: &quot;1500&quot;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>特点：</strong></p>
<ol>
<li>Cookie 信息中包含 <code>jsl</code>、<code>__jsl_clearance_s</code> 等键（<strong>注意调试前别忘记清空 Cookie 先</strong>）</li>
<li>在网络面板中打开<strong>保留日志</strong>，观察<strong>文档</strong>接口，会发现首页共请求 3 次，请求的前两次的<strong>状态码是 521</strong></li>
<li>前两次请求在 Google 浏览器中无法看到响应代码，但是 <strong>Hook 调试状态时可以</strong>，或<strong>切换浏览器直接查看</strong></li>
<li><strong>加速乐的 Cookie 变化是由调用 go 函数的传参决定的，</strong>参数校验存在于 bts 与 ct 参数之间，先对 bts 参数进行简单转换，并通过 ha 参数对应的加密类型对其加密，之后与 ct 参数值进行比较判断而完成校验</li>
<li><strong>ha 参数对应的加密类型有 3 种：MD5、SHA1 和 SHA256</strong></li>
</ol>
</li>
<li><p><strong>策略：</strong></p>
<ol>
<li>清除 Cookie 值，利用油猴 Hook cookie 跟栈分析（<strong>对应加速乐的请求次数进行 3 次请求</strong>）</li>
<li>每次请求都有服务器响应的 Cookie 信息，直接<strong>使用 session 会话</strong>进行请求，可自动携带此 Cookie 信息</li>
<li>对于 3 次请求，第一次得到响应代码通过 <code>execjs.eval</code> 生成初始的 Cookie 值，第二次携带此 Cookie 值请求得到响应代码，提取 go 函数的传参，逆向生成动态 Cookie 值，第三次携带此动态 Cookie 即可</li>
<li>对应 3 种加密类型，则不能用网页单一的 hash 函数，而是<strong>对不同的 ha 参数值调用不同的哈希函数</strong></li>
</ol>
</li>
</ul>
<h2 id="七、瑞数rs安全产品"><a href="#七、瑞数rs安全产品" class="headerlink" title="七、瑞数rs安全产品"></a>七、瑞数rs安全产品</h2><blockquote>
<p><strong>瑞数动态安全 Botgate（机器人防火墙）：</strong>以动态安全技术为核心，通过动态封装、动态验证、动态混淆、动态令牌等技术对服务器网页底层代码持续动态变换，增加服务器行为的不可预测性，实现了从用户端到服务器端的全方位主动防护，为各类 Web、HTML5 提供强大的安全保护，多用于政企、金融、运营商行业。</p>
</blockquote>
<p><img  
                       lazyload
                       alt="image"
                       data-src="https://osswcf.oss-cn-shanghai.aliyuncs.com/2024/03/1711359593-18b9dfd620dbeee.webp"
                       
                 ></p>
<h4 id="1-瑞数rs4"><a href="#1-瑞数rs4" class="headerlink" title="1. 瑞数rs4"></a>1. 瑞数rs4</h4><blockquote>
<p><strong>加密逻辑：</strong>第一次 202 响应码的请求返回一段 HTML 代码，由其中的自执行函数对外链引入的 js 文件中的乱码进行解析，还原成后续瑞数入口中执行的 1w+ 行的正常代码，创建多个 VM 文件动态生成 Cookie 值，同时 meat 标签中的 content 内容也会在环境中用到（**使用补环境逆向生成 Cookie 信息，<a class="link"   target="_blank" rel="noopener" href="http://www.fangdi.com.cn/index.html" >测试网站<i class="fas fa-external-link-alt"></i></a>**）</p>
<p><strong>瑞数检测：瑞数会检测调用的 js 文件的地址，即 __dirname 和 __filename 字段，错误则响应 400 状态码</strong></p>
<p><strong>解决方案：在逆向瑞数的本地 js 文件中，直接删除这两个字段，加上此前缀</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delete __dirname</span><br><span class="line">delete __filename</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><strong>第一次响应的 HTML 文件的结构：</strong><ol>
<li><strong>动态生成的 meat 标签：</strong>标签内 content 内容每次都是变化的</li>
<li><strong>固定引用的外链 js 文件：</strong>同一个网站同一个页面里的引用 js 内容一般是固定不会变的</li>
<li><strong>动态生成的 js 自执行函数：</strong>自执行代码每次变化的只是变量名，整体逻辑不变</li>
</ol>
</li>
<li><strong>特点：</strong><ol>
<li><strong>2 次无限 debugger：</strong>可直接右键<strong>一律不在此处暂停</strong>，也可以注入 Hook 脚本过掉</li>
<li><strong>3 次请求：</strong>首次请求首页<strong>响应码是 202（瑞数3、4代）</strong>，接着<strong>单独请求一个 js 文件</strong>，然后再次请求首页响应码是 <strong>200</strong>。在 XHR 请求中，后缀都带有 <strong><code>MeEwMD=4xxx</code></strong> 关键字，其中<strong>后缀值的第一个数字即为瑞数的版本</strong>，这是由 js 生成的（<strong>不打开网络面板的保留日志，正好可以看到响应码 202 请求的响应数据</strong>）</li>
<li><strong>2 个特殊 Cookie：<code>FSSBBIl1UgzbN7N80S</code> 和 <code>FSSBBIl1UgzbN7N80T</code>，</strong>以 S 结尾的是第一次请求首页响应设置的 Cookie，以 T 结尾的是由第一次请求首页返回的 HTML 中的 js 代码生成的动态 Cookie。T 和 S 前面的数字是 http 协议的默认端口号，后面<strong>值的第一位数字表示瑞数的版本</strong></li>
<li><strong>瑞数的入口：浏览器中 VM 文件是由 call、eavl 执行创建的，</strong>在 Hook Cookie 后跟栈会有大量的 VM 文件，所以在所有 VM 文件的上一帧便是瑞数生成 Cookie 的入口。此处 3、4 代瑞数可见关键字 eval、call，关键字可能被混淆，4 代会多一个 <strong>ret</strong> 关键字</li>
</ol>
</li>
<li><strong>策略与技巧：</strong><ol>
<li><strong>吐环境脚本，</strong>并不一定是最后一个环境不存在导致的报错，而是<strong>首要根据报错内容在网页分析</strong>，因为可能是因为存在 if 判断或 try 捕获一场，由于其上一个环境不足，导致走了这个环境而吐出这个环境</li>
<li><strong>补环境原则：</strong>需要什么补什么，需要补的环境<strong>先补上再看报错</strong>，不一定要一次性补全。其中删除方法可以不返回或返回空对象，创建方法则看网页创建的什么对应创建空对象或其他</li>
<li><strong>补环境技巧：</strong>报具体错误就进入网页调试，有调用就补方法；下一层才调用就补对象，对象里面再补方法；不报具体错误就无法进入网页调试，那就不知道是对象还是方法，可以都试一下。其中参数进行日志打印，打印后对应网页情况使用 if 针对参数补环境（<strong>根据网页的返回值，网页返回什么本地就返回什么</strong>）</li>
<li><strong>注意：</strong>补环境完成后，即不报错也不继续吐环境了，但数据不对，则<strong>需要观察在补环境过程中打印的日志</strong>，有没有再次被调用而传递了新参数，但是新参数的环境并没有补的情况</li>
</ol>
</li>
</ul>
<h4 id="2-瑞数rs5"><a href="#2-瑞数rs5" class="headerlink" title="2. 瑞数rs5"></a>2. 瑞数rs5</h4><blockquote>
<p><strong>注意：</strong>瑞数 5 代的加密逻辑、检测、文件结构、策略、补环境技巧与瑞数 4 代一模一样，唯二不同的便是其<strong>第一次请求首页的响应状态码是 412</strong> 和 <strong>Cookie信息中不包含 http 端口号了</strong>（**<a class="link"   target="_blank" rel="noopener" href="https://sugh.szu.edu.cn/Html/News/Columns/6/Index.html" >测试网站<i class="fas fa-external-link-alt"></i></a>**）</p>
</blockquote>
<ul>
<li><p><strong>2 个特殊 Cookie：<code>ihkYnttrQXfVO</code> 和 <code>ihkYnttrQXfVP</code>，</strong>以 O 结尾的是第一次请求首页响应设置的 Cookie，以 P 结尾的是由第一次请求首页返回的 HTML 中的 js 代码生成的动态 Cookie，<strong>两个 Cookie 信息的值首位数字为 5 代表瑞数的版本</strong></p>
</li>
<li><p><strong>补环境中的标签补法，从第二个标签开始，没有具体报错信息：</strong>此时可以在浏览器的控制台中，直接执行混淆对应的具体实现代码，根据返回值先补即可，如果没有完整会报错的</p>
</li>
<li><p><strong>遇到一种特殊报错，补环境方式：</strong></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 【吐环境】：方法：get   获取属性：document.documentElement   属性值类型: undefined</span><br><span class="line">// 【报错】：TypeError: Cannot read properties of undefined (reading &#x27;addEventListener&#x27;)</span><br><span class="line">// 【补环境】：</span><br><span class="line">document = &#123;</span><br><span class="line">    documentElement: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 【吐环境】：方法：get   获取属性：document.documentElement   属性值类型: object</span><br><span class="line">// 【报错】：TypeError: _$6T[_$Zx[794]] is not a function</span><br><span class="line">// 【补环境】：</span><br><span class="line">document = &#123;</span><br><span class="line">    documentElement: &#123;</span><br><span class="line">        addEventListener: function (res) &#123;</span><br><span class="line">            console.log(&quot;document.documentElement.addEventListener的参数：&quot;, res)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-瑞数rs6"><a href="#3-瑞数rs6" class="headerlink" title="3. 瑞数rs6"></a>3. 瑞数rs6</h4><blockquote>
<p><strong>注意：</strong>瑞数 6 代与瑞数 4、5 代最大的差异，就是其首次<strong>响应返回的 Html 文件的结构不同</strong>，瑞数 6 将原本动态加载的<strong>自执行函数</strong>转变为固定引入的<strong>外链 js 文件</strong>，而将原本固定引入的外链 js 文件转变为了动态加载在 script 标签内的代码，<strong>相当于将两者加载方式调换</strong>，另 meta 标签的 content 数据依然是动态的（**<a class="link"   target="_blank" rel="noopener" href="https://kscd.zking.com/app/vehicle/proposal/commonlogin" >测试网站<i class="fas fa-external-link-alt"></i></a>**）</p>
<p><strong>其余关键特点：</strong>与瑞数 5 代的 <strong>412+200 响应状态码</strong>、加密逻辑、检测、策略、补环境技巧几乎一致</p>
</blockquote>
<ul>
<li><strong>2 个特殊 Cookie：<code>hvAJjymUYBa3O</code> 和 <code>hvAJjymUYBa3P</code>，</strong>以 O 结尾的是第一次请求首页响应设置的 Cookie，<strong>其值首位数字一般为 6 代表瑞数的版本</strong>，以 P 结尾的是由第一次请求首页返回的 HTML 中的 js 代码生成的动态 Cookie，<strong>其值首位数字一般为 0 是瑞数 6 的特点</strong></li>
<li><strong>面对复杂环境，调试时有多个调试处，可以直接 Hook拦截其调用（断在调用 call 时进行 Hook 并执行）：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(function () &#123;</span><br><span class="line">    var originalcreateElement = window.callPhantom;</span><br><span class="line">    window.callPhantom = function (res) &#123;</span><br><span class="line">        // 在这里插入您的调试代码</span><br><span class="line">        console.log(&quot;参数：&quot;, res);</span><br><span class="line">        debugger;</span><br><span class="line">        return originalcreateElement.apply(this, arguments);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>瑞数 6 的技巧：</strong></p>
<ol>
<li><strong>在网页中复制 ts&#x2F;ss 文件代码和 js 自执行函数代码时都不要格式化，会有检测，左下角取消格式化后复制</strong></li>
<li><strong>报错 TypeError: _$xx[_$xx[x]] is not a function：</strong>非常常见的错误，要考虑多方面因素补环境，一是可以根据网页内容调试异常代码补环境，二是要根据吐的环境分析，如果吐的环境一眼能看出是对象，那么可能异常并不是因为吐的环境不存在而抛出的，此时需要观察其余环境是否补完整（<strong>参考瑞数 5 异常</strong>）</li>
</ol>
</li>
<li><p><strong>瑞数 6 注意的问题：</strong></p>
<ol>
<li><p><strong>吐环境脚本运行时被卡住，类似定时器：</strong>考虑了置空定时器的方式，还有压缩混淆代码的方式，但是都没有用，此时应该直接<strong>补上已吐出的 undefined 未定义属性的环境</strong></p>
</li>
<li><p><strong>补 window.localStorage 和 sessionStorage 的环境：</strong>最好在 Hook Cookie 时输出，此时环境最完整</p>
</li>
<li><p><strong>瑞数 6 调用 document.getElementsByTagName 的参数 script 标签必须直接补空数组，不检测</strong></p>
</li>
<li><p><strong>瑞数 6 的 window 环境不宜补多，一般只补以下环境（navigator也可能不检测，重点在document）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">window.top = window;</span><br><span class="line">window.self = window;</span><br><span class="line">window.CollectGarbage = function () &#123;&#125;</span><br><span class="line">window.ActiveXObject = function () &#123;&#125;  // 瑞数5、6都检测了</span><br><span class="line">window.addEventListener = function () &#123;&#125;</span><br><span class="line">window.attachEvent = function () &#123;&#125;</span><br><span class="line">window.HTMLFormElement = function () &#123;&#125;</span><br><span class="line">// window.localStorage</span><br><span class="line">// window.sessionStorage</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h2 id="八、国外系列产品"><a href="#八、国外系列产品" class="headerlink" title="八、国外系列产品"></a>八、国外系列产品</h2><h4 id="1-TLS指纹"><a href="#1-TLS指纹" class="headerlink" title="1. TLS指纹"></a>1. TLS指纹</h4><blockquote>
<p><strong>TLS&#x2F;JA3指纹：</strong>TLS 指纹是用来识别和跟踪 TLS（传输层安全）连接的一种方法。TLS 指纹的基本思想是通过识别 TLS 握手过程中使用的加密算法和其他参数来确定特定连接的唯一标识。这种唯一标识可以用于识别特定的应用程序、设备或者用户。TLS 握手是 TLS 连接建立的过程，包括客户端和服务器之间的通信，以确保双方都能够安全地通信。在握手过程中，客户端和服务器会协商使用的加密算法、密钥长度等参数。TLS 指纹就是根据这些参数的组合来识别连接的。</p>
<p><strong>导致后果：</strong>Requests 库是基于 urllib3 进行底层的HTTP通信，因此在通信时也会生成对应的指纹。那么服务器就可以通过检测指纹是否来自合法的客户端，而决定是否返回正确的数据（**特点响应403，<a class="link"   target="_blank" rel="noopener" href="https://ascii2d.net/" >测试网站<i class="fas fa-external-link-alt"></i></a>**）</p>
<blockquote>
<p>谷歌缓存访问：<code>https://webcache.googleusercontent.com/search?q=cache:https://xfblog.cn</code></p>
</blockquote>
</blockquote>
<ul>
<li><p>查看TLS指纹：<a class="link"   target="_blank" rel="noopener" href="https://tls.browserleaks.com/json" >416ca8550ccbff6ccaf4c8ce90b50a56<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">tls = &#123;</span><br><span class="line">  &quot;user_agent&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36&quot;,</span><br><span class="line"></span><br><span class="line">  # JA3是一种基于TLS客户端hello消息中的加密算法和其他参数生成的指纹。</span><br><span class="line">  # 用于识别TLS连接的指纹，ja3_hash是JA3指纹的哈希值，ja3_text是原始的JA3指纹文本。</span><br><span class="line">  &quot;ja3_hash&quot;: &quot;2199eaa5f6183940450f0cfb5eaec221&quot;,</span><br><span class="line">  &quot;ja3_text&quot;: &quot;771,4865-4866-4867-49195-49199-49196-49200-52393-52392-49171-49172-156-157-47-53,18-13-11-27-35-10-0-65281-23-51-45-65037-17513-16-5-43,29-23-24,0&quot;,</span><br><span class="line"></span><br><span class="line">  # JA3n是JA3指纹的一个变体，用于在不同的TLS版本中识别相同的TLS配置。</span><br><span class="line">  # 与ja3_hash和ja3_text类似，ja3n_hash是JA3指纹的哈希值，ja3n_text是原始的JA3指纹文本。</span><br><span class="line">  &quot;ja3n_hash&quot;: &quot;473f0e7c0b6a0f7b049072f4e683068b&quot;,</span><br><span class="line">  &quot;ja3n_text&quot;: &quot;771,4865-4866-4867-49195-49199-49196-49200-52393-52392-49171-49172-156-157-47-53,0-5-10-11-13-16-18-23-27-35-43-45-51-17513-65037-65281,29-23-24,0&quot;,</span><br><span class="line"></span><br><span class="line">  # Akamai是一个内容传递网络（CDN）服务提供商，</span><br><span class="line">  # akamai_hash和akamai_text是对请求经过Akamai网络时的一些特征进行哈希和文本表示的结果。</span><br><span class="line">  # 用于识别请求是否经过Akamai网络服务的指纹。</span><br><span class="line">  &quot;akamai_hash&quot;: &quot;52d84b11737d980aef856699f885ca86&quot;,</span><br><span class="line">  &quot;akamai_text&quot;: &quot;1:65536;2:0;4:6291456;6:262144156631050m,a,s,p&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>注意：在逆向时，使用的 user_agent 最好是谷歌 110 以前的版本，因为在 110 以后版本的浏览器的指纹是变化的，在 110 之前版本的浏览器的指纹是固定的</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from curl_cffi import requests</span><br><span class="line"></span><br><span class="line">print(&quot;edge99:&quot;, requests.get(&quot;https://tls.browserleaks.com/json&quot;, impersonate=&quot;edge99&quot;).json())</span><br><span class="line">print(&quot;chrome110:&quot;, requests.get(&quot;https://tls.browserleaks.com/json&quot;, impersonate=&quot;chrome110&quot;).json()) # 还可以处理 cloudflare 盾指纹</span><br><span class="line">print(&quot;safari15_3:&quot;, requests.get(&quot;https://tls.browserleaks.com/json&quot;, impersonate=&quot;safari15_3&quot;).json())</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>指定使用新版本浏览器：</strong>可以在 github 上搜索生成新版本浏览器 TLS 指纹对应的 python-tls 版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import tls_client</span><br><span class="line"></span><br><span class="line"># You can also use the following as client_identifier:</span><br><span class="line"># Chrome --&gt; chrome_103, chrome_104, chrome_105, chrome_106, chrome_107, chrome_108, chrome109, Chrome110,</span><br><span class="line">#            chrome111, chrome112, chrome_116_PSK, chrome_116_PSK_PQ, chrome_117, chrome_120</span><br><span class="line"># Firefox --&gt; firefox_102, firefox_104, firefox108, Firefox110, firefox_117, firefox_120</span><br><span class="line"># Opera --&gt; opera_89, opera_90</span><br><span class="line"># Safari --&gt; safari_15_3, safari_15_6_1, safari_16_0</span><br><span class="line"># iOS --&gt; safari_ios_15_5, safari_ios_15_6, safari_ios_16_0</span><br><span class="line"># iPadOS --&gt; safari_ios_15_6</span><br><span class="line"># Android --&gt; okhttp4_android_7, okhttp4_android_8, okhttp4_android_9, okhttp4_android_10, okhttp4_android_11,</span><br><span class="line">#             okhttp4_android_12, okhttp4_android_13</span><br><span class="line">#</span><br><span class="line"># more client identifiers can be found in settings.py</span><br><span class="line"></span><br><span class="line">session = tls_client.Session(</span><br><span class="line">  client_identifier=&quot;chrome112&quot;,</span><br><span class="line">  random_tls_extension_order=True</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">res = session.get(</span><br><span class="line">  &quot;https://www.example.com/&quot;,</span><br><span class="line">  headers=&#123;</span><br><span class="line">      &quot;key1&quot;: &quot;value1&quot;,</span><br><span class="line">  &#125;,</span><br><span class="line">  proxy=&quot;http://user:password@host:port&quot;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-Akamai"><a href="#2-Akamai" class="headerlink" title="2. Akamai"></a>2. Akamai</h4><blockquote>
<p><strong>Akamai：</strong>Akamai是一家全球性的内容传递网络（CDN）和云服务提供商。主要服务是通过在全球范围内分布的服务器网络来加速互联网上的内容传输。简单来说，Akamai通过将网站、应用程序和其他数字内容存储在离用户更近的服务器上，从而提高了内容的交付速度和性能（<strong>其中 Akamai Cookie 加密的传递明文数据的是 1.75 版本，传递编码过后的数据是 2 版本</strong>）</p>
<p><strong>Akamai Cookie加密逻辑：</strong></p>
<ol>
<li>请求首页，响应 Set-Cookie 值为 <del>-1</del> 的 _abck 信息，并包含用于生成 Cookie 信息的外链的 js 文件</li>
<li>对外链的 js 文件先发送一次 GET 请求，携带首次响应设置的 Cookie 信息，响应设置新的 _abck 信息</li>
<li>**再对外链 js 文件发送一次 POST 请求，携带刚刚 GET 请求响应新设置的 _abck 值和其余 Cookie 信息，同时需要逆向载荷中的 <code>sensor_data</code> 参数，最终响应设置正确的值为 <del>0</del> 的 <code>_abck</code> 信息（<a class="link"   target="_blank" rel="noopener" href="https://www.dhl.com/cn-zh/home.html?locale=true" >测试网站<i class="fas fa-external-link-alt"></i></a>**）</li>
</ol>
</blockquote>
<ul>
<li><strong>Akamai的解析思路：</strong><ol>
<li>先扣代码，再补环境，因为有大量的风控，只有扣一次代码才知道需要补哪些环境</li>
<li>最重要的是一个 58 位的数组需要解析，存在大量的风控</li>
<li>期间存在大量的控制平坦流，解决办法就是找返回值，在所有 case 语句的 return 处打断点，走进则对</li>
</ol>
</li>
<li><strong>风控（Anti-Fraud）</strong>：<ul>
<li><strong>行为分析</strong>：通过分析访问模式、用户行为等数据，来识别异常或可疑的访问</li>
<li><strong>设备指纹</strong>：对访问者的设备进行指纹识别，包括浏览器指纹、IP地址、操作系统等信息，以便追踪和识别恶意访问</li>
<li><strong>验证码</strong>：在认为访问行为异常或可疑时，可能会触发验证码验证，以确保访问者是真实的用户</li>
<li><strong>黑名单&#x2F;白名单</strong>：维护一份黑名单，记录已知的恶意IP地址或用户，并阻止它们的访问。同时，也会维护一份白名单，允许特定的用户或IP地址绕过风控机制</li>
</ul>
</li>
</ul>
<h4 id="3-Incapsula（reese84）"><a href="#3-Incapsula（reese84）" class="headerlink" title="3. Incapsula（reese84）"></a>3. Incapsula（reese84）</h4><blockquote>
<p><strong>reesee84 cookie 生成逻辑：</strong></p>
<ol>
<li>请求动态算法以及动态 K 值的 js 文件</li>
<li>通过收集浏览器指纹通过动态算法生成数据提交服务器生成 token</li>
</ol>
</blockquote>
<ul>
<li><strong>调试细节总结：</strong><ol>
<li>生成 token 过程中以及使用 token 过程中必须保持 IP 不变</li>
<li>同一个 ip 尽量保持单个 token 使用，不然容易封杀 tls</li>
<li>单个 token 正常使用，可以多次长时间使用至失效</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">document.body.addBehavior = undefined</span><br><span class="line">window.openDatabase = function () &#123; &#125;</span><br><span class="line"></span><br><span class="line">fillRect = function () &#123; &#125;</span><br><span class="line">fillText = function () &#123; &#125;</span><br><span class="line">beginPath = function () &#123; &#125;</span><br><span class="line">closePath = function () &#123; &#125;</span><br><span class="line">fill = function () &#123; &#125;</span><br><span class="line">arc = function () &#123; &#125;</span><br><span class="line">getImageData = function () &#123; return ImageData_obj &#125;</span><br><span class="line">toDataURL = function () &#123; return &#125;</span><br><span class="line"></span><br><span class="line">canvas_two = document[&quot;createElement&quot;](&quot;canvas&quot;);</span><br><span class="line">canvas_two.toDataURL = function () &#123; return &quot;data:image/webpdwadwadwadwadwa&quot; &#125;; //带上&quot;data:image/webp&quot;放在首位即可</span><br><span class="line"></span><br><span class="line">canvas_three = document[&quot;createElement&quot;](&quot;canvas&quot;);</span><br><span class="line">CanvasRenderingContext2D_two = canvas_three[&quot;getContext&quot;](&quot;2d&quot;);</span><br><span class="line"></span><br><span class="line">canvas_four = document[&quot;createElement&quot;](&quot;canvas&quot;);</span><br><span class="line">CanvasRenderingContext2D_three = canvas_four[&quot;getContext&quot;](&quot;2d&quot;);</span><br><span class="line">CanvasRenderingContext2D_three.putImageData = function () &#123; &#125;</span><br><span class="line">canvas_four.toDataURL = function () &#123; return &#125;</span><br><span class="line"></span><br><span class="line">canvas_five = document[&quot;createElement&quot;](&quot;canvas&quot;);</span><br><span class="line">WebGLRenderingContext_one = canvas_five[&quot;getContext&quot;](&quot;webgl&quot;)  er[&quot;getContext&quot;](&quot;experimental-webgl&quot;);</span><br><span class="line"></span><br><span class="line">WebGLBuffer_one = WebGLRenderingContext_one[&quot;createBuffer&quot;] &amp;&amp; WebGLRenderingContext_one[&quot;createBuffer&quot;]();</span><br><span class="line">WebGLRenderingContext_one.bindBuffer = function</span><br><span class="line">.bufferData = function</span><br><span class="line">.createProgram = function</span><br><span class="line">.createShader = function</span><br><span class="line">.shaderSource</span><br><span class="line">        .compileShader</span><br><span class="line">        .attachShader</span><br><span class="line">        .linkProgram</span><br><span class="line">        .useProgram</span><br><span class="line">        .getAttribLocation = function () &#123; return ???&#125;</span><br><span class="line">            .getUniformLocation</span><br><span class="line">            .enableVertexAttribArray</span><br><span class="line">            .vertexAttribPointer</span><br><span class="line">            .uniform2f</span><br><span class="line">            .drawArrays</span><br><span class="line">            .canvas = &#123;</span><br><span class="line">                toDataURL: function () &#123; return &quot;&quot; &#125;</span><br><span class="line">            &#125;</span><br><span class="line">                .readPixels = function () &#123; &#125;</span><br><span class="line"></span><br><span class="line">canvas_six = document[&quot;createElement&quot;](&quot;canvas&quot;);</span><br><span class="line"></span><br><span class="line">CanvasRenderingContext2D_canvas_six = canvas_six[&quot;getContext&quot;](&quot;2d&quot;);</span><br><span class="line">CanvasRenderingContext2D_canvas_six.createImageData = function () &#123;</span><br><span class="line">    return ImageDataOBj]</span><br><span class="line">    CanvasRenderingContext2D_canvas_six.putImageData = function () &#123; &#125;</span><br><span class="line">    ImageDataOBj = &#123;</span><br><span class="line">        data: &#123;      //Uint8ClampedArray</span><br><span class="line">            set: function () &#123; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    canvas_six.toDataURL = function () &#123; return &quot;&quot; &#125;</span><br><span class="line"></span><br><span class="line">    WebGLRenderingContext_one.getSupportedExtensions = function () &#123; return [] &#125;</span><br><span class="line">        .getParameter = function () &#123; &#125;        &quot;ALIASED_LINE_WIDTH_RANGE&quot; / &quot;ALIASED_POINT_SIZE_RANGE&quot; / &quot;ALPHA_BITS&quot;</span><br><span class="line">            .getContextAttributes = function() &#123; return obj = &#123; antialias: true &#125; &#125;</span><br><span class="line">    &quot;BLUE_BITS&quot; / &quot;DEPTH_BITS&quot; / &quot;GREEN_BITS&quot;</span><br><span class="line"></span><br><span class="line">    window[&quot;WebGLRenderingContext&quot;][&quot;prototype&quot;][&quot;getParameter&quot;][&quot;name&quot;];</span><br><span class="line">    toString检测</span><br><span class="line">    navigator.maxTouchPoints</span><br><span class="line">    document[&quot;createElement&quot;](&quot;video&quot;);  = object = &#123;</span><br><span class="line">        canPlayType: function () &#123; return &quot;probably&quot; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    document[&quot;createElement&quot;](&quot;audio&quot;);</span><br><span class="line">===&gt; &#123;</span><br><span class="line">        canPlayType: function () &#123; return &quot;probably&quot; &#125;      参数：&quot;audio/x-m4a;&quot;  返回maybe / 参数：[]  返回nope</span><br><span class="line">    &#125;</span><br><span class="line">    navigator.vendor</span><br><span class="line">        .product</span><br><span class="line">        .productSub</span><br><span class="line">    window.chrome = &#123;</span><br><span class="line">        loadTimes: function () &#123; &#125; // toString()检测，</span><br><span class="line">    app: &#123;</span><br><span class="line">            获取app下属性的描述符，</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    navigator.appName</span><br><span class="line">        .webdriver = false</span><br><span class="line">        [&quot;connection&quot;][&quot;rtt&quot;] = 100</span><br><span class="line"></span><br><span class="line">    window.history.length = 12</span><br><span class="line">    navigator.hardwareConcurrency = 12</span><br><span class="line"></span><br><span class="line">    window[&quot;self&quot;] !== window[&quot;top&quot;];</span><br><span class="line">    window[&quot;navigator&quot;][&quot;getBattery&quot;] 函数 toString检测</span><br><span class="line"></span><br><span class="line">    window[&quot;console&quot;][&quot;debug&quot;][&quot;name&quot;]; toString检测</span><br><span class="line">    window.PERSISTENT / TEMPORARY / PerformanceObserver.supportedEntryTypes</span><br><span class="line"></span><br><span class="line">    location.protocol</span><br><span class="line">    CanvasRenderingContext2D_十三 = document[&quot;createElement&quot;](&quot;canvas&quot;)[&quot;getContext&quot;](&quot;2d&quot;);</span><br><span class="line">.measureText = function () &#123; return &#123;&#125; &#125; ???????????????</span><br><span class="line"></span><br><span class="line">        twoelement = window[&quot;document&quot;][&quot;documentElement&quot;][&quot;children&quot;];</span><br><span class="line">    twoelement[0][&quot;tagName&quot;][&quot;toUpperCase&quot;]()</span><br><span class="line"></span><br><span class="line">    window.visualViewport.width / height / scale</span><br><span class="line"></span><br><span class="line">    document[&quot;createAttribute&quot;, &quot;createElement&quot;, &quot;createElementNS&quot;]; 三个函数</span><br><span class="line">    document[&quot;implementation&quot;][&quot;createHTMLDocument&quot;](&quot;&quot;);</span><br></pre></td></tr></table></figure>

<h2 id="九、验证码专题"><a href="#九、验证码专题" class="headerlink" title="九、验证码专题"></a>九、验证码专题</h2><blockquote>
<p><strong>常见验证码平台：</strong></p>
<ul>
<li><strong>网易易盾（yidun，背景带缺口+缺口）：</strong><a class="link"   target="_blank" rel="noopener" href="https://dun.163.com/trial/jigsaw" >03fff674e9e95e3ac8bfe84466f24c6c<i class="fas fa-external-link-alt"></i></a></li>
<li><strong>顶象（dx，canvas，背景带缺口+缺口）：</strong><a class="link"   target="_blank" rel="noopener" href="https://www.dingxiang-inc.com/business/captcha" >ef51a97e8dfa006dbca1825bae38cf48<i class="fas fa-external-link-alt"></i></a></li>
<li><strong>小盾安全，同盾（td，canvas，背景带缺口+缺口）：</strong><a class="link"   target="_blank" rel="noopener" href="https://xiaodun.com/onlineExperience/slidingPuzzle" >ad4cc66dab6d1618e3ed703379ce2d0b<i class="fas fa-external-link-alt"></i></a></li>
<li><strong>数美（shumei，背景带缺口+缺口）：</strong><a class="link"   target="_blank" rel="noopener" href="https://www.ishumei.com/new/product/tw/code" >70dba825d22eeeb5cec343ec195067e4<i class="fas fa-external-link-alt"></i></a></li>
<li><strong>极验（geetest，canvas，背景带缺口+缺口+完整背景）：</strong><a class="link"   target="_blank" rel="noopener" href="https://www.geetest.com/show" >3281b0760f9fc3cee6e0e2d0a87d5034<i class="fas fa-external-link-alt"></i></a></li>
<li><strong>VAPTCHA（vp，canvas，画轨迹）：</strong><a class="link"   target="_blank" rel="noopener" href="https://www.vaptcha.com/?lang=cn&from=0#demo" >a9e9cdc19da9fd4ba57abecae8ffaced<i class="fas fa-external-link-alt"></i></a></li>
<li><strong>腾讯（tc，背景带缺口+缺口）：</strong><a class="link"   target="_blank" rel="noopener" href="https://admin.xiaoe-tech.com/t/login?reg_source=0101&src_page=A#/acount" >b7d893c351d69c0da5a545cbff1d5520<i class="fas fa-external-link-alt"></i></a></li>
<li><strong>谷歌（hcaptcha，9图找实物）：</strong><a class="link"   target="_blank" rel="noopener" href="https://www.google.com/recaptcha/api2/demo" >e497cdff45d62c05b741c80b38584632<i class="fas fa-external-link-alt"></i></a>，<a class="link"   target="_blank" rel="noopener" href="https://www.yescaptcha.com/auth/register" >定制解决方案<i class="fas fa-external-link-alt"></i></a></li>
</ul>
</blockquote>
<h4 id="1-canvas底图还原"><a href="#1-canvas底图还原" class="headerlink" title="1. canvas底图还原"></a>1. canvas底图还原</h4><ul>
<li><strong>还原由 canvas 技术绘图生成的验证码底图</strong>（F12查看验证码元素可以看出）：<ol>
<li>在事件监听中<strong>勾选 canvas 断点</strong>，刷新网页会在画布创建时进入断点</li>
<li>通过分析生成算法，主要发现其<strong>由一个 Ut 数组和 for 循环</strong>将图像数据一块块 putImageData 到画布上</li>
</ol>
</li>
<li><strong>极验3代滑块底图还原（python 使用 PIL 库复现 js 逻辑）：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image</span><br><span class="line"></span><br><span class="line">def parse_image(self):</span><br><span class="line">    bg_url = &quot;https://static.geetest.com/&quot; + self.get2_data[&#x27;bg&#x27;]</span><br><span class="line">    full_url = &quot;https://static.geetest.com/&quot; + self.get2_data[&#x27;fullbg&#x27;]</span><br><span class="line"></span><br><span class="line">    with open(&#x27;./bg.png&#x27;, &#x27;wb&#x27;) as fp:</span><br><span class="line">        fp.write(requests.get(bg_url).content)</span><br><span class="line">    with open(&#x27;./full.png&#x27;, &#x27;wb&#x27;) as fp:</span><br><span class="line">        fp.write(requests.get(full_url).content)</span><br><span class="line"></span><br><span class="line">    img_list = [&quot;./bg.png&quot;, &quot;./full.png&quot;]</span><br><span class="line">    for index, img in enumerate(img_list):</span><br><span class="line">        image = Image.open(img)</span><br><span class="line">        s = Image.new(&quot;RGBA&quot;, (260, 160))</span><br><span class="line">        ut = [39, 38, 48, 49, 41, 40, 46, 47, 35, 34, 50, 51, 33, 32, 28, 29, 27, 26, 36, 37, 31, 30, 44, 45,</span><br><span class="line">              43, 42,</span><br><span class="line">              12, 13, 23, 22, 14, 15, 21, 20, 8, 9, 25, 24, 6, 7, 3, 2, 0, 1, 11, 10, 4, 5, 19, 18, 16, 17]</span><br><span class="line">        height_half = 80</span><br><span class="line">        for inx in range(52):</span><br><span class="line">            c = ut[inx] % 26 * 12 + 1</span><br><span class="line">            u = height_half if ut[inx] &gt; 25 else 0</span><br><span class="line">            l_ = image.crop(box=(c, u, c + 10, u + 80))</span><br><span class="line">            s.paste(l_, box=(inx % 26 * 10, 80 if inx &gt; 25 else 0))</span><br><span class="line"></span><br><span class="line">        if index == 0:</span><br><span class="line">            s.save(&quot;./bg.png&quot;)</span><br><span class="line">            logger.info(f&quot;还原缺口背景图 &#123;bg_url&#125; 成功&quot;)</span><br><span class="line">        else:</span><br><span class="line">            s.save(&quot;./full.png&quot;)</span><br><span class="line">            logger.info(f&quot;还原完整背景图 &#123;full_url&#125; 成功&quot;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>网页手动提取图片数据：</strong><ol>
<li>分析验证码时，发现其是通过 Canvas 画布生成的，且没有提供 API 接口可以获取图片</li>
<li>通过 <code>document.querySelector(&#39;&#39;).toDataURL()</code> 将 Canvas 内容转换为包含图像数据的 Data URL</li>
<li>通过使用 base64 和 PIL 库来处理包含在 Data URL 中的图像数据，并将其保存为本地文件</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import base64, io</span><br><span class="line">from PIL import Image  # pip install pillow</span><br><span class="line"></span><br><span class="line">bg = &#x27;data:image/png;base64,......JRU5ErkJggg==&#x27;</span><br><span class="line"></span><br><span class="line">images = bg.split(&#x27;,&#x27;)[1]</span><br><span class="line">images = base64.b64decode(images)  # 将base64编码的图像数据解码为二进制数据</span><br><span class="line">images = Image.open(io.BytesIO(images))  # 将二进制数据包装为一个类文件对象</span><br><span class="line">images.save(&#x27;bg.png&#x27;)</span><br></pre></td></tr></table></figure>

<h4 id="2-识别滑动距离"><a href="#2-识别滑动距离" class="headerlink" title="2. 识别滑动距离"></a>2. 识别滑动距离</h4><ul>
<li><strong>确定滑块验证码需要拖拽的位移距离：</strong><ol>
<li><strong>GitHub 基于人工智能的深度网络训练模型 ddddocr 开源库：</strong><a class="link"   target="_blank" rel="noopener" href="https://github.com/sml2h3/ddddocr" >f70901e4adbfaa715cd0753e2adf6bea<i class="fas fa-external-link-alt"></i></a></li>
<li><strong>第三方打码平台（<a class="link"   target="_blank" rel="noopener" href="https://www.jfbym.com/demo.html" >云码<i class="fas fa-external-link-alt"></i></a>）：</strong>通过完整图片与缺失滑块的图片进行像素对比（图片 –&gt; 矩阵 –&gt; 像素点）</li>
<li><strong>边缘检测算法：</strong>OpenCV 识别滑动距离</li>
</ol>
</li>
<li><strong>Ddddocr 识别滑动距离（算法1，缺口滑块图和有缺口的背景图）：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import ddddocr</span><br><span class="line"></span><br><span class="line">target_bytes = requests.get(slice_img_url).content</span><br><span class="line">background_bytes = requests.get(bg_img_url).content</span><br><span class="line"></span><br><span class="line">with open(&#x27;./target.png&#x27;, &#x27;wb&#x27;) as fp:</span><br><span class="line">    fp.write(target_bytes)</span><br><span class="line"></span><br><span class="line">with open(&#x27;./background.png&#x27;, &#x27;wb&#x27;) as fp:</span><br><span class="line">    fp.write(background_bytes)</span><br><span class="line"></span><br><span class="line">det = ddddocr.DdddOcr(det=False, ocr=False)</span><br><span class="line">cv2.imread(&quot;target.png&quot;)</span><br><span class="line">cv2.imread(&quot;background.png&quot;)</span><br><span class="line">res = det.slide_match(target_bytes, background_bytes)[&#x27;target&#x27;][0] - 4</span><br><span class="line">logger.info(f&quot;ddddocr识别图片需滑动距离为：&#123;res&#125;&quot;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Ddddocr 识别滑动距离（算法2，有缺口的背景图和完整背景图）：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import ddddocr</span><br><span class="line"></span><br><span class="line">def get_t_ddddocr(self):</span><br><span class="line">    slide = ddddocr.DdddOcr(det=False, ocr=False)</span><br><span class="line"></span><br><span class="line">    with open(&#x27;./bg.png&#x27;, &#x27;rb&#x27;) as f:</span><br><span class="line">        target_bytes = f.read()</span><br><span class="line"></span><br><span class="line">    with open(&#x27;./full.png&#x27;, &#x27;rb&#x27;) as f:</span><br><span class="line">        background_bytes = f.read()</span><br><span class="line"></span><br><span class="line">    t = slide.slide_comparison(target_bytes, background_bytes)[&#x27;target&#x27;][0] - 7</span><br><span class="line"></span><br><span class="line">    logger.info(f&quot;ddddocr识别图片需滑动距离为：&#123;t&#125;&quot;)</span><br><span class="line">    return t</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>边缘检测算法：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import PIL</span><br><span class="line">import numpy as np</span><br><span class="line">from PIL import Image</span><br><span class="line">from pathlib import Path</span><br><span class="line"></span><br><span class="line">def imshow(img, winname=&#x27;test&#x27;, delay=0):</span><br><span class="line">    &quot;&quot;&quot;cv2展示图片&quot;&quot;&quot;</span><br><span class="line">    cv2.imshow(winname, img)</span><br><span class="line">    cv2.waitKey(delay)</span><br><span class="line">    cv2.destroyAllWindows()</span><br><span class="line"></span><br><span class="line">def pil_to_cv2(img):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    pil转cv2图片</span><br><span class="line">    :param img: pil图像, &lt;type &#x27;PIL.JpegImagePlugin.JpegImageFile&#x27;&gt;</span><br><span class="line">    :return: cv2图像, &lt;type &#x27;numpy.ndarray&#x27;&gt;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    img = cv2.cvtColor(np.asarray(img), cv2.COLOR_RGB2BGR)</span><br><span class="line">    return img</span><br><span class="line"></span><br><span class="line">def bytes_to_cv2(img):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    二进制图片转cv2</span><br><span class="line">    :param img: 二进制图片数据, &lt;type &#x27;bytes&#x27;&gt;</span><br><span class="line">    :return: cv2图像, &lt;type &#x27;numpy.ndarray&#x27;&gt;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # 将图片字节码bytes, 转换成一维的numpy数组到缓存中</span><br><span class="line">    img_buffer_np = np.frombuffer(img, dtype=np.uint8)</span><br><span class="line">    # 从指定的内存缓存中读取一维numpy数据, 并把数据转换(解码)成图像矩阵格式</span><br><span class="line">    img_np = cv2.imdecode(img_buffer_np, 1)</span><br><span class="line">    return img_np</span><br><span class="line"></span><br><span class="line">def cv2_open(img, flag=None):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    统一输出图片格式为cv2图像, &lt;type &#x27;numpy.ndarray&#x27;&gt;</span><br><span class="line">    :param img: &lt;type &#x27;bytes&#x27;/&#x27;numpy.ndarray&#x27;/&#x27;str&#x27;/&#x27;Path&#x27;/&#x27;PIL.JpegImagePlugin.JpegImageFile&#x27;&gt;</span><br><span class="line">    :param flag: 颜色空间转换类型, default: None</span><br><span class="line">        eg: cv2.COLOR_BGR2GRAY（灰度图）</span><br><span class="line">    :return: cv2图像, &lt;numpy.ndarray&gt;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    if isinstance(img, bytes):</span><br><span class="line">        img = bytes_to_cv2(img)</span><br><span class="line">    elif isinstance(img, (str, Path)):</span><br><span class="line">        img = cv2.imread(str(img))</span><br><span class="line">    elif isinstance(img, np.ndarray):</span><br><span class="line">        img = img</span><br><span class="line">    elif isinstance(img, PIL.Image.Image):</span><br><span class="line">        img = pil_to_cv2(img)</span><br><span class="line">    else:</span><br><span class="line">        raise ValueError(f&#x27;输入的图片类型无法解析: &#123;type(img)&#125;&#x27;)</span><br><span class="line">    if flag is not None:</span><br><span class="line">        img = cv2.cvtColor(img, flag)</span><br><span class="line">    return img</span><br><span class="line"></span><br><span class="line">def get_distance(bg, tp, im_show=False, save_path=None):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    :param bg: 背景图路径或 Path 对象或图片二进制</span><br><span class="line">               eg: &#x27;assets/bg.jpg&#x27;、Path(&#x27;assets/bg.jpg&#x27;)</span><br><span class="line">    :param tp: 缺口图路径或 Path 对象或图片二进制</span><br><span class="line">               eg: &#x27;assets/tp.jpg&#x27;、Path(&#x27;assets/tp.jpg&#x27;)</span><br><span class="line">    :param im_show: 是否显示结果, &lt;type &#x27;bool&#x27;&gt;; default: False</span><br><span class="line">    :param save_path: 保存路径, &lt;type &#x27;str&#x27;/&#x27;Path&#x27;&gt;; default: None</span><br><span class="line">    :return: 缺口位置</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # 读取图片</span><br><span class="line">    bg_img = cv2_open(bg)</span><br><span class="line">    tp_gray = cv2_open(tp, flag=cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line">    # 金字塔均值漂移</span><br><span class="line">    bg_shift = cv2.pyrMeanShiftFiltering(bg_img, 5, 50)</span><br><span class="line"></span><br><span class="line">    # 边缘检测</span><br><span class="line">    tp_gray = cv2.Canny(tp_gray, 255, 255)</span><br><span class="line">    bg_gray = cv2.Canny(bg_shift, 255, 255)</span><br><span class="line"></span><br><span class="line">    # 目标匹配</span><br><span class="line">    result = cv2.matchTemplate(bg_gray, tp_gray, cv2.TM_CCOEFF_NORMED)</span><br><span class="line">    # 解析匹配结果</span><br><span class="line">    min_val, max_val, min_loc, max_loc = cv2.minMaxLoc(result)</span><br><span class="line"></span><br><span class="line">    distance = max_loc[0]</span><br><span class="line">    if save_path or im_show:</span><br><span class="line">        # 需要绘制的方框高度和宽度</span><br><span class="line">        tp_height, tp_width = tp_gray.shape[:2]</span><br><span class="line">        # 矩形左上角点位置</span><br><span class="line">        x, y = max_loc</span><br><span class="line">        # 矩形右下角点位置</span><br><span class="line">        _x, _y = x + tp_width, y + tp_height</span><br><span class="line">        # 绘制矩形</span><br><span class="line">        bg_img = cv2_open(bg)</span><br><span class="line">        cv2.rectangle(bg_img, (x, y), (_x, _y), (0, 0, 255), 2)</span><br><span class="line">        # 保存缺口识别结果到背景图</span><br><span class="line">        if save_path:</span><br><span class="line">            save_path = Path(save_path).resolve()</span><br><span class="line">            save_path = save_path.parent / f&quot;&#123;save_path.stem&#125;&#123;save_path.suffix&#125;&quot;</span><br><span class="line">            save_path = save_path.__str__()</span><br><span class="line">            cv2.imwrite(save_path, bg_img)</span><br><span class="line">        # 显示缺口识别结果</span><br><span class="line">        if im_show:</span><br><span class="line">            imshow(bg_img)</span><br><span class="line">    return distance</span><br><span class="line"></span><br><span class="line"># with open(&quot;./img/slide_bg.jpg&quot;, &quot;rb&quot;) as f:</span><br><span class="line">#     bg_img = f.read()</span><br><span class="line"># with open(&quot;./img/slide_slice.png&quot;, &quot;rb&quot;) as f:</span><br><span class="line">#     slice_img = f.read()</span><br><span class="line"># distance = get_distance(bg_img, slice_img)</span><br><span class="line"># print(distance)</span><br></pre></td></tr></table></figure>

<h4 id="3-track轨迹生成"><a href="#3-track轨迹生成" class="headerlink" title="3. track轨迹生成"></a>3. track轨迹生成</h4><blockquote>
<p>轨迹主要是针对滑块的，基于贝塞尔曲线生成轨迹可以参考：<a class="link"   target="_blank" rel="noopener" href="https://github.com/2833844911/gurs" >fa5294b67caaf91f4de8d6ed551a810e<i class="fas fa-external-link-alt"></i></a>，使用 tanh 和 arctan 函数整合生成轨迹可以参考：<a class="link"   target="_blank" rel="noopener" href="https://www.52pojie.cn/forum.php?mod=viewthread&tid=1162979" >7a15c1aca3c556ac8b660040c6811234<i class="fas fa-external-link-alt"></i></a></p>
</blockquote>
<ul>
<li><strong>极验3代滑块轨迹生成算法1：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line"></span><br><span class="line">def get_slide_track1(self, distance):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    根据滑动距离生成滑动轨迹</span><br><span class="line">    :param distance: 需要滑动的距离</span><br><span class="line">    :return: 滑动轨迹&lt;type &#x27;list&#x27;&gt;: [[x,y,t], ...]</span><br><span class="line">        x: 已滑动的横向距离</span><br><span class="line">        y: 已滑动的纵向距离, 除起点外, 均为0</span><br><span class="line">        t: 滑动过程消耗的时间, 单位: 毫秒</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __ease_out_expo(sep):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        缓动函数 easeOutExpo</span><br><span class="line">        参考：https://easings.net/zh-cn#easeOutExpo</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        if sep == 1:</span><br><span class="line">            return 1</span><br><span class="line">        else:</span><br><span class="line">            return 1 - pow(2, -10 * sep)</span><br><span class="line"></span><br><span class="line">    if not isinstance(distance, int) or distance &lt; 0:</span><br><span class="line">        raise ValueError(f&quot;distance类型必须是大于等于0的整数: distance: &#123;distance&#125;, type: &#123;type(distance)&#125;&quot;)</span><br><span class="line">    # 初始化轨迹列表</span><br><span class="line">    slide_track = [</span><br><span class="line">        [random.randint(-50, -10), random.randint(-50, -10), 0],</span><br><span class="line">        [0, 0, 0],</span><br><span class="line">    ]</span><br><span class="line">    # 共记录count次滑块位置信息</span><br><span class="line">    count = 30 + int(distance / 2)</span><br><span class="line">    # 初始化滑动时间</span><br><span class="line">    t = random.randint(50, 100)</span><br><span class="line">    # 记录上一次滑动的距离</span><br><span class="line">    _x = 0</span><br><span class="line">    _y = 0</span><br><span class="line">    for i in range(count):</span><br><span class="line">        # 已滑动的横向距离</span><br><span class="line">        x = round(__ease_out_expo(i / count) * distance)</span><br><span class="line">        # 滑动过程消耗的时间</span><br><span class="line">        t += random.randint(10, 20)</span><br><span class="line">        if x == _x:</span><br><span class="line">            continue</span><br><span class="line">        slide_track.append([x, _y, t])</span><br><span class="line">        _x = x</span><br><span class="line">    slide_track.append(slide_track[-1])</span><br><span class="line"></span><br><span class="line">    logger.info(f&quot;生成轨迹：&#123;slide_track&#125;&quot;)</span><br><span class="line">    return slide_track</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>极验3代滑块轨迹生成算法2：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line"></span><br><span class="line">def get_slide_track2(self, x):</span><br><span class="line">    # 初始化轨迹列表</span><br><span class="line">    slide_track = [</span><br><span class="line">        [random.randint(-50, -20), random.randint(-50, -10), 0],</span><br><span class="line">        [0, 0, 0],</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    if x &lt; 100:</span><br><span class="line">        move_section = 1  # 如果移动距离小于100 那么move次数为x加上 7到20之间的数</span><br><span class="line">    else:</span><br><span class="line">        move_section = 2  # 如果移动距离小于100 那么move次数为x加上 2乘 7到20之间的数</span><br><span class="line"></span><br><span class="line">    up_down = random.randint(0, 1)  # 确定一个方向 x大于0或x小于0</span><br><span class="line">    y = 0  # 数组的y值</span><br><span class="line">    time = random.randint(0, 10)  # 初始时间 即为第二个数组的时间  后续时间累加操作就可以了</span><br><span class="line">    count = 0</span><br><span class="line">    flag = 0</span><br><span class="line">    repetition = int(x / 4)  # 重复x出现的个数</span><br><span class="line">    frist_count = random.randint(6, 10)  # 前面y为0的数组个数</span><br><span class="line">    for i in range(x * random.randint(move_section * 7, move_section * 21)):  # move_section 在这里起作用</span><br><span class="line">        if i + 1 &gt; x:  # 如果i+1要等于x 或者小于x 但这里基本上都是等于x</span><br><span class="line">            break</span><br><span class="line">        if up_down == 0:  # up_down如果大于0 那么这个轨迹就是y增轨迹</span><br><span class="line">            if i &gt; frist_count:</span><br><span class="line">                if count == 0:</span><br><span class="line">                    y += random.randint(0, 1)</span><br><span class="line">                    count += 1</span><br><span class="line">                if flag &gt; random.randint(8, 10):</span><br><span class="line">                    count = 0</span><br><span class="line">                    flag = 0</span><br><span class="line">                if i + 1 &gt; int(x / 5) * 4:</span><br><span class="line">                    time += random.randint(20, 70)</span><br><span class="line">                elif i + 1 &gt; x - 3:</span><br><span class="line">                    time += random.randint(80, 180)</span><br><span class="line">                else:</span><br><span class="line">                    time += random.randint(0, 5)</span><br><span class="line">                slide_track.append([i + 1, y, time])</span><br><span class="line">                flag += 1</span><br><span class="line">                if random.randint(0, 1):</span><br><span class="line">                    if repetition:</span><br><span class="line">                        slide_track.append([i + 1, y, time + random.randint(0, 3)])</span><br><span class="line">                        flag += 1</span><br><span class="line">                        repetition -= 1</span><br><span class="line">            else:  # 前面几个数组y都为0</span><br><span class="line">                time += random.randint(0, 5)</span><br><span class="line">                slide_track.append([i + 1, y, time])</span><br><span class="line">                if random.randint(0, 1):</span><br><span class="line">                    if repetition:</span><br><span class="line">                        slide_track.append([i + 1, y, time + random.randint(0, 3)])</span><br><span class="line">                        repetition -= 1</span><br><span class="line"></span><br><span class="line">        if up_down == 1:  # up_down如果小于0 那么这个轨迹就是y减轨迹</span><br><span class="line">            if i &gt; frist_count:</span><br><span class="line">                if count == 0:</span><br><span class="line">                    y -= random.randint(0, 1)</span><br><span class="line">                    count += 1</span><br><span class="line">                if flag &gt; random.randint(8, 10):</span><br><span class="line">                    count = 0</span><br><span class="line">                    flag = 0</span><br><span class="line">                if i + 1 &gt; int(x / 5) * 4:</span><br><span class="line">                    time += random.randint(7, 40)</span><br><span class="line">                elif i + 1 &gt; x - 3:</span><br><span class="line">                    time += random.randint(80, 180)</span><br><span class="line">                else:</span><br><span class="line">                    time += random.randint(0, 5)</span><br><span class="line">                slide_track.append([i + 1, y, time])</span><br><span class="line">                flag += 1</span><br><span class="line">                if random.randint(0, 1):</span><br><span class="line">                    if repetition:</span><br><span class="line">                        slide_track.append([i + 1, y, time + random.randint(0, 3)])</span><br><span class="line">                        flag += 1</span><br><span class="line">                        repetition -= 1</span><br><span class="line">            else:</span><br><span class="line">                time += random.randint(0, 5)</span><br><span class="line">                slide_track.append([i + 1, y, time])</span><br><span class="line">                if random.randint(0, 1):</span><br><span class="line">                    if repetition:</span><br><span class="line">                        slide_track.append([i + 1, y, time + random.randint(0, 3)])</span><br><span class="line">                        repetition -= 1</span><br><span class="line"></span><br><span class="line">    print(f&quot;生成轨迹成功：&#123;slide_track&#125;\n&quot;)</span><br><span class="line">    return slide_track</span><br></pre></td></tr></table></figure>

<h4 id="4-极验3代滑块"><a href="#4-极验3代滑块" class="headerlink" title="4. 极验3代滑块"></a>4. 极验3代滑块</h4><blockquote>
<p><strong>请求接口逻辑分析（<a class="link"   target="_blank" rel="noopener" href="https://www.geetest.com/demo/slide-float.html" >测试网站<i class="fas fa-external-link-alt"></i></a>）：</strong></p>
<ol>
<li><strong>register-slide：</strong>携带时间戳，返回 challenge 和 gt 值</li>
<li><strong>gettype.php：</strong>携带 gt 值，返回一堆 js 文件地址</li>
<li><strong>get.php：</strong>携带 <strong>w1</strong>、challenge、gt 参数，返回带有 c 和 s 的数据</li>
<li><strong>ajax.php：</strong>携带 <strong>w2</strong>、challenge、gt 参数，返回滑块类型</li>
<li><strong>get.php：</strong>携带 challenge、gt 等多个参数，返回重要数据，包含新的 challenge、s 值和图片请求地址</li>
<li><strong>ajax.php：</strong>携带 <strong>w3</strong>、新challenge、gt 参数，返回验证成功数据</li>
</ol>
<p><strong>注意：极验必须严格按顺序请求每一次接口，哪怕返回的数据没有用，否则后续请求就会有响应错误的问题</strong></p>
<p><strong>逆向 w 值：极验 3 代中，需逆向的 w1 和 w2 参数，可置空，可固定，也可能要 js 生成，具体网站具体分析</strong></p>
</blockquote>
<ul>
<li><p><strong>突破策略：</strong></p>
<ol>
<li>验证码存在多个请求接口，<strong>在最终进行验证的接口载荷中通常存在一个需要逆向的加密验证 w 参数</strong>，可以通过启动器定位文件，搜索关键字 “w”，一般需要<strong>对源文件 AST 普通解混淆</strong>后替换文件，定位加密位置</li>
<li>逆向参数通常采用<strong>全扣代码补环境</strong>，<strong>所有方法都可以通过全局对象导出（不能直接导出的，可能是因为导出的对象小了，要往大里导，或者需要细扣代码）</strong>，也可能是因为<strong>存在环境检测</strong>，主要使用脚本补环境，因为环境不多，也可以使用 v_jstools 工具生成临时环境</li>
<li>其中 w3 参数中的滑块移动距离、轨迹加密参数，都是栈堆的上一帧传过来的，需要在上一个栈分析</li>
<li>对于携带 callback 载荷数据的接口返回的 jsonp 格式数据，<strong>一定不要为了方便获取 json 数据直接去掉 callback 参数，因为 callback 也是验证参数之一</strong>，使用正则表达式即可</li>
</ol>
</li>
<li><p><strong>细节避坑总结：</strong></p>
<ol>
<li><strong>关于 challenge 和 s 值：</strong>在第 2 次请求 get.php 接口后，响应会返回新的 challenge 值和 s 值，在后续请求 ajax.php 校验接口时，需要携带的 ch 值和逆向 w3 参数中所使用到的所有 ch 值，都必须是最新的</li>
<li><strong>关于 w3 中的 passtime 数据：</strong>不管是极验几代，逆向 w 时都有个 passtime 参与计算。这个值有两种情况：如果是滑块，则是滑动所用时间，即轨迹的最后一个时间值 **<code>track[track.length - 1][2]</code>**；除了滑块的其他情况，可以写死，也可以随机生成一个值 <strong><code>Math.floor((Math.random()*500) + 4000)</code></strong></li>
<li><strong>关于 w 中的随机变化字符串：</strong>不管是极验几代，都会有一个 16 位随机字符串参与了 w 的加密计算，这个随机字符串一般都会用到两次，这两次要保证是一样的才行</li>
<li><strong>关于缺口识别距离：</strong>滑块距离通常不是从最左边开始的，前面会有几个像素的空白距离，所以<strong>实际 distance &#x3D; 缺口识别距离 - 空白距离</strong>（要不要减去这个值、减去多少，具体网址具体分析）</li>
<li><strong>关于时间间隔：</strong>三代里面，整个流程走得太快了也不行，需要在生成 w 值之后，随机停留个 2 秒左右，例如三代的点选（文字点选、图标点选、语序点选、空间推理）</li>
<li><strong>关于 w2 中的 captcha_token 值：</strong>如果替换文件被检测出来，则返回的 captcha_token 是异常的，会导致一直验证失败</li>
</ol>
</li>
<li><p><strong>极验常见错误返回信息：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// challenge 不对</span><br><span class="line">geetest_xxxxxxxxxxxxx(&#123;&quot;status&quot;: &quot;error&quot;, &quot;error&quot;: &quot;illegal challenge&quot;, &quot;user_error&quot;: &quot;网络不给力&quot;, &quot;error_code&quot;: &quot;error_23&quot;&#125;)</span><br><span class="line">// w 生成不对</span><br><span class="line">geetest_xxxxxxxxxxxxx(&#123;&quot;status&quot;: &quot;error&quot;, &quot;error&quot;: &quot;param decrypt error&quot;, &quot;user_error&quot;: &quot;网络不给力&quot;, &quot;error_code&quot;: &quot;error_03&quot;&#125;)</span><br><span class="line">// 滑动验证没有轨迹</span><br><span class="line">geetest_xxxxxxxxxxxxx(&#123;&quot;status&quot;: &quot;error&quot;, &quot;error&quot;: &quot;not proof&quot;, &quot;user_error&quot;: &quot;网络不给力&quot;, &quot;error_code&quot;: &quot;error_21&quot;&#125;)</span><br><span class="line">// 轨迹、缺口距离、参数问题</span><br><span class="line">geetest_xxxxxxxxxxxxx(&#123;&quot;success&quot;: 0, &quot;message&quot;: &quot;fail&quot;&#125;)  // 缺口距离，轨迹生成问题</span><br><span class="line">geetest_xxxxxxxxxxxxx(&#123;&quot;success&quot;: 0, &quot;message&quot;: &quot;forbidden&quot;&#125;)  // 其余接口 w 参数问题</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="5-极验3代点选"><a href="#5-极验3代点选" class="headerlink" title="5. 极验3代点选"></a>5. 极验3代点选</h4><blockquote>
<p><strong>点选的请求接口逻辑：</strong>与滑块一致</p>
<p><strong>点选的核心处理逻辑：</strong></p>
<ol>
<li>通过云码识别验证码，得到文字坐标信息，并可以通过多组坐标变化数据，利用 chatgpt 生成坐标算法</li>
<li>w3 参数的逆向中，主要是对验证码图片中的文字坐标的验证，其余鼠标移动轨迹和鼠标点击的坐标信息均未验证，使用一组固定的真实数据模拟即可</li>
</ol>
<p><strong>确认点击的初始坐标位置：</strong>事件监听器断点 –&gt; 鼠标 –&gt; click，断点中 offsetX 和 offsetY 即为点击坐标信息</p>
</blockquote>
<ul>
<li><p><strong>细节避坑总结：</strong></p>
<ol>
<li><p><strong>关于时间间隔：</strong>三代里面，整个流程走得太快了也不行，需要在生成 w 值之后，随机停留个 2 秒左右，例如三代的点选（文字点选、图标点选、语序点选、空间推理），会返回以下错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geetest_xxxxxx(&#123;&quot;status&quot;: &quot;success&quot;, &quot;data&quot;: &#123;&quot;result&quot;: &quot;fail&quot;, &quot;msg&quot;: [&quot;duration short&quot;]&#125;&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h2 id="十、高难度逆向案例"><a href="#十、高难度逆向案例" class="headerlink" title="十、高难度逆向案例"></a>十、高难度逆向案例</h2><h4 id="1-异步-Promise-对象"><a href="#1-异步-Promise-对象" class="headerlink" title="1. 异步 Promise 对象"></a>1. 异步 Promise 对象</h4><blockquote>
<p><strong>Promise 是一种用来处理异步操作的对象，它代表了一个异步操作的最终完成或失败</strong>。有几下几种状态：</p>
<ul>
<li><strong>Pending（进行中）</strong>：等待中，或者进行中，表示还没有得到结果</li>
<li><strong>resolved、Fulfilled（已成功）</strong>：已经完成，表示得到了我们想要的结果，可以继续往下执行</li>
<li><strong>Rejected（已失败）</strong>：得到结果，但是由于结果并非我们所愿，因此拒绝执行</li>
</ul>
<p><strong>调用栈与事件循环：</strong>在 js 中，所有的代码执行都是在一个单线程上进行的，这个线程包含了一个调用栈和一个事件循环。调用栈（call stack）用来存储函数调用的栈结构，而事件循环（event loop）则负责处理异步操作和事件处理。当执行一个 Promise 异步操作时，该操作会被推到事件队列中，等待调用栈中的代码执行完成后再执行。这种机制确保了JavaScript在处理异步操作时不会阻塞其他代码的执行。</p>
<blockquote>
<p><strong>a.call(n, o)：</strong>调用 a 函数，并将 n 作为函数的上下文 this，传递参数 o（<strong>n 加载了 a 方法并传递 o参数</strong>）</p>
<p><strong>call 和 apply的区别：<code>func.call(context, arg1, arg2...)</code> 和 <code>func.apply(context, argsArray)</code></strong></p>
</blockquote>
</blockquote>
<ul>
<li><strong>基础语法： <code>new Promise(function(resolve, reject) &#123; &#125;);</code></strong><ol>
<li>Promise 构造函数接受一个函数为参数，函数拥有 resolve 和 reject 两个参数，由 js 引擎提供不用部署</li>
<li>Promise 的参数在构造之后会直接被<strong>异步运行</strong>，即起始函数，异步任务执行成功时调用 resolve 返回结果</li>
<li>Promise 对象的 then 方法用来处理成功时响应的数据，catch 方法用来接受处理失败时响应的数据</li>
</ol>
</li>
<li><strong>resolve 函数：</strong>将 Promise 对象的状态设置为成功，从 pending 变为 resolved，在异步操作成功的时候调用，并将异步操作结果作为参数传递出去</li>
<li><strong>reject 函数：</strong>将 Promise 对象的状态设置为失败，从 pending 变为 rejected，在异步操作失败的时候调用，并将异步操作抛出的异常作为参数传递出去</li>
<li><strong>Promise.then：</strong>对于 Promise 对象，可以使用 then 方法分别指定 resolved 和 rejected 状态的回调函数<ul>
<li><strong>注意：如果 .then 中写了参数而不是函数，则会变成 Promise 穿透</strong></li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">const p = new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    resolve(&quot;成功&quot;);</span><br><span class="line">&#125;);</span><br><span class="line">const results = p.then(</span><br><span class="line">    (res) =&gt; &#123;</span><br><span class="line">        console.log(&quot;第一次:&quot;, res); // 第一次: 成功</span><br><span class="line">        // return 6</span><br><span class="line">        // 这里的是否有返回值决定了第二次 .then 中处理成功的回调函数是否能接收到有效参数</span><br><span class="line">    &#125;,</span><br><span class="line">    (rej) =&gt; &#123;</span><br><span class="line">        console.log(rej); // 不执行</span><br><span class="line">    &#125;</span><br><span class="line">).then(</span><br><span class="line">    (res) =&gt; &#123;</span><br><span class="line">        console.log(&quot;第二次:&quot;, res); // 第二次: undefined</span><br><span class="line">        // 原因：因为第一个 .then 中处理 resolved 状态的回调函数中成功没有给返回值，</span><br><span class="line">        // 所以在第二个 .then 中剥离掉 promise，拿到的 results 就是 undefined</span><br><span class="line"></span><br><span class="line">        console.log(&quot;异步:&quot;, results); // 异步: Promise &#123; &lt;pending&gt; &#125;</span><br><span class="line">        // 原因：因为这里执行时，results 虽然已经定义，但因为 .then 链是异步的，</span><br><span class="line">        // results 还是处于 pending 状态，直到所有的 then 回调都执行完毕后才会变成 fulfilled</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">// 这个是最先打印，所以执行这里的时候，显示还是在 pending 状态</span><br><span class="line">console.log(&quot;单线程:&quot;, results); // 单线程: Promise &#123; &lt;pending&gt; &#125;</span><br><span class="line"></span><br><span class="line">// *********************** Promise 穿透 ************************</span><br><span class="line">const pp = new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    resolve(&quot;成功&quot;);</span><br><span class="line">&#125;);</span><br><span class="line">const result = pp.then(Promise.resolve(&quot;传不过去&quot;)); // 不是函数</span><br><span class="line">result.then((res) =&gt; &#123;</span><br><span class="line">    console.log(res); // 成功</span><br><span class="line">    console.log(result) // Promise &#123; &#x27;成功&#x27; &#125;</span><br><span class="line">&#125;);</span><br><span class="line">// 相当于以下这种写法</span><br><span class="line">pp.then(null).then((res) =&gt; &#123;</span><br><span class="line">    console.log(res); // 成功</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Promise.catch：</strong>用于注册在 Promise 对象拒绝（rejected）时的回调函数，同 .then 中的第二个参数的作用，两者可以同时存在，前者捕获异常则后者不会执行<ul>
<li>若 .then 中产生异常则能在 .catch 或者下一个 .then 中捕获。.then 和 .catch 本质上是没有区别的，但也需要分场合使用，一般异常用 .catch，拒绝状态用 .then</li>
<li>注意，异常一旦被捕获，则后面中的 .then 不管多少，都不会执行。一般是在最后写 .catch 去捕获异常，而不会一层层 reject 回调函数，这样代码可读性更高，且能捕获到上面最先报错的信息</li>
</ul>
</li>
<li><strong>Promise.finally：</strong>用于清理和最终处理逻辑，回调函数不接受任何参数，且是否执行与 Promise 状态无关</li>
<li><strong>案例1：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">// 第一层：获取用户信息</span><br><span class="line">function getUserInfo(userId) &#123;</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        // 模拟异步操作，获取用户信息</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            const userInfo = &#123;</span><br><span class="line">                id: userId,</span><br><span class="line">                name: &quot;John Doe&quot;,</span><br><span class="line">                email: &quot;johndoe@example.com&quot;</span><br><span class="line">            &#125;;</span><br><span class="line">            resolve(userInfo);</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 第二层：获取用户订单列表</span><br><span class="line">function getUserOrders(userId) &#123;</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        // 模拟异步操作，获取用户订单列表</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            const orders = [</span><br><span class="line">                &#123;id: 1, product: &quot;Product A&quot;&#125;,</span><br><span class="line">                &#123;id: 2, product: &quot;Product B&quot;&#125;,</span><br><span class="line">                &#123;id: 3, product: &quot;Product C&quot;&#125;</span><br><span class="line">            ];</span><br><span class="line">            resolve(orders);</span><br><span class="line">        &#125;, 2000);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 第三层：获取订单详情</span><br><span class="line">function getOrderDetails(orderId) &#123;</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        // 模拟异步操作，获取订单详情</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            const orderDetails = &#123;</span><br><span class="line">                id: orderId,</span><br><span class="line">                status: &quot;Delivered&quot;,</span><br><span class="line">                address: &quot;123 Main St&quot;</span><br><span class="line">            &#125;;</span><br><span class="line">            resolve(orderDetails);</span><br><span class="line">        &#125;, 1500);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 应用示例</span><br><span class="line">const userId = 123;</span><br><span class="line"></span><br><span class="line">getUserInfo(userId)</span><br><span class="line">    .then(userInfo =&gt; &#123;</span><br><span class="line">        console.log(&quot;User Info:&quot;, userInfo);</span><br><span class="line">        return getUserOrders(userInfo.id);</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(orders =&gt; &#123;</span><br><span class="line">        console.log(&quot;User Orders:&quot;, orders);</span><br><span class="line">        const orderId = orders[0].id;</span><br><span class="line">        return getOrderDetails(orderId);</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(orderDetails =&gt; &#123;</span><br><span class="line">        console.log(&quot;Order Details:&quot;, orderDetails);</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(error =&gt; &#123;</span><br><span class="line">        console.error(&quot;Error:&quot;, error);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">console.log(&quot;后续操作！！！&quot;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>案例2：</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> function fetchData(url) &#123;</span><br><span class="line">    return new Promise(function (resolve, reject) &#123;</span><br><span class="line">        var xhr = new XMLHttpRequest();</span><br><span class="line">        xhr.open(&#x27;GET&#x27;, url);</span><br><span class="line">        xhr.onload = function () &#123;</span><br><span class="line">            if (xhr.status === 200) &#123;</span><br><span class="line">                resolve(xhr.responseText);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                reject(Error(xhr.statusText));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        xhr.onerror = function () &#123;</span><br><span class="line">            reject(Error(&#x27;Network Error&#x27;));</span><br><span class="line">        &#125;;</span><br><span class="line">        xhr.send();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 调用fetchData()函数并处理Promise对象的结果</span><br><span class="line">fetchData(&#x27;https://v0.yiketianqi.com/api?unescape=1&amp;version=v9&amp;appid=47284135&amp;appsecret=jlmX3A6s&#x27;).then(function (response) &#123;</span><br><span class="line">    // 如果Promise对象成功解决，执行这里的代码</span><br><span class="line">    var data = JSON.parse(response)</span><br><span class="line">    console.log(&quot;data:::&quot;, data)</span><br><span class="line"></span><br><span class="line">&#125;).catch(function (error) &#123;</span><br><span class="line">    // 如果Promise对象被拒绝，执行这里的代码</span><br><span class="line">    console.log(&#x27;Error loading data:&#x27;, error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="2-攻防世界逆向"><a href="#2-攻防世界逆向" class="headerlink" title="2. 攻防世界逆向"></a>2. 攻防世界逆向</h4><blockquote>
<p><strong>变异瑞数：</strong>全扣补环境后，无法从 document.cookie 获取到 cookie 值，则补好环境后一样要去扣生成代码</p>
<p><strong>总结特殊扣法（有点适用 OB 混淆）：先全扣补环境，补好环境后扣代码，或者直接全局导出调用方法</strong></p>
<p><strong>瑞数特点补充：Cookie 是通过瑞数加密的网站，发送 XHR 请求所携带的载荷可以是明文，因为瑞数不检测</strong></p>
</blockquote>
<ul>
<li><p><strong>打开开发者工具就有无限 debugger：</strong>首要考虑是瑞数的可能性</p>
</li>
<li><p><strong>吐环境脚本不吐环境：</strong>可能是 console.log 被置空，可以将其在吐环境脚本中赋值给其他变量，并替换使用</p>
</li>
<li><p><strong>反调试 –&gt; 每次刷新重新生成 js 文件 –&gt; 断点被清空：</strong>启用事件监听器中的脚本断点，首次加载即可进入断点</p>
</li>
<li><p><strong>异常 TypeError: MutationObserver is not a constructor：</strong>补对象错误，应该补函数或类</p>
</li>
<li><p><strong>异常 TypeError: this[“MutationObserver”].observe is not a function：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MutationObserver = function () &#123;</span><br><span class="line">  this.observe = function (res) &#123;</span><br><span class="line">      log(&quot;MutationObserver.observe的参数：&quot;,res)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-猿人学反混淆攻防"><a href="#3-猿人学反混淆攻防" class="headerlink" title="3. 猿人学反混淆攻防"></a>3. 猿人学反混淆攻防</h4><blockquote>
<ol>
<li><p><strong>Chaeles 抓包工具：</strong>截获完整的数据包，且数据包的顺序严格与网站一致；同时 charles 还可以截获爬虫模拟请求的数据包，通过观察爬虫模拟的数据包与网站数据包的区别，便可以知道数据有误时问题所在</p>
</li>
<li><p><strong>Requests库 的 headers 处理机制：</strong></p>
<ul>
<li><strong>传入对象的要求：</strong>Requests 库要求传入的 headers 参数最终应该是一个字典形式的数据</li>
<li><strong>处理流程：</strong>检查传入的 headers 参数是否是一个字典，如果不是字典，但有 items 方法，Requests 库会调用 items 方法，将返回的键值对作为字典来处理</li>
<li><strong>源码分析：</strong>在 requests.models.py 中的 prepare_headers 方法中，具体处理 headers 的过程如下</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def prepare_headers(self, headers):</span><br><span class="line">    self.headers = CaseInsensitiveDict()  # 自定义字典类，作用是使 headers 键名不区分大小写</span><br><span class="line">    if headers:</span><br><span class="line">        for header in headers.items():</span><br><span class="line">            check_header_validity(header)</span><br><span class="line">            name, value = header</span><br><span class="line">            self.headers[to_native_string(name)] = value</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><p><strong>第一题（js 混淆 - 源码乱码）：</strong></p>
<ol>
<li>由一个 <strong>返回值为空的特殊函数</strong> + <strong>全局属性 window[‘x’]</strong> 生成值，那么全局属性大概率是通过函数生成的</li>
<li>在扣具体加密值处的函数时，<strong>应重点关注函数返回值</strong>，有些值结果是固定的，就无需全扣又去生成固定值</li>
</ol>
</li>
<li><p><strong>第二题（js 混淆 - 动态cookie1）：</strong></p>
<ol>
<li>使用 AST 解混淆后，需手动删除剩余冗余代码，<strong>其中有操作符相关的代码一般是和加密相关的，不能删</strong></li>
<li><strong>冗余代码：</strong>无调用解密函数、移位自执行函数、大数组函数、无用自执行函数、包含 constructor 和 debugger 的、try 和 if 语句的不走逻辑、eval 函数（关注 eval 执行代码，可用浏览器执行结果后判断）</li>
</ol>
</li>
<li><p><strong>第三题（访问逻辑 - 推心置腹）：</strong></p>
<ol>
<li><strong>一些服务器会验证 HTTP 请求头的顺序：</strong>在 Python 3.6 之前字典的顺序是不可预测的；而从 3.7 开始字典的插入顺序被正式保留。<strong>而 Requests 库在给 headers 参数时，会自动对头字段进行一定排序或处理</strong></li>
<li><strong>重点：</strong>模拟请求需针对多个接口，<strong>需严格按顺序请求每一次接口，哪怕返回的数据没有用，但环环相扣</strong></li>
<li><strong>解决方案：</strong><ul>
<li>以 Charles 截获数据包中的请求原始数据构建请求头，通过 session 设置 headers 信息，因为其底层实现于 OrderedDict 数据结构，确保了发送请求时，请求头的顺序与添加的顺序保持一致</li>
<li>在模拟请求多个接口时，每次请求所携带请求头都可能不同，除了 session 实现请求头有序，也可以通过创建类定义 items 类方法返回元组列表，利用元组有序、不可变的特点确保请求头的顺序不变</li>
</ul>
</li>
</ol>
</li>
<li><p><strong>第四题（雪碧图、样式干扰）：</strong></p>
<ol>
<li>在分析接口时，尽管整个数据包、响应数据等都很简单，整个接口中无任何加密，但在这个过程中只要发现有任何一小点数据与浏览器不一致，都应该从 send 发送请求处仔细分析，其中自有奥秘</li>
<li><strong>Base64 编码与解码（btoa 和 atob 是 window 对象的两个函数）：</strong><ul>
<li><strong>btoa（binary to ASCII）：</strong>用于将二进制数据 b’str’ 编码为 Base64 格式的 ASCII 字符串</li>
<li><strong>atob（ASCII to binary）：</strong>用于将 Base64 格式的 ASCII 字符串解码为原始的 b’str’ 二进制数据</li>
<li><strong>python 实现 Base64 编码：</strong><code>base64.b64encode(&#39;str&#39;.encode()).decode()</code></li>
</ul>
</li>
<li><strong>在某些数据无法具体还原或还原复杂度较高时，可以考虑使用映射关系将数据写死，但前提是其变化不大</strong></li>
</ol>
</li>
<li><p><strong>第五题（js 混淆 - 乱码增强）：</strong></p>
<ol>
<li>Hook cookie 使用油猴不起作用，则使用 v_tools</li>
</ol>
</li>
</ul>

                    
                </div>

                
                        
<div class="post-copyright-info-container border-box">
    <div class="copyright-info-content border-box">
        <div class="copyright-info-top border-box">
            <div class="copyright-post-title border-box text-ellipsis">
                06_JS逆向_技术专题
            </div>

            <div class="copyright-post-link border-box text-ellipsis">
                2024/03/11/06-js逆向-技术专题/
            </div>
        </div>

        <div class="copyright-info-bottom border-box">
            <div class="copyright-post-author bottom-item">
                <div class="type">
                    作者
                </div>
                <div class="content">xfblog</div>
            </div>

            <div class="post-time bottom-item">
                <div class="type">
                    发布于
                </div>
                <div class="content">2024-03-11 18:27</div>
            </div>


            <div class="post-license bottom-item">
                <div class="type">
                    许可
                </div>
                <div class="content tooltip" data-tooltip-content="CC BY-NC-SA 4.0">
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" target="_blank">
                        
                            <i class="fa-brands fa-creative-commons"></i>
                            <i class="fa-brands fa-creative-commons-by"></i>
                            <i class="fa-brands fa-creative-commons-nc"></i>
                            <i class="fa-brands fa-creative-commons-sa"></i>
                        
                    </a>
                </div>
            </div>
        </div>

        <i class="copyright-bg fa-solid fa-copyright"></i>
    </div>
    <div class="copy-copyright-info flex-center tooltip" data-tooltip-content="复制版权信息" data-tooltip-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/Python/">Python</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E7%88%AC%E8%99%AB/">爬虫</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                            <div class="post-share-container border-box">
    <ul class="share-list-wrap border-box">
        <li class="qq share-item border-box flex-center tooltip"
            data-tooltip-content="分享到 QQ"
        >
            <i class="fa-brands fa-qq"></i>
        </li>
        <li class="wechat share-item border-box flex-center tooltip tooltip-img"
            data-tooltip-content="分享到微信"
            data-tooltip-img-tip="微信扫一扫"
            data-tooltip-img-style="background-color: #fff; top: -10px; padding: 0.6rem 0.6rem 0.1rem 0.6rem;"
        >
            <i class="fa-brands fa-weixin"></i>
        </li>
        <li class="weibo share-item border-box flex-center tooltip"
            data-tooltip-content="分享到微博"
        >
            <i class="fa-brands fa-weibo"></i>
        </li>
    </ul>
</div>

                        
                    </div>
                </div>

                
                    

<div class="reward-author-container border-box flex-center">
    <div class="reward-btn border-box flex-center tooltip tooltip-img"
            data-tooltip-img-url="/images/zfb.webp"
            data-tooltip-img-trigger="click"
            data-tooltip-img-style="top: -6px;"
    >
        <i class="fa-solid fa-gift"></i>&nbsp;创作不易，打赏随意，您的支持是我更新的动力💪！
    </div>
</div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/2024/05/26/AST%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/"
                                   title="AST技术专题"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">AST技术专题</span>
                                        <span class="post-nav-item">上一篇</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2024/01/15/05-js%E9%80%86%E5%90%91-%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/"
                                   title="05_JS逆向_加密算法"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">05_JS逆向_加密算法</span>
                                        <span class="post-nav-item">下一篇</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
            <div class="pc-post-toc right-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81Webpack%E4%B8%93%E9%A2%98"><span class="nav-text">一、Webpack专题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="nav-text">1. 加载器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97"><span class="nav-text">2. 动态加载模块</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81OB%E6%B7%B7%E6%B7%86%E4%B8%93%E9%A2%98"><span class="nav-text">二、OB混淆专题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-ob%E6%B7%B7%E6%B7%86%E6%8A%80%E6%9C%AF"><span class="nav-text">1. ob混淆技术</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-ob%E6%B7%B7%E6%B7%86%E7%BB%93%E6%9E%84"><span class="nav-text">2. ob混淆结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-ob%E6%B7%B7%E6%B7%86%E5%AE%9E%E7%8E%B0"><span class="nav-text">3. ob混淆实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95"><span class="nav-text">4. 问题记录</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81RPC%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98"><span class="nav-text">三、RPC技术专题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-websocket%E5%8D%8F%E8%AE%AE"><span class="nav-text">1. websocket协议</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-RPC%E6%8A%80%E6%9C%AF"><span class="nav-text">2. RPC技术</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-RPC%E9%80%86%E5%90%91%E4%B8%AD%E5%AE%9E%E7%8E%B0"><span class="nav-text">3. RPC逆向中实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E6%B2%B9%E7%8C%B4%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6"><span class="nav-text">4. 油猴工具插件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81JSVMP%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98"><span class="nav-text">四、JSVMP技术专题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%97%A5%E5%BF%97%E6%8F%92%E6%A1%A9%E5%8E%9F%E7%90%86"><span class="nav-text">1. 日志插桩原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%9D%A1%E4%BB%B6%E6%96%AD%E7%82%B9%E5%AE%9A%E4%BD%8D"><span class="nav-text">2. 条件断点定位</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-jsvmp%E7%BA%AF%E7%AE%97%E5%AE%9E%E7%8E%B0"><span class="nav-text">3. jsvmp纯算实现</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E8%A1%A5%E7%8E%AF%E5%A2%83%E4%B8%93%E9%A2%98"><span class="nav-text">五、补环境专题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%8E%AF%E5%A2%83%E6%A3%80%E6%B5%8B"><span class="nav-text">1. 环境检测</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%90%90%E7%8E%AF%E5%A2%83%E8%84%9A%E6%9C%AC"><span class="nav-text">2. 吐环境脚本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-selenium%E8%A1%A5%E7%8E%AF%E5%A2%83"><span class="nav-text">3. selenium补环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-flask%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3"><span class="nav-text">4. flask实现接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-jsdom%E8%A1%A5%E7%8E%AF%E5%A2%83"><span class="nav-text">5. jsdom补环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-%E5%8E%9F%E5%9E%8B%E6%A3%80%E6%B5%8B"><span class="nav-text">6. 原型检测</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-toString%E6%A3%80%E6%B5%8B"><span class="nav-text">7. toString检测</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-vm2%E6%A1%86%E6%9E%B6%E8%A1%A5%E7%8E%AF%E5%A2%83"><span class="nav-text">8. vm2框架补环境</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81Cookie%E5%8F%8D%E7%88%AC%E4%B8%93%E9%A2%98"><span class="nav-text">六、Cookie反爬专题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%9C%8D%E5%8A%A1%E5%99%A8cookie%E5%93%8D%E5%BA%94"><span class="nav-text">1. 服务器cookie响应</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E9%98%BF%E9%87%8C%E7%B3%BBcookie%E9%80%86%E5%90%91"><span class="nav-text">2. 阿里系cookie逆向</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%8A%A0%E9%80%9F%E4%B9%90cookie%E9%80%86%E5%90%91"><span class="nav-text">3. 加速乐cookie逆向</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E7%91%9E%E6%95%B0rs%E5%AE%89%E5%85%A8%E4%BA%A7%E5%93%81"><span class="nav-text">七、瑞数rs安全产品</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%91%9E%E6%95%B0rs4"><span class="nav-text">1. 瑞数rs4</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E7%91%9E%E6%95%B0rs5"><span class="nav-text">2. 瑞数rs5</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E7%91%9E%E6%95%B0rs6"><span class="nav-text">3. 瑞数rs6</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AB%E3%80%81%E5%9B%BD%E5%A4%96%E7%B3%BB%E5%88%97%E4%BA%A7%E5%93%81"><span class="nav-text">八、国外系列产品</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-TLS%E6%8C%87%E7%BA%B9"><span class="nav-text">1. TLS指纹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Akamai"><span class="nav-text">2. Akamai</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-Incapsula%EF%BC%88reese84%EF%BC%89"><span class="nav-text">3. Incapsula（reese84）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%9D%E3%80%81%E9%AA%8C%E8%AF%81%E7%A0%81%E4%B8%93%E9%A2%98"><span class="nav-text">九、验证码专题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-canvas%E5%BA%95%E5%9B%BE%E8%BF%98%E5%8E%9F"><span class="nav-text">1. canvas底图还原</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%AF%86%E5%88%AB%E6%BB%91%E5%8A%A8%E8%B7%9D%E7%A6%BB"><span class="nav-text">2. 识别滑动距离</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-track%E8%BD%A8%E8%BF%B9%E7%94%9F%E6%88%90"><span class="nav-text">3. track轨迹生成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E6%9E%81%E9%AA%8C3%E4%BB%A3%E6%BB%91%E5%9D%97"><span class="nav-text">4. 极验3代滑块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E6%9E%81%E9%AA%8C3%E4%BB%A3%E7%82%B9%E9%80%89"><span class="nav-text">5. 极验3代点选</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E3%80%81%E9%AB%98%E9%9A%BE%E5%BA%A6%E9%80%86%E5%90%91%E6%A1%88%E4%BE%8B"><span class="nav-text">十、高难度逆向案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%BC%82%E6%AD%A5-Promise-%E5%AF%B9%E8%B1%A1"><span class="nav-text">1. 异步 Promise 对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C%E9%80%86%E5%90%91"><span class="nav-text">2. 攻防世界逆向</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E7%8C%BF%E4%BA%BA%E5%AD%A6%E5%8F%8D%E6%B7%B7%E6%B7%86%E6%94%BB%E9%98%B2"><span class="nav-text">3. 猿人学反混淆攻防</span></a></li></ol></li></ol></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
    Copyright&nbsp;&copy;&nbsp;<span>2021</span>&nbsp;-&nbsp;2024&nbsp;<a href="https://xfblog.cn/" target="_self">小傅博客</a>&nbsp;-&nbsp;All&nbsp;rights&nbsp;reserved.&nbsp;&nbsp;&nbsp;&nbsp;
    
            <!-- &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">xfblog</a> -->
        
    </div>

    <!-- <div class="theme-info info-item">
        由&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;驱动&nbsp;&&nbsp;主题&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div> -->

    

    

    
        <div class="record-info info-item">
            
                
                    <div class="record-item border-box">
                        <a class=""
                           target="_blank"
                           href="https://beian.miit.gov.cn"
                        >
                            蜀ICP备2021021033号-1
                        </a>
                    </div>
                
            
                
                    <div class="record-item border-box">
                        <a class=""
                           target="_blank"
                           href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51138102000134"
                        >
                            川公网安备 51138102000134号
                        </a>
                    </div>
                
            
        </div>&nbsp;&nbsp;&nbsp;&nbsp;
    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81Webpack%E4%B8%93%E9%A2%98"><span class="nav-text">一、Webpack专题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="nav-text">1. 加载器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97"><span class="nav-text">2. 动态加载模块</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81OB%E6%B7%B7%E6%B7%86%E4%B8%93%E9%A2%98"><span class="nav-text">二、OB混淆专题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-ob%E6%B7%B7%E6%B7%86%E6%8A%80%E6%9C%AF"><span class="nav-text">1. ob混淆技术</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-ob%E6%B7%B7%E6%B7%86%E7%BB%93%E6%9E%84"><span class="nav-text">2. ob混淆结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-ob%E6%B7%B7%E6%B7%86%E5%AE%9E%E7%8E%B0"><span class="nav-text">3. ob混淆实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95"><span class="nav-text">4. 问题记录</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81RPC%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98"><span class="nav-text">三、RPC技术专题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-websocket%E5%8D%8F%E8%AE%AE"><span class="nav-text">1. websocket协议</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-RPC%E6%8A%80%E6%9C%AF"><span class="nav-text">2. RPC技术</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-RPC%E9%80%86%E5%90%91%E4%B8%AD%E5%AE%9E%E7%8E%B0"><span class="nav-text">3. RPC逆向中实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E6%B2%B9%E7%8C%B4%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6"><span class="nav-text">4. 油猴工具插件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81JSVMP%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98"><span class="nav-text">四、JSVMP技术专题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%97%A5%E5%BF%97%E6%8F%92%E6%A1%A9%E5%8E%9F%E7%90%86"><span class="nav-text">1. 日志插桩原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%9D%A1%E4%BB%B6%E6%96%AD%E7%82%B9%E5%AE%9A%E4%BD%8D"><span class="nav-text">2. 条件断点定位</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-jsvmp%E7%BA%AF%E7%AE%97%E5%AE%9E%E7%8E%B0"><span class="nav-text">3. jsvmp纯算实现</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E8%A1%A5%E7%8E%AF%E5%A2%83%E4%B8%93%E9%A2%98"><span class="nav-text">五、补环境专题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%8E%AF%E5%A2%83%E6%A3%80%E6%B5%8B"><span class="nav-text">1. 环境检测</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%90%90%E7%8E%AF%E5%A2%83%E8%84%9A%E6%9C%AC"><span class="nav-text">2. 吐环境脚本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-selenium%E8%A1%A5%E7%8E%AF%E5%A2%83"><span class="nav-text">3. selenium补环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-flask%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3"><span class="nav-text">4. flask实现接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-jsdom%E8%A1%A5%E7%8E%AF%E5%A2%83"><span class="nav-text">5. jsdom补环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-%E5%8E%9F%E5%9E%8B%E6%A3%80%E6%B5%8B"><span class="nav-text">6. 原型检测</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-toString%E6%A3%80%E6%B5%8B"><span class="nav-text">7. toString检测</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-vm2%E6%A1%86%E6%9E%B6%E8%A1%A5%E7%8E%AF%E5%A2%83"><span class="nav-text">8. vm2框架补环境</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81Cookie%E5%8F%8D%E7%88%AC%E4%B8%93%E9%A2%98"><span class="nav-text">六、Cookie反爬专题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%9C%8D%E5%8A%A1%E5%99%A8cookie%E5%93%8D%E5%BA%94"><span class="nav-text">1. 服务器cookie响应</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E9%98%BF%E9%87%8C%E7%B3%BBcookie%E9%80%86%E5%90%91"><span class="nav-text">2. 阿里系cookie逆向</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%8A%A0%E9%80%9F%E4%B9%90cookie%E9%80%86%E5%90%91"><span class="nav-text">3. 加速乐cookie逆向</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E7%91%9E%E6%95%B0rs%E5%AE%89%E5%85%A8%E4%BA%A7%E5%93%81"><span class="nav-text">七、瑞数rs安全产品</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%91%9E%E6%95%B0rs4"><span class="nav-text">1. 瑞数rs4</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E7%91%9E%E6%95%B0rs5"><span class="nav-text">2. 瑞数rs5</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E7%91%9E%E6%95%B0rs6"><span class="nav-text">3. 瑞数rs6</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AB%E3%80%81%E5%9B%BD%E5%A4%96%E7%B3%BB%E5%88%97%E4%BA%A7%E5%93%81"><span class="nav-text">八、国外系列产品</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-TLS%E6%8C%87%E7%BA%B9"><span class="nav-text">1. TLS指纹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Akamai"><span class="nav-text">2. Akamai</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-Incapsula%EF%BC%88reese84%EF%BC%89"><span class="nav-text">3. Incapsula（reese84）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%9D%E3%80%81%E9%AA%8C%E8%AF%81%E7%A0%81%E4%B8%93%E9%A2%98"><span class="nav-text">九、验证码专题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-canvas%E5%BA%95%E5%9B%BE%E8%BF%98%E5%8E%9F"><span class="nav-text">1. canvas底图还原</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%AF%86%E5%88%AB%E6%BB%91%E5%8A%A8%E8%B7%9D%E7%A6%BB"><span class="nav-text">2. 识别滑动距离</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-track%E8%BD%A8%E8%BF%B9%E7%94%9F%E6%88%90"><span class="nav-text">3. track轨迹生成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E6%9E%81%E9%AA%8C3%E4%BB%A3%E6%BB%91%E5%9D%97"><span class="nav-text">4. 极验3代滑块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E6%9E%81%E9%AA%8C3%E4%BB%A3%E7%82%B9%E9%80%89"><span class="nav-text">5. 极验3代点选</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E3%80%81%E9%AB%98%E9%9A%BE%E5%BA%A6%E9%80%86%E5%90%91%E6%A1%88%E4%BE%8B"><span class="nav-text">十、高难度逆向案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%BC%82%E6%AD%A5-Promise-%E5%AF%B9%E8%B1%A1"><span class="nav-text">1. 异步 Promise 对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C%E9%80%86%E5%90%91"><span class="nav-text">2. 攻防世界逆向</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E7%8C%BF%E4%BA%BA%E5%AD%A6%E5%8F%8D%E6%B7%B7%E6%B7%86%E6%94%BB%E9%98%B2"><span class="nav-text">3. 猿人学反混淆攻防</span></a></li></ol></li></ol></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>





<!-- common js -->
<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/toggle-theme.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/code-block.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/libs/anime.min.js"></script>

<!-- local search -->

    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/local-search.js"></script>


<!-- lazyload -->

    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/lazyload.js"></script>


<div class="pjax">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/post/post-helper.js"></script>

        <!-- toc -->
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/post/toc.js"></script>
        

        <!-- copyright-info -->
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/post/copyright-info.js"></script>
        

        <!-- share -->
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/post/share.js"></script>
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->

    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart()
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd()
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'))
            KEEP.initExecute()
        });
    });
</script>




    
        
            
<script class="custom-inject-js" src="/js/run_time.js" data-pjax></script>

        
    
        
            
<script class="custom-inject-js" src="/js/code_click_copy.js" data-pjax></script>

        
    
        
            
<script class="custom-inject-js" src="/js/copyrightpro.js" data-pjax></script>

        
    

</body>
</html>
