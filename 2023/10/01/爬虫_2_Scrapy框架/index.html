<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="xfblog">
    
    <title>
        
            çˆ¬è™«_2_Scrapyæ¡†æ¶ |
        
        XFBLOG.CN
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/favicon.webp">
    
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/font/css/fontawesome.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/font/css/regular.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/font/css/solid.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/font/css/brands.min.css">
    
        
            
                
<link rel="stylesheet" href="/css/custom-1.css">

            
        
    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.xml"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"XFBLOG.CN","author":"xfblog","avatar":"/images/avatar.webp","logo":"/images/logo.webp","favicon":"/images/favicon.webp"},"menu":{"home":"/ || fa-solid fa-home","JumpTo":{"children":[{"JSé€†å‘_3_æ‰£ç®—æ³•ä¸“é¢˜":"/2024/05/01/JSé€†å‘_3_æ‰£ç®—æ³•ä¸“é¢˜/"},{"JSé€†å‘_4_è¡¥ç¯å¢ƒä¸“é¢˜":"/2024/07/01/JSé€†å‘_4_è¡¥ç¯å¢ƒä¸“é¢˜/"}]},"archives":"/archives || fa-solid fa-box-archive","tags":"/tags || fa-solid fa-tags","links":"/links || fa-solid fa-link","about":"/about || fa-solid fa-circle-info"},"first_screen":{"enable":true,"background_img":"/images/home_lights.webp","background_img_dark":"/images/home_dark.webp","description":null,"hitokoto":false},"social_contact":{"enable":true,"links":{"github":"https://github.com/xfblogcn","weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":true,"hide_header":true},"home":{"announcement":"ç‰ˆæƒå£°æ˜ï¼šæœ¬ç«™æ‰€æœ‰æ–‡ç« å‡ä¸º xfblog.cn å°å‚…åŸåˆ›ï¼Œè¯·éµå¾ª CC 4.0 BY-SA ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚","category":true,"tag":true,"post_datetime":"created","post_datetime_format":"YYYY-MM-DD"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":true,"min2read":true},"datetime_format":"YYYY-MM-DD","copyright_info":true,"share":true,"reward":{"enable":true,"img_link":"/images/zfb.webp","text":"åˆ›ä½œä¸æ˜“ï¼Œæ‰“èµéšæ„ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘æ›´æ–°çš„åŠ¨åŠ›ğŸ’ªï¼"}},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"obsidian"},"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":true,"site_uv":false,"site_pv":false,"page_pv":true}},"local_search":{"enable":true,"preload":true},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.36"},"waline":{"server_url":null,"reaction":false,"version":"3.2.1"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":true},"lazyload":{"enable":true},"cdn":{"enable":true,"provider":"jsdelivr"},"pjax":{"enable":true},"footer":{"since":2021,"word_count":false,"site_deploy":{"enable":false,"provider":"github","url":null},"record":{"enable":true,"list":[{"code":"èœ€ICPå¤‡2021021033å·-1","link":"https://beian.miit.gov.cn"},{"code":"å·å…¬ç½‘å®‰å¤‡ 51138102000134å·","link":"http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51138102000134"}]}},"inject":{"enable":true,"css":["/css/custom-1.css"],"js":["/js/run_time.js","/js/code_click_copy.js","/js/copyrightpro.js"]},"root":"","source_data":{},"version":"4.2.5"}
    KEEP.language_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s ä¸ªæœˆå‰","year":"%s å¹´å‰"}
    KEEP.language_code_block = {"copy":"å¤åˆ¶ä»£ç ","copied":"å·²å¤åˆ¶","fold":"æŠ˜å ä»£ç å—","folded":"å·²æŠ˜å "}
    KEEP.language_copy_copyright = {"copy":"å¤åˆ¶ç‰ˆæƒä¿¡æ¯","copied":"å·²å¤åˆ¶","title":"åŸæ–‡æ ‡é¢˜","author":"åŸæ–‡ä½œè€…","link":"åŸæ–‡é“¾æ¥"}
  </script>
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Keep" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/logo.webp">
                </a>
            
            <a class="site-name border-box" href="/">
               XFBLOG.CN
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-home"></i>
                                
                                é¦–é¡µ
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box has-sub-menu">
                            <a class="menu-text-color border-box" href="javascript:void(0);">
                                
                                JUMPTO
                                
                                    <i class="menu-text-color collapse-icon fa-solid fa-angle-down"></i>
                                
                            </a>
                            
                                <ul class="sub-menu-list border-box">
                                    
                                        
                                        <li class="sub-menu-item border-box ">
                                            <a class="menu-text-color border-box flex-start" href="/2024/05/01/JS%E9%80%86%E5%90%91_3_%E6%89%A3%E7%AE%97%E6%B3%95%E4%B8%93%E9%A2%98/">
                                                
                                                JSé€†å‘_3_æ‰£ç®—æ³•ä¸“é¢˜
                                            </a>
                                        </li>
                                    
                                        
                                        <li class="sub-menu-item border-box ">
                                            <a class="menu-text-color border-box flex-start" href="/2024/07/01/JS%E9%80%86%E5%90%91_4_%E8%A1%A5%E7%8E%AF%E5%A2%83%E4%B8%93%E9%A2%98/">
                                                
                                                JSé€†å‘_4_è¡¥ç¯å¢ƒä¸“é¢˜
                                            </a>
                                        </li>
                                    
                                </ul>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                
                                å½’æ¡£
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/tags">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-tags"></i>
                                
                                æ ‡ç­¾
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/links">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-link"></i>
                                
                                å‹é“¾
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/about">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-circle-info"></i>
                                
                                å…³äº
                                
                            </a>
                            
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="menu-text-color fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-home"></i>
                                </span>
                            
                            é¦–é¡µ
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box has-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="javascript:void(0);">
                            
                            JUMPTO
                        </a>
                        
                            <i class="right-side collapse-icon fa-solid fa-angle-left"></i>
                        
                    </label>
                    
                        <ul class="drawer-sub-menu-list border-box">
                            
                                
                                <li class="sub-menu-item border-box">
                                    <a class="drawer-menu-text-color border-box flex-start" href="/2024/05/01/js%E9%80%86%E5%90%91_3_%E6%89%A3%E7%AE%97%E6%B3%95%E4%B8%93%E9%A2%98/">
                                        
                                        JSé€†å‘_3_æ‰£ç®—æ³•ä¸“é¢˜
                                    </a>
                                </li>
                            
                                
                                <li class="sub-menu-item border-box">
                                    <a class="drawer-menu-text-color border-box flex-start" href="/2024/07/01/js%E9%80%86%E5%90%91_4_%E8%A1%A5%E7%8E%AF%E5%A2%83%E4%B8%93%E9%A2%98/">
                                        
                                        JSé€†å‘_4_è¡¥ç¯å¢ƒä¸“é¢˜
                                    </a>
                                </li>
                            
                        </ul>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                </span>
                            
                            å½’æ¡£
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/tags">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-tags"></i>
                                </span>
                            
                            æ ‡ç­¾
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/links">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-link"></i>
                                </span>
                            
                            å‹é“¾
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/about">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-circle-info"></i>
                                </span>
                            
                            å…³äº
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        çˆ¬è™«_2_Scrapyæ¡†æ¶
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/avatar.webp">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">xfblog</span>
                                
                                    <span class="author-badge">Lv3</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2023-10-01</span>
            </span>

            
                <span class="meta-info-item post-update-date">
                    <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                    <span class="datetime" data-updated="Mon Dec 09 2024 10:26:09 GMT+0800">2024-12-09</span>
                </span>
            
        

        
            <span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="post-category-ul">
                    
                            <li class="category-item"><a href="/categories/%E7%88%AC%E8%99%AB/">çˆ¬è™«</a></li>
                        
                    
                </ul>
            </span>
        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E7%88%AC%E8%99%AB/">çˆ¬è™«</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/Python/">Python</a></li>
                        
                    
                </ul>
            </span>
        

        
        
            <span class="meta-info-item post-wordcount">
                <i class="icon fas fa-file-word"></i>&nbsp;<span>16k å­—</span>
            </span>
        
        
            <span class="meta-info-item post-min2read">
                <i class="icon fas fa-clock"></i>&nbsp;<span>69 åˆ†é’Ÿ</span>
            </span>
        
        
            <span class="meta-info-item post-pv">
                <i class="icon fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
            </span>
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <h2 id="ä¸€ã€äº†è§£Scrapyæ¡†æ¶"><a href="#ä¸€ã€äº†è§£Scrapyæ¡†æ¶" class="headerlink" title="ä¸€ã€äº†è§£Scrapyæ¡†æ¶"></a>ä¸€ã€äº†è§£Scrapyæ¡†æ¶</h2><blockquote>
<p><strong>ä»€ä¹ˆæ˜¯ Scrapy ï¼Ÿ</strong></p>
<p><strong>Scrapyæ˜¯ä¸€ä¸ªç”¨äºçˆ¬å–ç½‘ç«™å†…å®¹ï¼Œæå–ç»“æ„æ€§æ•°æ®è€Œç¼–å†™çš„ Python å¼€æºçˆ¬è™«åº”ç”¨æ¡†æ¶ã€‚å®ƒæä¾›äº†ä¸€å¥—åŸºç¡€ç»“æ„ï¼Œä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿè½»æ¾åœ°å®šä¹‰å¦‚ä½•ä»ç½‘ç«™ä¸­æå–æ•°æ®ï¼Œä»¥åŠå¦‚ä½•å­˜å‚¨å’Œå¤„ç†è¿™äº›æ•°æ®ï¼Œå…·æœ‰é«˜åº¦çš„å¯å®šåˆ¶æ€§å’Œå¯æ‰©å±•æ€§ï¼ˆ<a class="link"   href="https://docs.scrapy.org/en/latest/index.html"  target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£<i class="fas fa-external-link-alt"></i></a>ã€<a class="link"   href="https://www.osgeo.cn/scrapy/intro/install.html"  target="_blank" rel="noopener">ä¸­æ–‡å®˜æ–¹æ–‡æ¡£<i class="fas fa-external-link-alt"></i></a>ï¼‰</strong></p>
<p><strong>Event-driven networkingï¼ˆæ”¯æŒå¼‚æ­¥ï¼‰ï¼š</strong>Scrapy æ˜¯å¼‚æ­¥çˆ¬è™«æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ Twisted åº“å®ç°å¼‚æ­¥æ“ä½œã€‚è™½ç„¶ <strong>Scrapy çš„é»˜è®¤é…ç½®æ˜¯å•çº¿ç¨‹çš„ï¼Œä½†å®ƒé€šè¿‡ Twisted æä¾›çš„äº‹ä»¶å¾ªç¯æœºåˆ¶å®ç°äº†å¼‚æ­¥å¹¶å‘</strong>ï¼Œè¿™ä½¿å¾— Scrapy èƒ½å¤Ÿåœ¨å•ä¸ªè¿›ç¨‹ä¸­é«˜æ•ˆåœ°å¤„ç†å¹¶å‘è¯·æ±‚</p>
</blockquote>
<h3 id="1-scrapyçš„å·¥ä½œåŸç†"><a href="#1-scrapyçš„å·¥ä½œåŸç†" class="headerlink" title="1. scrapyçš„å·¥ä½œåŸç†"></a>1. scrapyçš„å·¥ä½œåŸç†</h3><ul>
<li><strong>å¼•æ“ï¼ˆScrapy Engineï¼‰ï¼š</strong>Scrapyå¼•æ“æ˜¯æ•´ä¸ªæ¡†æ¶çš„æ ¸å¿ƒï¼Œè´Ÿè´£æ§åˆ¶ç³»ç»Ÿæ‰€æœ‰ç»„ä»¶ä¹‹é—´çš„æ•°æ®æµï¼Œå¹¶åœ¨å‘ç”Ÿç‰¹å®šåŠ¨ä½œæ—¶è§¦å‘äº‹ä»¶</li>
<li><strong>è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰ï¼š</strong>è°ƒåº¦å™¨æ¥æ”¶æ¥è‡ªå¼•æ“çš„è¯·æ±‚ï¼Œå¹¶å°†å…¶æ’é˜Ÿï¼ŒåŒæ—¶å»é™¤é‡å¤çš„ç½‘å€ï¼Œä»¥ä¾›ç¨åå¼•æ“è¯·æ±‚å®ƒä»¬æ—¶ä½¿ç”¨ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å®šåˆ¶è°ƒåº¦å™¨</li>
<li><strong>ä¸‹è½½å™¨ï¼ˆDownloaderï¼‰ï¼š</strong>ä¸‹è½½å™¨æ˜¯æ‰€æœ‰ç»„ä»¶ä¸­è´Ÿæ‹…æœ€å¤§çš„ï¼Œå®ƒç”¨äºé«˜é€Ÿåœ°ä¸‹è½½ç½‘ç»œä¸Šçš„èµ„æºï¼Œè´Ÿè´£è·å–ç½‘é¡µå¹¶å°†å…¶æä¾›ç»™å¼•æ“ï¼Œå¼•æ“ç„¶åå°†å…¶æä¾›ç»™Spidersçˆ¬è™«</li>
<li><strong>çˆ¬è™«ï¼ˆSpidersï¼‰ï¼š</strong>çˆ¬è™«æ˜¯ç”±ç”¨æˆ·ç¼–å†™çš„è‡ªå®šä¹‰ç±»ï¼Œç”¨äºè§£æå“åº”å¹¶ä»ä¸­æå–æ•°æ®ä¿¡æ¯ï¼ˆæ‰€è°“çš„å®ä½“Itemï¼‰æˆ–å…¶ä»–è¦è·Ÿè¸ªçš„è¯·æ±‚</li>
<li><strong>å®ä½“ç®¡é“ï¼ˆItem Pipelineï¼‰ï¼š</strong>å®ä½“ç®¡é“ç”¨äºæ¥æ”¶çˆ¬è™«ä¼ è¿‡æ¥çš„æ•°æ®ï¼Œè´Ÿè´£åœ¨çˆ¬è™«æå–æ•°æ®åå¯¹å…¶è¿›è¡Œå¤„ç†ï¼ŒåŒ…æ‹¬æ¸…ç†ã€éªŒè¯å’ŒæŒä¹…åŒ–å­˜å‚¨</li>
<li><strong>ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰ï¼š</strong>ä¸­é—´ä»¶ç›¸å½“äºè¿‡æ»¤å™¨ï¼Œå¤¹åœ¨ä¸åŒéƒ¨åˆ†ä¹‹é—´ï¼ˆ<strong>ä¸‹è½½å™¨ä¸­é—´ä»¶</strong>ä½äºå¼•æ“å’Œä¸‹è½½å™¨ä¹‹é—´ï¼Œ<strong>çˆ¬è™«ä¸­é—´ä»¶</strong>ä½äºå¼•æ“å’Œçˆ¬è™«ä¹‹é—´ï¼‰æˆªè·æ•°æ®æµï¼Œå¹¶è¿›è¡Œç‰¹æ®Šçš„åŠ å·¥å¤„ç†</li>
</ul>
<img    
                       lazyload
                       alt="image"
                       data-src="https://xfblog.cn/images/1701832575-05e785c7a0438d6.webp"
                         style="width:80%;margin:0 auto;"
                 >

<ul>
<li><strong>scrapyçš„å·¥ä½œæµç¨‹ï¼š</strong><ol>
<li>ç”±çˆ¬è™«å°†èµ·å§‹çš„ URL æ„é€ æˆ Requests å¯¹è±¡ â‡’ çˆ¬è™«ä¸­é—´ä»¶ â‡’ å¼•æ“ â‡’ è°ƒåº¦å™¨</li>
<li>è°ƒåº¦å™¨æŠŠ Requests å¯¹è±¡ â‡’ å¼•æ“ â‡’ ä¸‹è½½ä¸­é—´ä»¶ â‡’ ä¸‹è½½å™¨</li>
<li>ä¸‹è½½å™¨å‘é€è¯·æ±‚ï¼Œè·å– Responses å“åº” â‡’ ä¸‹è½½ä¸­é—´ä»¶ â‡’ å¼•æ“ â‡’ çˆ¬è™«ä¸­é—´ä»¶ â‡’ çˆ¬è™«</li>
<li>çˆ¬è™«æå– URL åœ°å€ï¼Œç»„è£…æˆ Requests å¯¹è±¡ â‡’ çˆ¬è™«ä¸­é—´ä»¶ â‡’ å¼•æ“ â‡’ è°ƒåº¦å™¨ï¼ˆé‡å¤æ­¥éª¤2ï¼‰</li>
<li>çˆ¬è™«æå–æ•°æ® â‡’ å¼•æ“ â‡’ å®ä½“ç®¡é“å¤„ç†å’Œä¿å­˜æ•°æ®</li>
</ol>
</li>
<li><strong>å·¥ä½œæµç¨‹æ¦‚è¿°ï¼š</strong>é¦–å…ˆç”±çˆ¬è™«ä» URL èµ·å§‹é˜Ÿåˆ—ä¸­å–å‡ºå¾…è¯·æ±‚ URL å¹¶å°†å®ƒä¼ é€’ç»™è°ƒåº¦å™¨ï¼Œç„¶åå¼•æ“ä»è°ƒåº¦å™¨çš„å¾…çˆ¬é˜Ÿåˆ—ä¸­å–å¾…çˆ¬ URL å¹¶ä¼šç»ä¸‹è½½ä¸­é—´ä»¶äº¤ç»™ä¸‹è½½å™¨è¿›è¡Œæ•°æ®ä¸‹è½½ï¼Œéšåå°†è·å–çš„æ•°æ®ç»çˆ¬è™«ä¸­é—´ä»¶äº¤ç»™çˆ¬è™«æ¨¡å—è¿›è¡Œåˆ†æå¹¶æå–å‡ºç›®æ ‡æ•°æ®å’Œæ–° URLï¼Œæœ€åå°†æ–° URL ä¼ é€’ç»™è°ƒåº¦å™¨çš„åŒæ—¶æŠŠè§£æçš„ç›®æ ‡æ•°æ®äº¤ç»™æŒä¹…åŒ–æ¨¡å—è¿›è¡Œå¤„ç†ã€‚æ­¤å¤–ï¼Œåœ¨æ•°æ®æµåŠ¨è¿‡ç¨‹ä¸­èƒ½å¤Ÿé…ç½®å„ç§ä¸­é—´ä»¶ï¼Œè¿›è¡Œå¿…è¦çš„åŠŸèƒ½æ‰©å±•ã€‚</li>
</ul>
<h3 id="2-scrapyçš„é¡¹ç›®åˆè¯†"><a href="#2-scrapyçš„é¡¹ç›®åˆè¯†" class="headerlink" title="2. scrapyçš„é¡¹ç›®åˆè¯†"></a>2. scrapyçš„é¡¹ç›®åˆè¯†</h3><blockquote>
<p><strong>Scrapyå®‰è£…ï¼š<code>pip install scrapy -i https://pypi.tuna.tsinghua.edu.cn/simple</code></strong></p>
</blockquote>
<ul>
<li><strong>scrapyçš„ä½¿ç”¨æµç¨‹ï¼š</strong><ol>
<li><strong>åˆ›å»ºscrapyé¡¹ç›®</strong>ï¼šscrapy startproject é¡¹ç›®åå­—</li>
<li><strong>è¿›å…¥scrapyé¡¹ç›®æ–‡ä»¶å¤¹</strong>ï¼šcd é¡¹ç›®åå­—</li>
<li><strong>åˆ›å»ºçˆ¬è™«è„šæœ¬</strong>ï¼šscrapy genspider çˆ¬è™«å å…è®¸çˆ¬å–çš„åŸŸå</li>
<li><strong>è¿è¡Œscrapyçˆ¬è™«</strong>ï¼šscrapy crawl çˆ¬è™«åå­—</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import scrapy</span><br><span class="line">from scrapy import cmdline  # è¿è¡ŒæŒ‡ä»¤çš„å·¥å…·</span><br><span class="line">from scrapy.http import HtmlResponse</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">åˆ›å»ºscrapyé¡¹ç›®ï¼šscrapy startproject &lt;project_name&gt;</span><br><span class="line">è¿›å…¥scrapyé¡¹ç›®æ–‡ä»¶å¤¹ï¼šcd &lt;project_name&gt;</span><br><span class="line">åˆ›å»ºçˆ¬è™«è„šæœ¬ï¼šscrapy genspider &lt;spider_name&gt; &lt;spider_url&gt;</span><br><span class="line">è¿è¡Œscrapyé¡¹ç›®ï¼ˆä¸€å®šè¦åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼‰ï¼šscrapy crawl &lt;spider_name&gt;</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">class BaiduSpider(scrapy.Spider):</span><br><span class="line">    # çˆ¬è™«è„šæœ¬åç§°ï¼ˆåœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œå¯èƒ½æœ‰å¤šä¸ªçˆ¬è™«ï¼Œé€šè¿‡åç§°å¯ä»¥åŒºåˆ†å®ƒä»¬ï¼‰</span><br><span class="line">    name = &quot;xfblog&quot;</span><br><span class="line">    # å…è®¸çˆ¬å–çš„åŸŸååˆ—è¡¨ï¼ˆé™åˆ¶çˆ¬è™«åªèƒ½çˆ¬å–æŒ‡å®šåŸŸåä¸‹çš„é¡µé¢ï¼Œé¿å…çˆ¬è™«æ— æ„é—´çˆ¬å–åˆ°å…¶ä»–åŸŸåçš„å†…å®¹ï¼‰</span><br><span class="line">    allowed_domains = [&quot;xfblog.cn&quot;]</span><br><span class="line">    # å®šä¹‰çˆ¬è™«å¯åŠ¨æ—¶è¦è®¿é—®çš„èµ·å§‹URLåˆ—è¡¨ï¼ˆçˆ¬è™«å°†ä»è¿™äº›URLå¼€å§‹è¯·æ±‚é¡µé¢å¹¶è°ƒç”¨parseæ–¹æ³•å¤„ç†å“åº”ï¼‰</span><br><span class="line">    start_urls = [&quot;http://xfblog.cn/&quot;]</span><br><span class="line"></span><br><span class="line">    # æŒ‡å®šresponseå‚æ•°çš„ç±»å‹ä¸ºHtmlResponseï¼Œå¯ä»¥ä½¿ç”¨ä½¿ç”¨HtmlResponseæä¾›çš„æ–¹æ³•æ¥æ–¹ä¾¿åœ°è¿›è¡ŒHTMLè§£æ</span><br><span class="line">    def parse(self, response: HtmlResponse, **kwargs):</span><br><span class="line">        &quot;&quot;&quot;å¯¹start_urlsä¸­çš„URLçˆ¬å–ä¹‹åï¼Œå›è°ƒçš„å‡½æ•°&quot;&quot;&quot;</span><br><span class="line">        print(f&quot;å“åº”å¯¹è±¡çš„urlåœ°å€ï¼š&#123;response.url&#125;&quot;)</span><br><span class="line">        print(f&quot;å“åº”å¯¹è±¡çš„å“åº”å¤´ï¼š&#123;response.headers&#125;&quot;)</span><br><span class="line">        print(f&quot;å“åº”å¯¹è±¡å¯¹åº”çš„è¯·æ±‚urlåœ°å€ï¼š&#123;response.request.url&#125;&quot;)</span><br><span class="line">        print(f&quot;å“åº”å¯¹è±¡å¯¹åº”çš„è¯·æ±‚å¤´ï¼š&#123;response.request.headers&#125;&quot;)</span><br><span class="line">        print(f&quot;å“åº”å¯¹è±¡çš„çŠ¶æ€ç ï¼š&#123;response.status&#125;&quot;)</span><br><span class="line">        print(f&quot;å“åº”å¯¹è±¡çš„äºŒè¿›åˆ¶æ•°æ®ï¼ˆcontentï¼‰ï¼š&#123;response.body&#125;&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    # ä½¿ç”¨cmdline.execute()æ–¹æ³•æ¥æ‰§è¡Œå¯åŠ¨å‘½ä»¤ï¼Œé»˜è®¤æ‰“å°æ—¥å¿—ä¿¡æ¯</span><br><span class="line">    cmdline.execute(&#x27;scrapy crawl xfblog&#x27;.split())</span><br><span class="line">    # cmdline.execute(&quot;scrapy crawl xfblog --nolog&quot;.split())  # è®¾ç½®æ—¥å¿—çš„æœ€ä½çº§åˆ«</span><br></pre></td></tr></table></figure>

<h3 id="3-scrapyçš„æ–­ç‚¹ç»­çˆ¬"><a href="#3-scrapyçš„æ–­ç‚¹ç»­çˆ¬" class="headerlink" title="3. scrapyçš„æ–­ç‚¹ç»­çˆ¬"></a>3. scrapyçš„æ–­ç‚¹ç»­çˆ¬</h3><blockquote>
<p><strong>Scrapy ä¸­çš„æš‚åœå’Œæ¢å¤çˆ¬å–çš„åŠŸèƒ½é€šå¸¸è¢«ç§°ä¸ºâ€æ–­ç‚¹ç»­çˆ¬â€ï¼ˆResuming Crawlsï¼‰</strong></p>
<p><strong>ä½¿ç”¨ï¼š</strong>æ–­ç‚¹ç»­çˆ¬å…è®¸åœ¨çˆ¬å–è¿‡ç¨‹ä¸­æš‚åœçˆ¬è™«ï¼Œç„¶ååœ¨ä¹‹åçš„æŸä¸ªæ—¶é—´ç‚¹æˆ–åœ¨ä¸åŒçš„æœºå™¨ä¸Šç»§ç»­çˆ¬å–ã€‚è¿™å¯¹äºå¤§è§„æ¨¡çš„çˆ¬å–ä»»åŠ¡å’Œé•¿æ—¶é—´è¿è¡Œçš„çˆ¬è™«æ¥è¯´éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šå› ä¸ºå„ç§åŸå› ä¸­æ–­ï¼Œä¾‹å¦‚ç½‘ç»œé—®é¢˜ã€ç¨‹åºå´©æºƒç­‰</p>
</blockquote>
<ul>
<li><p><strong>æ–­ç‚¹ç»­çˆ¬è¿‡ç¨‹ï¼š</strong></p>
<ul>
<li><strong>å¯åŠ¨çˆ¬è™«ï¼ˆæ”¯æŒæš‚åœæ¢å¤çš„å‘½ä»¤ï¼‰ï¼š<code>scrapy crawl çˆ¬è™«å -s JOBDIR=ç¼“å­˜scrapyä¿¡æ¯çš„è·¯å¾„</code></strong></li>
<li><strong>æš‚åœçˆ¬è™«ï¼šåœ¨ç»ˆç«¯é‡ŒæŒ‰ä¸‹ä¸€æ¬¡ <code>ctrl+c</code>ï¼ˆåªèƒ½ä¸€æ¬¡ï¼‰</strong></li>
<li><strong>æ¢å¤çˆ¬è™«ï¼ˆä¸å¯åŠ¨ç›¸åŒçš„å‘½ä»¤ï¼‰ï¼š<code>scrapy crawl çˆ¬è™«å -s JOBDIR=ç¼“å­˜scrapyä¿¡æ¯çš„è·¯å¾„</code></strong></li>
</ul>
</li>
<li><p><strong>æ³¨æ„ï¼š</strong>å¦‚æœæœ‰å¤šä¸ªçˆ¬è™«è„šæœ¬ï¼Œé‚£ä¹ˆä¸€å®šè¦åˆ†åˆ«æŒ‡å®šç¼“å­˜è·¯å¾„ï¼Œä¸èƒ½ä½¿ç”¨åŒä¸€ä¸ªç¼“å­˜è·¯å¾„</p>
</li>
</ul>
<h3 id="4-scrapyçš„éå†ç®—æ³•"><a href="#4-scrapyçš„éå†ç®—æ³•" class="headerlink" title="4. scrapyçš„éå†ç®—æ³•"></a>4. scrapyçš„éå†ç®—æ³•</h3><blockquote>
<p>è¿™é‡Œä»‹ç»äº†ä¸¤ç§å›¾éå†ç®—æ³•ï¼Œåœ¨åç»­çš„ä½¿ç”¨ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºscrapyæ‰€ä½¿ç”¨çš„æ˜¯<strong>æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰</strong></p>
</blockquote>
<ul>
<li><strong>æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰</strong>ï¼š<ul>
<li><strong>ç­–ç•¥ï¼š</strong>ä»èµ·å§‹èŠ‚ç‚¹å¼€å§‹ï¼Œå°½å¯èƒ½æ·±å…¥åˆ°å›¾ä¸­çš„æŸä¸€åˆ†æ”¯ï¼Œç›´åˆ°ä¸èƒ½å†æ·±å…¥ä¸ºæ­¢ï¼Œç„¶åå›æº¯åˆ°ä¸Šä¸€å±‚ï¼Œå†ç»§ç»­æ·±å…¥å¦ä¸€ä¸ªåˆ†æ”¯ã€‚è¿™ä¸ªè¿‡ç¨‹é€’å½’è¿›è¡Œï¼Œç›´åˆ°éå†å®Œæ•´ä¸ªå›¾</li>
<li><strong>å®ç°æ–¹å¼ï¼š</strong>é€šå¸¸ä½¿ç”¨é€’å½’æˆ–æ ˆæ¥å®ç°ã€‚åœ¨é€’å½’å®ç°ä¸­ï¼Œæ¯è®¿é—®ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œé€’å½’è°ƒç”¨ä¼šä¸æ–­æ·±å…¥åˆ°ä¸‹ä¸€å±‚</li>
<li><strong>ç‰¹ç‚¹ï¼š</strong>æ·±åº¦ä¼˜å…ˆæœç´¢å¸¸ç”¨äºè§£å†³è·¯å¾„é—®é¢˜ï¼Œä¾‹å¦‚æŸ¥æ‰¾å›¾ä¸­çš„è·¯å¾„ã€è§£å†³è¿·å®«ç­‰ã€‚åœ¨æ ‘çš„æ·±åº¦ä¼˜å…ˆæœç´¢ä¸­ï¼Œå®ƒå¯ä»¥ç”¨æ¥éå†æ‰€æœ‰èŠ‚ç‚¹</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºä¸€ä¸ªç”¨äºæ ‡è®°å·²è®¿é—®èŠ‚ç‚¹çš„é›†åˆ</span><br><span class="line">visited = set()</span><br><span class="line"></span><br><span class="line"># èŠ‚ç‚¹å›¾</span><br><span class="line">graph = &#123;</span><br><span class="line">    &#x27;A&#x27;: [&#x27;B&#x27;, &#x27;C&#x27;],</span><br><span class="line">    &#x27;B&#x27;: [&#x27;D&#x27;, &#x27;E&#x27;],</span><br><span class="line">    &#x27;C&#x27;: [&#x27;F&#x27;, &#x27;G&#x27;, &#x27;H&#x27;],</span><br><span class="line">    &#x27;D&#x27;: [],</span><br><span class="line">    &#x27;E&#x27;: [&#x27;I&#x27;],</span><br><span class="line">    &#x27;F&#x27;: [],</span><br><span class="line">    &#x27;G&#x27;: [],</span><br><span class="line">    &#x27;H&#x27;: [],</span><br><span class="line">    &#x27;I&#x27;: []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># é€šè¿‡é€’å½’çš„æ–¹å¼å®ç°æ·±åº¦ä¼˜å…ˆéå†å‡½æ•°</span><br><span class="line">def dfs_recursion(graph, node):</span><br><span class="line">    # å°†å½“å‰èŠ‚ç‚¹æ ‡è®°ä¸ºå·²è®¿é—®ï¼Œå¹¶è¾“å‡ºèŠ‚ç‚¹å€¼</span><br><span class="line">    visited.add(node)</span><br><span class="line">    print(node, end=&#x27; &#x27;)</span><br><span class="line"></span><br><span class="line">    # éå†å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰é‚»å±…èŠ‚ç‚¹</span><br><span class="line">    for neighbor in graph[node]:</span><br><span class="line">        # å¦‚æœé‚»å±…èŠ‚ç‚¹æœªè¢«è®¿é—®ï¼Œåˆ™é€’å½’è°ƒç”¨è‡ªå·±éå†é‚»å±…çš„é‚»å±…èŠ‚ç‚¹</span><br><span class="line">        if neighbor not in visited:</span><br><span class="line">            dfs_recursion(graph, neighbor)</span><br><span class="line"></span><br><span class="line">dfs_recursion(graph, &#x27;A&#x27;)  # A B D E I C F G H</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰</strong>ï¼š<ul>
<li><strong>ç­–ç•¥ï¼š</strong>ä»èµ·å§‹èŠ‚ç‚¹å¼€å§‹ï¼Œå…ˆè®¿é—®å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰ç›¸é‚»èŠ‚ç‚¹ï¼Œç„¶åä¾æ¬¡è®¿é—®è¿™äº›ç›¸é‚»èŠ‚ç‚¹çš„ç›¸é‚»èŠ‚ç‚¹ï¼Œä¾æ­¤ç±»æ¨ï¼ˆè¿™ä¸ªè¿‡ç¨‹ä½¿ç”¨é˜Ÿåˆ—æ¥å®ç°ï¼‰</li>
<li><strong>å®ç°æ–¹å¼ï¼š</strong>ä½¿ç”¨é˜Ÿåˆ—æ¥ä¿å­˜å¾…è®¿é—®çš„èŠ‚ç‚¹ï¼Œæ¯æ¬¡ä»é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªèŠ‚ç‚¹è®¿é—®ï¼Œç„¶åå°†å…¶æ‰€æœ‰æœªè®¿é—®çš„ç›¸é‚»èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—</li>
<li><strong>ç‰¹ç‚¹ï¼š</strong>å¹¿åº¦ä¼˜å…ˆæœç´¢å¸¸ç”¨äºè§£å†³æœ€çŸ­è·¯å¾„é—®é¢˜ï¼Œä¾‹å¦‚æŸ¥æ‰¾ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ã€‚åœ¨æ ‘çš„å¹¿åº¦ä¼˜å…ˆæœç´¢ä¸­ï¼Œå®ƒå¯ä»¥ç”¨æ¥å±‚åºéå†æ‰€æœ‰èŠ‚ç‚¹</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">from collections import deque</span><br><span class="line"></span><br><span class="line"># èŠ‚ç‚¹å›¾</span><br><span class="line">graph = &#123;</span><br><span class="line">    &#x27;A&#x27;: [&#x27;B&#x27;, &#x27;C&#x27;],</span><br><span class="line">    &#x27;B&#x27;: [&#x27;D&#x27;, &#x27;E&#x27;],</span><br><span class="line">    &#x27;C&#x27;: [&#x27;F&#x27;, &#x27;G&#x27;, &#x27;H&#x27;],</span><br><span class="line">    &#x27;D&#x27;: [],</span><br><span class="line">    &#x27;E&#x27;: [&#x27;I&#x27;],</span><br><span class="line">    &#x27;F&#x27;: [],</span><br><span class="line">    &#x27;G&#x27;: [],</span><br><span class="line">    &#x27;H&#x27;: [],</span><br><span class="line">    &#x27;I&#x27;: []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨dequeé˜Ÿåˆ—å®ç°çš„å¹¿åº¦ä¼˜å…ˆéå†å‡½æ•°</span><br><span class="line">def bfs(graph, start):</span><br><span class="line">    # åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œç”¨äºå­˜å‚¨éœ€è¦éå†çš„èŠ‚ç‚¹</span><br><span class="line">    queue = deque([start])</span><br><span class="line">    # åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ï¼Œç”¨äºå­˜å‚¨å·²ç»éå†è¿‡çš„èŠ‚ç‚¹</span><br><span class="line">    visited = list()</span><br><span class="line"></span><br><span class="line">    while queue:</span><br><span class="line">        # å–å‡ºé˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶å°†å…¶æ ‡è®°ä¸ºå·²è®¿é—®</span><br><span class="line">        node = queue.popleft()</span><br><span class="line">        visited.append(node)</span><br><span class="line"></span><br><span class="line">        # éå†å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰é‚»å±…èŠ‚ç‚¹</span><br><span class="line">        for neighbor in graph[node]:</span><br><span class="line">            # å¦‚æœè¯¥é‚»å±…èŠ‚ç‚¹è¿˜æœªè¢«è®¿é—®ï¼Œåˆ™å°†å…¶åŠ å…¥é˜Ÿåˆ—</span><br><span class="line">            if neighbor not in visited:</span><br><span class="line">                queue.append(neighbor)</span><br><span class="line"></span><br><span class="line">    return visited</span><br><span class="line"></span><br><span class="line">print(bfs(graph, &#x27;A&#x27;))  # [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, &#x27;D&#x27;, &#x27;E&#x27;, &#x27;F&#x27;, &#x27;G&#x27;, &#x27;H&#x27;, &#x27;I&#x27;]</span><br></pre></td></tr></table></figure>

<h3 id="5-scrapyçš„æ—¥å¿—çº§åˆ«"><a href="#5-scrapyçš„æ—¥å¿—çº§åˆ«" class="headerlink" title="5. scrapyçš„æ—¥å¿—çº§åˆ«"></a>5. scrapyçš„æ—¥å¿—çº§åˆ«</h3><blockquote>
<p>Scrapyæ¡†æ¶æä¾›äº†å¼ºå¤§çš„æ—¥å¿—åŠŸèƒ½ï¼ŒåŸºäºPythonçš„å†…ç½® logging æ¨¡å—ï¼Œç”¨äºè®°å½•å’Œå¤„ç†åœ¨çˆ¬å–è¿‡ç¨‹ä¸­å‘ç”Ÿçš„é”™è¯¯ï¼Œå¹¶ä¸”æœ‰ä¸åŒçš„æ—¥å¿—çº§åˆ«ï¼ˆ<strong>é»˜è®¤ä¸ºDEBUGçº§åˆ«</strong>ï¼‰ï¼š</p>
<ul>
<li><strong>æ—¥å¿—é…ç½®ï¼šåœ¨é…ç½®æ–‡ä»¶settings.pyä¸­å¯ä»¥é€šè¿‡LOG_LEVELå‚æ•°è°ƒæ•´æ—¥å¿—çº§åˆ«</strong></li>
<li>**æ—¥å¿—ä½¿ç”¨ï¼šç”± scrapy.Spider ç±»æä¾›äº†ç”¨äºè®°å½•æ—¥å¿—çš„å±æ€§ <code>self.logger.æ—¥å¿—çº§åˆ«(&quot;&quot;)</code> **</li>
<li><strong>æ—¥å¿—çº§åˆ«ï¼ˆæŒ‰ç…§ä¸¥é‡ç¨‹åº¦æ’åºï¼‰ï¼š DEBUG &lt; INFO &lt; WARNING &lt; ERROR &lt; CRITICAL</strong></li>
</ul>
</blockquote>
<ul>
<li><strong>DEBUGï¼ˆè°ƒè¯•ï¼‰:</strong><ul>
<li><strong>å«ä¹‰ï¼š</strong> ç”¨äºè¯¦ç»†å’Œè°ƒè¯•ä¿¡æ¯ã€‚é€šå¸¸åœ¨å¼€å‘å’Œè°ƒè¯•é˜¶æ®µä½¿ç”¨ï¼Œè®°å½•ç¨‹åºå†…éƒ¨çŠ¶æ€ã€å˜é‡å€¼ç­‰è¯¦ç»†ä¿¡æ¯ã€‚</li>
<li><strong>ç¤ºä¾‹ï¼š</strong> <code>self.logger.debug(&quot;è¿™æ˜¯è°ƒè¯•ä¿¡æ¯&quot;)</code></li>
</ul>
</li>
<li><strong>INFOï¼ˆä¿¡æ¯ï¼‰:</strong><ul>
<li><strong>å«ä¹‰ï¼š</strong> ç”¨äºä¸€èˆ¬æ€§çš„ä¿¡æ¯è®°å½•ï¼Œç”¨äºè¡¨æ˜åº”ç”¨ç¨‹åºçš„æ­£å¸¸è¿è¡Œæƒ…å†µã€‚é€šå¸¸æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è®°å½•çš„çº§åˆ«ã€‚</li>
<li><strong>ç¤ºä¾‹ï¼š</strong> <code>self.logger.info(&quot;åº”ç”¨ç¨‹åºæˆåŠŸå¯åŠ¨&quot;)</code></li>
</ul>
</li>
<li><strong>WARNINGï¼ˆè­¦å‘Šï¼‰:</strong><ul>
<li><strong>å«ä¹‰ï¼š</strong> ç”¨äºè¡¨ç¤ºæ½œåœ¨çš„é—®é¢˜ï¼Œä¸å½±å“ç¨‹åºæ­£å¸¸è¿è¡Œï¼Œä½†å¯èƒ½éœ€è¦æ³¨æ„ã€‚é€šå¸¸ç”¨äºè­¦å‘Šå¯èƒ½ä¼šå¯¼è‡´é”™è¯¯çš„æƒ…å†µã€‚</li>
<li><strong>ç¤ºä¾‹ï¼š</strong> <code>self.logger.warning(&quot;æ–‡ä»¶æœªæ‰¾åˆ°ï¼Œä½¿ç”¨é»˜è®¤è®¾ç½®&quot;)</code></li>
</ul>
</li>
<li><strong>ERRORï¼ˆé”™è¯¯ï¼‰:</strong><ul>
<li><strong>å«ä¹‰ï¼š</strong> ç”¨äºè¡¨ç¤ºé”™è¯¯æƒ…å†µï¼Œä½†ç¨‹åºä»ç„¶å¯ä»¥ç»§ç»­è¿è¡Œã€‚é€šå¸¸ç”¨äºè®°å½•æ•è·åˆ°çš„å¼‚å¸¸æˆ–å…¶ä»–å¯¼è‡´ç¨‹åºä¸èƒ½æ­£å¸¸å·¥ä½œçš„é”™è¯¯ã€‚</li>
<li><strong>ç¤ºä¾‹ï¼š</strong> <code>self.logger.error(&quot;å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯&quot;)</code></li>
</ul>
</li>
<li><strong>CRITICALï¼ˆä¸¥é‡é”™è¯¯ï¼‰:</strong><ul>
<li><strong>å«ä¹‰ï¼š</strong> ç”¨äºè¡¨ç¤ºä¸¥é‡é”™è¯¯ï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºæ— æ³•ç»§ç»­è¿è¡Œã€‚é€šå¸¸ç”¨äºè®°å½•ä¸å¯æ¢å¤çš„é”™è¯¯æƒ…å†µã€‚</li>
<li><strong>ç¤ºä¾‹ï¼š</strong> <code>self.logger.critical(&quot;ä¸¥é‡é”™è¯¯ï¼šæ— æ³•è¿æ¥åˆ°æ•°æ®åº“&quot;)</code></li>
</ul>
</li>
</ul>
<h2 id="äºŒã€Spiderçˆ¬è™«æ¨¡å—"><a href="#äºŒã€Spiderçˆ¬è™«æ¨¡å—" class="headerlink" title="äºŒã€Spiderçˆ¬è™«æ¨¡å—"></a>äºŒã€Spiderçˆ¬è™«æ¨¡å—</h2><blockquote>
<p><strong>dont_filterå‚æ•°ï¼š</strong></p>
<ul>
<li><strong>ä½œç”¨ï¼š</strong>ç”¨äºå‘Šè¯‰æ¡†æ¶åœ¨è¿›è¡Œè¯·æ±‚å»é‡æ—¶æ˜¯å¦å¿½ç•¥å¯¹è¯¥è¯·æ±‚çš„å»é‡æ£€æŸ¥</li>
<li><strong>ç”¨æ³•ï¼š</strong>å¯ä»¥é€šè¿‡è®¾ç½® <code>dont_filter=True</code> æ¥ç¦ç”¨è¯·æ±‚ url è¿‡æ»¤</li>
<li><strong>é»˜è®¤å€¼ï¼š</strong>åœ¨ scrapy.Request è¯·æ±‚æ–¹æ³•ä¸­ï¼Œé»˜è®¤ dont_filter&#x3D;Falseï¼ˆ<strong>é»˜è®¤å¼€å¯è¿‡æ»¤</strong>ï¼‰</li>
</ul>
</blockquote>
<h3 id="1-é‡è¦å‡½æ•°"><a href="#1-é‡è¦å‡½æ•°" class="headerlink" title="1. é‡è¦å‡½æ•°"></a>1. é‡è¦å‡½æ•°</h3><blockquote>
<p><strong>éœ€è¦é‡å†™ start_requests æ–¹æ³•çš„åœºæ™¯ï¼š</strong></p>
<ol>
<li>å¦‚æœ start_urls ä¸­çš„ url æ˜¯éœ€è¦ç™»å½•åæ‰èƒ½è®¿é—®çš„ç½‘é¡µï¼Œåˆ™éœ€é‡å†™æ­¤æ–¹æ³•é‡æ–°å‘èµ·è¯·æ±‚å¹¶æ‰‹åŠ¨æ·»åŠ cookie</li>
<li>å¦‚æœéœ€è¦å¼€å¯è¯·æ±‚ url è¿‡æ»¤ï¼Œåˆ™éœ€è¦é‡å†™æ­¤æ–¹æ³•é‡æ–°å‘èµ· scrapy.Request è¯·æ±‚ï¼Œæ­¤è¯·æ±‚é»˜è®¤å¼€å¯è¿‡æ»¤ï¼ˆå› ä¸º start_urls ä¸­çš„ url åœ¨è¢«ç”Ÿæˆ Request å¯¹è±¡æ—¶ï¼Œé»˜è®¤è®¾ç½®ä¸ºå…³é—­è¿‡æ»¤ï¼Œå³ <code>dont_filter=True</code>ï¼‰</li>
<li>å¦‚æœ start_urls ä¸­çš„ url éœ€è¦ä½¿ç”¨ POST è¯·æ±‚ï¼Œåˆ™éœ€è¦é‡å†™æ­¤æ–¹æ³•ä½¿ç”¨ scrapy.FormRequest å‘èµ·è¯·æ±‚</li>
</ol>
</blockquote>
<ul>
<li><p><strong>start_requests å‡½æ•°ï¼š</strong></p>
<ul>
<li><p><strong>ä½œç”¨ï¼š</strong>ç”¨äºç”Ÿæˆåˆå§‹è¯·æ±‚ï¼Œè‹¥ä¸é‡å†™æ­¤å‡½æ•°ï¼Œåˆ™é»˜è®¤ä» start_urls ä¸­ç”Ÿæˆåˆå§‹è¯·æ±‚</p>
</li>
<li><p><strong>å›è°ƒå‡½æ•°ï¼š</strong>ç”Ÿæˆçš„è¯·æ±‚é»˜è®¤ä½¿ç”¨ parse ä½œä¸ºå›è°ƒå‡½æ•°ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå›è°ƒå‡½æ•°ï¼Œæ ¹æ®ä¸åŒçš„æ¡ä»¶ï¼Œæ‰§è¡Œä¸åŒçš„å›è°ƒè§£æå‡½æ•°</p>
</li>
</ul>
</li>
<li><p><strong>parse å‡½æ•°ï¼š</strong></p>
<ul>
<li><strong>ä½œç”¨ï¼š</strong>æ˜¯ Scrapy çˆ¬è™«ä¸­ç”¨äºå¤„ç†å“åº”æ•°æ®çš„é»˜è®¤å›è°ƒå‡½æ•°ï¼Œå¯ä»¥æå–æ‰€éœ€çš„ä¿¡æ¯ï¼Œæˆ–è·Ÿè¿›å…¶ä»–é“¾æ¥ç”Ÿæˆæ›´å¤šè¯·æ±‚</li>
</ul>
</li>
<li><p><strong>æ³¨æ„ï¼šparseå‡½æ•°ä¸­å¯ä»¥ä½¿ç”¨yieldè¯­å¥ç”Ÿæˆå¤šä¸ªè¯·æ±‚æˆ–æ•°æ®é¡¹ï¼Œä½†åªèƒ½æ˜¯ BaseItemã€Requestã€dict å’ŒNone å››ç§ç±»å‹å¯¹è±¡</strong></p>
<ul>
<li><strong>BaseItemï¼š</strong>é€šè¿‡ yield è¿”å›çš„ BaseItem å¯¹è±¡å°†è¢«ä¼ é€’ç»™ Item Pipeline è¿›è¡Œå¤„ç†</li>
<li><strong>Requestï¼š</strong>é€šè¿‡ yield Request(â€¦) çš„æ–¹å¼ï¼Œçˆ¬è™«å¯ä»¥åœ¨è§£æå‡½æ•°ä¸­å‘èµ·æ–°çš„è¯·æ±‚ï¼Œç»§ç»­çˆ¬å–å…¶ä»–é¡µé¢</li>
<li><strong>dictï¼š</strong>é€šè¿‡ yield è¿”å›å­—å…¸å¯¹è±¡ï¼Œå¯ä»¥å°†æå–åˆ°çš„æ•°æ®ä¼ é€’ç»™åç»­çš„è§£æå‡½æ•°æˆ– Item Pipeline è¿›è¡Œå¤„ç†</li>
<li><strong>Noneï¼š</strong>yield None é€šå¸¸ç”¨äºç»“æŸå½“å‰è§£æå‡½æ•°çš„æ‰§è¡Œ</li>
</ul>
</li>
<li><p><strong>response.xpath() æ–¹æ³•ï¼š</strong>æ¥å—ä¸€ä¸ª XPath è¡¨è¾¾å¼ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«é€‰å®šèŠ‚ç‚¹çš„ SelectorList å¯¹è±¡</p>
<ul>
<li><strong>extract()ï¼š</strong>ç”¨äºè·å– SelectorList ä¸­æ‰€æœ‰åŒ¹é…çš„èŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ–‡æœ¬å†…å®¹çš„åˆ—è¡¨</li>
<li><strong>extract_first()ï¼š</strong>ç”¨äºè·å– SelectorList ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…çš„èŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…çš„èŠ‚ç‚¹ï¼Œåˆ™è¿”å› None</li>
</ul>
</li>
<li><p><strong>response.urljoin() æ–¹æ³•ï¼š</strong>ä½œç”¨æ˜¯å°†ç›¸å¯¹URLè½¬æ¢ä¸ºç»å¯¹URL</p>
</li>
</ul>
<h3 id="2-æ•°æ®æå–ã€è·Ÿè¿›é“¾æ¥"><a href="#2-æ•°æ®æå–ã€è·Ÿè¿›é“¾æ¥" class="headerlink" title="2. æ•°æ®æå–ã€è·Ÿè¿›é“¾æ¥"></a>2. æ•°æ®æå–ã€è·Ÿè¿›é“¾æ¥</h3><blockquote>
<p>æ¡ˆä¾‹1ï¼šè±†ç“£ç”µå½±top250ï¼ˆ<code>https://movie.douban.com/top250</code>ï¼‰</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">import scrapy</span><br><span class="line">from scrapy import cmdline</span><br><span class="line">from scrapy.http import HtmlResponse</span><br><span class="line">import redis</span><br><span class="line">import hashlib</span><br><span class="line"></span><br><span class="line">class Top250Spider(scrapy.Spider):</span><br><span class="line">    name = &quot;top250&quot;</span><br><span class="line">    allowed_domains = [&quot;movie.douban.com&quot;, &quot;doubanio.com&quot;]</span><br><span class="line"></span><br><span class="line">    # start_urls = [&quot;https://movie.douban.com/top250&quot;]</span><br><span class="line"></span><br><span class="line">    def __init__(self, *args, **kwargs):</span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line">        self.redis_cli = redis.Redis()</span><br><span class="line"></span><br><span class="line">    # ç¨‹åºé€€å‡ºæ—¶å…³é—­redisè¿æ¥</span><br><span class="line">    def __del__(self):</span><br><span class="line">        self.redis_cli.close()</span><br><span class="line"></span><br><span class="line">    def start_requests(self):</span><br><span class="line">        url = &quot;https://movie.douban.com/top250?start=&#123;&#125;&amp;filter=&quot;</span><br><span class="line">        for page in range(0, 226, 25):</span><br><span class="line">            url_md5 = hashlib.md5(str(url.format(page)).encode()).hexdigest()</span><br><span class="line">            if self.redis_cli.sismember(&#x27;douban:tx_work_url_filter&#x27;, url_md5):</span><br><span class="line">                print(&quot;urlé‡å¤...&quot;)</span><br><span class="line">                continue</span><br><span class="line">            else:</span><br><span class="line">                self.redis_cli.sadd(&#x27;douban:tx_work_url_filter&#x27;, url_md5)</span><br><span class="line">            yield scrapy.Request(url=url.format(page))</span><br><span class="line"></span><br><span class="line">    def parse(self, response: HtmlResponse, **kwargs):</span><br><span class="line">        li_list = response.xpath(&quot;//div[@id=&#x27;content&#x27;]//ol[@class=&#x27;grid_view&#x27;]/li&quot;)</span><br><span class="line">        for item in li_list:</span><br><span class="line">            info = dict()</span><br><span class="line">            info[&#x27;type_&#x27;] = &#x27;info&#x27;</span><br><span class="line">            info[&#x27;img_url&#x27;] = item.xpath(&quot;.//img/@src&quot;).extract_first()</span><br><span class="line">            info[&#x27;title&#x27;] = item.xpath(&quot;.//div[@class=&#x27;hd&#x27;]/a/span/text()&quot;).extract_first()</span><br><span class="line">            info[&#x27;star&#x27;] = item.xpath(&quot;.//span[@class=&#x27;rating_num&#x27;]/text()&quot;).extract_first()</span><br><span class="line">            # info[&#x27;comment&#x27;] = item.xpath(&quot;.//div[@class=&#x27;star&#x27;]/span[last()]/text()&quot;).extract_first()</span><br><span class="line">            yield info</span><br><span class="line">            yield scrapy.Request(url=info[&#x27;img_url&#x27;], callback=self.img_parse, cb_kwargs=&#123;&quot;title&quot;: info[&#x27;title&#x27;]&#125;)</span><br><span class="line"></span><br><span class="line">    @staticmethod</span><br><span class="line">    def img_parse(response: HtmlResponse, title):</span><br><span class="line">        yield &#123;</span><br><span class="line">            &quot;type_&quot;: &#x27;image&#x27;,</span><br><span class="line">            &quot;img_name&quot;: title + &#x27;.png&#x27;,</span><br><span class="line">            &quot;img_content&quot;: response.body</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    cmdline.execute(&#x27;scrapy crawl top250&#x27;.split())</span><br></pre></td></tr></table></figure>

<h3 id="3-è¯·æ±‚postæºå¸¦è¡¨å•"><a href="#3-è¯·æ±‚postæºå¸¦è¡¨å•" class="headerlink" title="3. è¯·æ±‚postæºå¸¦è¡¨å•"></a>3. è¯·æ±‚postæºå¸¦è¡¨å•</h3><blockquote>
<p>æ¡ˆä¾‹ï¼šå·¨æ½®èµ„è®¯ç½‘ï¼ˆ<code>http://www.cninfo.com.cn/new/commonUrl?url=disclosure/list/notice#szse</code>ï¼‰</p>
</blockquote>
<ul>
<li>å¯¹äºæºå¸¦è¡¨å•æ•°æ®çš„postè¯·æ±‚ï¼Œé€šè¿‡ <strong>scrapy.FormRequest()</strong> å‘èµ·</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import scrapy</span><br><span class="line">from scrapy import cmdline</span><br><span class="line"></span><br><span class="line">class CninfoSpider(scrapy.Spider):</span><br><span class="line">    name = &quot;cninfo&quot;</span><br><span class="line">    allowed_domains = [&quot;www.cninfo.com.cn&quot;]</span><br><span class="line"></span><br><span class="line">    # start_urls = [&quot;http://www.cninfo.com.cn/new/index&quot;]</span><br><span class="line"></span><br><span class="line">    def start_requests(self):</span><br><span class="line">        url = &quot;http://www.cninfo.com.cn/new/disclosure&quot;</span><br><span class="line">        for page in range(1, 26):</span><br><span class="line">            data = &#123;</span><br><span class="line">                &quot;column&quot;: &quot;szse_latest&quot;,</span><br><span class="line">                &quot;pageNum&quot;: str(page),</span><br><span class="line">                &quot;pageSize&quot;: &quot;30&quot;,</span><br><span class="line">                &quot;sortName&quot;: &quot;&quot;,</span><br><span class="line">                &quot;sortType&quot;: &quot;&quot;,</span><br><span class="line">                &quot;clusterFlag&quot;: &quot;true&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            yield scrapy.FormRequest(url=url, formdata=data)</span><br><span class="line"></span><br><span class="line">    def parse(self, response):</span><br><span class="line">        print(response)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    cmdline.execute(&quot;scrapy crawl cninfo&quot;.split())</span><br></pre></td></tr></table></figure>

<h3 id="4-è¯·æ±‚postæºå¸¦json"><a href="#4-è¯·æ±‚postæºå¸¦json" class="headerlink" title="4. è¯·æ±‚postæºå¸¦json"></a>4. è¯·æ±‚postæºå¸¦json</h3><blockquote>
<p>æ¡ˆä¾‹ï¼šç½‘æ˜“æ‹›è˜ï¼ˆ<code>https://hr.163.com/job-list.html</code>ï¼‰</p>
</blockquote>
<ul>
<li>å¯¹äºæºå¸¦jsonæ•°æ®çš„postè¯·æ±‚ï¼Œé€šè¿‡ <strong>scrapy.http.JsonRequest()</strong> å‘èµ·</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import scrapy</span><br><span class="line">from scrapy import cmdline</span><br><span class="line">from scrapy.http import JsonRequest, HtmlResponse</span><br><span class="line"></span><br><span class="line">class WorkinfoSpider(scrapy.Spider):</span><br><span class="line">    name = &quot;workinfo&quot;</span><br><span class="line">    allowed_domains = [&quot;hr.163.com&quot;]</span><br><span class="line"></span><br><span class="line">    def start_requests(self):</span><br><span class="line">        url = &quot;https://hr.163.com/api/hr163/position/queryPage&quot;</span><br><span class="line">        json_params = &#123;</span><br><span class="line">            &quot;currentPage&quot;: 1,</span><br><span class="line">            &quot;pageSize&quot;: 10</span><br><span class="line">        &#125;</span><br><span class="line">        yield JsonRequest(url=url, data=json_params)</span><br><span class="line"></span><br><span class="line">    def parse(self, response: HtmlResponse, **kwargs):</span><br><span class="line">        print(response.json())</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    cmdline.execute(&quot;scrapy crawl workinfo --nolog&quot;.split())</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€Middlewareå’ŒExtension"><a href="#ä¸‰ã€Middlewareå’ŒExtension" class="headerlink" title="ä¸‰ã€Middlewareå’ŒExtension"></a>ä¸‰ã€Middlewareå’ŒExtension</h2><blockquote>
<p><strong>Middlewareï¼š</strong>ä¸­é—´ä»¶ä¸»è¦æœ‰<strong>ä¸‹è½½å™¨ä¸­é—´ä»¶</strong>å’Œ<strong>çˆ¬è™«ä¸­é—´ä»¶</strong>ï¼Œåœ¨Scrapyé»˜è®¤çš„æƒ…å†µä¸‹ï¼Œä¸¤ç§ä¸­é—´ä»¶éƒ½åœ¨ middlewares.py ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä½†ç”±äºä¸¤ç§ä¸­é—´ä»¶ä½¿ç”¨æ–¹æ³•ç›¸åŒå’ŒåŠŸèƒ½é‡å¤ï¼Œæ‰€ä»¥<strong>å¸¸ä½¿ç”¨ä¸‹è½½å™¨ä¸­é—´ä»¶</strong></p>
<p><strong>ä»˜è´¹IPä»£ç†ï¼š</strong><a class="link"   href="https://www.kuaidaili.com/doc/dev/sdk_http/#proxy_python-scrapy"  target="_blank" rel="noopener">å¿«ä»£ç†å¼€å‘é…ç½®æ–‡æ¡£<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>æ‰©å±•ï¼ˆExtensionï¼‰ï¼š</strong>æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå…è®¸å¼€å‘è€…é€šè¿‡æ·»åŠ è‡ªå®šä¹‰åŠŸèƒ½æ¥æ‰©å±•æˆ–ä¿®æ”¹Scrapyæ¡†æ¶åœ¨è¿è¡Œè¿‡ç¨‹ä¸­çš„è¡Œä¸ºï¼Œä»¥æ»¡è¶³ç‰¹å®šéœ€æ±‚æˆ–æ‰§è¡Œé¢å¤–çš„ä»»åŠ¡</p>
<p><strong>æ³¨æ„ï¼šæœ‰ä¸€ä¸ªæ€ç»´è¯¯åŒºï¼Œå°±æ˜¯å°†â€é€šè¿‡seleniumè·å–åˆ°ç™»å½•åçš„cookiesâ€çš„è¡Œä¸ºä½¿ç”¨æ‰©å±•å®ç°ï¼Œä¿è¯å…¨å±€åªæ‰§è¡Œä¸€æ¬¡ï¼Œä½†æ˜¯æ‰©å±•ä¸€èˆ¬æ˜¯æ ¹æ®çˆ¬è™«çš„å¯åŠ¨è€Œå¯åŠ¨çš„ï¼Œå¦‚æœè¦åœ¨start_reqestsä¸­ä½¿ç”¨æ­¤æ‰©å±•ï¼Œé‚£ä¹ˆæ­¤æ—¶çˆ¬è™«è¿˜æ²¡æœ‰å¯åŠ¨ï¼Œæ‰©å±•ä¹Ÿå°±è‡ªç„¶æ— æ³•è¿è¡Œï¼Œæ‹¿ä¸åˆ°cookiesï¼›è€Œå¦‚æœè¦åœ¨parseå‡½æ•°ä¸­ä½¿ç”¨æ­¤æ‰©å±•ï¼Œè™½ç„¶ç¡®å®å¯ä»¥æ‹¿åˆ°ç™»å½•åçš„cookiesï¼Œä½†æ˜¯è¿™æ„å‘³ç€æ¯ä¸€æ¬¡è¯·æ±‚çš„æ¯ä¸€æ¬¡å“åº”éƒ½å°†è·å–ä¸€æ¬¡cookiesï¼Œè¿™æ˜¯æ²¡æœ‰å¿…è¦çš„</strong></p>
<p><strong>è§£å†³ï¼šå°†â€é€šè¿‡seleniumè·å–åˆ°ç™»å½•åçš„cookiesâ€çš„é€»è¾‘åœ¨spiderçˆ¬è™«æ¨¡å—çš„start_requestsæ–¹æ³•ä¸­å®ç°</strong>ï¼ˆå³ä¿è¯äº†åœ¨çˆ¬è™«å¯åŠ¨å‰æ‰§è¡Œï¼Œæ‹¿åˆ°ç™»å½•åçš„cookiesï¼Œåˆä¿è¯äº†åªæ‰§è¡Œä¸€æ¬¡ï¼‰</p>
</blockquote>
<h3 id="1-é‡è¦å‡½æ•°-1"><a href="#1-é‡è¦å‡½æ•°-1" class="headerlink" title="1. é‡è¦å‡½æ•°"></a>1. é‡è¦å‡½æ•°</h3><ul>
<li><p><strong>from_crawler å‡½æ•°ï¼š</strong></p>
<ul>
<li><strong>ä½œç”¨ï¼š</strong>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç±»æ–¹æ³•ï¼Œç”¨äºåœ¨ä¸­é—´ä»¶å®ä¾‹åŒ–ä¹‹å‰è®¾ç½®ä¸€äº›é…ç½®</li>
<li><strong>å‚æ•°crawlerï¼š</strong>æ˜¯ä¸€ä¸ªScrapyçš„ Crawler å¯¹è±¡ï¼ŒåŒ…å«äº†å½“å‰çˆ¬è™«çš„é…ç½®ä¿¡æ¯</li>
<li><strong>ç”¨æ³•ï¼š</strong>é€šå¸¸è¢«ç”¨æ¥ä»é…ç½®ä¸­è·å–ä¸€äº›å€¼ï¼Œå¹¶å°†å®ƒä»¬ä¼ é€’ç»™ä¸­é—´ä»¶çš„å®ä¾‹ã€‚è¿™ä½¿å¾—ä¸­é—´ä»¶å¯ä»¥æ ¹æ®çˆ¬è™«çš„é…ç½®åŠ¨æ€åœ°è°ƒæ•´å…¶è¡Œä¸º</li>
</ul>
</li>
<li><p><strong>process_request å‡½æ•°ï¼š</strong></p>
<ul>
<li><strong>è¿”å›Noneï¼š</strong>å°†è¯¥Requestå¯¹è±¡ä¼ é€’ç»™ä¸‹è½½å™¨ï¼Œæˆ–é€šè¿‡å¼•æ“ä¼ é€’ç»™å…¶ä»–æƒé‡æ›´ä½çš„ä¸‹è½½ä¸­é—´ä»¶çš„process_requestæ–¹æ³•ï¼ˆå‡½æ•°æ²¡æœ‰returnä¹Ÿæ˜¯è¿”å›Noneï¼‰</li>
<li><strong>è¿”å›Responseå¯¹è±¡ï¼š</strong>ä¸å†è¯·æ±‚ï¼ŒæŠŠresponseè¿”å›ç»™å¼•æ“</li>
<li><strong>è¿”å›Requestå¯¹è±¡ï¼š</strong>æŠŠrequestå¯¹è±¡é€šè¿‡å¼•æ“å†æ¬¡äº¤ç»™è°ƒåº¦å™¨ï¼Œæ­¤æ—¶å°†ä¸é€šè¿‡å…¶ä»–æƒé‡ä½çš„process_requestæ–¹æ³•</li>
</ul>
</li>
<li><p><strong>process_response å‡½æ•°ï¼š</strong></p>
<ul>
<li><strong>è¿”å›Resposneå¯¹è±¡ï¼š</strong>å°†è¯¥Resposneå¯¹è±¡ä¼ é€’ç»™çˆ¬è™«å¤„ç†ï¼Œæˆ–é€šè¿‡å¼•æ“ä¼ é€’ç»™å…¶ä»–æƒé‡æ›´ä½çš„ä¸‹è½½ä¸­é—´ä»¶çš„process_responseæ–¹æ³•</li>
<li><strong>è¿”å›Requestå¯¹è±¡ï¼š</strong>é€šè¿‡å¼•æ“å†æ¬¡äº¤ç»™è°ƒå–å™¨è¿›è¡Œè¯·æ±‚ï¼Œå†æ¬¡é€šè¿‡å½“å‰ä¸‹è½½ä¸­é—´ä»¶çš„process_requestæ–¹æ³•ï¼Œè€Œä¸ä¼šé€šè¿‡å…¶ä»–æƒé‡ä½çš„process_requestæ–¹æ³•</li>
</ul>
</li>
</ul>
<h3 id="2-æŒ‡çº¹å»é‡ä¸­é—´ä»¶"><a href="#2-æŒ‡çº¹å»é‡ä¸­é—´ä»¶" class="headerlink" title="2. æŒ‡çº¹å»é‡ä¸­é—´ä»¶"></a>2. æŒ‡çº¹å»é‡ä¸­é—´ä»¶</h3><ul>
<li><strong>Js é€†å‘ç»“åˆ Scrapy æ¡†æ¶</strong>ï¼šå¦‚æœ POST è¯·æ±‚æºå¸¦çš„æ•°æ®æ˜¯ç»è¿‡ js åŠ å¯†ä¸”æ¯æ¬¡ç”Ÿæˆä¸ä¸€æ ·ï¼Œåˆ™åœ¨åˆ†å¸ƒå¼ä¸­å°±æ— æ³•é€šè¿‡è¯·æ±‚å¯¹è±¡çš„æŒ‡çº¹å®Œæˆå»é‡ï¼Œè€Œéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªå¯ä»¥ç”¨äºå»é‡çš„å‚æ•°ç”ŸæˆæŒ‡çº¹ï¼ˆä¾‹å¦‚åŠ å¯†å‰çš„æ˜æ–‡å‚æ•°ï¼‰</li>
<li><strong>æ³¨æ„é…ç½® scrapy_redis å»é‡å™¨ï¼š</strong><code>DUPEFILTER_CLASS = &quot;myproject.middlewares.MyDupeFilter&quot;</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># è‡ªå®šä¹‰çš„ Scrapy å»é‡ä¸­é—´ä»¶</span><br><span class="line">from scrapy_redis.dupefilter import RFPDupeFilter</span><br><span class="line">import hashlib</span><br><span class="line"></span><br><span class="line"># å®šä¹‰è‡ªå®šä¹‰çš„å»é‡è¿‡æ»¤å™¨ç±» MyDupeFilterï¼Œç»§æ‰¿è‡ª RFPDupeFilter</span><br><span class="line">class MyDupeFilter(RFPDupeFilter):</span><br><span class="line">    def __init__(self, server, key, debug=False):</span><br><span class="line">        # è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œä¼ é€’å‚æ•° server, key, debug</span><br><span class="line">        super(MyDupeFilter, self).__init__(server, key, debug)</span><br><span class="line">        # åˆå§‹åŒ–ä¸€ä¸ªé›†åˆç”¨äºå­˜å‚¨æŒ‡çº¹ä¿¡æ¯ï¼Œç¡®ä¿è¯·æ±‚çš„å”¯ä¸€æ€§</span><br><span class="line">        self.fingerprints = set()</span><br><span class="line">        # å°†ä¼ é€’çš„ key ä½œä¸ºæŒ‡çº¹çš„é”®å€¼</span><br><span class="line">        self.fingerprint_key = key</span><br><span class="line"></span><br><span class="line">    def request_seen(self, request):</span><br><span class="line">        # ä»è¯·æ±‚çš„ meta ä¸­æå–å…³é”®ä¿¡æ¯ï¼Œä¾‹å¦‚ &#x27;unique_key&#x27;ï¼ˆä¾‹å¦‚åŠ å¯†å‰çš„æ˜æ–‡å‚æ•°ï¼‰</span><br><span class="line">        unique_key = request.meta.get(&#x27;unique_key&#x27;)</span><br><span class="line">        # ä½¿ç”¨ SHA-1 å“ˆå¸Œç®—æ³•å¯¹å…³é”®ä¿¡æ¯è¿›è¡Œå“ˆå¸Œï¼Œç”ŸæˆæŒ‡çº¹</span><br><span class="line">        fp = hashlib.sha1(unique_key.encode()).hexdigest()</span><br><span class="line"></span><br><span class="line">        # å¦‚æœæŒ‡çº¹å·²å­˜åœ¨äºé›†åˆä¸­ï¼Œè¡¨ç¤ºè¯·æ±‚é‡å¤</span><br><span class="line">        if fp in self.fingerprints:</span><br><span class="line">            return True</span><br><span class="line">        # å°†æ–°çš„æŒ‡çº¹æ·»åŠ åˆ°é›†åˆä¸­</span><br><span class="line">        self.fingerprints.add(fp)</span><br><span class="line"></span><br><span class="line">        # å¦‚æœè®¾ç½®äº† fingerprint_keyï¼Œå°†æŒ‡çº¹æ·»åŠ åˆ° Redis ä¸­ï¼Œä»¥ç¡®ä¿åˆ†å¸ƒå¼å»é‡</span><br><span class="line">        if self.fingerprint_key:</span><br><span class="line">            self.server.sadd(self.fingerprint_key, fp)</span><br><span class="line"></span><br><span class="line">        # è¿”å› False è¡¨ç¤ºè¯·æ±‚ä¸é‡å¤</span><br><span class="line">        return False</span><br></pre></td></tr></table></figure>

<h3 id="2-ä»˜è´¹ä»£ç†ipæ‰©å±•"><a href="#2-ä»˜è´¹ä»£ç†ipæ‰©å±•" class="headerlink" title="2. ä»˜è´¹ä»£ç†ipæ‰©å±•"></a>2. ä»˜è´¹ä»£ç†ipæ‰©å±•</h3><blockquote>
<p>æ¡ˆä¾‹1ï¼šè±†ç“£ç”µå½±top250ï¼ˆ<code>https://movie.douban.com/top250</code>ï¼‰</p>
</blockquote>
<ul>
<li>è‡ªå®šä¹‰å¿«ä»£ç†çš„scrapyæ‰©å±•ï¼ˆ<strong>extend_ip.py</strong>ï¼‰</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">import threading</span><br><span class="line">import requests</span><br><span class="line">from scrapy import signals</span><br><span class="line"></span><br><span class="line"># æå–ä»£ç†IPçš„apiï¼Œä¸€æ¬¡æå–10ä¸ªï¼ˆç”Ÿæˆé“¾æ¥ï¼šhttps://www.kuaidaili.com/dps/genapiurl/ï¼‰</span><br><span class="line">api_url = &#x27;https://dps.kdlapi.com/api/getdps/?secret_id=o88cwu0sh49ls75kntwt&amp;num=1&amp;signature=dtb4yamicu504fub6llgx7mjabckit83&amp;pt=1&amp;format=json&amp;sep=1&#x27;</span><br><span class="line">foo = True</span><br><span class="line"></span><br><span class="line">class Proxy:</span><br><span class="line">    def __init__(self, ):</span><br><span class="line">        self._proxy_list = requests.get(api_url).json().get(&#x27;data&#x27;).get(&#x27;proxy_list&#x27;)</span><br><span class="line"></span><br><span class="line">    @property  # p.proxy_listï¼šè‡ªåŠ¨æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œå¹¶è·å–æ–¹æ³•çš„è¿”å›å€¼</span><br><span class="line">    def proxy_list(self):</span><br><span class="line">        return self._proxy_list</span><br><span class="line"></span><br><span class="line">    @proxy_list.setter  # p.proxy_list=&#x27;abc&#x27;ï¼šè‡ªåŠ¨æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œå¹¶å°†&#x27;abc&#x27;èµ‹å€¼ç»™listå‚æ•°</span><br><span class="line">    def proxy_list(self, list):</span><br><span class="line">        self._proxy_list = list</span><br><span class="line"></span><br><span class="line">pro = Proxy()</span><br><span class="line"></span><br><span class="line">class MyExtend:</span><br><span class="line">    def __init__(self, crawler):</span><br><span class="line">        self.crawler = crawler</span><br><span class="line">        # å°†è‡ªå®šä¹‰æ–¹æ³•ç»‘å®šåˆ°scrapyä¿¡å·ä¸Šï¼Œä½¿ç¨‹åºä¸spiderå¼•æ“åŒæ­¥å¯åŠ¨ä¸å…³é—­</span><br><span class="line">        crawler.signals.connect(self.start, signals.engine_started)</span><br><span class="line">        crawler.signals.connect(self.close, signals.spider_closed)</span><br><span class="line"></span><br><span class="line">    @classmethod</span><br><span class="line">    def from_crawler(cls, crawler):</span><br><span class="line">        return cls(crawler)</span><br><span class="line"></span><br><span class="line">    def start(self):</span><br><span class="line">        t = threading.Thread(target=self.extract_proxy)</span><br><span class="line">        t.start()</span><br><span class="line"></span><br><span class="line">    def extract_proxy(self):</span><br><span class="line">        while foo:</span><br><span class="line">            pro.proxy_list = requests.get(api_url).json().get(&#x27;data&#x27;).get(&#x27;proxy_list&#x27;)</span><br><span class="line">            # è®¾ç½®æ¯ä¸€åˆ†é’Ÿæå–ä¸€æ¬¡ipï¼Œæ›´æ–°proxy_liståˆ—è¡¨ä¸­çš„ipï¼Œä¿è¯éƒ½æ˜¯æœ‰æ•ˆip</span><br><span class="line">            time.sleep(60)</span><br><span class="line"></span><br><span class="line">    def close(self):</span><br><span class="line">        global foo</span><br><span class="line">        foo = False</span><br></pre></td></tr></table></figure>

<h3 id="3-ä»˜è´¹ä»£ç†ä¸­é—´ä»¶"><a href="#3-ä»˜è´¹ä»£ç†ä¸­é—´ä»¶" class="headerlink" title="3. ä»˜è´¹ä»£ç†ä¸­é—´ä»¶"></a>3. ä»˜è´¹ä»£ç†ä¸­é—´ä»¶</h3><blockquote>
<p>æ¡ˆä¾‹1ï¼šè±†ç“£ç”µå½±top250ï¼ˆ<code>https://movie.douban.com/top250</code>ï¼‰</p>
</blockquote>
<ul>
<li>è‡ªå®šä¹‰HeadersDownloaderMiddlewareä¸­é—´ä»¶ï¼ˆ<strong>middlewares.py</strong>ï¼‰</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line">from scrapy.http import HtmlResponse</span><br><span class="line">from .extend_ip import pro</span><br><span class="line"></span><br><span class="line">class HeadersDownloaderMiddleware:</span><br><span class="line">    def __init__(self, user_agent_list=None):</span><br><span class="line">        self.user_agent_list = user_agent_list</span><br><span class="line"></span><br><span class="line">    @classmethod</span><br><span class="line">    def from_crawler(cls, crawler):</span><br><span class="line">        # ä»settingsé…ç½®ä¸­è·å–user_agentå€¼</span><br><span class="line">        user_agent_list = crawler.settings.get(&#x27;USER_AGENTS_LIST&#x27;)</span><br><span class="line">        # åˆ›å»ºä¸­é—´ä»¶å®ä¾‹å¹¶ä¼ é€’é…ç½®å€¼</span><br><span class="line">        return cls(user_agent_list)</span><br><span class="line"></span><br><span class="line">    def process_request(self, request: HtmlResponse, spider):</span><br><span class="line">        &quot;&quot;&quot;æ¯ä¸€ä¸ªrequesté€šè¿‡ä¸‹è½½å™¨ä¸­é—´ä»¶ï¼Œæ­¤æ–¹æ³•éƒ½ä¼šè¿è¡Œä¸€æ¬¡ï¼Œæ–¹æ³•process_responseåŒç†&quot;&quot;&quot;</span><br><span class="line">        # print(&quot;ä¸‹è½½ä¸­é—´ä»¶---------process_request---------&quot;)</span><br><span class="line">        request.headers[&#x27;User-Agent&#x27;] = random.choice(self.user_agent_list)</span><br><span class="line"></span><br><span class="line">        # è®¾ç½®å…è´¹ä»£ç†</span><br><span class="line">        # request.meta[&#x27;proxy&#x27;] = &#x27;http://127.0.0.1:7890&#x27;</span><br><span class="line"></span><br><span class="line">        # è®¾ç½®ä»˜è´¹ä»£ç†ï¼Œéœ€è¦åœ¨settings.pyä¸­æ¿€æ´»extend_ipæ‰©å±•</span><br><span class="line">        username = &quot;d4550779926&quot;</span><br><span class="line">        password = &quot;kzsel6pa&quot;</span><br><span class="line">        # å¦‚æœå½“å‰ipä¸å¯ç”¨ï¼Œé‚£ä¹ˆprocess_responseé‡è¯•ï¼Œè¿™é‡Œä¼šåœ¨ä»£ç†æ± ä¸­é‡æ–°é€‰æ‹©ä¸€ä¸ªä»£ç†ip</span><br><span class="line">        proxy = random.choice(pro.proxy_list)</span><br><span class="line">        # print(f&quot;å½“å‰è¯·æ±‚ä½¿ç”¨çš„ä»£ç†ipï¼š&#123;proxy&#125;&quot;)</span><br><span class="line">        request.meta[&#x27;proxy&#x27;] = f&quot;http://&#123;username&#125;:&#123;password&#125;@&#123;proxy&#125;/&quot;</span><br><span class="line"></span><br><span class="line">        # ä¸å†™returenï¼šé»˜è®¤è¿”å›None</span><br><span class="line"></span><br><span class="line">    def process_response(self, request, response: HtmlResponse, spider):</span><br><span class="line">        # print(&quot;ä¸‹è½½ä¸­é—´ä»¶---------process_response---------&quot;)</span><br><span class="line">        # print(request.headers)  # é€šè¿‡request.headersç›´æ¥æ‹¿åˆ°è¯·æ±‚å¤´</span><br><span class="line">        if not response.status == 200:</span><br><span class="line">            request.dont_filter = True  # ä½¿é‡å¤å‘é€çš„è¯·æ±‚å¯¹è±¡èƒ½å¤Ÿå†æ¬¡è¿›å…¥è°ƒåº¦å™¨çš„é˜Ÿåˆ—</span><br><span class="line">            return request</span><br><span class="line">        return response  # æœ€åå¿…é¡»å°†å¤„ç†åçš„å“åº”è¿”å›ç»™å¼•æ“</span><br></pre></td></tr></table></figure>

<h3 id="4-ä¸­é—´ä»¶seleniumé…ç½®"><a href="#4-ä¸­é—´ä»¶seleniumé…ç½®" class="headerlink" title="4. ä¸­é—´ä»¶seleniumé…ç½®"></a>4. ä¸­é—´ä»¶seleniumé…ç½®</h3><blockquote>
<p>æ¡ˆä¾‹2ï¼šè…¾è®¯æ‹›è˜ï¼ˆ<code>https://careers.tencent.com/search.html?keyword=python</code>ï¼‰</p>
<p><strong>æ³¨æ„ï¼šè¿™é‡Œé€‰æ‹©åœ¨ä¸‹è½½ä¸­é—´ä»¶çš„process_requestæ–¹æ³•ä¸­é…ç½®seleniumï¼Œæ˜¯å› ä¸ºè¿™é‡Œçš„çˆ¬å–é€»è¾‘</strong></p>
<ul>
<li><strong>çˆ¬å–é€»è¾‘ï¼šå…ˆåœ¨spideræ¨¡å—çš„start_requestsæ–¹æ³•ä¸­æ„é€ å¾ªç¯å‘èµ·å¤šä¸ªç¿»é¡µè¯·æ±‚ï¼Œç„¶åæ¯ä¸€ä¸ªscrapy.Request()éƒ½åœ¨ç»è¿‡ä¸‹è½½ä¸­é—´ä»¶æ—¶è¢«å¼€å¯seleniumè·å–äº†ç½‘é¡µæºä»£ç ï¼Œå¹¶ä¸”å°†å“åº”è¿”å›ç»™äº†å¼•æ“ï¼Œè¿™æ ·å…¶å®æ¯ä¸€ä¸ªè¯·æ±‚éƒ½æ²¡æœ‰èµ°åˆ°downloaderä¸‹è½½å™¨ï¼Œå°±å·²ç»è·å–åˆ°å“åº”è¿”å›äº†</strong></li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">from scrapy import signals</span><br><span class="line">from scrapy.http import HtmlResponse</span><br><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.webdriver.support.ui import WebDriverWait</span><br><span class="line">from selenium.webdriver.support import expected_conditions as EC</span><br><span class="line">from selenium.webdriver.common.by import By</span><br><span class="line"></span><br><span class="line">class SeleniumDownloaderMiddleware:</span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.browser = webdriver.Chrome()</span><br><span class="line"></span><br><span class="line">    @classmethod</span><br><span class="line">    def from_crawler(cls, crawler):</span><br><span class="line">        s = cls()</span><br><span class="line">        # æ£€æµ‹çˆ¬è™«çŠ¶æ€ï¼Œå¦‚æœçˆ¬è™«å…³é—­åˆ™è°ƒç”¨spider_closedæ–¹æ³•</span><br><span class="line">        crawler.signals.connect(s.spider_closed, signal=signals.spider_closed)</span><br><span class="line">        return s</span><br><span class="line"></span><br><span class="line">    def spider_closed(self):</span><br><span class="line">        self.browser.quit()</span><br><span class="line"></span><br><span class="line">    def process_request(self, request, spider):</span><br><span class="line">        self.browser.get(request.url)</span><br><span class="line">        wait_ob = WebDriverWait(self.browser, timeout=10)</span><br><span class="line">        # ç­‰å¾…æ‰€æœ‰å·¥ä½œä¿¡æ¯å­˜åœ¨ï¼ˆåŠ è½½å®Œæ¯•ï¼‰</span><br><span class="line">        wait_ob.until(EC.presence_of_all_elements_located((By.XPATH, &#x27;//div[@class=&quot;recruit-list&quot;]&#x27;)))</span><br><span class="line">        body = self.browser.page_source  # è·å–ç½‘é¡µæºä»£ç </span><br><span class="line"></span><br><span class="line">        # è¿™ç§åšæ³•å°†ä¸ä¼šç»è¿‡ä¸‹è½½å™¨è¿›è¡Œè¯·æ±‚ï¼Œé€šè¿‡seleniumç›´æ¥å°†è·å–åˆ°çš„bodyæ‰“åŒ…æˆå“åº”è¿”å›ç»™å¼•æ“</span><br><span class="line">        return HtmlResponse(body=body, url=request.url, request=request, encoding=&#x27;utf-8&#x27;)</span><br></pre></td></tr></table></figure>

<h2 id="å››ã€Itemå®ä½“æ¨¡å—"><a href="#å››ã€Itemå®ä½“æ¨¡å—" class="headerlink" title="å››ã€Itemå®ä½“æ¨¡å—"></a>å››ã€Itemå®ä½“æ¨¡å—</h2><h3 id="1-é‡è¦çŸ¥è¯†ç‚¹"><a href="#1-é‡è¦çŸ¥è¯†ç‚¹" class="headerlink" title="1. é‡è¦çŸ¥è¯†ç‚¹"></a>1. é‡è¦çŸ¥è¯†ç‚¹</h3><ul>
<li><p><strong>Itemæ¨¡å—ï¼š</strong>ç”¨äºå®šä¹‰æ•°æ®æ¨¡å‹ï¼Œå³åœ¨çˆ¬å–è¿‡ç¨‹ä¸­éœ€è¦æå–çš„æ•°æ®çš„ç»“æ„ã€‚æ¨¡å—ä¸­å®šä¹‰äº† Scrapy Item ç±»ï¼Œæè¿°äº†çˆ¬å–åˆ°çš„æ•°æ®åº”è¯¥åŒ…å«å“ªäº›å­—æ®µä»¥åŠå®ƒä»¬çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥åœ¨å¤šä¸ªçˆ¬è™«ä¸­é‡å¤ä½¿ç”¨</p>
</li>
<li><p><strong>ItemLoaderå·¥å…·ï¼š</strong>ç”¨äºåŠ è½½å’Œå¤„ç†çˆ¬å–åˆ°çš„æ•°æ®å¹¶å¡«å……åˆ° Item å¯¹è±¡ä¸­ï¼Œåœ¨Itemçš„å¡«å……è¿‡ç¨‹ä¸­å¯ä»¥åº”ç”¨å¤šä¸ªå¤„ç†å™¨ï¼Œè¿›è¡Œæ•°æ®æ¸…æ´—ã€è½¬æ¢ã€é¢„å¤„ç†ç­‰æ“ä½œ</p>
<ul>
<li><strong>input_processorï¼š</strong>åº”ç”¨äºä»<strong>ç½‘é¡µä¸­æå–çš„åŸå§‹æ•°æ®</strong>çš„å¤„ç†å™¨ï¼Œç”¨äºåœ¨å°†æ•°æ®å¡«å……åˆ° <strong>ItemLoader ä¹‹å‰</strong>å¯¹å…¶è¿›è¡Œæ¸…ç†ã€è½¬æ¢æˆ–å…¶ä»–æ“ä½œï¼ˆ<strong>æ¸…ç†æ–‡æœ¬ã€è½¬æ¢æ ¼å¼ç­‰</strong>ï¼‰</li>
<li><strong>output_processorï¼š</strong>åº”ç”¨äºä» <strong>ItemLoader åŠ è½½çš„æ•°æ®</strong>çš„å¤„ç†å™¨ï¼Œç”¨äºåœ¨æ•°æ®å¡«å……åˆ° <strong>Item ä¹‹å‰</strong>å¯¹å…¶è¿›è¡Œæ¸…ç†ã€è½¬æ¢æˆ–å…¶ä»–æ“ä½œï¼ˆ<strong>å–ç¬¬ä¸€ä¸ªéç©ºå€¼ã€æ‹¼æ¥å­—ç¬¦ä¸²ç­‰</strong>ï¼‰</li>
</ul>
</li>
<li><p><strong>itemloaders.processors æ¨¡å—ä¸­æä¾›äº†ä¸€ç³»åˆ—ç”¨äºæ•°æ®å¤„ç†çš„ç±»ï¼š</strong></p>
<ul>
<li><strong>TakeFirstï¼š</strong>ä»å¤„ç†å™¨è¿”å›çš„ç»“æœä¸­å–ç¬¬ä¸€ä¸ªéç©ºå€¼ï¼Œå¸¸ç”¨äºè·å–å•ä¸€æ•°æ®é¡¹</li>
<li><strong>MapComposeï¼š</strong>å¯¹ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ä¸­çš„æ¯ä¸ªå…ƒç´ åº”ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªå¤„ç†å™¨</li>
<li><strong>Composeï¼š</strong>å°†å¤šä¸ªå¤„ç†å™¨ç»„åˆåœ¨ä¸€èµ·ï¼ŒæŒ‰ç…§é¡ºåºåº”ç”¨</li>
<li><strong>Joinï¼š</strong>å°†åˆ—è¡¨ä¸­çš„å­—ç¬¦ä¸²è¿æ¥æˆå•ä¸ªå­—ç¬¦ä¸²ï¼Œé»˜è®¤è¿æ¥ç¬¦ä¸ºâ€â€ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰</li>
<li><strong>Identityï¼š</strong>è¿”å›è¾“å…¥çš„åŸå§‹å€¼ï¼Œå³ä¸åšä»»ä½•å¤„ç†ç›´æ¥è¿”å›è¾“å…¥æ•°æ®æœ¬èº«</li>
</ul>
</li>
<li><p><strong>æ³¨æ„ï¼šè¿™äº›å¤„ç†å™¨ç±»å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç»„åˆåœ¨ä¸€èµ·å½¢æˆå¤„ç†å™¨é“¾ï¼Œé€šå¸¸ç”¨åœ¨ ItemLoader çš„ input_processor å’Œ output_processor å‚æ•°ä¸­</strong></p>
</li>
<li><p><strong>add_xpath() æ–¹æ³•ï¼š</strong></p>
<ul>
<li><strong>ä½œç”¨ï¼š</strong>åœ¨spiderçˆ¬è™«ä¸­åˆ›å»ºItemLoaderå®ä¾‹ï¼Œå¹¶ä½¿ç”¨ add_xpath æ–¹æ³•å°†æ•°æ®å¡«å……åˆ° ItemLoader ä¸­ï¼Œæœ€åyieldç”Ÿæˆitemå¯¹è±¡</li>
</ul>
<ul>
<li><strong>è¿”å›å€¼ï¼š</strong>åœ¨å¡«å……æ•°æ®æ—¶ï¼Œxpathè‹¥åŒ¹é…æˆåŠŸåˆ™è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼ŒåŒ¹é…å¤±è´¥åˆ™è¿”å›None</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">def parse(self, response):</span><br><span class="line">    # åˆ›å»ºä¸€ä¸ª ItemLoader å®ä¾‹ï¼Œå¹¶æŒ‡å®šè¦åŠ è½½çš„ Item ç±»</span><br><span class="line">    loader = ItemLoader(item=MyItem(), response=response)</span><br><span class="line"></span><br><span class="line">    # ä½¿ç”¨ add_xpath æ–¹æ³•æ·»åŠ æ•°æ®ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Itemçš„å­—æ®µåï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯XPathè¡¨è¾¾å¼</span><br><span class="line">    loader.add_xpath(&#x27;title&#x27;, &#x27;//h1/text()&#x27;)</span><br><span class="line">    loader.add_xpath(&#x27;description&#x27;, &#x27;//div[@class=&quot;description&quot;]/text()&#x27;)</span><br><span class="line"></span><br><span class="line">    # å®ŒæˆåŠ è½½å¹¶ç”Ÿæˆ Item å¯¹è±¡</span><br><span class="line">    yield loader.load_item()</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="äº”ã€Piplineç®¡é“æ¨¡å—"><a href="#äº”ã€Piplineç®¡é“æ¨¡å—" class="headerlink" title="äº”ã€Piplineç®¡é“æ¨¡å—"></a>äº”ã€Piplineç®¡é“æ¨¡å—</h2><h3 id="1-é‡è¦å‡½æ•°-2"><a href="#1-é‡è¦å‡½æ•°-2" class="headerlink" title="1. é‡è¦å‡½æ•°"></a>1. é‡è¦å‡½æ•°</h3><ul>
<li><p><strong>from_settings(cls, settings) ç±»æ–¹æ³•ï¼š</strong></p>
<ul>
<li><strong>ä½œç”¨ï¼š</strong>æ˜¯ Scrapy ä¸­çš„ä¸€ä¸ªçº¦å®šï¼Œç”¨äºä»é…ç½®æ–‡ä»¶ä¸­è¯»å–è®¾ç½®å¹¶åˆå§‹åŒ–ç›¸å…³å¯¹è±¡ï¼Œé€šå¸¸åœ¨ Pipeline ä¸­ä½¿ç”¨ï¼Œä½†åœ¨å…¶ä»–æ¨¡å—ç»„ä»¶ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨</li>
<li><strong>å‚æ•°settingsï¼š</strong>æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ key è·å–åˆ° setting.py é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®é¡¹</li>
</ul>
</li>
<li><p><strong>process_item(self, item, spider)å‡½æ•°ï¼š</strong></p>
<ul>
<li><strong>ä½œç”¨ï¼š</strong>ç”¨äºå¤„ç†ä»çˆ¬è™«ä¸­ä¼ é€’è¿‡æ¥çš„ Item å¯¹è±¡ï¼Œå¦‚æ•°æ®æ¸…æ´—ã€æŒä¹…åŒ–å­˜å‚¨ç­‰ï¼ˆ<strong>æ­¤å‡½æ•°ä¸å¯çœç•¥</strong>ï¼‰</li>
<li><strong>å‚æ•°itemï¼š</strong>çˆ¬è™«ä¼ é€’è¿‡æ¥çš„ Item å¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ªå­—å…¸æˆ–ç±»ä¼¼å­—å…¸çš„å¯¹è±¡ï¼ŒåŒ…å«äº†çˆ¬è™«æŠ“å–åˆ°çš„æ•°æ®</li>
<li><strong>å‚æ•°spiderï¼š</strong>çˆ¬è™«å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡ spider.name è·å–çˆ¬è™«åç§°</li>
</ul>
</li>
<li><p><strong>process_itemè¿”å›å€¼ï¼š</strong></p>
<ul>
<li><strong>è¿”å› Item å¯¹è±¡ï¼š</strong>åˆ™è¯¥å¯¹è±¡å°†ç»§ç»­åœ¨åç»­çš„ Pipeline ä¸­è¿›è¡Œå¤„ç†</li>
<li><strong>è¿”å› None å¯¹è±¡ï¼š</strong>è¡¨ç¤ºè¯¥ Item çš„å¤„ç†è¿‡ç¨‹å°†åœæ­¢ï¼Œä¸å†ä¼ é€’ç»™å…¶ä»– Pipelineï¼Œ<strong>ä½†æ˜¯åç»­æƒé‡æ›´ä½çš„ pipeline çš„ process_item æ–¹æ³•æ¥å—åˆ°çš„ item å°†ä¼šæ˜¯None</strong></li>
<li><strong>è¿”å› DropItem å¼‚å¸¸ï¼š</strong>è¡¨ç¤ºä¸¢å¼ƒè¯¥ Itemï¼ˆ**<code>raise DropItem(&quot;&quot;)</code>**ï¼‰</li>
</ul>
</li>
<li><p><strong>open_spiderå‡½æ•°ï¼š</strong></p>
<ul>
<li><strong>ä½œç”¨ï¼š</strong>åœ¨çˆ¬è™«å¯åŠ¨æ—¶è¢«è°ƒç”¨ï¼Œç”¨äºæ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œå¦‚é“¾æ¥æ•°æ®åº“ã€å‡†å¤‡æ–‡ä»¶å¥æŸ„ç­‰ï¼ˆ<strong>åªæ‰§è¡Œä¸€æ¬¡</strong>ï¼‰</li>
</ul>
</li>
<li><p><strong>close_spiderå‡½æ•°ï¼š</strong></p>
<ul>
<li><strong>ä½œç”¨ï¼š</strong>åœ¨çˆ¬è™«å…³é—­æ—¶è¢«è°ƒç”¨ï¼Œç”¨äºæ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œï¼Œå¦‚å…³é—­æ•°æ®åº“è¿æ¥ã€å…³é—­æ–‡ä»¶ç­‰ï¼ˆ<strong>åªæ‰§è¡Œä¸€æ¬¡</strong>ï¼‰</li>
</ul>
</li>
</ul>
<h3 id="2-å¤šä¸ªç®¡é“itemä¼ é€’"><a href="#2-å¤šä¸ªç®¡é“itemä¼ é€’" class="headerlink" title="2. å¤šä¸ªç®¡é“itemä¼ é€’"></a>2. å¤šä¸ªç®¡é“itemä¼ é€’</h3><blockquote>
<p>æ¡ˆä¾‹1ï¼šè±†ç“£ç”µå½±top250ï¼ˆ<code>https://movie.douban.com/top250</code>ï¼‰</p>
</blockquote>
<ul>
<li><strong>æ³¨æ„ï¼šè™½ç„¶å½“ä¸€ä¸ª Item è¢«è¿”å› None æ—¶ï¼Œè¯¥ Item å°†ä¸å†è¢«ä¼ é€’ç»™åç»­çš„ Pipelineï¼Œä½†åœ¨ Scrapy ä¸­ï¼Œç”±äºå¼‚æ­¥å¤„ç†ï¼ŒæŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šå‡ºç° None è¢«ä¼ é€’åˆ°ä¸‹ä¸€ä¸ª Pipeline çš„æƒ…å†µï¼Œæ­¤æ—¶åˆ™éœ€æ·»åŠ åˆ¤æ–­å¤„ç†</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">import pymongo</span><br><span class="line">import os</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">class DoubanImgPipeline:</span><br><span class="line">    &quot;&quot;&quot;ä¿å­˜å›¾ç‰‡æ•°æ®&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def process_item(self, item, spider):</span><br><span class="line">        # å¯èƒ½å­˜åœ¨å¤šä¸ªçˆ¬è™«è„šæœ¬ï¼Œå¯ä»¥é€šè¿‡çˆ¬è™«åç§°æŒ‡å®šç›®æ ‡è„šæœ¬</span><br><span class="line">        if spider.name == &#x27;top250&#x27;:</span><br><span class="line">            if item[&#x27;type_&#x27;] == &#x27;image&#x27;:</span><br><span class="line">                images_path = os.path.dirname(os.getcwd()) + &#x27;/download/&#x27;</span><br><span class="line">                if not os.path.exists(images_path):</span><br><span class="line">                    os.mkdir(images_path)</span><br><span class="line">                with open(images_path + item[&#x27;img_name&#x27;], &#x27;wb&#x27;) as fp:</span><br><span class="line">                    fp.write(item[&#x27;img_content&#x27;])</span><br><span class="line">                    print(f&quot;ä¸‹è½½å›¾ç‰‡&#123;item[&#x27;img_name&#x27;]&#125;æˆåŠŸã€‚ã€‚ã€‚&quot;)</span><br><span class="line">                # è¿”å›Noneï¼Œè¡¨ç¤ºè¯¥Itemä¸å†ä¼ é€’ç»™åç»­Pipeline</span><br><span class="line">                return None</span><br><span class="line">            else:</span><br><span class="line">                # å°†å›¾ç‰‡ä»¥å¤–çš„æ•°æ®ï¼ˆItemï¼‰ä¼ é€’ç»™å…¶å®ƒpiplineç®¡é“ï¼Œè¿›è¡Œå…¶ä½™ä¿å­˜å¤„ç†</span><br><span class="line">                return item</span><br><span class="line"></span><br><span class="line">class DoubanFilePipeline:</span><br><span class="line">    &quot;&quot;&quot;ä¿å­˜ç”µå½±ä¿¡æ¯ä¸ºæ–‡ä»¶&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def process_item(self, item, spider):</span><br><span class="line">        if spider.name == &#x27;top250&#x27;:</span><br><span class="line">            # æ£€æŸ¥itemæ˜¯å¦ä¸º Noneï¼Œå¦‚æœæ˜¯åˆ™ä¸å¤„ç†</span><br><span class="line">            if item is not None:</span><br><span class="line">                self.fp.write(json.dumps(item, ensure_ascii=False, indent=4))</span><br><span class="line">                print(f&quot;ä¿å­˜æ–‡ä»¶&#123;item[&#x27;title&#x27;]&#125;æˆåŠŸã€‚ã€‚ã€‚&quot;)</span><br><span class="line">                return item</span><br><span class="line"></span><br><span class="line">    def open_spider(self, spider):</span><br><span class="line">        if spider.name == &#x27;top250&#x27;:</span><br><span class="line">            self.fp = open(&#x27;json.text&#x27;, &#x27;a&#x27;, encoding=&#x27;utf-8&#x27;)</span><br><span class="line"></span><br><span class="line">    def close_spider(self, spider):</span><br><span class="line">        if spider.name == &#x27;top250&#x27;:</span><br><span class="line">            self.fp.close()</span><br><span class="line"></span><br><span class="line">class DoubanMongoPipeline:</span><br><span class="line">    &quot;&quot;&quot;ä¿å­˜ç”µå½±ä¿¡æ¯åˆ°mongoæ•°æ®åº“ä¸­&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def process_item(self, item, spider):</span><br><span class="line">        if spider.name == &#x27;top250&#x27;:</span><br><span class="line">            # æ£€æŸ¥itemæ˜¯å¦ä¸º Noneï¼Œå¦‚æœæ˜¯åˆ™ä¸å¤„ç†</span><br><span class="line">            if item is not None:</span><br><span class="line">                self.collection.insert_one(item)</span><br><span class="line">                print(f&quot;å­˜å‚¨æ•°æ®åº“&#123;item[&#x27;title&#x27;]&#125;æˆåŠŸã€‚ã€‚ã€‚&quot;)</span><br><span class="line"></span><br><span class="line">    def open_spider(self, spider):</span><br><span class="line">        if spider.name == &#x27;top250&#x27;:</span><br><span class="line">            self.mongo_cli = pymongo.MongoClient()</span><br><span class="line">            self.collection = self.mongo_cli[&#x27;py_spider&#x27;][&#x27;douban_top250&#x27;]</span><br><span class="line"></span><br><span class="line">    def close_spider(self, spider):</span><br><span class="line">        if spider.name == &#x27;top250&#x27;:</span><br><span class="line">            self.mongo_cli.close()</span><br></pre></td></tr></table></figure>

<h3 id="3-æ•°æ®å­˜å‚¨å»é‡"><a href="#3-æ•°æ®å­˜å‚¨å»é‡" class="headerlink" title="3. æ•°æ®å­˜å‚¨å»é‡"></a>3. æ•°æ®å­˜å‚¨å»é‡</h3><blockquote>
<p>æ¡ˆä¾‹1ï¼šè±†ç“£ç”µå½±top250ï¼ˆ<code>https://movie.douban.com/top250</code>ï¼‰</p>
</blockquote>
<ul>
<li>åœ¨ç®¡é“piplineä¸­<strong>åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜å‚¨è¿‡</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">class DoubanCheckPipeline:</span><br><span class="line">    &quot;&quot;&quot;å¯¹æ•°æ®è¿›è¡Œå»é‡&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def process_item(self, item, spider):</span><br><span class="line">        if spider.name == &#x27;top250&#x27;:</span><br><span class="line">            # åˆ›å»ºä¸€ä¸ªæ–°çš„å­—å…¸ï¼Œå°† img_content å­—æ®µå‰”é™¤ï¼Œè½¬ä¸ºå­—ç¬¦ä¸²å¹¶åŠ å¯†æˆ md5 å€¼</span><br><span class="line">            # åŸå› ï¼šbyteså¯¹è±¡ä¸æ˜¯å¯ JSON åºåˆ—åŒ–çš„å¯¹è±¡ï¼Œä¼šåºåˆ—åŒ–å¤±è´¥æŠ›å‡ºå¼‚å¸¸</span><br><span class="line">            item_copy = &#123;key: value for key, value in item.items() if key != &#x27;img_content&#x27;&#125;</span><br><span class="line">            item_md5 = hashlib.md5(json.dumps(item_copy).encode()).hexdigest()</span><br><span class="line"></span><br><span class="line">            # ä½¿ç”¨redisä¸­seté›†åˆçš„ sismember æ–¹æ³•æ£€æŸ¥æˆå‘˜æ˜¯å¦å­˜åœ¨</span><br><span class="line">            if self.redis_cli.sismember(&#x27;douban:tx_work_item_filter&#x27;, item_md5):</span><br><span class="line">                # æŠ›å‡º DropItem å¼‚å¸¸ï¼Œè¡¨ç¤ºä¸¢å¼ƒè¯¥Item</span><br><span class="line">                raise DropItem(&#x27;æ•°æ®å·²å­˜åœ¨ã€‚ã€‚ã€‚&#x27;)</span><br><span class="line">            else:</span><br><span class="line">                self.redis_cli.sadd(&#x27;douban:tx_work_item_filter&#x27;, item_md5)</span><br><span class="line">            return item</span><br><span class="line"></span><br><span class="line">    def open_spider(self, spider):</span><br><span class="line">        if spider.name == &#x27;top250&#x27;:</span><br><span class="line">            self.redis_cli = redis.Redis()</span><br><span class="line"></span><br><span class="line">    def close_spider(self, spider):</span><br><span class="line">        if spider.name == &#x27;top250&#x27;:</span><br><span class="line">            self.redis_cli.close()</span><br></pre></td></tr></table></figure>

<h3 id="4-è¯·æ±‚urlåœ°å€å»é‡"><a href="#4-è¯·æ±‚urlåœ°å€å»é‡" class="headerlink" title="4. è¯·æ±‚urlåœ°å€å»é‡"></a>4. è¯·æ±‚urlåœ°å€å»é‡</h3><blockquote>
<p>æ¡ˆä¾‹1ï¼šè±†ç“£ç”µå½±top250ï¼ˆ<code>https://movie.douban.com/top250</code>ï¼‰</p>
</blockquote>
<ul>
<li>åœ¨çˆ¬è™«spideræˆ–çˆ¬è™«ä¸­é—´ä»¶ä¸­<strong>åˆ¤æ–­URLæ˜¯å¦è¯·æ±‚è¿‡</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import scrapy</span><br><span class="line">from scrapy import cmdline</span><br><span class="line">from scrapy.http import HtmlResponse</span><br><span class="line">import redis</span><br><span class="line">import hashlib</span><br><span class="line"></span><br><span class="line">class Top250Spider(scrapy.Spider):</span><br><span class="line">    name = &quot;top250&quot;</span><br><span class="line">    allowed_domains = [&quot;movie.douban.com&quot;, &quot;doubanio.com&quot;]</span><br><span class="line"></span><br><span class="line">    # start_urls = [&quot;https://movie.douban.com/top250&quot;]</span><br><span class="line"></span><br><span class="line">    def __init__(self, *args, **kwargs):</span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line">        self.redis_cli = redis.Redis()</span><br><span class="line"></span><br><span class="line">    # ç¨‹åºé€€å‡ºæ—¶å…³é—­redisè¿æ¥</span><br><span class="line">    def __del__(self):</span><br><span class="line">        self.redis_cli.close()</span><br><span class="line"></span><br><span class="line">    def start_requests(self):</span><br><span class="line">        url = &quot;https://movie.douban.com/top250?start=&#123;&#125;&amp;filter=&quot;</span><br><span class="line">        for page in range(0, 226, 25):</span><br><span class="line">            url_md5 = hashlib.md5(str(url.format(page)).encode()).hexdigest()</span><br><span class="line">            if self.redis_cli.sismember(&#x27;douban:tx_work_url_filter&#x27;, url_md5):</span><br><span class="line">                print(&quot;urlé‡å¤...&quot;)</span><br><span class="line">                continue</span><br><span class="line">            else:</span><br><span class="line">                self.redis_cli.sadd(&#x27;douban:tx_work_url_filter&#x27;, url_md5)</span><br><span class="line">            yield scrapy.Request(url=url.format(page))</span><br></pre></td></tr></table></figure>

<h3 id="5-adbapiå¼‚æ­¥æ•°æ®åº“æ¥å£"><a href="#5-adbapiå¼‚æ­¥æ•°æ®åº“æ¥å£" class="headerlink" title="5. adbapiå¼‚æ­¥æ•°æ®åº“æ¥å£"></a>5. adbapiå¼‚æ­¥æ•°æ®åº“æ¥å£</h3><blockquote>
<p><strong>twistedä¸­çš„adbapiï¼š</strong></p>
<p>æ•°æ®åº“pymysqlçš„commit()å’Œexecute()åœ¨æäº¤æ•°æ®æ—¶ï¼Œéƒ½æ˜¯åŒæ­¥æäº¤è‡³æ•°æ®åº“ï¼Œç”±äºscrapyæ¡†æ¶æ•°æ®çš„è§£æå’Œå¼‚æ­¥å¤šçº¿ç¨‹çš„ï¼Œæ‰€ä»¥scrapyçš„æ•°æ®è§£æé€Ÿåº¦è¦è¿œé«˜äºæ•°æ®çš„å†™å…¥æ•°æ®åº“çš„é€Ÿåº¦ã€‚å¦‚æœæ•°æ®å†™å…¥è¿‡æ…¢ï¼Œä¼šé€ æˆæ•°æ®åº“å†™å…¥çš„é˜»å¡ï¼Œå½±å“æ•°æ®åº“å†™å…¥çš„æ•ˆç‡ã€‚ ä½¿ç”¨<code>twisted</code>å¼‚æ­¥IOæ¡†æ¶ï¼Œå®ç°æ•°æ®çš„å¼‚æ­¥å†™å…¥ï¼Œé€šè¿‡å¤šçº¿ç¨‹å¼‚æ­¥çš„å½¢å¼å¯¹æ•°æ®è¿›è¡Œå†™å…¥ï¼Œå¯ä»¥æé«˜æ•°æ®çš„å†™å…¥é€Ÿåº¦</p>
</blockquote>
<ul>
<li><strong>adbapi.ConnectionPool ç±»ï¼š</strong>åˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± å¯¹è±¡ï¼Œå…¶ä¸­åŒ…æ‹¬å¤šä¸ªè¿æ¥å¯¹è±¡ï¼Œæ¯ä¸ªè¿æ¥å¯¹è±¡åœ¨ç‹¬ç«‹çš„çº¿ç¨‹ä¸­å·¥ä½œã€‚adbapiåªæ˜¯æä¾›äº†å¼‚æ­¥è®¿é—®æ•°æ®åº“çš„ç¼–ç¨‹æ¡†æ¶ï¼Œå†å…¶å†…éƒ¨ä¾ç„¶ä½¿ç”¨<code>pymysql</code>è¿™ç±»åº“è®¿é—®æ•°æ®åº“</li>
<li><strong>dbpool.runInteraction(do_insert, item) æ–¹æ³•ï¼š</strong>å¼‚æ­¥è°ƒç”¨do_insertå‡½æ•°ï¼Œ<code>dbpool</code>ä¼šé€‰æ‹©è¿æ¥æ± ä¸­çš„ä¸€ä¸ªè¿æ¥å¯¹è±¡åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­è°ƒç”¨insert_dbï¼Œå…¶ä¸­å‚æ•°itemä¼šè¢«ä¼ ç»™do_insertçš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¼ ç»™do_insertçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª<code>Transaction</code>å¯¹è±¡ï¼Œå…¶æ¥å£ä¸<code>cursor</code>å¯¹è±¡ç±»ä¼¼ï¼Œå¯ä»¥è°ƒç”¨<code>execute</code>æ–¹æ³•æ‰§è¡ŒSQLè¯­å¥ï¼Œdo_insertæ‰§è¡Œåï¼Œä¸éœ€è¦è°ƒç”¨commitæ–¹æ³•æäº¤äº‹åŠ¡ï¼Œ<code>adbapi</code>ä¼šè‡ªåŠ¨å¤„ç†<strong>æ‰€æœ‰</strong>æ•°æ®åº“äº‹åŠ¡</li>
<li><strong>query.addErrback(self.handle_error) æ–¹æ³•ï¼š</strong>addErrbackæ–¹æ³•æ˜¯<code>Twisted</code>æ¡†æ¶ä¸­ç”¨äºå¤„ç†<code>Deferred</code>å¯¹è±¡ä¸­å‘ç”Ÿé”™è¯¯çš„å›è°ƒæ–¹æ³•ã€‚å½“åœ¨<code>runInteraction</code>ä¸­æ‰§è¡Œçš„æ“ä½œå‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œè¯¥å¼‚å¸¸ä¼šè¢«åŒ…è£…ä¸ºä¸€ä¸ª<code>Failure</code>å¯¹è±¡ï¼Œç„¶åé€šè¿‡addErrbackæŒ‡å®šçš„å›è°ƒå‡½æ•°è¿›è¡Œå¤„ç†ã€‚<code>handle_error</code>æ–¹æ³•ä¸­çš„å‚æ•°<code>failure</code>å°±æ˜¯åŒ…å«äº†å¼‚å¸¸ä¿¡æ¯çš„<code>Failure</code>å¯¹è±¡</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">class MysqlTwistedPipeline:</span><br><span class="line">    def __init__(self, dbpool):</span><br><span class="line">        self.dbpool = dbpool</span><br><span class="line"></span><br><span class="line">    @classmethod</span><br><span class="line">    def from_settings(cls, settings):</span><br><span class="line">        dbparms = dict(</span><br><span class="line">            host=settings[&quot;MYSQL_HOST&quot;],</span><br><span class="line">            db=settings[&quot;MYSQL_DBNAME&quot;],</span><br><span class="line">            user=settings[&quot;MYSQL_USER&quot;],</span><br><span class="line">            passwd=settings[&quot;MYSQL_PASSWORD&quot;],</span><br><span class="line">            charset=&quot;utf8&quot;,  # å­—ç¬¦é›†å¿…é¡»æ˜¯utf8æ›´è§„èŒƒï¼Œutf-8ä¼šæŠ¥é”™</span><br><span class="line">            cursorclass=pymysql.cursors.DictCursor,  # æŒ‡å®šäº†åœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶è¿”å›çš„ç»“æœé›†çš„æ¸¸æ ‡ç±»å‹</span><br><span class="line">            use_unicode=True,  # ä½¿ç”¨Unicodeç¼–ç ï¼Œæ›´å¥½åœ°æ”¯æŒåŒ…å«éASCIIå­—ç¬¦çš„æ•°æ®</span><br><span class="line">        )</span><br><span class="line">        dbpool = adbapi.ConnectionPool(&#x27;pymysql&#x27;, **dbparms)</span><br><span class="line"></span><br><span class="line">        # åœ¨åˆ›å»ºè¿æ¥æ± çš„æ—¶å€™å¼‚æ­¥æ‰§è¡Œåˆ›å»ºè¡¨çš„é€»è¾‘</span><br><span class="line">        cls.create_table(dbpool)</span><br><span class="line"></span><br><span class="line">        return cls(dbpool)</span><br><span class="line"></span><br><span class="line">    @classmethod</span><br><span class="line">    def create_table(cls, dbpool):</span><br><span class="line">        sql = &quot;&quot;&quot;</span><br><span class="line">            create table if not exists table_name(</span><br><span class="line">                </span><br><span class="line">            );</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        # å¼‚æ­¥æ–¹å¼æ‰§è¡Œåˆ›å»ºè¡¨çš„sqlè¯­å¥</span><br><span class="line">        dbpool.runInteraction(cls._create_table, sql)</span><br><span class="line"></span><br><span class="line">    @staticmethod</span><br><span class="line">    def _create_table(cursor, sql):</span><br><span class="line">        cursor.execute(sql)</span><br><span class="line"></span><br><span class="line">    def process_item(self, item, spider):</span><br><span class="line">        # å¼‚æ­¥è°ƒç”¨do_insertå‡½æ•°ï¼Œæ‰§è¡Œsqlè¯­å¥ï¼Œå¹¶ä¼ å…¥itemå‚æ•°</span><br><span class="line">        query = self.dbpool.runInteraction(self.do_insert, item)</span><br><span class="line">        # åœ¨runInteractionä¸­æ‰§è¡Œçš„æ“ä½œå‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå›è°ƒhandle_errorå‡½æ•°å¤„ç†å¼‚å¸¸</span><br><span class="line">        query.addErrback(self.handle_error)</span><br><span class="line"></span><br><span class="line">    def do_insert(self, cursor, item):</span><br><span class="line">        &quot;&quot;&quot;æ³¨æ„ï¼šåœ¨æ„é€ sqlè¯­å¥æ—¶ï¼Œæœ€å¥½ä½¿ç”¨å‚æ•°åŒ–å ä½ç¬¦æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ</span><br><span class="line">        è€Œä¸æ˜¯ç›´æ¥åœ¨sqlæŸ¥è¯¢ä¸­æ’å…¥å€¼ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥é¿å…sqlæ³¨å…¥çš„é—®é¢˜ï¼Œå¹¶æ›´å®¹æ˜“å¤„ç†ç‰¹æ®Šå­—ç¬¦</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        # `ON DUPLICATE KEY UPDATE`è¯­æ³•åœ¨æ’å…¥æ•°æ®æ—¶å¦‚æœä¸»é”®å†²çªï¼Œåˆ™å¯ä»¥æŒ‡å®šå­—æ®µè¿›è¡Œæ›´æ–°çš„æ“ä½œ</span><br><span class="line">        sql = f&quot;&quot;&quot;</span><br><span class="line">            insert into cnblogs_news values (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s)</span><br><span class="line">            ON DUPLICATE KEY UPDATE totalview=VALUES(totalview);</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">        # éœ€è¦ä¿è¯è¿›å…¥æ•°æ®åº“çš„æ¯ä¸ªå€¼éƒ½æ˜¯stræˆ–è€…intç±»å‹çš„</span><br><span class="line">        params = []</span><br><span class="line">        cursor.execute(sql, params)  # å‚æ•°2æ¥å—åˆ—è¡¨æˆ–å…ƒç»„</span><br><span class="line"></span><br><span class="line">    def handle_error(self, failure):</span><br><span class="line">        print(f&quot;mysqlå¤„ç†é”™è¯¯ï¼š&#123;failure&#125;&quot;)</span><br></pre></td></tr></table></figure>

<h2 id="å…­ã€Settingsé…ç½®æ¨¡å—"><a href="#å…­ã€Settingsé…ç½®æ¨¡å—" class="headerlink" title="å…­ã€Settingsé…ç½®æ¨¡å—"></a>å…­ã€Settingsé…ç½®æ¨¡å—</h2><h3 id="1-é…ç½®ä¸‹è½½å»¶è¿Ÿ"><a href="#1-é…ç½®ä¸‹è½½å»¶è¿Ÿ" class="headerlink" title="1. é…ç½®ä¸‹è½½å»¶è¿Ÿ"></a>1. é…ç½®ä¸‹è½½å»¶è¿Ÿ</h3><ul>
<li><strong>DOWNLOAD_DELAYï¼šé™åˆ¶çš„æ˜¯æ¯ä¸ªè¯·æ±‚ä¹‹é—´çš„å»¶è¿Ÿï¼Œè€Œä¸æ˜¯æ¯ç»„å¹¶å‘è¯·æ±‚ä¹‹å‰</strong></li>
<li><strong>æ³¨æ„ï¼š</strong>é™åˆ¶å¹¶å‘è¯·æ±‚çš„æ•°é‡æ˜¯ä¸ºäº†æ§åˆ¶çˆ¬è™«å¯¹ç›®æ ‡ç½‘ç«™çš„è®¿é—®é¢‘ç‡ï¼Œé˜²æ­¢å¯¹æœåŠ¡å™¨é€ æˆè¿‡å¤§çš„è´Ÿæ‹…ã€‚å³ä½¿è®¾ç½®äº† DOWNLOAD_DELAYï¼Œå¦‚æœå¹¶å‘è¯·æ±‚æ•°é‡è¿‡é«˜ï¼Œä»ç„¶å¯èƒ½åœ¨çŸ­æ—¶é—´å†…å‘æœåŠ¡å™¨å‘é€å¤§é‡è¯·æ±‚ï¼Œè¿™å¯èƒ½å¯¼è‡´æœåŠ¡å™¨æ‹’ç»æœåŠ¡ã€IPè¢«å°ç¦ç­‰é—®é¢˜</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># ä¸‹è½½å»¶è¿Ÿï¼Œæ¯ä¸ªè¯·æ±‚é—´çš„ä¸‹è½½å»¶è¿Ÿï¼Œå•ä½ä¸ºç§’(default: 0ï¼Œé»˜è®¤æ˜¯é’ˆå¯¹åŒä¸€åŸŸåçš„æ¯ä¸ªè¯·æ±‚å»¶è¿Ÿ)</span><br><span class="line">DOWNLOAD_DELAY = 2</span><br><span class="line"># éšæœºä¸‹è½½å»¶è¿Ÿï¼ŒèŒƒå›´æ˜¯0.5åˆ°1.5å€DOWNLOAD_DELAY(default: True)</span><br><span class="line">DOWNLOAD_DELAY_RANDOMIZE = True</span><br><span class="line"></span><br><span class="line"># å…¨å±€é™åˆ¶ï¼Œé…ç½®æ‰§è¡Œçš„æœ€å¤§å¹¶å‘è¯·æ±‚æ•°(default: 16)</span><br><span class="line"># CONCURRENT_REQUESTS = 4</span><br><span class="line"># æ³¨æ„ï¼šCONCURRENT_REQUESTS &gt;= CONCURRENT_REQUESTS_PER_DOMAIN + CONCURRENT_REQUESTS_PER_IP</span><br><span class="line"></span><br><span class="line"># ä¸‹è½½å»¶è¿Ÿè®¾ç½®å°†ä»…æ”¯æŒä»¥ä¸‹å…¶ä¸­ä¸€é¡¹ï¼š</span><br><span class="line"># CONCURRENT_REQUESTS_PER_DOMAIN = 2  # åŒä¸€åŸŸåä¸‹çš„å¹¶å‘è¯·æ±‚æ•°é‡(default: 8)</span><br><span class="line"># CONCURRENT_REQUESTS_PER_IP = 2  # åŒä¸€IPä¸‹çš„å¹¶å‘è¯·æ±‚æ•°é‡(default: 0ï¼Œåˆ™ä¼˜å…ˆçº§é«˜äºåŸŸåé™åˆ¶)</span><br></pre></td></tr></table></figure>

<h3 id="2-å…¨éƒ¨é…ç½®"><a href="#2-å…¨éƒ¨é…ç½®" class="headerlink" title="2. å…¨éƒ¨é…ç½®"></a>2. å…¨éƒ¨é…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line"></span><br><span class="line">BOT_NAME = &quot;project&quot;  # è¡¨ç¤ºScrapyé¡¹ç›®çš„åç§°</span><br><span class="line"></span><br><span class="line">SPIDER_MODULES = [&quot;project.spiders&quot;]  # è¡¨ç¤ºScrapyé¡¹ç›®ä¸­åŒ…å«çˆ¬è™«ä»£ç çš„Pythonæ¨¡å—ï¼Œæ˜¯ä¸€ä¸ªåˆ—è¡¨</span><br><span class="line">NEWSPIDER_MODULE = &quot;project.spiders&quot;  # è¡¨ç¤ºåˆ›å»ºæ–°çˆ¬è™«æ—¶çš„è„šæœ¬æ–‡ä»¶æ”¾ç½®çš„é»˜è®¤æ¨¡å—</span><br><span class="line"></span><br><span class="line"># Obey robots.txt rules</span><br><span class="line">ROBOTSTXT_OBEY = True  # ç”¨äºæŒ‡å®šæ˜¯å¦éµå¾ªç½‘ç«™çš„ robots.txt è§„åˆ™</span><br><span class="line"></span><br><span class="line"># Configure maximum concurrent requests performed by Scrapy (default: 16)</span><br><span class="line">CONCURRENT_REQUESTS = 32  # ç”¨äºæŒ‡å®šåœ¨ä»»ä½•ç»™å®šæ—¶é—´ç‚¹åŒæ—¶æ‰§è¡Œçš„æœ€å¤§è¯·æ±‚æ•°é‡</span><br><span class="line"></span><br><span class="line"># é»˜è®¤æƒ…å†µä¸‹ï¼ŒRANDOMIZE_DOWNLOAD_DELAY = Trueï¼Œç”¨äºæ§åˆ¶æ˜¯å¦éšæœºåŒ–DOWNLOAD_DELAY</span><br><span class="line"># å®é™…å»¶è¿Ÿæ—¶é—´ï¼š[0.5 * DOWNLOAD_DELAY, 1.5 * DOWNLOAD_DELAY]ï¼Œå³0.5åˆ°1.5å€ä¹‹é—´</span><br><span class="line">DOWNLOAD_DELAY = 1</span><br><span class="line"># ä¸‹è½½å»¶è¿Ÿè®¾ç½®åªä¼šå—åˆ°CONCURRENT_REQUESTS_PER_DOMAINæˆ–CONCURRENT_REQUESTS_PER_IPä¸­çš„ä¸€ä¸ªå½±å“</span><br><span class="line"># CONCURRENT_REQUESTS_PER_DOMAIN = 16  # æ§åˆ¶å¯¹äºåŒä¸€åŸŸåçš„å¹¶å‘è¯·æ±‚æ•°é‡</span><br><span class="line"># CONCURRENT_REQUESTS_PER_IP = 16  # æ§åˆ¶å¯¹äºåŒä¸€ IP åœ°å€çš„å¹¶å‘è¯·æ±‚æ•°é‡</span><br><span class="line"></span><br><span class="line"># Disable cookies (enabled by default)</span><br><span class="line"># COOKIES_ENABLED = False  # ç”¨äºæ§åˆ¶æ˜¯å¦å¯ç”¨cookiesï¼ˆé»˜è®¤ cookies æ˜¯å¯ç”¨çš„ï¼‰</span><br><span class="line"></span><br><span class="line"># ç”¨äºè®¾ç½®é»˜è®¤çš„è¯·æ±‚å¤´ä¿¡æ¯</span><br><span class="line">DEFAULT_REQUEST_HEADERS = &#123;  </span><br><span class="line">    &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36&#x27;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># ç”¨äºå¯ç”¨æˆ–ç¦ç”¨çˆ¬è™«ä¸­é—´ä»¶ï¼ˆæ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼‰</span><br><span class="line"># SPIDER_MIDDLEWARES = &#123;</span><br><span class="line">#    &quot;project.middlewares.ProjectSpiderMiddleware&quot;: 543,</span><br><span class="line"># &#125;</span><br><span class="line"></span><br><span class="line"># ç”¨äºå¯ç”¨æˆ–ç¦ç”¨ä¸‹è½½å™¨ä¸­é—´ä»¶ï¼ˆæ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼‰</span><br><span class="line">DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line">    &quot;project.middlewares.IpDownloaderMiddleware&quot;: 543,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># ç”¨äºå¯ç”¨æˆ–ç¦ç”¨æ‰©å±•ï¼ˆæ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼‰</span><br><span class="line">EXTENSIONS = &#123;</span><br><span class="line">    &quot;project.extend_ip.MyExtend&quot;: 300,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># ç”¨äºæŒ‡å®šæ•°æ®å¤„ç†çš„ç®¡é“çš„è®¾ç½®ï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§é¡ºåºï¼Œä¾æ¬¡å°† Item ç»è¿‡è¿™äº› Pipeline è¿›è¡Œå¤„ç†</span><br><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">    &quot;project.pipelines.JsonExporterPipeline&quot;: 300,</span><br><span class="line">    &quot;project.pipelines.ScrapyJsonExporterPipeline&quot;: 301,</span><br><span class="line">    # &quot;scrapy.pipelines.images.ImagesPipeline&quot;: 1,  # ä½¿ç”¨scrapyé»˜è®¤çš„ä¸‹è½½å›¾ç‰‡pipelineï¼Œä¼˜å…ˆçº§ä¸º1</span><br><span class="line">    &quot;project.pipelines.MyImagesPipeline&quot;: 1,</span><br><span class="line">    &quot;project.pipelines.MysqlTwistedPipeline&quot;: 302,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Enable and configure the AutoThrottle extension (disabled by default)</span><br><span class="line"># See https://docs.scrapy.org/en/latest/topics/autothrottle.html</span><br><span class="line"># AUTOTHROTTLE_ENABLED = True  # å¯ç”¨æˆ–ç¦ç”¨è‡ªåŠ¨é™é€Ÿæ‰©å±•ï¼Œé»˜è®¤æ˜¯ç¦ç”¨çš„</span><br><span class="line"># The initial download delay</span><br><span class="line"># AUTOTHROTTLE_START_DELAY = 5  # åˆå§‹ä¸‹è½½å»¶è¿Ÿï¼Œè¡¨ç¤ºåœ¨ Scrapy å‘é€ç¬¬ä¸€ä¸ªè¯·æ±‚ä¹‹å‰ç­‰å¾…çš„æ—¶é—´ï¼Œé»˜è®¤ä¸º5ç§’</span><br><span class="line"># The maximum download delay to be set in case of high latencies</span><br><span class="line"># AUTOTHROTTLE_MAX_DELAY = 60  # æœ€å¤§ä¸‹è½½å»¶è¿Ÿï¼Œè¡¨ç¤ºè‡ªåŠ¨é™é€Ÿçš„æœ€å¤§ç­‰å¾…æ—¶é—´</span><br><span class="line"># The average number of requests Scrapy should be sending in parallel to</span><br><span class="line"># each remote server</span><br><span class="line"># AUTOTHROTTLE_TARGET_CONCURRENCY = 1.0  # æ¯ä¸ªè¿œç¨‹æœåŠ¡å™¨å¹³å‡å¹¶è¡Œå‘é€çš„è¯·æ±‚æ•°é‡ï¼Œé»˜è®¤ä¸º 1.0</span><br><span class="line"># Enable showing throttling stats for every response received:</span><br><span class="line"># AUTOTHROTTLE_DEBUG = False  # å¯ç”¨æˆ–ç¦ç”¨è‡ªåŠ¨é™é€Ÿçš„è°ƒè¯•æ¨¡å¼ï¼Œé»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œå¼€å¯è°ƒè¯•ä¼šè®°å½•æ›´å¤šæœ‰å…³ä¿¡æ¯</span><br><span class="line"></span><br><span class="line"># Enable and configure HTTP caching (disabled by default)</span><br><span class="line"># See https://docs.scrapy.org/en/latest/topics/downloader-middleware.html#httpcache-middleware-settings</span><br><span class="line"># HTTPCACHE_ENABLED = True  # å¯ç”¨æˆ–ç¦ç”¨HTTPç¼“å­˜ï¼Œé»˜è®¤æ˜¯ç¦ç”¨çš„</span><br><span class="line"># HTTPCACHE_EXPIRATION_SECS = 0  # æŒ‡å®šç¼“å­˜å“åº”çš„è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰ï¼Œè¿‡æœŸåå°†å‘é€æ–°è¯·æ±‚åˆ°æœåŠ¡å™¨</span><br><span class="line"># HTTPCACHE_DIR = &quot;httpcache&quot;  # å®šä¹‰ç¼“å­˜å“åº”çš„å­˜å‚¨ç›®å½•</span><br><span class="line"># HTTPCACHE_IGNORE_HTTP_CODES = []  # å®šä¹‰åœ¨ç¼“å­˜æ—¶åº”è¯¥å¿½ç•¥çš„HTTPçŠ¶æ€ç åˆ—è¡¨</span><br><span class="line"># HTTPCACHE_STORAGE = &quot;scrapy.extensions.httpcache.FilesystemCacheStorage&quot;  # å­˜å‚¨ç¼“å­˜çš„å¼•æ“</span><br><span class="line"></span><br><span class="line"># Set settings whose default value is deprecated to a future-proof value</span><br><span class="line"># è¿™äº›è®¾ç½®çš„ä½œç”¨æ˜¯ç¡®ä¿åœ¨å°†æ¥çš„Scrapyç‰ˆæœ¬ä¸­ä»ç„¶èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œå› ä¸ºæŸäº›é»˜è®¤å€¼å·²è¢«å¼ƒç”¨</span><br><span class="line">REQUEST_FINGERPRINTER_IMPLEMENTATION = &quot;2.7&quot;</span><br><span class="line">TWISTED_REACTOR = &quot;twisted.internet.asyncioreactor.AsyncioSelectorReactor&quot;</span><br><span class="line">FEED_EXPORT_ENCODING = &quot;utf-8&quot;</span><br><span class="line"></span><br><span class="line"># å¤„ç†å›¾åƒä¸‹è½½çš„è®¾ç½®å­—æ®µ</span><br><span class="line">IMAGES_URLS_FIELD = &#x27;front_image_url&#x27;  # ç”¨äºæŒ‡å®š Item å¯¹è±¡ä¸­åŒ…å«å›¾åƒ URL çš„å­—æ®µåç§°</span><br><span class="line"># å¦‚æœè·¯å¾„ä»¥æ–œæ /å¼€å¤´ï¼Œå°±æ˜¯ç»å¯¹è·¯å¾„ï¼›æ²¡æœ‰ä»¥æ–œæ å¼€å¤´ï¼Œå°±æ˜¯ç›¸å¯¹äºå½“å‰å·¥ä½œç›®å½•çš„ç›¸å¯¹è·¯å¾„</span><br><span class="line">IMAGES_STORE = os.path.dirname(os.getcwd()) + &#x27;/images/&#x27;</span><br><span class="line"></span><br><span class="line"># MySQLç›¸å…³é…ç½®</span><br><span class="line">MYSQL_HOST = &quot;127.0.0.1&quot;</span><br><span class="line">MYSQL_USER = &quot;root&quot;</span><br><span class="line">MYSQL_PASSWORD = &quot;123456&quot;</span><br><span class="line">MYSQL_DBNAME = &quot;py_spider&quot;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸ƒã€cnblogsé¡¹ç›®å®æˆ˜"><a href="#ä¸ƒã€cnblogsé¡¹ç›®å®æˆ˜" class="headerlink" title="ä¸ƒã€cnblogsé¡¹ç›®å®æˆ˜"></a>ä¸ƒã€cnblogsé¡¹ç›®å®æˆ˜</h2><h3 id="1-spiders-cnblogs-py"><a href="#1-spiders-cnblogs-py" class="headerlink" title="1. spiders&#x2F;cnblogs.py"></a>1. spiders&#x2F;cnblogs.py</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">import scrapy</span><br><span class="line">from scrapy import cmdline</span><br><span class="line">from scrapy.http import HtmlResponse</span><br><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.webdriver.support.ui import WebDriverWait</span><br><span class="line">from selenium.webdriver.support import expected_conditions as EC</span><br><span class="line">from selenium.webdriver.common.by import By</span><br><span class="line">import time</span><br><span class="line">import re</span><br><span class="line">import hashlib</span><br><span class="line">from urllib import parse</span><br><span class="line"></span><br><span class="line">from scrapy.loader import ItemLoader</span><br><span class="line">from bkyuan.items import DefaultItemLoader</span><br><span class="line">from bkyuan.items import CnblogsArticleItem</span><br><span class="line"></span><br><span class="line">class CnblogsSpider(scrapy.Spider):</span><br><span class="line">    name = &quot;cnblogs&quot;</span><br><span class="line">    allowed_domains = [&quot;news.cnblogs.com&quot;, &quot;cnblogs.com&quot;]</span><br><span class="line">    start_urls = [&quot;https://news.cnblogs.com/&quot;]</span><br><span class="line"></span><br><span class="line">    options = webdriver.ChromeOptions()</span><br><span class="line">    # ç¦ç”¨Chromeçš„Blinkæ¸²æŸ“å¼•æ“ä¸­ç›¸å…³çš„è‡ªåŠ¨åŒ–ç‰¹æ€§ï¼Œç›®çš„æ˜¯å‡å°‘è¢«è‡ªåŠ¨åŒ–å·¥å…·æ£€æµ‹åˆ°çš„æ¦‚ç‡</span><br><span class="line">    options.add_argument(&#x27;--disable-blink-features=AutomationControlled&#x27;)</span><br><span class="line">    options.add_argument(&#x27;--headless&#x27;)  # æ— å¤´æ¨¡å¼</span><br><span class="line">    options.page_load_strategy = &quot;eager&quot;  # æ›´æ”¹é¡µé¢åŠ è½½ç­–ç•¥ä¸ºeager</span><br><span class="line"></span><br><span class="line">    def __init__(self, *args, **kwargs):</span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line">        self.browser = webdriver.Chrome(options=self.options)</span><br><span class="line">        self.wait_bro = WebDriverWait(self.browser, 5)</span><br><span class="line"></span><br><span class="line">    def __del__(self):</span><br><span class="line">        self.browser.quit()</span><br><span class="line"></span><br><span class="line">    def start_requests(self):</span><br><span class="line">        self.browser.get(&quot;https://account.cnblogs.com/signin&quot;)</span><br><span class="line">        username = self.wait_bro.until(</span><br><span class="line">            EC.presence_of_element_located((By.XPATH, &#x27;//input[@formcontrolname=&quot;username&quot;]&#x27;)))</span><br><span class="line">        password = self.wait_bro.until(</span><br><span class="line">            EC.presence_of_element_located((By.XPATH, &#x27;//input[@formcontrolname=&quot;password&quot;]&#x27;)))</span><br><span class="line">        login_btn = self.wait_bro.until(</span><br><span class="line">            EC.element_to_be_clickable((By.XPATH, &#x27;//button[contains(@class,&quot;mat-flat-button&quot;)]&#x27;)))</span><br><span class="line">        username.send_keys(&quot;å°å‚…xfblog&quot;)</span><br><span class="line">        password.send_keys(&quot;zhangjie789&quot;)</span><br><span class="line">        login_btn.click()</span><br><span class="line">        check_btn = self.wait_bro.until(EC.element_to_be_clickable((By.XPATH, &#x27;//div[@id=&quot;rectMask&quot;]&#x27;)))</span><br><span class="line">        check_btn.click()</span><br><span class="line">        # ç™»å½•æˆåŠŸåï¼Œé¦–å…ˆè·³è½¬æ–°é—»é¡µï¼Œç„¶åéšæœºè®¿é—®ä¸€ç¯‡æ–‡ç« ï¼Œè·å–å…¶cookiesä»¥ä¾›åç»­çˆ¬å–æ–‡ç« è¯¦æƒ…é¡µæºå¸¦</span><br><span class="line">        time.sleep(2)  # ç™»å½•æˆåŠŸåä¸èƒ½ç‚¹å‡»å¤ªå¿«ï¼Œå¦åˆ™ä¼šåˆè·³è½¬è‡³ç™»å½•é¡µé¢</span><br><span class="line">        self.browser.get(&quot;https://news.cnblogs.com/&quot;)</span><br><span class="line">        article_a = self.wait_bro.until(</span><br><span class="line">            EC.element_to_be_clickable((By.XPATH, &#x27;//div[@class=&quot;news_block&quot;][1]//h2/a&#x27;)))</span><br><span class="line">        article_a.click()</span><br><span class="line">        cookies = self.browser.get_cookies()</span><br><span class="line">        cookie_dict = &#123;item[&#x27;name&#x27;]: item[&#x27;value&#x27;] for item in cookies&#125;</span><br><span class="line"></span><br><span class="line">        url = &quot;https://news.cnblogs.com/n/page/&#123;&#125;/&quot;</span><br><span class="line">        for page in range(1, 101):</span><br><span class="line">            yield scrapy.Request(url=url.format(page), cookies=cookie_dict, meta=&#123;&#x27;cookies&#x27;: cookie_dict&#125;)</span><br><span class="line"></span><br><span class="line">    def parse(self, response: HtmlResponse, **kwargs):</span><br><span class="line">        &quot;&quot;&quot;parseå‡½æ•°ä¸»è¦å®Œæˆä¸¤ä¸ªåŠŸèƒ½ï¼š</span><br><span class="line">        1. è·å–è¿™é¡µä¸­çš„æ¯æ¡æ–°é—»çš„å°é¢å›¾ç‰‡ï¼Œå­˜ä¸ºå…ƒæ•°æ®</span><br><span class="line">        2. è·å–æ–°é—»è¯¦æƒ…é¡µçš„urlï¼Œå¹¶äº¤ç»™scrapyè¿›è¡Œä¸‹è½½åè°ƒç”¨ç›¸åº”çš„è§£ææ–¹æ³•</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        news_list = response.xpath(&quot;//div[@id=&#x27;news_list&#x27;]/div[@class=&#x27;news_block&#x27;]&quot;)</span><br><span class="line">        for news in news_list:</span><br><span class="line">            image_url = news.xpath(&quot;.//img/@src&quot;).extract_first()</span><br><span class="line">            # è¿™é‡Œæœ‰äº›æ–‡ç« æ²¡æœ‰å°é¢å›¾ç‰‡ã€‚æœ‰äº›ä»¥//å¼€å¤´ï¼Œæ‰€ä»¥éœ€è¦å¤„ç†ä¸ºå®Œæ•´url</span><br><span class="line">            if image_url and image_url.startswith(&quot;//&quot;):</span><br><span class="line">                image_url = &quot;https:&quot; + image_url</span><br><span class="line">            article_url = news.xpath(&quot;.//h2[@class=&#x27;news_entry&#x27;]/a/@href&quot;).extract_first()</span><br><span class="line"></span><br><span class="line">            # ä½¿ç”¨response.urljoin()æ–¹æ³•å°†ç›¸å¯¹urlè½¬æ¢ä¸ºç»å¯¹url</span><br><span class="line">            article_url = response.urljoin(article_url)</span><br><span class="line">            yield scrapy.Request(url=article_url, cookies=response.meta.get(&quot;cookies&quot;, &quot;&quot;),</span><br><span class="line">                                 meta=&#123;&#x27;front_image_url&#x27;: image_url&#125;, callback=self.parse_article)</span><br><span class="line"></span><br><span class="line">    def parse_article(self, response: HtmlResponse):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        åˆ†æå¾—çŸ¥ï¼šåç»­æ–‡ç« è¯¦æƒ…çš„è¯„è®ºæ•°ã€é˜…è¯»é‡ç­‰æ•°æ®ï¼Œæ˜¯é€šè¿‡æ•°æ®apiè¿”å›çš„ï¼Œæ‰€ä»¥éœ€è¦å¾—åˆ°æ–‡ç« idï¼Œ</span><br><span class="line">        æ„é€ è¯·æ±‚urlï¼šhttps://news.cnblogs.com/NewsAjax/GetAjaxNewsInfo?contentId=&#123;&#125;</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        article_id = re.findall(r&#x27;.*?(\d&#123;6,&#125;?)&#x27;, response.url)[0]</span><br><span class="line">        url_md5 = hashlib.md5(str(response.url).encode()).hexdigest()</span><br><span class="line">        # æ—¥å¿—æ‰“å°è¯·æ±‚å…ƒæ•°æ®</span><br><span class="line">        self.logger.warning(response.request.meta)</span><br><span class="line">        if article_id:</span><br><span class="line">            # åˆ›å»ºä¸€ä¸ª ItemLoader å®ä¾‹ï¼Œå¹¶æŒ‡å®šè¦åŠ è½½çš„ Item ç±»</span><br><span class="line">            item_info = DefaultItemLoader(item=CnblogsArticleItem(), response=response)</span><br><span class="line">            item_info.add_xpath(&quot;title&quot;, &#x27;//*[@id=&quot;news_title&quot;]/a/text()&#x27;)</span><br><span class="line">            item_info.add_xpath(&quot;create_date&quot;, &#x27;//*[@id=&quot;news_info&quot;]//*[@class=&quot;time&quot;]/text()&#x27;)</span><br><span class="line">            item_info.add_xpath(&quot;tags&quot;, &#x27;//*[@id=&quot;news_more_info&quot;]//a/text()&#x27;)</span><br><span class="line">            item_info.add_value(&quot;url&quot;, response.url)</span><br><span class="line">            item_info.add_value(&quot;url_md5_id&quot;, url_md5)</span><br><span class="line">            # ä¸‹è½½å›¾ç‰‡éœ€è¦åœ¨settingsä¸­é…ç½® IMAGES_URLS_FIELD å’Œ IMAGES_STORE å­—æ®µ</span><br><span class="line">            # ä¸€å®šè¦ç¡®ä¿å›¾ç‰‡ url å€¼æ˜¯æœ‰æ•ˆçš„ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ ValueErrorï¼šMissing scheme in request url</span><br><span class="line">            if response.meta.get(&quot;front_image_url&quot;, &quot;&quot;):</span><br><span class="line">                item_info.add_value(&quot;front_image_url&quot;, response.meta.get(&quot;front_image_url&quot;, &quot;&quot;))</span><br><span class="line"></span><br><span class="line">            # ç”±äºæ˜¯å¸¦ç€cookiesåœ¨è¿›è¡Œè¯¦æƒ…é¡µè¯·æ±‚ï¼Œæ­¤æ—¶response.urlå·²ç»å˜äº†ï¼Œæ‰€ä»¥ä¸å†ä½¿ç”¨response.urljoin()</span><br><span class="line">            # å¯ä»¥ä½¿ç”¨ urllib.parse åŒ…ä¸­çš„ urljoin() æ–¹æ³•ï¼Œæ‰‹åŠ¨æ§åˆ¶ url å‰ç¼€</span><br><span class="line">            api_url = parse.urljoin(&quot;https://news.cnblogs.com/&quot;, f&quot;/NewsAjax/GetAjaxNewsInfo?contentId=&#123;article_id&#125;&quot;)</span><br><span class="line">            yield scrapy.Request(url=api_url, meta=&#123;&#x27;item_info&#x27;: item_info&#125;, callback=self.parse_api)</span><br><span class="line"></span><br><span class="line">    def parse_api(self, response: HtmlResponse):</span><br><span class="line">        data = response.json()</span><br><span class="line">        item_info = response.meta.get(&quot;item_info&quot;, &quot;&quot;)</span><br><span class="line">        # æ³¨æ„ item ä¸­å’Œè¿™é‡Œå®šä¹‰å­—æ®µçš„å¤§å°å†™ï¼ŒåŒºåˆ†å¤§å°å†™ï¼</span><br><span class="line">        item_info.add_value(&quot;commentcount&quot;, data.get(&quot;CommentCount&quot;, 0))  # è¯„è®ºæ•°</span><br><span class="line">        item_info.add_value(&quot;totalview&quot;, data.get(&quot;TotalView&quot;, 0))  # é˜…è¯»é‡</span><br><span class="line">        item_info.add_value(&quot;diggcount&quot;, data.get(&quot;DiggCount&quot;, 0))  # æ¨èæ•°é‡</span><br><span class="line">        item_info.add_value(&quot;burycount&quot;, data.get(&quot;BuryCount&quot;, 0))  # ä¸æ¨èæ•°é‡</span><br><span class="line"></span><br><span class="line">        # å®ŒæˆåŠ è½½å¹¶ç”Ÿæˆ Item å¯¹è±¡</span><br><span class="line">        yield item_info.load_item()</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    cmdline.execute(&quot;scrapy crawl cnblogs&quot;.split())</span><br></pre></td></tr></table></figure>

<h3 id="2-extend-ip-py"><a href="#2-extend-ip-py" class="headerlink" title="2. extend_ip.py"></a>2. extend_ip.py</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">import threading</span><br><span class="line">import requests</span><br><span class="line">from scrapy import signals</span><br><span class="line"></span><br><span class="line"># æå–ä»£ç†IPçš„apiï¼Œä¸€æ¬¡æå–10ä¸ªï¼ˆç”Ÿæˆé“¾æ¥ï¼šhttps://www.kuaidaili.com/dps/genapiurl/ï¼‰</span><br><span class="line">api_url = &#x27;https://dps.kdlapi.com/api/getdps/?secret_id=o88cwu0sh49ls75kntwt&amp;num=1&amp;signature=dtb4yamicu504fub6llgx7mjabckit83&amp;pt=1&amp;format=json&amp;sep=1&#x27;</span><br><span class="line">foo = True</span><br><span class="line"></span><br><span class="line">class Proxy:</span><br><span class="line">    def __init__(self, ):</span><br><span class="line">        self._proxy_list = requests.get(api_url).json().get(&#x27;data&#x27;).get(&#x27;proxy_list&#x27;)</span><br><span class="line"></span><br><span class="line">    @property  # p.proxy_listï¼šè‡ªåŠ¨æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œå¹¶è·å–æ–¹æ³•çš„è¿”å›å€¼</span><br><span class="line">    def proxy_list(self):</span><br><span class="line">        return self._proxy_list</span><br><span class="line"></span><br><span class="line">    @proxy_list.setter  # p.proxy_list=&#x27;abc&#x27;ï¼šè‡ªåŠ¨æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œå¹¶å°†&#x27;abc&#x27;èµ‹å€¼ç»™listå‚æ•°</span><br><span class="line">    def proxy_list(self, list):</span><br><span class="line">        self._proxy_list = list</span><br><span class="line"></span><br><span class="line">pro = Proxy()</span><br><span class="line"></span><br><span class="line">class MyExtend:</span><br><span class="line">    def __init__(self, crawler):</span><br><span class="line">        self.crawler = crawler</span><br><span class="line">        # å°†è‡ªå®šä¹‰æ–¹æ³•ç»‘å®šåˆ°scrapyä¿¡å·ä¸Šï¼Œä½¿ç¨‹åºä¸spiderå¼•æ“åŒæ­¥å¯åŠ¨ä¸å…³é—­</span><br><span class="line">        crawler.signals.connect(self.start, signals.engine_started)</span><br><span class="line">        crawler.signals.connect(self.close, signals.spider_closed)</span><br><span class="line"></span><br><span class="line">    @classmethod</span><br><span class="line">    def from_crawler(cls, crawler):</span><br><span class="line">        return cls(crawler)</span><br><span class="line"></span><br><span class="line">    def start(self):</span><br><span class="line">        t = threading.Thread(target=self.extract_proxy)</span><br><span class="line">        t.start()</span><br><span class="line"></span><br><span class="line">    def extract_proxy(self):</span><br><span class="line">        while foo:</span><br><span class="line">            pro.proxy_list = requests.get(api_url).json().get(&#x27;data&#x27;).get(&#x27;proxy_list&#x27;)</span><br><span class="line">            # è®¾ç½®æ¯ä¸€åˆ†é’Ÿæå–ä¸€æ¬¡ipï¼Œæ›´æ–°proxy_liståˆ—è¡¨ä¸­çš„ipï¼Œä¿è¯éƒ½æ˜¯æœ‰æ•ˆip</span><br><span class="line">            time.sleep(60)</span><br><span class="line"></span><br><span class="line">    def close(self):</span><br><span class="line">        global foo</span><br><span class="line">        foo = False</span><br></pre></td></tr></table></figure>

<h3 id="3-middlewares-py"><a href="#3-middlewares-py" class="headerlink" title="3. middlewares.py"></a>3. middlewares.py</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">from scrapy import signals</span><br><span class="line">import random</span><br><span class="line">from .extend_ip import pro</span><br><span class="line">from scrapy.http import HtmlResponse</span><br><span class="line"></span><br><span class="line">class IpDownloaderMiddleware:</span><br><span class="line">    def process_request(self, request, spider):</span><br><span class="line">        username = &quot;d4550779926&quot;</span><br><span class="line">        password = &quot;kzsel6pa&quot;</span><br><span class="line">        # å¦‚æœå½“å‰ipä¸å¯ç”¨ï¼Œé‚£ä¹ˆprocess_responseé‡è¯•ï¼Œè¿™é‡Œä¼šåœ¨ä»£ç†æ± ä¸­é‡æ–°é€‰æ‹©ä¸€ä¸ªä»£ç†ip</span><br><span class="line">        proxy = random.choice(pro.proxy_list)</span><br><span class="line">        request.meta[&#x27;proxy&#x27;] = f&quot;http://&#123;username&#125;:&#123;password&#125;@&#123;proxy&#125;/&quot;</span><br><span class="line">        return None</span><br><span class="line"></span><br><span class="line">    def process_response(self, request, response: HtmlResponse, spider):</span><br><span class="line">        if not response.status == 200:</span><br><span class="line">            request.dont_filter = True</span><br><span class="line">            return request</span><br><span class="line">        return response</span><br></pre></td></tr></table></figure>

<h3 id="4-items-py"><a href="#4-items-py" class="headerlink" title="4. items.py"></a>4. items.py</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">import scrapy</span><br><span class="line">from itemloaders.processors import TakeFirst, Identity, Join, Compose, MapCompose</span><br><span class="line">from scrapy.loader import ItemLoader</span><br><span class="line"></span><br><span class="line">def date_convert(date):</span><br><span class="line">    # è¿™é‡Œå¤„ç†å­—æ®µä¸€å®šä¸èƒ½åªå¤„ç†ä¸å¯¹çš„ï¼Œè¦å°†æ­£ç¡®çš„ä¹Ÿreturnå›å»</span><br><span class="line">    return &quot;1970-07-01&quot; if not date else date</span><br><span class="line">    </span><br><span class="line">class DefaultItemLoader(ItemLoader):</span><br><span class="line">    # é…ç½®é»˜è®¤çš„è¾“å‡ºå­—æ®µæ ¼å¼ï¼Œå› ä¸ºåœ¨è·å–æ•°æ®æ—¶ï¼Œadd_xpathæ–¹æ³•è·å–çš„éƒ½æ˜¯åˆ—è¡¨</span><br><span class="line">    default_output_processor = TakeFirst()  # å–å‡ºåˆ—è¡¨ç¬¬ä¸€ä¸ªéç©ºå€¼</span><br><span class="line"></span><br><span class="line">class CnblogsArticleItem(scrapy.Item):</span><br><span class="line">    title = scrapy.Field()</span><br><span class="line">    create_date = scrapy.Field(</span><br><span class="line">        # å¸¸é…åˆspiderä¸­çš„add_valueè¿›è¡Œå¤„ç†å™¨è°ƒç”¨ï¼Œç”¨äºåœ¨å°†æ•°æ®å¡«å……åˆ°ItemLoaderä¹‹å‰å¯¹å…¶è¿›è¡Œå¤„ç†</span><br><span class="line">        input_processor=Compose(date_convert)  # å¦‚æœè·å–çš„æ—¥æœŸä¸ºç©ºï¼Œåˆ™èµ‹å€¼&quot;1970-07-01&quot;</span><br><span class="line">    )</span><br><span class="line">    tags = scrapy.Field(</span><br><span class="line">        # ç”±äºæ ‡ç­¾tagsä¸æ­¢ä¸€ä¸ªï¼Œè€ŒTakeFirst()åªå–ç¬¬ä¸€ä¸ªï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨Joinå°†å¤šä¸ªæ‹¼æ¥ä¸ºå­—ç¬¦ä¸²</span><br><span class="line">        output_processor=Join(&quot;,&quot;)</span><br><span class="line">    )</span><br><span class="line">    url = scrapy.Field()</span><br><span class="line">    url_md5_id = scrapy.Field()</span><br><span class="line"></span><br><span class="line">    front_image_url = scrapy.Field(</span><br><span class="line">        # å›¾ç‰‡ä¸‹è½½å­—æ®µçš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­åŒ…å«æ­£ç¡®çš„å›¾ç‰‡urlåœ°å€</span><br><span class="line">        # DefaultItemLoaderå°†å›¾ç‰‡å­—æ®µè¾“å‡ºä¸ºäº†å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦è¾“å‡ºåŸå§‹æ•°æ®ï¼Œå³åˆ—è¡¨</span><br><span class="line">        output_processor=Identity()</span><br><span class="line">    )</span><br><span class="line">    front_image_path = scrapy.Field()</span><br><span class="line"></span><br><span class="line">    commentcount = scrapy.Field()</span><br><span class="line">    totalview = scrapy.Field()</span><br><span class="line">    diggcount = scrapy.Field()</span><br><span class="line">    burycount = scrapy.Field()</span><br></pre></td></tr></table></figure>

<h3 id="5-piplines-py"><a href="#5-piplines-py" class="headerlink" title="5. piplines.py"></a>5. piplines.py</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">import scrapy</span><br><span class="line">import json</span><br><span class="line">from scrapy.exporters import JsonLinesItemExporter</span><br><span class="line">from scrapy.pipelines.images import ImagesPipeline</span><br><span class="line">from twisted.enterprise import adbapi</span><br><span class="line">import pymysql.cursors</span><br><span class="line"></span><br><span class="line"># è‡ªå®šä¹‰jsonæ•°æ®çš„å¯¼å‡ºæ¨¡å¼ï¼Œæ‰€æœ‰çš„iteméƒ½ä¼šåœ¨å†…å­˜ä¸­è¢«å¤„ç†å¹¶æœ€ç»ˆå†™å…¥æ–‡ä»¶ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æ¶ˆè€—è¾ƒé«˜</span><br><span class="line">class JsonExporterPipeline:</span><br><span class="line">    &quot;&quot;&quot;å…³äºåˆå§‹åŒ–æ–‡ä»¶å¯¹è±¡çš„é—®é¢˜ï¼š</span><br><span class="line">    1ã€å¦‚æœæƒ³è¦åœ¨çˆ¬è™«å¯åŠ¨æ—¶åˆ›å»ºæ–‡ä»¶ï¼Œåœ¨å…³é—­æ—¶å…³é—­æ–‡ä»¶ï¼Œä½¿ç”¨ open_spider å’Œ close_spider æ˜¯å¾ˆå¥½çš„é€‰æ‹©</span><br><span class="line">    2ã€å¦‚æœæƒ³è¦åœ¨æ•´ä¸ªçˆ¬è™«è¿è¡ŒæœŸé—´ä¿æŒæ–‡ä»¶æ‰“å¼€çŠ¶æ€ï¼Œé‚£ä¹ˆä½¿ç”¨ __init__ å’Œ spider_closed çš„å†™æ³•ä¹Ÿæ˜¯å¯ä»¥çš„</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def process_item(self, item, spider):</span><br><span class="line">        if spider.name == &quot;cnblogs&quot;:</span><br><span class="line">            # ä¸ºäº†ç¡®ä¿ä½¿æ•´ä¸ªæ–‡ä»¶æˆä¸ºä¸€ä¸ª JSON æ•°ç»„ï¼Œæ–¹ä¾¿åç»­è°ƒç”¨ï¼Œåªéœ€åŠ ä¸Šæ¢è¡Œå³å¯è‡ªåŠ¨ç”Ÿæˆ</span><br><span class="line">            self.fp.write(json.dumps(dict(item), ensure_ascii=False) + &quot;,\n&quot;)</span><br><span class="line">            return item</span><br><span class="line"></span><br><span class="line">    def open_spider(self, spider):</span><br><span class="line">        if spider.name == &quot;cnblogs&quot;:</span><br><span class="line">            # ä½¿ç”¨é»˜è®¤çš„ JSON ç¼–ç å™¨æ— æ³•å¤„ç†è‡ªå®šä¹‰å¯¹è±¡ï¼Œæ— æ³•å°† Item å¯¹è±¡è½¬æ¢ä¸ºå­—å…¸</span><br><span class="line">            self.fp = open(&quot;article1.json&quot;, &quot;w&quot;, encoding=&#x27;utf-8&#x27;)</span><br><span class="line">            self.fp.write(&quot;[\n&quot;)</span><br><span class="line"></span><br><span class="line">    def close_spider(self, spider):</span><br><span class="line">        if spider.name == &quot;cnblogs&quot;:</span><br><span class="line">            self.fp.write(&quot;]\n&quot;)</span><br><span class="line">            self.fp.close()</span><br><span class="line"></span><br><span class="line"># Scrapyå®˜æ–¹çš„jsonæ•°æ®å¯¼å‡ºæ¨¡å¼ï¼Œæ¯æ¬¡parseå‡½æ•°yieldçš„itemç»è¿‡å¤„ç†ç›´æ¥å†™å…¥jsonæ–‡ä»¶ï¼Œä¸å å†…å­˜</span><br><span class="line">class ScrapyJsonExporterPipeline:</span><br><span class="line">    def __init__(self):</span><br><span class="line">        # ä»¥äºŒè¿›åˆ¶æ¨¡å¼æ‰“å¼€æ–‡ä»¶æ—¶ä¸åº”è¯¥æŒ‡å®šç¼–ç å‚æ•°ï¼Œå› ä¸ºæ–‡ä»¶æ˜¯ä»¥å­—èŠ‚å½¢å¼è¯»å–å’Œå†™å…¥çš„ï¼Œè€Œä¸æ˜¯å­—ç¬¦</span><br><span class="line">        self.fp = open(&quot;article2.json&quot;, &quot;wb&quot;)</span><br><span class="line">        self.exporter = JsonLinesItemExporter(self.fp, encoding=&quot;utf-8&quot;, ensure_ascii=False)</span><br><span class="line">        self.exporter.start_exporting()</span><br><span class="line">        self.fp.write(b&quot;[&quot;)</span><br><span class="line"></span><br><span class="line">    def process_item(self, item, spider):</span><br><span class="line">        # æ³¨æ„ï¼šexport_itemæ–¹æ³•ä¸­åªæ¥å—å­—èŠ‚æ•°æ®ï¼Œæ‰€ä»¥ä¸Šé¢æ–‡ä»¶åº”è¯¥ä»¥äºŒè¿›åˆ¶æ¨¡å¼wbæ‰“å¼€</span><br><span class="line">        self.exporter.export_item(item)</span><br><span class="line">        self.fp.write(b&quot;,&quot;)</span><br><span class="line">        return item</span><br><span class="line"></span><br><span class="line">    def close_spider(self, spider):</span><br><span class="line">        self.exporter.finish_exporting()</span><br><span class="line">        self.fp.write(b&quot;]&quot;)</span><br><span class="line">        self.fp.close()</span><br><span class="line"></span><br><span class="line"># è‡ªå®šä¹‰ä¸‹è½½å›¾ç‰‡ç®¡é“ï¼Œéå†ä¸‹è½½ç»“æœï¼Œè·å–å›¾ç‰‡ä¿å­˜çš„è·¯å¾„å¹¶æ·»åŠ åˆ°itemä¸­ï¼Œæœ€åè¿”å›å¤„ç†åçš„item</span><br><span class="line">class MyImagesPipeline(ImagesPipeline):</span><br><span class="line">    def item_completed(self, results, item, info):</span><br><span class="line">        if &#x27;front_image_url&#x27; in item:</span><br><span class="line">            for ok, value in results:</span><br><span class="line">                front_image_path = value[&#x27;path&#x27;]</span><br><span class="line">                item[&#x27;front_image_path&#x27;] = front_image_path</span><br><span class="line">        return item</span><br><span class="line"></span><br><span class="line"># è‡ªå®šä¹‰å¼‚æ­¥mysqlå­˜å‚¨ç®¡é“</span><br><span class="line">class MysqlTwistedPipeline:</span><br><span class="line">    def __init__(self, dbpool):</span><br><span class="line">        self.dbpool = dbpool</span><br><span class="line"></span><br><span class="line">    @classmethod</span><br><span class="line">    def from_settings(cls, settings):</span><br><span class="line">        dbparms = dict(</span><br><span class="line">            host=settings[&quot;MYSQL_HOST&quot;],</span><br><span class="line">            db=settings[&quot;MYSQL_DBNAME&quot;],</span><br><span class="line">            user=settings[&quot;MYSQL_USER&quot;],</span><br><span class="line">            passwd=settings[&quot;MYSQL_PASSWORD&quot;],</span><br><span class="line">            charset=&quot;utf8&quot;,  # å­—ç¬¦é›†å¿…é¡»æ˜¯utf8æ›´è§„èŒƒï¼Œutf-8ä¼šæŠ¥é”™</span><br><span class="line">            cursorclass=pymysql.cursors.DictCursor,  # æŒ‡å®šäº†åœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶è¿”å›çš„ç»“æœé›†çš„æ¸¸æ ‡ç±»å‹</span><br><span class="line">            use_unicode=True,  # ä½¿ç”¨Unicodeç¼–ç ï¼Œæ›´å¥½åœ°æ”¯æŒåŒ…å«éASCIIå­—ç¬¦çš„æ•°æ®</span><br><span class="line">        )</span><br><span class="line">        dbpool = adbapi.ConnectionPool(&#x27;pymysql&#x27;, **dbparms)</span><br><span class="line"></span><br><span class="line">        # åœ¨åˆ›å»ºè¿æ¥æ± çš„æ—¶å€™å¼‚æ­¥æ‰§è¡Œåˆ›å»ºè¡¨çš„é€»è¾‘</span><br><span class="line">        cls.create_table(dbpool)</span><br><span class="line"></span><br><span class="line">        return cls(dbpool)</span><br><span class="line"></span><br><span class="line">    @classmethod</span><br><span class="line">    def create_table(cls, dbpool):</span><br><span class="line">        sql = &quot;&quot;&quot;</span><br><span class="line">            create table if not exists cnblogs_news(</span><br><span class="line">                url_md5_id char(32) primary key,</span><br><span class="line">                title varchar(255),</span><br><span class="line">                tags varchar(50),</span><br><span class="line">                create_date timestamp,</span><br><span class="line">                url varchar(255),</span><br><span class="line">                front_image_url varchar(255),</span><br><span class="line">                front_image_path varchar(255),</span><br><span class="line">                commentcount int,</span><br><span class="line">                totalview int,</span><br><span class="line">                diggcount int,</span><br><span class="line">                burycount int</span><br><span class="line">            );</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        # å¼‚æ­¥æ–¹å¼æ‰§è¡Œåˆ›å»ºè¡¨çš„sqlè¯­å¥</span><br><span class="line">        dbpool.runInteraction(cls._create_table, sql)</span><br><span class="line"></span><br><span class="line">    @staticmethod</span><br><span class="line">    def _create_table(cursor, sql):</span><br><span class="line">        cursor.execute(sql)</span><br><span class="line"></span><br><span class="line">    def process_item(self, item, spider):</span><br><span class="line">        # å¼‚æ­¥è°ƒç”¨do_insertå‡½æ•°ï¼Œæ‰§è¡Œsqlè¯­å¥ï¼Œå¹¶ä¼ å…¥itemå‚æ•°</span><br><span class="line">        query = self.dbpool.runInteraction(self.do_insert, item)</span><br><span class="line">        # åœ¨runInteractionä¸­æ‰§è¡Œçš„æ“ä½œå‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå›è°ƒhandle_errorå‡½æ•°å¤„ç†å¼‚å¸¸</span><br><span class="line">        query.addErrback(self.handle_error)</span><br><span class="line"></span><br><span class="line">    def do_insert(self, cursor, item):</span><br><span class="line">        &quot;&quot;&quot;æ³¨æ„ï¼šåœ¨æ„é€ sqlè¯­å¥æ—¶ï¼Œæœ€å¥½ä½¿ç”¨å‚æ•°åŒ–å ä½ç¬¦æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ</span><br><span class="line">        è€Œä¸æ˜¯ç›´æ¥åœ¨sqlæŸ¥è¯¢ä¸­æ’å…¥å€¼ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥é¿å…sqlæ³¨å…¥çš„é—®é¢˜ï¼Œå¹¶æ›´å®¹æ˜“å¤„ç†ç‰¹æ®Šå­—ç¬¦</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        # `ON DUPLICATE KEY UPDATE`è¯­æ³•åœ¨æ’å…¥æ•°æ®æ—¶å¦‚æœä¸»é”®å†²çªï¼Œåˆ™æŒ‡å®šä¸€ä¸ªå­—æ®µè¿›è¡Œæ›´æ–°çš„æ“ä½œ</span><br><span class="line">        sql = f&quot;&quot;&quot;</span><br><span class="line">            insert into cnblogs_news values (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s)</span><br><span class="line">            ON DUPLICATE KEY UPDATE totalview=VALUES(totalview);</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        params = [</span><br><span class="line">            item.get(&quot;url_md5_id&quot;, &quot;&quot;),</span><br><span class="line">            item.get(&quot;title&quot;, &quot;&quot;),</span><br><span class="line">            item.get(&quot;tags&quot;, &quot;&quot;),</span><br><span class="line">            item.get(&quot;create_date&quot;, &quot;&quot;),</span><br><span class="line">            item.get(&quot;url&quot;, &quot;&quot;),</span><br><span class="line">            # ä¿è¯è¿›å…¥æ•°æ®åº“çš„æ¯ä¸ªå€¼éƒ½æ˜¯stræˆ–è€…intç±»å‹çš„</span><br><span class="line">            &quot;,&quot;.join(item.get(&quot;front_image_url&quot;, [])),</span><br><span class="line">            item.get(&quot;front_image_path&quot;, &quot;&quot;),</span><br><span class="line">            item.get(&quot;commentcount&quot;, &quot;&quot;),</span><br><span class="line">            item.get(&quot;totalview&quot;, &quot;&quot;),</span><br><span class="line">            item.get(&quot;diggcount&quot;, &quot;&quot;),</span><br><span class="line">            item.get(&quot;burycount&quot;, &quot;&quot;)</span><br><span class="line">        ]</span><br><span class="line">        cursor.execute(sql, params)  # å‚æ•°2æ¥å—åˆ—è¡¨æˆ–å…ƒç»„</span><br><span class="line"></span><br><span class="line">    def handle_error(self, failure):</span><br><span class="line">        print(f&quot;mysqlå¤„ç†é”™è¯¯ï¼š&#123;failure&#125;&quot;)</span><br></pre></td></tr></table></figure>

<h3 id="6-settings-py"><a href="#6-settings-py" class="headerlink" title="6. settings.py"></a>6. settings.py</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line"></span><br><span class="line">BOT_NAME = &quot;bkyuan&quot;</span><br><span class="line"></span><br><span class="line">SPIDER_MODULES = [&quot;bkyuan.spiders&quot;]</span><br><span class="line">NEWSPIDER_MODULE = &quot;bkyuan.spiders&quot;</span><br><span class="line"></span><br><span class="line"># Obey robots.txt rules</span><br><span class="line">ROBOTSTXT_OBEY = False</span><br><span class="line"></span><br><span class="line"># Override the default request headers:</span><br><span class="line">DEFAULT_REQUEST_HEADERS = &#123;</span><br><span class="line">    &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36&#x27;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Enable or disable downloader middlewares</span><br><span class="line"># See https://docs.scrapy.org/en/latest/topics/downloader-middleware.html</span><br><span class="line">DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line">    &quot;bkyuan.middlewares.IpDownloaderMiddleware&quot;: 543,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Enable or disable extensions</span><br><span class="line"># See https://docs.scrapy.org/en/latest/topics/extensions.html</span><br><span class="line">EXTENSIONS = &#123;</span><br><span class="line">    &quot;bkyuan.extend_ip.MyExtend&quot;: 300,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Configure item pipelines</span><br><span class="line"># See https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span><br><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">    &quot;bkyuan.pipelines.JsonExporterPipeline&quot;: 300,</span><br><span class="line">    &quot;bkyuan.pipelines.ScrapyJsonExporterPipeline&quot;: 301,</span><br><span class="line">    # &quot;scrapy.pipelines.images.ImagesPipeline&quot;: 1,  # ä½¿ç”¨scrapyé»˜è®¤çš„ä¸‹è½½å›¾ç‰‡pipelineï¼Œä¼˜å…ˆçº§ä¸º1</span><br><span class="line">    &quot;bkyuan.pipelines.MyImagesPipeline&quot;: 1,</span><br><span class="line">    &quot;bkyuan.pipelines.MysqlTwistedPipeline&quot;: 302,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Set settings whose default value is deprecated to a future-proof value</span><br><span class="line">REQUEST_FINGERPRINTER_IMPLEMENTATION = &quot;2.7&quot;</span><br><span class="line">TWISTED_REACTOR = &quot;twisted.internet.asyncioreactor.AsyncioSelectorReactor&quot;</span><br><span class="line">FEED_EXPORT_ENCODING = &quot;utf-8&quot;</span><br><span class="line"></span><br><span class="line"># å¤„ç†å›¾åƒä¸‹è½½çš„è®¾ç½®å­—æ®µ</span><br><span class="line">IMAGES_URLS_FIELD = &#x27;front_image_url&#x27;  # ç”¨äºæŒ‡å®š Item å¯¹è±¡ä¸­åŒ…å«å›¾åƒ URL çš„å­—æ®µåç§°</span><br><span class="line"># å¦‚æœè·¯å¾„ä»¥æ–œæ /å¼€å¤´ï¼Œå°±æ˜¯ç»å¯¹è·¯å¾„ï¼›æ²¡æœ‰ä»¥æ–œæ å¼€å¤´ï¼Œå°±æ˜¯ç›¸å¯¹äºå½“å‰å·¥ä½œç›®å½•çš„ç›¸å¯¹è·¯å¾„</span><br><span class="line">IMAGES_STORE = os.path.dirname(os.getcwd()) + &#x27;/images/&#x27;</span><br><span class="line"></span><br><span class="line"># MySQLç›¸å…³é…ç½®</span><br><span class="line">MYSQL_HOST = &quot;127.0.0.1&quot;</span><br><span class="line">MYSQL_USER = &quot;root&quot;</span><br><span class="line">MYSQL_PASSWORD = &quot;123456&quot;</span><br><span class="line">MYSQL_DBNAME = &quot;py_spider&quot;</span><br></pre></td></tr></table></figure>

<h2 id="å…«ã€Scrapy-Rediså¢é‡çˆ¬è™«"><a href="#å…«ã€Scrapy-Rediså¢é‡çˆ¬è™«" class="headerlink" title="å…«ã€Scrapy_Rediså¢é‡çˆ¬è™«"></a>å…«ã€Scrapy_Rediså¢é‡çˆ¬è™«</h2><blockquote>
<p><strong>å¼•å…¥ï¼š</strong>å‰é¢æ‰€æåˆ°çš„<code>scrapyçš„æ–­ç‚¹ç»­çˆ¬</code>å’Œ<code>è¯·æ±‚urlåœ°å€å»é‡</code>å°±æ˜¯åœ¨åŸç”Ÿå®ç°å¢é‡çˆ¬è™«ï¼Œè™½ç„¶æœ‰æ•ˆï¼Œä½†å´æ— æ³•ä»<code>JOBDIR</code>æŒ‡å®šçš„è·¯å¾„ä¸­çœ‹åˆ°çˆ¬å–çš„æƒ…å†µï¼Œè€Œ <strong>scrapy_redis</strong> åˆ™æ˜¯å°†ä¸¤è€…èåˆå¹¶å®Œç¾å®ç°ï¼Œä¸ä»…å¯ä»¥ä»¥åŒæ ·çš„æ–¹å¼ <strong>ctrl+c</strong> å®ç°æš‚åœï¼Œä»¥å¯åŠ¨å‘½ä»¤å®ç°æ–­ç‚¹ç»­çˆ¬ï¼Œè¿˜å¯ä»¥åœ¨redisæ•°æ®åº“ä¸­é€šè¿‡ <strong>dupfilter</strong> å’Œ <strong>requests</strong> å­—æ®µå¾—çŸ¥çˆ¬å–æƒ…å†µï¼Œå…¶ä¸­<strong>dupfilterå¯¹åº”å·²çˆ¬å–çš„æŒ‡çº¹</strong>ï¼Œè€Œ<strong>requestså¯¹åº”è¿˜æ²¡çˆ¬å–çš„</strong>ï¼Œä»¥å®ç°å¢é‡çˆ¬è™«</p>
<p><strong>ä»€ä¹ˆæ˜¯å¢é‡çˆ¬è™«ï¼Ÿ</strong></p>
<p>åœ¨Scrapyä¸­ï¼Œå¢é‡çˆ¬è™«ï¼ˆIncremental Crawlingï¼‰æ˜¯æŒ‡åªçˆ¬å–è‡ªä¸Šæ¬¡çˆ¬å–ä»¥æ¥å‘ç”Ÿå˜åŒ–çš„æ•°æ®ï¼Œè€Œä¸æ˜¯é‡æ–°çˆ¬å–æ•´ä¸ªç½‘ç«™æˆ–æ•°æ®é›†ã€‚è¿™æ ·å¯ä»¥èŠ‚çœæ—¶é—´å’Œèµ„æºï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§è§„æ¨¡çš„ç½‘ç«™æˆ–æ•°æ®é›†æ—¶</p>
<p><strong>scrapy_redis æ‰©å±•ï¼š</strong>scrapy_rediså…è®¸åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ä½¿ç”¨Scrapyï¼Œå¹¶ä¸”å¯ä»¥å•ç‹¬åˆ©ç”¨æ­¤æ’ä»¶å®ç°å¢é‡çˆ¬è™«ï¼Œé€šè¿‡åœ¨Redisä¸­å­˜å‚¨çˆ¬å–çŠ¶æ€æ¥é¿å…é‡å¤çˆ¬å–ç›¸åŒçš„æ•°æ®</p>
<p><strong>æ³¨æ„ï¼šä½¿ç”¨scrapy-redisä¹‹å‰æœ€å¥½å°†scrapyç‰ˆæœ¬ä¿æŒåœ¨2.8.0ç‰ˆæœ¬ï¼Œä»¥å…æœ‰å…¼å®¹æ€§é—®é¢˜</strong></p>
<ul>
<li><strong><code>pip install scrapy==2.8.0</code></strong></li>
<li><strong><code>pip install scrapy-redis</code></strong></li>
</ul>
</blockquote>
<ul>
<li><strong>å¢é‡çˆ¬è™« settings.py æ–‡ä»¶æ–°å¢é…ç½®ï¼š</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot; scrapy-redisé…ç½® &quot;&quot;&quot;</span><br><span class="line"># ï¼ˆä½¿ç”¨ scrapy_redis è°ƒåº¦å™¨ï¼‰æŒ‡å®šç”¨äºç®¡ç†è¯·æ±‚è°ƒåº¦çš„ç±»</span><br><span class="line">SCHEDULER = &quot;scrapy_redis.scheduler.Scheduler&quot;</span><br><span class="line"># ï¼ˆä½¿ç”¨ scrapy_redis å»é‡å™¨ï¼‰æŒ‡å®šç”¨äºç®¡ç†é‡å¤è¯·æ±‚çš„ç±»</span><br><span class="line">DUPEFILTER_CLASS = &quot;scrapy_redis.dupefilter.RFPDupeFilter&quot;</span><br><span class="line">&quot;&quot;&quot;å¯ä»¥æ›¿æ¢æˆå¸ƒéš†è¿‡æ»¤å™¨ï¼š</span><br><span class="line">pip install scrapy-redis-bloomfilter</span><br><span class="line">from scrapy_redis_bloomfilter.dupefilter import RFPDupeFilter</span><br><span class="line">DUPEFILTER_CLASS = &#x27;scrapy_redis_bloomfilter.dupefilter.RFPDupeFilter&#x27;</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"># ï¼ˆè°ƒåº¦å™¨æŒä¹…åŒ–ï¼‰æ˜¯å¦åœ¨å…³é—­æ—¶å€™ä¿ç•™åŸæ¥çš„è°ƒåº¦å™¨å’Œå»é‡è®°å½•ï¼ŒTrue=ä¿ç•™ï¼ŒFalse=æ¸…ç©º</span><br><span class="line">SCHEDULER_PERSIST = True</span><br><span class="line"># ï¼ˆè®¾ç½® redis è¿æ¥ä¿¡æ¯ï¼‰è¿™é‡Œè¡¨ç¤º Redis è¿è¡Œåœ¨æœ¬åœ°æœºå™¨ä¸Šï¼Œä½¿ç”¨é»˜è®¤ç«¯å£ 6379 å’Œæ•°æ®åº“0</span><br><span class="line">REDIS_URL = &quot;redis://127.0.0.1:6379/0&quot;</span><br><span class="line"></span><br><span class="line"># ï¼ˆè°ƒåº¦å™¨é˜Ÿåˆ—ç±»ï¼‰æŒ‡å®šç”¨äºç®¡ç†ä¼˜å…ˆçº§é˜Ÿåˆ—çš„ç±»</span><br><span class="line">SCHEDULER_QUEUE_CLASS = &#x27;scrapy_redis.queue.PriorityQueue&#x27;  # ï¼ˆä¼˜å…ˆçº§é˜Ÿåˆ—ï¼‰</span><br><span class="line"># SCHEDULER_QUEUE_CLASS = &#x27;scrapy_redis.queue.FifoQueue&#x27;  # ï¼ˆå…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼‰</span><br><span class="line"># SCHEDULER_QUEUE_CLASS = &#x27;scrapy_redis.queue.LifoQueue&#x27;  # ï¼ˆå…ˆè¿›åå‡º/åè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼‰</span><br><span class="line"></span><br><span class="line"># ï¼ˆå¯åŠ¨æ—¶æ¸…ç©ºè°ƒåº¦å™¨ï¼‰é»˜è®¤ä¸ºFalseï¼ŒTrueè¡¨ç¤ºè°ƒåº¦å™¨å°†åœ¨å¯åŠ¨æ—¶æ¸…ç©ºæ‰€æœ‰å¾…å¤„ç†çš„è¯·æ±‚å’Œå»é‡è¿‡æ»¤å™¨ï¼Œä¸€èˆ¬ä¸é…ç½®</span><br><span class="line"># SCHEDULER_FLUSH_ON_START = True</span><br></pre></td></tr></table></figure>

<h2 id="ä¹ã€Scrapy-Redisåˆ†å¸ƒå¼çˆ¬è™«"><a href="#ä¹ã€Scrapy-Redisåˆ†å¸ƒå¼çˆ¬è™«" class="headerlink" title="ä¹ã€Scrapy_Redisåˆ†å¸ƒå¼çˆ¬è™«"></a>ä¹ã€Scrapy_Redisåˆ†å¸ƒå¼çˆ¬è™«</h2><blockquote>
<p>**æ³¨æ„ï¼šå­¦ä¹ ä½¿ç”¨ ubuntu-18.04.6 ç‰ˆæœ¬è™šæ‹Ÿæœºæ¨¡æ‹Ÿå®ç°åˆ†å¸ƒå¼çˆ¬è™«ï¼ˆ<a class="link"   href="https://xfblog.cn/2023/11/01/%E7%88%AC%E8%99%AB_3_Ubuntu%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"  target="_blank" rel="noopener">ubuntu-18.04.6å®‰è£…é…ç½®<i class="fas fa-external-link-alt"></i></a>**ï¼‰</p>
<p><strong>å¼•å…¥ï¼šä¸ºä»€ä¹ˆè¦ä½¿ç”¨ scrapy_redis åšåˆ†å¸ƒå¼çˆ¬è™«ï¼Ÿ</strong></p>
<ul>
<li>åœ¨å•æœºçˆ¬è™«ä¸­ï¼Œæ‰€æœ‰è¯·æ±‚å¯¹è±¡ requests éƒ½æ˜¯ç›´æ¥å­˜æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œé™¤ä¸»æœºå¤–çš„å…¶ä»–ç”µè„‘æ˜¯ä¸å¯èƒ½è®¿é—®åˆ°ä¸»æœºçš„å†…å­˜çš„ï¼Œæ‰€ä»¥å€ŸåŠ© scrapy_redis å°†åŸæœ¬å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ•°æ®æ”¾åˆ°äº† Redis é˜Ÿåˆ—ä¸­ï¼Œåˆ©ç”¨ Redis é«˜æ•ˆå’Œæ”¯æŒç½‘ç»œè®¿é—®çš„ç‰¹æ€§ï¼Œä¾¿å¯ä»¥å®ç°å¤šå°ç”µè„‘è¯»å–åŒä¸€ä¸ª Redis é˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼Œä»è€Œå®ç°åˆ†å¸ƒå¼çˆ¬è™«</li>
</ul>
</blockquote>
<h3 id="1-scrapy-rediså·¥ä½œæµç¨‹"><a href="#1-scrapy-rediså·¥ä½œæµç¨‹" class="headerlink" title="1. scrapy_rediså·¥ä½œæµç¨‹"></a>1. scrapy_rediså·¥ä½œæµç¨‹</h3><ul>
<li><strong>scrapy_redisçš„å®ç°åŸç†ï¼š</strong><ul>
<li><strong>æ›¿æ¢è°ƒåº¦å™¨å’Œå»é‡å™¨ï¼š</strong>scrapy_redis æ›¿æ¢äº† Scrapy æ¡†æ¶ä¸­çš„é»˜è®¤è°ƒåº¦å™¨å’Œå»é‡å™¨ï¼Œå°† Redis ä½œä¸ºä¸­å¿ƒåŒ–çš„ä»»åŠ¡è°ƒåº¦å’Œå»é‡çš„æ•°æ®å­˜å‚¨</li>
<li><strong>ä»»åŠ¡é˜Ÿåˆ—çš„ä½¿ç”¨ï¼š</strong>scrapy_redis ä½¿ç”¨ Redis æ•°æ®åº“ä½œä¸ºä»»åŠ¡é˜Ÿåˆ—ï¼Œå°†çˆ¬è™«éœ€è¦çˆ¬å–çš„ URL å­˜å‚¨åœ¨ Redis çš„åˆ—è¡¨æˆ–è€…é›†åˆä¸­ã€‚æ¯ä¸ªçˆ¬è™«èŠ‚ç‚¹éƒ½å¯ä»¥ä»è¿™ä¸ª Redis é˜Ÿåˆ—ä¸­è·å–å¾…çˆ¬å–çš„ URLï¼Œå®ç°äº†ä»»åŠ¡çš„åˆ†å‘</li>
<li><strong>åˆ†å¸ƒå¼å»é‡ï¼š</strong>scrapy_redis é€šè¿‡ä½¿ç”¨ Redis æ•°æ®ç»“æ„çš„å»é‡ç‰¹æ€§ï¼Œå³ <code>RFPDupeFilter</code>ï¼Œæ¥å®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„ URL å»é‡ã€‚å½“ä¸€ä¸ª URL è¢«åŠ å…¥åˆ° Redis ä¸­æ—¶ï¼Œç³»ç»Ÿä¼šæ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨äº Redis ä¸­ï¼Œä»¥å®ç°å»é‡</li>
<li><strong>ä»»åŠ¡è°ƒåº¦å’Œåˆ†é…ï¼š</strong>scrapy_redis çš„è°ƒåº¦å™¨è´Ÿè´£ä» Redis é˜Ÿåˆ—ä¸­è·å–å¾…çˆ¬å–çš„ URLï¼Œå¹¶å°†å…¶åˆ†é…ç»™ä¸åŒçš„çˆ¬è™«èŠ‚ç‚¹ã€‚è¿™æ ·ï¼Œä¸åŒçš„èŠ‚ç‚¹å¯ä»¥å¹¶è¡Œåœ°çˆ¬å–ä¸åŒçš„ URLï¼Œæé«˜äº†æ•´ä¸ªç³»ç»Ÿçš„æ•ˆç‡</li>
</ul>
</li>
<li><strong>scrapy_redisçš„å·¥ä½œæµç¨‹ï¼š</strong><ol>
<li>åœ¨scrapy_redisä¸­ï¼Œæ‰€æœ‰å¾…æŠ“å–çš„ request å¯¹è±¡å’Œå»é‡çš„ request å¯¹è±¡æŒ‡çº¹éƒ½å­˜åœ¨å…±ç”¨çš„ redis é˜Ÿåˆ—ä¸­</li>
<li>æ‰€æœ‰çš„æœåŠ¡å™¨ä¸­çš„ scrapy è¿›ç¨‹å…±ç”¨åŒä¸€ä¸ª redis ä¸­çš„ request å¯¹è±¡çš„é˜Ÿåˆ—</li>
<li>æ‰€æœ‰çš„ request å¯¹è±¡å­˜å…¥ redis å‰ï¼Œéƒ½ä¼šé€šè¿‡ redis ä¸­çš„ request æŒ‡çº¹é›†åˆè¿›è¡Œåˆ¤æ–­æ˜¯å¦å­˜å…¥è¿‡ï¼ˆå»é‡ï¼‰</li>
</ol>
</li>
</ul>
<img    
                       lazyload
                       alt="image"
                       data-src="https://xfblog.cn/images/1703165509-14b9d3416aa3a54.png"
                         style="width:80%;margin:0 auto;"
                 >

<h3 id="2-RedisPipelineçš„ä½¿ç”¨"><a href="#2-RedisPipelineçš„ä½¿ç”¨" class="headerlink" title="2. RedisPipelineçš„ä½¿ç”¨"></a>2. RedisPipelineçš„ä½¿ç”¨</h3><blockquote>
<p><strong>å¼€å¯RedisPipelineç®¡é“ï¼š<code>&quot;scrapy_redis.pipelines.RedisPipeline&quot;: 301</code>ï¼ˆå°†æ‰€æœ‰æ•°æ®å­˜å…¥redisä¸­ï¼‰</strong></p>
</blockquote>
<ul>
<li><p><strong>å…³äºæ•°æ®å­˜å‚¨é—®é¢˜ï¼š</strong>åˆ†å¸ƒå¼çˆ¬è™«ä¸­ï¼Œæ¯ä¸€å°ç”µè„‘ä¸Šåªå­˜å‚¨è¿™å°ç”µè„‘æ‰€çˆ¬å–çš„æ•°æ®ï¼Œä¸å…¶ä»–è®¾å¤‡æ‰€çˆ¬å–çš„æ•°æ®äº’ä¸ç›¸é€šä¹Ÿä¸é‡å¤ï¼Œæ‰€ä»¥è§£å†³æ•°æ®ç»Ÿä¸€å­˜å‚¨ä¾¿æˆä¸ºé—®é¢˜ã€‚<strong>å¼€å¯RedisPipelineç®¡é“</strong>ï¼Œé‚£ä¹ˆåˆ™å¯ä»¥å®ç°æ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨Redisæ•°æ®åº“ä¸­ï¼Œä½†å‰ææ˜¯æ‰€æœ‰è®¾å¤‡éƒ½å¼€å¯ï¼Œå¦åˆ™è®¾å¤‡ä¹‹é—´æ•°æ®ä¹Ÿäº’ä¸ç›¸é€š</p>
</li>
<li><p><strong>å…³äºRedisä¸­æ•°æ®çš„é—®é¢˜ï¼š</strong>åœ¨RedisPipelineç®¡é“å­˜å‚¨æ•°æ®æ—¶ï¼Œä¸æ”¯æŒå­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ï¼Œéœ€è¦å°†äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œ Base64 ç¼–ç ï¼Œå¹¶å°†ç»“æœè§£ç ä¸ºå­—ç¬¦ä¸²åå†å­˜å‚¨ï¼ˆ<strong>æ³¨æ„ï¼šç”±äºåœ¨ä¼ é€’itemæ—¶å°†å›¾ç‰‡æ•°æ®è¿›è¡Œäº† Base64 ç¼–ç ï¼Œé‚£ä¹ˆåœ¨ pipline å…¶ä»–ç®¡é“ä¸­ä¿å­˜æ•°æ®æ—¶ï¼Œå°±ä¸€å®šè¦å°†æ•°æ®è¿›è¡Œ Base64 è§£ç ï¼Œæ‰èƒ½æ­£ç¡®ä¿å­˜</strong>ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># spider.pyï¼šå°†äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œ Base64 ç¼–ç ï¼Œå¹¶å°†ç»“æœè§£ç ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰èƒ½æ­£ç¡®ä¼ é€’</span><br><span class="line">img_data = base64.b64encode(response.body).decode()</span><br><span class="line">yield &#123;</span><br><span class="line">    &quot;type_&quot;: &#x27;image&#x27;,</span><br><span class="line">    &quot;img_name&quot;: title + &#x27;.png&#x27;,</span><br><span class="line">    &quot;img_content&quot;: img_data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># piplines.pyï¼šå°†æ•°æ®è¿›è¡Œ Base64 è§£ç ï¼Œæ‰èƒ½æ­£ç¡®ä¿å­˜</span><br><span class="line">with open(images_path + item[&#x27;img_name&#x27;], &#x27;wb&#x27;) as fp:</span><br><span class="line">    img_data = base64.b64decode(item[&#x27;img_content&#x27;])</span><br><span class="line">    fp.write(img_data)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-å®ç°GETè¯·æ±‚"><a href="#3-å®ç°GETè¯·æ±‚" class="headerlink" title="3. å®ç°GETè¯·æ±‚"></a>3. å®ç°GETè¯·æ±‚</h3><blockquote>
<p><strong>scrapy_redis çš„ä½¿ç”¨æ³¨æ„ï¼š</strong></p>
<ol>
<li><strong>ä¸èƒ½ä½¿ç”¨ start_urls å±æ€§ï¼š</strong>RedisSpider ç±»æ˜¯ä¸ºåˆ†å¸ƒå¼çˆ¬è™«è®¾è®¡çš„ï¼Œå®ƒä½¿ç”¨ Redis ä½œä¸ºä»»åŠ¡é˜Ÿåˆ—ï¼Œæ‰€ä»¥å¦‚æœçˆ¬è™«ç±»ç»§æ‰¿äº† RedisSpider ç±»ï¼Œä¾¿ä¸èƒ½ä½¿ç”¨æ­¤å±æ€§äº†</li>
<li><strong>ä¸èƒ½é‡å†™ start_requests æ–¹æ³•ï¼š</strong>RedisSpider ç±»ä¸ scrapy.Spider ç±»ä¸­çš„ start_requests æ–¹æ³•åº•å±‚å®ç°ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å¦‚æœçˆ¬è™«ç±»ç»§æ‰¿äº† RedisSpider ç±»ï¼Œä¾¿ä¸èƒ½é‡å†™æ­¤æ–¹æ³•äº†</li>
</ol>
</blockquote>
<ul>
<li><p><strong>scrapy_redisé¡¹ç›®é…ç½®ï¼š</strong></p>
<ol>
<li><p><strong>å°†çˆ¬è™«ç±»ç»§æ‰¿è‡ª RedisSpider ç±»ï¼š</strong>å¹¶æŒ‡å®š <strong><code>redis_key</code></strong> å±æ€§ï¼Œå³ä» Redis é˜Ÿåˆ—ä¸­è·å–èµ·å§‹ URL çš„é”®å</p>
</li>
<li><p><strong>æ·»åŠ  scrapy_redis é…ç½®ï¼ˆsettingsæ–‡ä»¶ï¼‰ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot; scrapy-redisé…ç½® &quot;&quot;&quot;</span><br><span class="line"># é…ç½®scrapy_redisè°ƒåº¦å™¨</span><br><span class="line">SCHEDULER = &quot;scrapy_redis.scheduler.Scheduler&quot;</span><br><span class="line"># é…ç½®scrapy_rediså»é‡å™¨</span><br><span class="line">DUPEFILTER_CLASS = &quot;scrapy_redis.dupefilter.RFPDupeFilter&quot;</span><br><span class="line"># è°ƒåº¦å™¨æŒä¹…åŒ–ï¼ŒTrue=ä¿ç•™ï¼ŒFalse=æ¸…ç©º</span><br><span class="line">SCHEDULER_PERSIST = True</span><br><span class="line"># é…ç½®redisè¿æ¥ä¿¡æ¯</span><br><span class="line">REDIS_URL = &quot;redis://127.0.0.1:6379/0&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æ‰§è¡Œä¿å­˜ start_url çš„è„šæœ¬ï¼š</strong>ç”±äº scrapy_redis ä¸å†é€šè¿‡ start_urls å±æ€§è¯»å–èµ·å§‹urlï¼Œè€Œæ˜¯é€šè¿‡ <strong><code>redis_key</code></strong> å±æ€§ä» Redis é˜Ÿåˆ—ä¸­è·å–èµ·å§‹ URL çš„é”®åï¼Œæ‰€ä»¥éœ€è¦å…ˆå°†èµ·å§‹ start_url ä¿å­˜åˆ° Redis ä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import redis</span><br><span class="line"></span><br><span class="line">res = redis.Redis(host=&quot;192.168.64.12&quot;, port=6379)</span><br><span class="line">res.lpush(&#x27;dd_book:start_url&#x27;, &#x27;https://movie.douban.com/top250?start=&#123;&#125;&amp;filter=&#x27;)</span><br><span class="line">res.close()</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h3 id="4-å®ç°POSTè¯·æ±‚"><a href="#4-å®ç°POSTè¯·æ±‚" class="headerlink" title="4. å®ç°POSTè¯·æ±‚"></a>4. å®ç°POSTè¯·æ±‚</h3><blockquote>
<p><strong>ä½¿ç”¨ scrapy_redis å®ç° POST è¯·æ±‚æºå¸¦è¡¨å•æ•°æ®ï¼š</strong></p>
<ul>
<li>è¿›è¡Œ post è¯·æ±‚æ—¶ï¼Œé€šå¸¸é€šè¿‡æºå¸¦çš„è¡¨å•æ•°æ®è¿›è¡Œç¿»é¡µç­‰æ“ä½œï¼Œæ­¤æ—¶ url å›ºå®šï¼Œæ‰€ä»¥ Redis ä¸­å­˜å‚¨çš„åº”è¯¥æ˜¯è¡¨å•æ•°æ®ï¼Œåªéœ€æºå¸¦ä¸åŒè¡¨å•æ•°æ®ä¾¿å¯å‘èµ·ä¸åŒ post è¯·æ±‚</li>
</ul>
</blockquote>
<ul>
<li><p><strong>scrapy_redisé¡¹ç›®é…ç½®ï¼š</strong></p>
<ol>
<li><p><strong>å°†çˆ¬è™«ç±»ç»§æ‰¿è‡ª RedisSpider ç±»ï¼š</strong>å¹¶æŒ‡å®š <strong><code>redis_key</code></strong> å±æ€§ï¼Œå³ä» Redis é˜Ÿåˆ—ä¸­è·å–èµ·å§‹ URL çš„é”®å</p>
</li>
<li><p><strong>æ·»åŠ  scrapy_redis é…ç½®ï¼ˆsettingsæ–‡ä»¶ï¼‰ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot; scrapy-redisé…ç½® &quot;&quot;&quot;</span><br><span class="line"># é…ç½®scrapy_redisè°ƒåº¦å™¨</span><br><span class="line">SCHEDULER = &quot;scrapy_redis.scheduler.Scheduler&quot;</span><br><span class="line"># é…ç½®scrapy_rediså»é‡å™¨</span><br><span class="line">DUPEFILTER_CLASS = &quot;scrapy_redis.dupefilter.RFPDupeFilter&quot;</span><br><span class="line"># è°ƒåº¦å™¨æŒä¹…åŒ–ï¼ŒTrue=ä¿ç•™ï¼ŒFalse=æ¸…ç©º</span><br><span class="line">SCHEDULER_PERSIST = True</span><br><span class="line"># é…ç½®redisè¿æ¥ä¿¡æ¯</span><br><span class="line">REDIS_URL = &quot;redis://127.0.0.1:6379/0&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>é‡å†™ make_request_from_data æ–¹æ³•ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def make_request_from_data(self, data):</span><br><span class="line">    # å‚æ•°dataï¼š&#123;&#x27;url&#x27;: url, &#x27;from_data&#x27;: fromdata, &#x27;meta&#x27;: meta&#125;</span><br><span class="line">    # å³å­˜å‚¨åœ¨redisä¸­çš„èµ·å§‹form_dataè¡¨å•æ•°æ®ï¼Œä¸€èˆ¬é€šè¿‡æ‰‹åŠ¨æ‰§è¡Œè„šæœ¬æ’å…¥</span><br><span class="line">    data = json.loads(data)</span><br><span class="line">    form_data = data.get(&quot;from_data&quot;)</span><br><span class="line"></span><br><span class="line">    # ç”±äºpostè¯·æ±‚åªéœ€é€šè¿‡æ”¹å˜è¡¨å•æ•°æ®æ§åˆ¶ç¿»é¡µï¼Œæ‰€ä»¥urlå¯ä»¥å†™æ­»</span><br><span class="line">    url = &quot;http://www.cninfo.com.cn/new/disclosure&quot;</span><br><span class="line">    return FormRequest(url=url, formdata=form_data)  # å¿…é¡»ä½¿ç”¨returnè¿”å›è¯·æ±‚</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æ‰§è¡Œä¿å­˜ form_data çš„è„šæœ¬ï¼š</strong>ä¸getè¯·æ±‚ä¸åŒçš„æ˜¯ï¼Œgetè¯·æ±‚ä¸­ç›´æ¥é€šè¿‡è¯·æ±‚ä¸åŒçš„ url åœ°å€æ§åˆ¶ç¿»é¡µï¼Œè€Œ post è¯·æ±‚ä¸­é€šè¿‡æºå¸¦ä¸åŒçš„ form_data è¡¨å•æ•°æ®è¿›è¡Œæ§åˆ¶ç¿»é¡µï¼Œæ‰€ä»¥ post è¯·æ±‚ä¸­å­˜å‚¨åœ¨ Redis é˜Ÿåˆ—ä¸­çš„æ˜¯ form_data è¡¨å•æ•°æ®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import redis</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">def push_start_url(db, request_obj):</span><br><span class="line">    # å‚æ•°request_objï¼š&#123;&#x27;url&#x27;: url, &#x27;from_data&#x27;: fromdata, &#x27;meta&#x27;: meta&#125;</span><br><span class="line">    db.lpush(&#x27;jc:start_urls&#x27;, json.dumps(request_obj))</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    redis_cli = redis.Redis()</span><br><span class="line">    for page in range(1, 21):</span><br><span class="line">        from_data = &#123;</span><br><span class="line">            &quot;column&quot;: &quot;szse_latest&quot;,</span><br><span class="line">            &quot;pageNum&quot;: str(page),</span><br><span class="line">            &quot;pageSize&quot;: &quot;30&quot;,</span><br><span class="line">            &quot;sortName&quot;: &quot;&quot;,</span><br><span class="line">            &quot;sortType&quot;: &quot;&quot;,</span><br><span class="line">            &quot;clusterFlag&quot;: &quot;true&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        push_start_url(redis_cli, &#123;&#x27;from_data&#x27;: from_data&#125;)</span><br><span class="line">    redis_cli.close()</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h2 id="åã€scrapyé¡¹ç›®éƒ¨ç½²"><a href="#åã€scrapyé¡¹ç›®éƒ¨ç½²" class="headerlink" title="åã€scrapyé¡¹ç›®éƒ¨ç½²"></a>åã€scrapyé¡¹ç›®éƒ¨ç½²</h2><h3 id="1-é¡¹ç›®éƒ¨ç½²-scrapyd"><a href="#1-é¡¹ç›®éƒ¨ç½²-scrapyd" class="headerlink" title="1. é¡¹ç›®éƒ¨ç½²_scrapyd"></a>1. é¡¹ç›®éƒ¨ç½²_scrapyd</h3><ul>
<li><p><strong>ã€æœåŠ¡å™¨ç«¯ã€‘å®‰è£…scrapydï¼š<code>pip install scrapyd</code></strong></p>
<ul>
<li><p><strong>åœ¨å­˜å‚¨æ‰€æœ‰çˆ¬è™«é¡¹ç›®çš„æ–‡ä»¶å¤¹æ ¹è·¯å¾„ä¸‹åˆ›å»ºå¹¶é…ç½® scrapyd.conf æ–‡ä»¶ï¼š<code>vim scrapyd.conf</code></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[scrapyd]</span><br><span class="line"># ç›‘å¬çš„IPåœ°å€ï¼Œé»˜è®¤ä¸º127.0.0.1ï¼ˆä¿®æ”¹æˆ0.0.0.0æ‰èƒ½åœ¨åˆ«çš„ç”µè„‘ä¸Šè®¿é—®scrapydè¿è¡Œä¹‹åçš„æœåŠ¡å™¨ï¼‰</span><br><span class="line">bind_address = 0.0.0.0</span><br><span class="line"># ç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤ä¸º6800</span><br><span class="line">http_port = 6800</span><br><span class="line"># æ˜¯å¦æ‰“å¼€debugæ¨¡å¼ï¼Œé»˜è®¤ä¸ºoff</span><br><span class="line">debug = off</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>åœ¨å½“å‰è·¯å¾„ä¸‹å¼€å¯ scrapy æœåŠ¡ï¼š<code>scrapyd</code>ï¼ˆæœåŠ¡å™¨åœ°å€æ›´æ”¹ä¸º <a class="link"   target="_blank" rel="noopener" href="http://0.0.0.0:6800/" >http://0.0.0.0:6800/<i class="fas fa-external-link-alt"></i></a> å³å¯ï¼‰</strong></p>
</li>
</ul>
</li>
<li><p><strong>ã€å®¢æˆ·ç«¯ã€‘å®‰è£…scrapyd-clientï¼š<code>pip install scrapyd-client</code></strong></p>
<ul>
<li><p><strong>é…ç½®çˆ¬è™«é¡¹ç›®çš„ scrapy.cfg æ–‡ä»¶ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[settings]</span><br><span class="line">default = douban.settings</span><br><span class="line"></span><br><span class="line">[deploy:ubuntu-1]  # æ ‡è®°è¦å‘å¸ƒé“å“ªä¸ªæœåŠ¡å™¨</span><br><span class="line">url = http://192.168.64.12:6800/</span><br><span class="line">project = douban</span><br><span class="line"></span><br><span class="line">;å¦‚æœæœ‰å¤šå°æœåŠ¡å™¨å¯ä»¥ç¼–å†™å¤šä¸ªdeploy</span><br><span class="line">;[deploy:ubuntu-2]</span><br><span class="line">;url = http://192.168.64.13:6800/</span><br><span class="line">;project = douban</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æ£€æŸ¥ scrapy.cfg é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼š<code>scrapyd-deploy -l</code>ï¼ˆå°å†™Lï¼‰</strong></p>
</li>
</ul>
</li>
<li><p><strong>å°†å®¢æˆ·ç«¯ scrapy é¡¹ç›®å‘å¸ƒåˆ°æœåŠ¡å™¨ç«¯ï¼š<code>scrapyd-deploy &lt;target&gt; -p &lt;project&gt; --version &lt;version&gt;</code></strong></p>
<ul>
<li>targetï¼šé…ç½®æ–‡ä»¶ scrapy.cfg é‡Œ deploy åé¢çš„ target åå­—ï¼Œä¾‹å¦‚ <code>ubuntu-1</code></li>
<li>projectï¼šå¯ä»¥éšæ„å®šä¹‰ï¼Œè·Ÿçˆ¬è™«çš„å·¥ç¨‹åå­—æ— å…³ï¼Œä¸€èˆ¬ä¸scrapyçˆ¬è™«é¡¹ç›®åç›¸åŒ</li>
<li>versionï¼šè‡ªå®šä¹‰ç‰ˆæœ¬å·ï¼Œä¸å†™çš„è¯é»˜è®¤ä¸ºå½“å‰æ—¶é—´æˆ³ï¼Œ<strong>ä¸€èˆ¬ä¸å†™</strong></li>
<li><strong>æ³¨æ„ï¼šå‘å¸ƒæ—¶çˆ¬è™«æ˜¯æœªè¿è¡ŒçŠ¶æ€ï¼Œä¸”çˆ¬è™«ç›®å½•ä¸‹ä¸è¦æ”¾æ— å…³çš„pyæ–‡ä»¶ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´å‘å¸ƒå¤±è´¥</strong></li>
</ul>
</li>
<li><p><strong>è¿è¡Œçˆ¬è™«ï¼š<code>curl http://æœåŠ¡å™¨ip:6800/schedule.json -d project=é¡¹ç›®å -d spider=è„šæœ¬å</code></strong></p>
</li>
<li><p><strong>åœæ­¢çˆ¬è™«ï¼š<code>curl http://æœåŠ¡å™¨ip:6800/cancel.json -d project=é¡¹ç›®å -d job=ä»»åŠ¡çš„idå€¼</code></strong></p>
</li>
</ul>
<h3 id="2-é¡¹ç›®éƒ¨ç½²-scrapydweb"><a href="#2-é¡¹ç›®éƒ¨ç½²-scrapydweb" class="headerlink" title="2. é¡¹ç›®éƒ¨ç½²_scrapydweb"></a>2. é¡¹ç›®éƒ¨ç½²_scrapydweb</h3><blockquote>
<p><strong>æ³¨æ„ï¼šscrapydwebçš„å…¼å®¹é—®é¢˜å¾ˆå¤§ï¼Œéœ€è¦åˆ›å»º requirements.txt æ–‡ä»¶ç»Ÿä¸€æ§åˆ¶åŒ…çš„ç‰ˆæœ¬ï¼Œé€šè¿‡ <code>pip install -r requirements.txt</code> å®‰è£…æ‰€æœ‰å…¼å®¹ç‰ˆæœ¬çš„åŒ…</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pip&gt;=19.1.1</span><br><span class="line">APScheduler==3.5.3</span><br><span class="line">click==7.0</span><br><span class="line">colorama==0.4.0</span><br><span class="line">Flask==1.0.2</span><br><span class="line">Flask-Compress==1.4.0</span><br><span class="line">Flask-SQLAlchemy==2.4.0</span><br><span class="line">idna==2.7</span><br><span class="line">itsdangerous==1.1.0</span><br><span class="line">Jinja2==2.10</span><br><span class="line">logparser==0.8.2</span><br><span class="line">MarkupSafe==1.1.1</span><br><span class="line">pexpect==4.7.0</span><br><span class="line">ptyprocess==0.6.0</span><br><span class="line">pytz==2018.9</span><br><span class="line">requests&gt;=2.21.0</span><br><span class="line">setuptools&gt;=40.6.3</span><br><span class="line">six==1.12.0</span><br><span class="line">SQLAlchemy==1.3.24</span><br><span class="line">tzlocal==1.5.1</span><br><span class="line">w3lib==1.19.0</span><br><span class="line">Werkzeug==0.14.1</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><p><strong>ã€æœåŠ¡å™¨ç«¯ã€‘å®‰è£…scrapydwebï¼š<code>pip install scrapydweb</code></strong></p>
</li>
<li><p><strong>å¼€å¯ scrapydweb æœåŠ¡ï¼ˆå¿…é¡»å…ˆå¼€å¯ scrapyd æœåŠ¡ï¼‰ï¼š<code>scrapydweb</code></strong></p>
<ul>
<li>scrapydweb æœåŠ¡å¯ä»¥åœ¨ä»»æ„è·¯å¾„ä¸‹å¼€å¯</li>
<li>scrapydweb æœåŠ¡ç¬¬ä¸€æ¬¡è¿è¡Œä¸ä¼šæˆåŠŸï¼Œåªä¼šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œç¬¬äºŒæ¬¡è¿è¡Œå³å¯æˆåŠŸ</li>
</ul>
</li>
<li><p><strong>åŸºæœ¬ä½¿ç”¨ï¼š</strong></p>
<ol>
<li>é€šè¿‡ 5000 ç«¯å£è®¿é—® scrapydweb æœåŠ¡</li>
<li>åœ¨ Deploy Project â€“&gt; Upload file ä¸­ä¸Šä¼ å‹ç¼©åçš„é¡¹ç›®</li>
<li>åœ¨ Run Spider ä¸­è¿è¡Œçˆ¬è™«</li>
<li>åœ¨ Jobs ä¸­å¯ä»¥è¿›è¡Œçˆ¬è™«çš„æš‚åœå’Œå¯åŠ¨</li>
</ol>
</li>
</ul>
<h3 id="3-é¡¹ç›®éƒ¨ç½²-Gerapy"><a href="#3-é¡¹ç›®éƒ¨ç½²-Gerapy" class="headerlink" title="3. é¡¹ç›®éƒ¨ç½²_Gerapy"></a>3. é¡¹ç›®éƒ¨ç½²_Gerapy</h3><blockquote>
<p><strong>æ³¨æ„ï¼šGerapy æ˜¯ä¸€ä¸ªåŸºäºWebçš„å®¢æˆ·ç«¯ï¼Œå®‰è£…åœ¨å®¢æˆ·ç«¯ï¼Œç”¨äºç®¡ç†å’Œç›‘æ§åˆ†å¸ƒå¼çˆ¬è™«ï¼ŒåŸºäº django å¼€å‘</strong></p>
<p><strong>å®‰è£…ï¼š<code>pip install gerapy==0.9.12</code>ï¼ˆ0.9.12æ˜¯ç¨³å®šç‰ˆæœ¬ï¼‰</strong></p>
</blockquote>
<ul>
<li><p><strong>Gerapy åŸºæœ¬ä½¿ç”¨ï¼š</strong></p>
<ol>
<li><strong><code>gerapy init</code>ï¼š</strong>æŒ‡å®šä¸€ä¸ªå•ç‹¬ç”¨äºéƒ¨ç½² Gerapy çš„æ–‡ä»¶å¤¹ï¼Œé€šè¿‡æ­¤å‘½ä»¤åˆ›å»ºä¸€ä¸ª Gerapy å·¥ä½œç›®å½•</li>
<li><strong><code>gerapy migrate</code>ï¼š</strong>æ‰§è¡Œæ•°æ®åº“è¿ç§»æ“ä½œï¼Œå°†æ•°æ®åº“æ¨¡å‹çš„å˜æ›´åº”ç”¨åˆ°æ•°æ®åº“ä¸­</li>
<li><strong><code>gerapy createsuperuser</code>ï¼š</strong>åˆ›å»ºä¸€ä¸ªå…·æœ‰ç³»ç»Ÿä¸­æœ€é«˜çº§åˆ«çš„æƒé™çš„è¶…çº§ç”¨æˆ·</li>
<li><strong><code>gerapy runserver</code>ï¼š</strong>åœ¨å¼€å‘ç¯å¢ƒä¸­å¯åŠ¨ Gerapy çš„ Web æœåŠ¡å™¨</li>
</ol>
</li>
<li><p><strong>Gerapy çš„ Web æœåŠ¡å™¨åŸºæœ¬ä½¿ç”¨ï¼š</strong></p>
<ol>
<li><strong>ä¸»æœºç®¡ç†ï¼š</strong>ç”¨äºè¿æ¥ scrapyd æœåŠ¡ï¼Œæ‰€ä»¥éœ€è¦ç¡®ä¿ ubuntu ä¸­çš„ scrapyd æœåŠ¡æ˜¯å¼€å¯çš„ï¼ˆåç§°ï¼šubuntu-1ï¼Œipï¼šubuntuçš„ipåœ°å€ï¼Œç«¯å£ï¼š6800ï¼Œè®¤è¯ï¼šscrapydä¹Ÿæœ‰è´¦å·å¯†ç åˆ™éœ€è¦è®¤è¯ï¼‰</li>
<li><strong>é¡¹ç›®ç®¡ç†ï¼š</strong>ç”¨äºä¸Šä¼  scrapy é¡¹ç›®ï¼Œä¸Šä¼  â€“&gt; éƒ¨ç½² â€“&gt; æ‰“åŒ…é¡¹ç›® â€“&gt; é€‰å–èŠ‚ç‚¹ â€“&gt; ç‚¹å‡»éƒ¨ç½² â€“&gt; ä¸»æœºç®¡ç†</li>
<li><strong>ä»»åŠ¡ç®¡ç†ï¼š</strong>ç”¨äºå¼€å¯ä¸åŒçˆ¬è™«ä»»åŠ¡ï¼ˆDateï¼šæŒ‡å®šæ—¶é—´è¿è¡Œçˆ¬è™«ï¼ŒIntervalï¼šé—´éš”æŒ‡å®šæ—¶é—´å - é‡å¤è°ƒç”¨çˆ¬è™«ï¼ŒCrontabï¼šå®šæ—¶çˆ¬è™«ï¼‰</li>
</ol>
</li>
</ul>

                    
                </div>

                
                        
<div class="post-copyright-info-container border-box">
    <div class="copyright-info-content border-box">
        <div class="copyright-info-top border-box">
            <div class="copyright-post-title border-box text-ellipsis">
                çˆ¬è™«_2_Scrapyæ¡†æ¶
            </div>

            <div class="copyright-post-link border-box text-ellipsis">
                2023/10/01/çˆ¬è™«_2_Scrapyæ¡†æ¶/
            </div>
        </div>

        <div class="copyright-info-bottom border-box">
            <div class="copyright-post-author bottom-item">
                <div class="type">
                    ä½œè€…
                </div>
                <div class="content">xfblog</div>
            </div>

            <div class="post-time bottom-item">
                <div class="type">
                    å‘å¸ƒäº
                </div>
                <div class="content">2023-10-01 00:00</div>
            </div>


            <div class="post-license bottom-item">
                <div class="type">
                    è®¸å¯
                </div>
                <div class="content tooltip" data-tooltip-content="CC BY-NC-SA 4.0">
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" target="_blank">
                        
                            <i class="fa-brands fa-creative-commons"></i>
                            <i class="fa-brands fa-creative-commons-by"></i>
                            <i class="fa-brands fa-creative-commons-nc"></i>
                            <i class="fa-brands fa-creative-commons-sa"></i>
                        
                    </a>
                </div>
            </div>
        </div>

        <i class="copyright-bg fa-solid fa-copyright"></i>
    </div>
    <div class="copy-copyright-info flex-center tooltip" data-tooltip-content="å¤åˆ¶ç‰ˆæƒä¿¡æ¯" data-tooltip-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E7%88%AC%E8%99%AB/">çˆ¬è™«</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/Python/">Python</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                            <div class="post-share-container border-box">
    <ul class="share-list-wrap border-box">
        <li class="qq share-item border-box flex-center tooltip"
            data-tooltip-content="åˆ†äº«åˆ° QQ"
        >
            <i class="fa-brands fa-qq"></i>
        </li>
        <li class="wechat share-item border-box flex-center tooltip tooltip-img"
            data-tooltip-content="åˆ†äº«åˆ°å¾®ä¿¡"
            data-tooltip-img-tip="å¾®ä¿¡æ‰«ä¸€æ‰«"
            data-tooltip-img-style="background-color: #fff; top: -10px; padding: 0.6rem 0.6rem 0.1rem 0.6rem;"
        >
            <i class="fa-brands fa-weixin"></i>
        </li>
        <li class="weibo share-item border-box flex-center tooltip"
            data-tooltip-content="åˆ†äº«åˆ°å¾®åš"
        >
            <i class="fa-brands fa-weibo"></i>
        </li>
    </ul>
</div>

                        
                    </div>
                </div>

                
                    

<div class="reward-author-container border-box flex-center">
    <div class="reward-btn border-box flex-center tooltip tooltip-img"
            data-tooltip-img-url="/images/zfb.webp"
            data-tooltip-img-trigger="click"
            data-tooltip-img-style="top: -6px;"
    >
        <i class="fa-solid fa-gift"></i>&nbsp;åˆ›ä½œä¸æ˜“ï¼Œæ‰“èµéšæ„ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘æ›´æ–°çš„åŠ¨åŠ›ğŸ’ªï¼
    </div>
</div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/2023/11/01/%E7%88%AC%E8%99%AB_3_Ubuntu%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"
                                   title="çˆ¬è™«_3_Ubuntuå®‰è£…é…ç½®"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">çˆ¬è™«_3_Ubuntuå®‰è£…é…ç½®</span>
                                        <span class="post-nav-item">ä¸Šä¸€ç¯‡</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2023/09/01/%E7%88%AC%E8%99%AB_1_%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"
                                   title="çˆ¬è™«_1_åŸºç¡€çŸ¥è¯†"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">çˆ¬è™«_1_åŸºç¡€çŸ¥è¯†</span>
                                        <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
            <div class="pc-post-toc right-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E4%BA%86%E8%A7%A3Scrapy%E6%A1%86%E6%9E%B6"><span class="nav-text">ä¸€ã€äº†è§£Scrapyæ¡†æ¶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-scrapy%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-text">1. scrapyçš„å·¥ä½œåŸç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-scrapy%E7%9A%84%E9%A1%B9%E7%9B%AE%E5%88%9D%E8%AF%86"><span class="nav-text">2. scrapyçš„é¡¹ç›®åˆè¯†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-scrapy%E7%9A%84%E6%96%AD%E7%82%B9%E7%BB%AD%E7%88%AC"><span class="nav-text">3. scrapyçš„æ–­ç‚¹ç»­çˆ¬</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-scrapy%E7%9A%84%E9%81%8D%E5%8E%86%E7%AE%97%E6%B3%95"><span class="nav-text">4. scrapyçš„éå†ç®—æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-scrapy%E7%9A%84%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB"><span class="nav-text">5. scrapyçš„æ—¥å¿—çº§åˆ«</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81Spider%E7%88%AC%E8%99%AB%E6%A8%A1%E5%9D%97"><span class="nav-text">äºŒã€Spiderçˆ¬è™«æ¨¡å—</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%87%8D%E8%A6%81%E5%87%BD%E6%95%B0"><span class="nav-text">1. é‡è¦å‡½æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%95%B0%E6%8D%AE%E6%8F%90%E5%8F%96%E3%80%81%E8%B7%9F%E8%BF%9B%E9%93%BE%E6%8E%A5"><span class="nav-text">2. æ•°æ®æå–ã€è·Ÿè¿›é“¾æ¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%AF%B7%E6%B1%82post%E6%90%BA%E5%B8%A6%E8%A1%A8%E5%8D%95"><span class="nav-text">3. è¯·æ±‚postæºå¸¦è¡¨å•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E8%AF%B7%E6%B1%82post%E6%90%BA%E5%B8%A6json"><span class="nav-text">4. è¯·æ±‚postæºå¸¦json</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81Middleware%E5%92%8CExtension"><span class="nav-text">ä¸‰ã€Middlewareå’ŒExtension</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%87%8D%E8%A6%81%E5%87%BD%E6%95%B0-1"><span class="nav-text">1. é‡è¦å‡½æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%8C%87%E7%BA%B9%E5%8E%BB%E9%87%8D%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-text">2. æŒ‡çº¹å»é‡ä¸­é—´ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E4%BB%98%E8%B4%B9%E4%BB%A3%E7%90%86ip%E6%89%A9%E5%B1%95"><span class="nav-text">2. ä»˜è´¹ä»£ç†ipæ‰©å±•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E4%BB%98%E8%B4%B9%E4%BB%A3%E7%90%86%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-text">3. ä»˜è´¹ä»£ç†ä¸­é—´ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E4%B8%AD%E9%97%B4%E4%BB%B6selenium%E9%85%8D%E7%BD%AE"><span class="nav-text">4. ä¸­é—´ä»¶seleniumé…ç½®</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81Item%E5%AE%9E%E4%BD%93%E6%A8%A1%E5%9D%97"><span class="nav-text">å››ã€Itemå®ä½“æ¨¡å—</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%87%8D%E8%A6%81%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="nav-text">1. é‡è¦çŸ¥è¯†ç‚¹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81Pipline%E7%AE%A1%E9%81%93%E6%A8%A1%E5%9D%97"><span class="nav-text">äº”ã€Piplineç®¡é“æ¨¡å—</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%87%8D%E8%A6%81%E5%87%BD%E6%95%B0-2"><span class="nav-text">1. é‡è¦å‡½æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%A4%9A%E4%B8%AA%E7%AE%A1%E9%81%93item%E4%BC%A0%E9%80%92"><span class="nav-text">2. å¤šä¸ªç®¡é“itemä¼ é€’</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%8E%BB%E9%87%8D"><span class="nav-text">3. æ•°æ®å­˜å‚¨å»é‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E8%AF%B7%E6%B1%82url%E5%9C%B0%E5%9D%80%E5%8E%BB%E9%87%8D"><span class="nav-text">4. è¯·æ±‚urlåœ°å€å»é‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-adbapi%E5%BC%82%E6%AD%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8E%A5%E5%8F%A3"><span class="nav-text">5. adbapiå¼‚æ­¥æ•°æ®åº“æ¥å£</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81Settings%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%9D%97"><span class="nav-text">å…­ã€Settingsé…ç½®æ¨¡å—</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%85%8D%E7%BD%AE%E4%B8%8B%E8%BD%BD%E5%BB%B6%E8%BF%9F"><span class="nav-text">1. é…ç½®ä¸‹è½½å»¶è¿Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%85%A8%E9%83%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">2. å…¨éƒ¨é…ç½®</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E3%80%81cnblogs%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98"><span class="nav-text">ä¸ƒã€cnblogsé¡¹ç›®å®æˆ˜</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-spiders-cnblogs-py"><span class="nav-text">1. spiders&#x2F;cnblogs.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-extend-ip-py"><span class="nav-text">2. extend_ip.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-middlewares-py"><span class="nav-text">3. middlewares.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-items-py"><span class="nav-text">4. items.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-piplines-py"><span class="nav-text">5. piplines.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-settings-py"><span class="nav-text">6. settings.py</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AB%E3%80%81Scrapy-Redis%E5%A2%9E%E9%87%8F%E7%88%AC%E8%99%AB"><span class="nav-text">å…«ã€Scrapy_Rediså¢é‡çˆ¬è™«</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%9D%E3%80%81Scrapy-Redis%E5%88%86%E5%B8%83%E5%BC%8F%E7%88%AC%E8%99%AB"><span class="nav-text">ä¹ã€Scrapy_Redisåˆ†å¸ƒå¼çˆ¬è™«</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-scrapy-redis%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="nav-text">1. scrapy_rediså·¥ä½œæµç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-RedisPipeline%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">2. RedisPipelineçš„ä½¿ç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%AE%9E%E7%8E%B0GET%E8%AF%B7%E6%B1%82"><span class="nav-text">3. å®ç°GETè¯·æ±‚</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%AE%9E%E7%8E%B0POST%E8%AF%B7%E6%B1%82"><span class="nav-text">4. å®ç°POSTè¯·æ±‚</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E3%80%81scrapy%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2"><span class="nav-text">åã€scrapyé¡¹ç›®éƒ¨ç½²</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2-scrapyd"><span class="nav-text">1. é¡¹ç›®éƒ¨ç½²_scrapyd</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2-scrapydweb"><span class="nav-text">2. é¡¹ç›®éƒ¨ç½²_scrapydweb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2-Gerapy"><span class="nav-text">3. é¡¹ç›®éƒ¨ç½²_Gerapy</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
    Copyright&nbsp;&copy;&nbsp;<span>2021</span>&nbsp;-&nbsp;2025&nbsp;<a href="https://xfblog.cn/" target="_self">å°å‚…åšå®¢</a>&nbsp;-&nbsp;All&nbsp;rights&nbsp;reserved.&nbsp;&nbsp;&nbsp;&nbsp;
    
            <!-- &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">xfblog</a> -->
        
    </div>

    <!-- <div class="theme-info info-item">
        ç”±&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;é©±åŠ¨&nbsp;&&nbsp;ä¸»é¢˜&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div> -->

    

    

    
        <div class="record-info info-item">
            
                
                    <div class="record-item border-box">
                        <a class=""
                           target="_blank"
                           href="https://beian.miit.gov.cn"
                        >
                        
                            èœ€ICPå¤‡2021021033å·-1
                        </a>
                    </div>
                
            
                
                    <div class="record-item border-box">
                        <a class=""
                           target="_blank"
                           href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51138102000134"
                        >
                        
                            <!-- åœ¨ç¬¬äºŒä¸ª <a> æ ‡ç­¾å‰æ’å…¥å›¾ç‰‡ -->
                            <img src="http://xfblog.cn/images/icon.webp" style="vertical-align: top;">
                        
                            å·å…¬ç½‘å®‰å¤‡ 51138102000134å·
                        </a>
                    </div>
                
            
        </div>&nbsp;&nbsp;&nbsp;&nbsp;
        
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="æœç´¢..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E4%BA%86%E8%A7%A3Scrapy%E6%A1%86%E6%9E%B6"><span class="nav-text">ä¸€ã€äº†è§£Scrapyæ¡†æ¶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-scrapy%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-text">1. scrapyçš„å·¥ä½œåŸç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-scrapy%E7%9A%84%E9%A1%B9%E7%9B%AE%E5%88%9D%E8%AF%86"><span class="nav-text">2. scrapyçš„é¡¹ç›®åˆè¯†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-scrapy%E7%9A%84%E6%96%AD%E7%82%B9%E7%BB%AD%E7%88%AC"><span class="nav-text">3. scrapyçš„æ–­ç‚¹ç»­çˆ¬</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-scrapy%E7%9A%84%E9%81%8D%E5%8E%86%E7%AE%97%E6%B3%95"><span class="nav-text">4. scrapyçš„éå†ç®—æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-scrapy%E7%9A%84%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB"><span class="nav-text">5. scrapyçš„æ—¥å¿—çº§åˆ«</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81Spider%E7%88%AC%E8%99%AB%E6%A8%A1%E5%9D%97"><span class="nav-text">äºŒã€Spiderçˆ¬è™«æ¨¡å—</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%87%8D%E8%A6%81%E5%87%BD%E6%95%B0"><span class="nav-text">1. é‡è¦å‡½æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%95%B0%E6%8D%AE%E6%8F%90%E5%8F%96%E3%80%81%E8%B7%9F%E8%BF%9B%E9%93%BE%E6%8E%A5"><span class="nav-text">2. æ•°æ®æå–ã€è·Ÿè¿›é“¾æ¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%AF%B7%E6%B1%82post%E6%90%BA%E5%B8%A6%E8%A1%A8%E5%8D%95"><span class="nav-text">3. è¯·æ±‚postæºå¸¦è¡¨å•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E8%AF%B7%E6%B1%82post%E6%90%BA%E5%B8%A6json"><span class="nav-text">4. è¯·æ±‚postæºå¸¦json</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81Middleware%E5%92%8CExtension"><span class="nav-text">ä¸‰ã€Middlewareå’ŒExtension</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%87%8D%E8%A6%81%E5%87%BD%E6%95%B0-1"><span class="nav-text">1. é‡è¦å‡½æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%8C%87%E7%BA%B9%E5%8E%BB%E9%87%8D%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-text">2. æŒ‡çº¹å»é‡ä¸­é—´ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E4%BB%98%E8%B4%B9%E4%BB%A3%E7%90%86ip%E6%89%A9%E5%B1%95"><span class="nav-text">2. ä»˜è´¹ä»£ç†ipæ‰©å±•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E4%BB%98%E8%B4%B9%E4%BB%A3%E7%90%86%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-text">3. ä»˜è´¹ä»£ç†ä¸­é—´ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E4%B8%AD%E9%97%B4%E4%BB%B6selenium%E9%85%8D%E7%BD%AE"><span class="nav-text">4. ä¸­é—´ä»¶seleniumé…ç½®</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81Item%E5%AE%9E%E4%BD%93%E6%A8%A1%E5%9D%97"><span class="nav-text">å››ã€Itemå®ä½“æ¨¡å—</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%87%8D%E8%A6%81%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="nav-text">1. é‡è¦çŸ¥è¯†ç‚¹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81Pipline%E7%AE%A1%E9%81%93%E6%A8%A1%E5%9D%97"><span class="nav-text">äº”ã€Piplineç®¡é“æ¨¡å—</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%87%8D%E8%A6%81%E5%87%BD%E6%95%B0-2"><span class="nav-text">1. é‡è¦å‡½æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%A4%9A%E4%B8%AA%E7%AE%A1%E9%81%93item%E4%BC%A0%E9%80%92"><span class="nav-text">2. å¤šä¸ªç®¡é“itemä¼ é€’</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%8E%BB%E9%87%8D"><span class="nav-text">3. æ•°æ®å­˜å‚¨å»é‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E8%AF%B7%E6%B1%82url%E5%9C%B0%E5%9D%80%E5%8E%BB%E9%87%8D"><span class="nav-text">4. è¯·æ±‚urlåœ°å€å»é‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-adbapi%E5%BC%82%E6%AD%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8E%A5%E5%8F%A3"><span class="nav-text">5. adbapiå¼‚æ­¥æ•°æ®åº“æ¥å£</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81Settings%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%9D%97"><span class="nav-text">å…­ã€Settingsé…ç½®æ¨¡å—</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%85%8D%E7%BD%AE%E4%B8%8B%E8%BD%BD%E5%BB%B6%E8%BF%9F"><span class="nav-text">1. é…ç½®ä¸‹è½½å»¶è¿Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%85%A8%E9%83%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">2. å…¨éƒ¨é…ç½®</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E3%80%81cnblogs%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98"><span class="nav-text">ä¸ƒã€cnblogsé¡¹ç›®å®æˆ˜</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-spiders-cnblogs-py"><span class="nav-text">1. spiders&#x2F;cnblogs.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-extend-ip-py"><span class="nav-text">2. extend_ip.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-middlewares-py"><span class="nav-text">3. middlewares.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-items-py"><span class="nav-text">4. items.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-piplines-py"><span class="nav-text">5. piplines.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-settings-py"><span class="nav-text">6. settings.py</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AB%E3%80%81Scrapy-Redis%E5%A2%9E%E9%87%8F%E7%88%AC%E8%99%AB"><span class="nav-text">å…«ã€Scrapy_Rediså¢é‡çˆ¬è™«</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%9D%E3%80%81Scrapy-Redis%E5%88%86%E5%B8%83%E5%BC%8F%E7%88%AC%E8%99%AB"><span class="nav-text">ä¹ã€Scrapy_Redisåˆ†å¸ƒå¼çˆ¬è™«</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-scrapy-redis%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="nav-text">1. scrapy_rediså·¥ä½œæµç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-RedisPipeline%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">2. RedisPipelineçš„ä½¿ç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%AE%9E%E7%8E%B0GET%E8%AF%B7%E6%B1%82"><span class="nav-text">3. å®ç°GETè¯·æ±‚</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%AE%9E%E7%8E%B0POST%E8%AF%B7%E6%B1%82"><span class="nav-text">4. å®ç°POSTè¯·æ±‚</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E3%80%81scrapy%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2"><span class="nav-text">åã€scrapyé¡¹ç›®éƒ¨ç½²</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2-scrapyd"><span class="nav-text">1. é¡¹ç›®éƒ¨ç½²_scrapyd</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2-scrapydweb"><span class="nav-text">2. é¡¹ç›®éƒ¨ç½²_scrapydweb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2-Gerapy"><span class="nav-text">3. é¡¹ç›®éƒ¨ç½²_Gerapy</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>





<!-- common js -->
<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/toggle-theme.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/code-block.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/libs/anime.min.js"></script>

<!-- local search -->

    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/local-search.js"></script>


<!-- lazyload -->

    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/lazyload.js"></script>


<div class="pjax">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/post/post-helper.js"></script>

        <!-- toc -->
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/post/toc.js"></script>
        

        <!-- copyright-info -->
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/post/copyright-info.js"></script>
        

        <!-- share -->
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/post/share.js"></script>
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->

    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart()
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd()
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'))
            KEEP.initExecute()
        });
    });
</script>




    
        
            
<script class="custom-inject-js" src="/js/run_time.js" data-pjax></script>

        
    
        
            
<script class="custom-inject-js" src="/js/code_click_copy.js" data-pjax></script>

        
    
        
            
<script class="custom-inject-js" src="/js/copyrightpro.js" data-pjax></script>

        
    

</body>
</html>
