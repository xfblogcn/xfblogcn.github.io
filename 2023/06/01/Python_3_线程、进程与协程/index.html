<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="xfblog">
    
    <title>
        
            Python_3_çº¿ç¨‹ã€è¿›ç¨‹ä¸åç¨‹ |
        
        XFBLOG.CN
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/favicon.webp">
    
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/font/css/fontawesome.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/font/css/regular.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/font/css/solid.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/font/css/brands.min.css">
    
        
            
                
<link rel="stylesheet" href="/css/custom-1.css">

            
        
    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.xml"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"XFBLOG.CN","author":"xfblog","avatar":"/images/avatar.webp","logo":"/images/logo.webp","favicon":"/images/favicon.webp"},"menu":{"home":"/ || fa-solid fa-home","JumpTo":{"children":[{"JSé€†å‘_3_æ‰£ç®—æ³•ä¸“é¢˜":"/2024/05/01/JSé€†å‘_3_æ‰£ç®—æ³•ä¸“é¢˜/"},{"JSé€†å‘_4_è¡¥ç¯å¢ƒä¸“é¢˜":"/2024/07/01/JSé€†å‘_4_è¡¥ç¯å¢ƒä¸“é¢˜/"}]},"archives":"/archives || fa-solid fa-box-archive","tags":"/tags || fa-solid fa-tags","links":"/links || fa-solid fa-link","about":"/about || fa-solid fa-circle-info"},"first_screen":{"enable":true,"background_img":"/images/home_lights.webp","background_img_dark":"/images/home_dark.webp","description":null,"hitokoto":false},"social_contact":{"enable":true,"links":{"github":"https://github.com/xfblogcn","weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":true,"hide_header":true},"home":{"announcement":"ç‰ˆæƒå£°æ˜ï¼šæœ¬ç«™æ‰€æœ‰æ–‡ç« å‡ä¸º xfblog.cn å°å‚…åŸåˆ›ï¼Œè¯·éµå¾ª CC 4.0 BY-SA ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚","category":true,"tag":true,"post_datetime":"created","post_datetime_format":"YYYY-MM-DD"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":true,"min2read":true},"datetime_format":"YYYY-MM-DD","copyright_info":true,"share":true,"reward":{"enable":true,"img_link":"/images/zfb.webp","text":"åˆ›ä½œä¸æ˜“ï¼Œæ‰“èµéšæ„ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘æ›´æ–°çš„åŠ¨åŠ›ğŸ’ªï¼"}},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"obsidian"},"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":true,"site_uv":false,"site_pv":false,"page_pv":true}},"local_search":{"enable":true,"preload":true},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.36"},"waline":{"server_url":null,"reaction":false,"version":"3.2.1"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":true},"lazyload":{"enable":true},"cdn":{"enable":true,"provider":"jsdelivr"},"pjax":{"enable":true},"footer":{"since":2021,"word_count":false,"site_deploy":{"enable":false,"provider":"github","url":null},"record":{"enable":true,"list":[{"code":"èœ€ICPå¤‡2021021033å·-1","link":"https://beian.miit.gov.cn"},{"code":"å·å…¬ç½‘å®‰å¤‡ 51138102000134å·","link":"http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51138102000134"}]}},"inject":{"enable":true,"css":["/css/custom-1.css"],"js":null},"root":"","source_data":{},"version":"4.2.5"}
    KEEP.language_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s ä¸ªæœˆå‰","year":"%s å¹´å‰"}
    KEEP.language_code_block = {"copy":"å¤åˆ¶ä»£ç ","copied":"å·²å¤åˆ¶","fold":"æŠ˜å ä»£ç å—","folded":"å·²æŠ˜å "}
    KEEP.language_copy_copyright = {"copy":"å¤åˆ¶ç‰ˆæƒä¿¡æ¯","copied":"å·²å¤åˆ¶","title":"åŸæ–‡æ ‡é¢˜","author":"åŸæ–‡ä½œè€…","link":"åŸæ–‡é“¾æ¥"}
  </script>
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Keep" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/logo.webp">
                </a>
            
            <a class="site-name border-box" href="/">
               XFBLOG.CN
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-home"></i>
                                
                                é¦–é¡µ
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box has-sub-menu">
                            <a class="menu-text-color border-box" href="javascript:void(0);">
                                
                                JUMPTO
                                
                                    <i class="menu-text-color collapse-icon fa-solid fa-angle-down"></i>
                                
                            </a>
                            
                                <ul class="sub-menu-list border-box">
                                    
                                        
                                        <li class="sub-menu-item border-box ">
                                            <a class="menu-text-color border-box flex-start" href="/2024/05/01/JS%E9%80%86%E5%90%91_3_%E6%89%A3%E7%AE%97%E6%B3%95%E4%B8%93%E9%A2%98/">
                                                
                                                JSé€†å‘_3_æ‰£ç®—æ³•ä¸“é¢˜
                                            </a>
                                        </li>
                                    
                                        
                                        <li class="sub-menu-item border-box ">
                                            <a class="menu-text-color border-box flex-start" href="/2024/07/01/JS%E9%80%86%E5%90%91_4_%E8%A1%A5%E7%8E%AF%E5%A2%83%E4%B8%93%E9%A2%98/">
                                                
                                                JSé€†å‘_4_è¡¥ç¯å¢ƒä¸“é¢˜
                                            </a>
                                        </li>
                                    
                                </ul>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                
                                å½’æ¡£
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/tags">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-tags"></i>
                                
                                æ ‡ç­¾
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/links">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-link"></i>
                                
                                å‹é“¾
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/about">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-circle-info"></i>
                                
                                å…³äº
                                
                            </a>
                            
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="menu-text-color fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-home"></i>
                                </span>
                            
                            é¦–é¡µ
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box has-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="javascript:void(0);">
                            
                            JUMPTO
                        </a>
                        
                            <i class="right-side collapse-icon fa-solid fa-angle-left"></i>
                        
                    </label>
                    
                        <ul class="drawer-sub-menu-list border-box">
                            
                                
                                <li class="sub-menu-item border-box">
                                    <a class="drawer-menu-text-color border-box flex-start" href="/2024/05/01/js%E9%80%86%E5%90%91_3_%E6%89%A3%E7%AE%97%E6%B3%95%E4%B8%93%E9%A2%98/">
                                        
                                        JSé€†å‘_3_æ‰£ç®—æ³•ä¸“é¢˜
                                    </a>
                                </li>
                            
                                
                                <li class="sub-menu-item border-box">
                                    <a class="drawer-menu-text-color border-box flex-start" href="/2024/07/01/js%E9%80%86%E5%90%91_4_%E8%A1%A5%E7%8E%AF%E5%A2%83%E4%B8%93%E9%A2%98/">
                                        
                                        JSé€†å‘_4_è¡¥ç¯å¢ƒä¸“é¢˜
                                    </a>
                                </li>
                            
                        </ul>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                </span>
                            
                            å½’æ¡£
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/tags">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-tags"></i>
                                </span>
                            
                            æ ‡ç­¾
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/links">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-link"></i>
                                </span>
                            
                            å‹é“¾
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/about">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-circle-info"></i>
                                </span>
                            
                            å…³äº
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        Python_3_çº¿ç¨‹ã€è¿›ç¨‹ä¸åç¨‹
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/avatar.webp">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">xfblog</span>
                                
                                    <span class="author-badge">Lv3</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2023-06-01</span>
            </span>

            
                <span class="meta-info-item post-update-date">
                    <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                    <span class="datetime" data-updated="Mon Dec 09 2024 10:26:09 GMT+0800">2024-12-09</span>
                </span>
            
        

        
            <span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="post-category-ul">
                    
                            <li class="category-item"><a href="/categories/Python/">Python</a></li>
                        
                    
                </ul>
            </span>
        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/Python/">Python</a></li>
                        
                    
                </ul>
            </span>
        

        
        
            <span class="meta-info-item post-wordcount">
                <i class="icon fas fa-file-word"></i>&nbsp;<span>15.2k å­—</span>
            </span>
        
        
            <span class="meta-info-item post-min2read">
                <i class="icon fas fa-clock"></i>&nbsp;<span>61 åˆ†é’Ÿ</span>
            </span>
        
        
            <span class="meta-info-item post-pv">
                <i class="icon fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
            </span>
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <h2 id="ä¸€ã€çº¿ç¨‹"><a href="#ä¸€ã€çº¿ç¨‹" class="headerlink" title="ä¸€ã€çº¿ç¨‹"></a>ä¸€ã€çº¿ç¨‹</h2><blockquote>
<p><strong>é‡è¦æ¦‚å¿µï¼š</strong></p>
<ul>
<li><strong>è¿›ç¨‹</strong>ï¼šæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½ã€‚å³è¿è¡Œä¸­çš„åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºæ˜¯é™æ€çš„ï¼Œè€Œè¿›ç¨‹æ˜¯åŠ¨æ€çš„</li>
<li><strong>çº¿ç¨‹</strong>ï¼šæ˜¯æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•ä½ã€‚å®ƒè¢«åŒ…å«åœ¨è¿›ç¨‹ä¹‹ä¸­ï¼Œæ˜¯è¿›ç¨‹ä¸­çš„å®é™…è¿ä½œå•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¹¶å‘å¤šä¸ªçº¿ç¨‹ï¼Œæ¯æ¡çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œä¸åŒçš„ä»»åŠ¡</li>
<li><strong>å¹¶å‘</strong>ï¼šå¤šä¸ªä»»åŠ¡äº¤æ›¿æ‰§è¡Œçš„æ–¹å¼ç§°ä¸ºå¹¶å‘</li>
<li><strong>å¹¶è¡Œ</strong>ï¼šå¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œçš„æ–¹å¼ç§°ä¸ºå¹¶è¡Œï¼ˆ<strong>ä¸ç®¡æ˜¯å•æ ¸ cpu è¿˜æ˜¯å¤šæ ¸ cpu éƒ½æ”¯æŒå¤šä»»åŠ¡</strong>ï¼‰</li>
</ul>
<p><strong>è¿›ç¨‹ä¸çº¿ç¨‹çš„å…³è”ï¼š</strong></p>
<ol>
<li>æ¯ä¸ªè¿›ç¨‹è‡³å°‘å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ã€‚æ¯ä¸ªè¿›ç¨‹ç”¨æ¥å®Œæˆä¸€ä»¶ä»»åŠ¡ï¼Œæ¯ä¸ªçº¿ç¨‹ç”¨æ¥å®Œæˆè¿›ç¨‹å†…çš„ä¸€ä»¶å­ä»»åŠ¡</li>
<li><strong>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œè€Œè¿›ç¨‹å†…çš„æ‰€æœ‰çº¿ç¨‹å…±äº«å†…å­˜ç©ºé—´</strong></li>
</ol>
</blockquote>
<h3 id="1-è‡ªåŠ¨åˆ›å»ºä¸å¯åŠ¨çš„çº¿ç¨‹"><a href="#1-è‡ªåŠ¨åˆ›å»ºä¸å¯åŠ¨çš„çº¿ç¨‹" class="headerlink" title="1. è‡ªåŠ¨åˆ›å»ºä¸å¯åŠ¨çš„çº¿ç¨‹"></a>1. è‡ªåŠ¨åˆ›å»ºä¸å¯åŠ¨çš„çº¿ç¨‹</h3><ul>
<li>ç®€ä»‹ï¼š<strong>ä»»ä½•è¿›ç¨‹éƒ½ä¼šè‡ªåŠ¨åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹è¢«ç§°ä¸ºçˆ¶&#x2F;ä¸»çº¿ç¨‹ï¼Œå…¶é»˜è®¤åç§°ä¸º MainThread</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import time, threading</span><br><span class="line"></span><br><span class="line"># è‡ªåŠ¨åˆ›å»ºå¹¶å¯åŠ¨äº†ä¸»çº¿ç¨‹ï¼šMainThread</span><br><span class="line">print(f&#x27;è‡ªåŠ¨åˆ›å»ºå¹¶å¯åŠ¨äº†ä¸»çº¿ç¨‹ï¼š&#123;threading.current_thread().name&#125;&#x27;)</span><br><span class="line"></span><br><span class="line">time.sleep(5)</span><br></pre></td></tr></table></figure>

<h3 id="2-å­çº¿ç¨‹çš„åˆ›å»º1"><a href="#2-å­çº¿ç¨‹çš„åˆ›å»º1" class="headerlink" title="2. å­çº¿ç¨‹çš„åˆ›å»º1"></a>2. å­çº¿ç¨‹çš„åˆ›å»º1</h3><ul>
<li><p><strong>ä½¿ç”¨ç±»å¯¹è±¡ Thread åˆ›å»ºå¹¶å¯åŠ¨å­çº¿ç¨‹ï¼š</strong>æ ‡å‡†åº“æ¨¡å— threading ä¸­æä¾›äº†ä¸€ä¸ªç±»å¯¹è±¡ Threadï¼Œç”¨äºè¡¨ç¤ºçº¿ç¨‹</p>
</li>
<li><p><strong>åº”ç”¨ï¼š</strong>æ ¹æ®ç±»å¯¹è±¡ Thread åˆ›å»ºçº¿ç¨‹å®ä¾‹å¯¹è±¡ï¼Œè°ƒç”¨çº¿ç¨‹å®ä¾‹å¯¹è±¡çš„æ–¹æ³• start() å³å¯å¯åŠ¨çº¿ç¨‹ï¼ˆ<strong>è°ƒç”¨æ–¹æ³• start() åï¼Œå…ˆä¼šè‡ªåŠ¨è°ƒç”¨ Thread ç±»ä¸­çš„ run() æ–¹æ³•ï¼Œæ–¹æ³•run()åˆä¼šè‡ªåŠ¨è°ƒç”¨å‚æ•° target æŒ‡å®šçš„å‡½æ•°</strong>ï¼‰</p>
</li>
<li><p><strong>åˆ›å»ºçº¿ç¨‹å®ä¾‹å¯¹è±¡æ—¶å¿…é¡»æŒ‡å®šå…³é”®å­—å®å‚ï¼š</strong></p>
<ul>
<li>å…¶æ„é€ æ–¹æ³•å®šä¹‰ä¸ºï¼š<strong>__init__(self, group&#x3D;None, target&#x3D;None, name&#x3D;None, args&#x3D;(), kwargs&#x3D;None, *, daemon&#x3D;None)</strong></li>
</ul>
<ol>
<li><strong>å‚æ•° groupï¼š</strong>ç”¨äºæŒ‡å®šçº¿ç¨‹å®ä¾‹å¯¹è±¡æ‰€å±çš„çº¿ç¨‹ç»„ï¼Œé»˜è®¤ä¸å±äºä»»ä½•çº¿ç¨‹ç»„</li>
<li><strong>å‚æ•° nameï¼š</strong>ç”¨äºæŒ‡å®šåˆ›å»ºçš„çº¿ç¨‹å®ä¾‹å¯¹è±¡çš„åç§°ï¼Œç¬¬nä¸ªå­çº¿ç¨‹çš„é»˜è®¤åç§°ä¸ºâ€™Thread-nâ€™</li>
<li><strong>å‚æ•° targetï¼š</strong>ç”¨äºæŒ‡å®šè¢«æ–¹æ³•run()è°ƒç”¨çš„å‡½æ•°ï¼Œé»˜è®¤æ²¡æœ‰å‡½æ•°è¢«è°ƒç”¨</li>
<li><strong>å‚æ•° argsï¼š</strong>ç”¨äºæŒ‡å®štargetæ¥æ”¶çš„ä½ç½®å‚æ•°ï¼Œç”¨å…ƒç»„è¡¨ç¤ºï¼Œé»˜è®¤ä¸æ¥æ”¶ä½ç½®å‚æ•°</li>
<li><strong>å‚æ•° kwargsï¼š</strong>ç”¨äºæŒ‡å®štargetæ¥æ”¶çš„å…³é”®å­—å‚æ•°ï¼Œç”¨å­—å…¸è¡¨ç¤ºï¼Œé»˜è®¤ä¸æ¥æ”¶å…³é”®å­—å‚æ•°</li>
<li><strong>å‚æ•° daemonï¼š</strong>ç”¨äºæŒ‡å®šçº¿ç¨‹å®ä¾‹å¯¹è±¡æ˜¯å¦æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œé»˜è®¤ä¸æ˜¯å®ˆæŠ¤çº¿ç¨‹</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">print(&#x27;çˆ¶çº¿ç¨‹%så¯åŠ¨&#x27; % threading.current_thread().name)</span><br><span class="line"></span><br><span class="line">def do_sth(arg1, arg2):</span><br><span class="line">    print(&#x27;å­çº¿ç¨‹%så¯åŠ¨&#x27; % threading.current_thread().name)</span><br><span class="line">    time.sleep(2)</span><br><span class="line">    print(&#x27;arg1 = %d, arg2 = %d&#x27; % (arg1, arg2))</span><br><span class="line">    print(&#x27;å­çº¿ç¨‹%sç»“æŸ&#x27; % threading.current_thread().name)</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºçº¿ç¨‹å¯¹è±¡ï¼Œä½†çº¿ç¨‹æ˜¯æ²¡æœ‰è¢«æ“ä½œç³»ç»Ÿåˆ›å»ºçš„</span><br><span class="line">t1 = threading.Thread(target=do_sth, args=(5, 8), name=&#x27;mythread&#x27;)</span><br><span class="line"># å¯åŠ¨çº¿ç¨‹å¯¹è±¡æ—¶ï¼Œæ“ä½œç³»ç»Ÿæ‰åˆ›å»ºçº¿ç¨‹</span><br><span class="line">t1.start()</span><br><span class="line"></span><br><span class="line">time.sleep(5)</span><br><span class="line">print(&#x27;çˆ¶çº¿ç¨‹%sç»“æŸ&#x27; % threading.current_thread().name)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">çˆ¶çº¿ç¨‹MainThreadå¯åŠ¨</span><br><span class="line">å­çº¿ç¨‹mythreadå¯åŠ¨</span><br><span class="line">arg1 = 5, arg2 = 8</span><br><span class="line">å­çº¿ç¨‹mythreadç»“æŸ</span><br><span class="line">çˆ¶çº¿ç¨‹MainThreadç»“æŸ</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="3-å­çº¿ç¨‹çš„åˆ›å»º2"><a href="#3-å­çº¿ç¨‹çš„åˆ›å»º2" class="headerlink" title="3. å­çº¿ç¨‹çš„åˆ›å»º2"></a>3. å­çº¿ç¨‹çš„åˆ›å»º2</h3><ul>
<li><strong>è‡ªå®šä¹‰ç»§æ‰¿è‡ª Thread çš„ç±»å¯¹è±¡ï¼š</strong>é‡å†™ __init__() å’Œ run() æ–¹æ³•ï¼Œä½¿ç”¨è‡ªå®šä¹‰ç±»å¯¹è±¡åˆ›å»ºå¹¶å¯åŠ¨å­çº¿ç¨‹</li>
<li><strong>åº”ç”¨ï¼š</strong>æ ¹æ®è‡ªå®šä¹‰çš„ç±»å¯¹è±¡åˆ›å»ºçº¿ç¨‹å®ä¾‹å¯¹è±¡ï¼Œç„¶åè°ƒç”¨çº¿ç¨‹å®ä¾‹å¯¹è±¡çš„æ–¹æ³• start() å¯åŠ¨çº¿ç¨‹ï¼ˆ<strong>è°ƒç”¨æ–¹æ³• start() åï¼Œä¼šè‡ªåŠ¨è°ƒç”¨é‡å†™åçš„ run() æ–¹æ³•</strong>ï¼‰</li>
<li><strong>ä¸å­çº¿ç¨‹çš„åˆ›å»º 1 çš„åŒºåˆ«ï¼š</strong><ul>
<li><strong>åœ¨åˆ›å»ºçº¿ç¨‹å®ä¾‹å¯¹è±¡æ—¶æ— éœ€å†æŒ‡å®šå‚æ•° target</strong>ï¼Œå‚æ•° target æŒ‡å®šçš„å‡½æ•°çš„å‡½æ•°ä½“è½¬ç§»åˆ°äº†æ–¹æ³• run() ä¸­</li>
<li>ç¬¬ 1 ç§æ–¹å¼åˆ›å»ºçº¿ç¨‹å®ä¾‹å¯¹è±¡æ—¶æŒ‡å®šçš„å…¶å®ƒå‚æ•°ï¼Œåœ¨ç¬¬ 2ç§æ–¹å¼ä¸­å¯ä»¥ä¼ é€’ç»™é‡å†™åçš„ç‰¹æ®Šæ–¹æ³•__init__()</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">from threading import Thread, current_thread</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">print(&#x27;çˆ¶çº¿ç¨‹%så¯åŠ¨&#x27; % current_thread().name)</span><br><span class="line"></span><br><span class="line">class MyThread(Thread):</span><br><span class="line">    def __init__(self, name, args):</span><br><span class="line">        super().__init__(name=name)</span><br><span class="line">        self.args = args</span><br><span class="line"></span><br><span class="line">    def run(self):</span><br><span class="line">        print(&#x27;å­çº¿ç¨‹%så¯åŠ¨&#x27; % current_thread().name)</span><br><span class="line">        time.sleep(2)</span><br><span class="line">        print(&#x27;arg1 = %d, arg2 = %d&#x27; % self.args)</span><br><span class="line">        print(&#x27;å­çº¿ç¨‹%sç»“æŸ&#x27; % current_thread().name)</span><br><span class="line"></span><br><span class="line">mt = MyThread(name=&#x27;mythread&#x27;, args=(5, 8))</span><br><span class="line">mt.start()</span><br><span class="line"></span><br><span class="line">time.sleep(5)</span><br><span class="line">print(&#x27;çˆ¶çº¿ç¨‹%sç»“æŸ&#x27; % current_thread().name)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">çˆ¶çº¿ç¨‹MainThreadå¯åŠ¨</span><br><span class="line">å­çº¿ç¨‹mythreadå¯åŠ¨</span><br><span class="line">arg1 = 5, arg2 = 8</span><br><span class="line">å­çº¿ç¨‹mythreadç»“æŸ</span><br><span class="line">çˆ¶çº¿ç¨‹MainThreadç»“æŸ</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h2 id="äºŒã€è¿›ç¨‹"><a href="#äºŒã€è¿›ç¨‹" class="headerlink" title="äºŒã€è¿›ç¨‹"></a>äºŒã€è¿›ç¨‹</h2><h3 id="1-è‡ªåŠ¨åˆ›å»ºä¸å¯åŠ¨çš„è¿›ç¨‹"><a href="#1-è‡ªåŠ¨åˆ›å»ºä¸å¯åŠ¨çš„è¿›ç¨‹" class="headerlink" title="1. è‡ªåŠ¨åˆ›å»ºä¸å¯åŠ¨çš„è¿›ç¨‹"></a>1. è‡ªåŠ¨åˆ›å»ºä¸å¯åŠ¨çš„è¿›ç¨‹</h3><ul>
<li>ç®€ä»‹ï¼šå½“PyCharmä¸­è¿è¡Œä¸€ä¸ªpyæ–‡ä»¶æ—¶ï¼ŒPyCharmå¯¹åº”çš„è¿›ç¨‹ä¼šè‡ªåŠ¨åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œè¯¥è¿›ç¨‹è¢«ç§°ä¸ºçˆ¶è¿›ç¨‹ï¼Œå…¶é»˜è®¤åç§°ä¸ºPythonã€‚<strong>å½“æ–‡ä»¶è¿è¡Œç»“æŸæ—¶ï¼Œè¿›ç¨‹ä¹Ÿä¼šéšä¹‹ç»“æŸ</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import multiprocessing</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">print(os.getpid())  # è·å–å½“å‰çš„è¿›ç¨‹id</span><br><span class="line">print(os.getppid())  # è·å–å½“å‰è¿›ç¨‹çš„çˆ¶è¿›ç¨‹id</span><br><span class="line"></span><br><span class="line"># æ–¹æ³•current_processå¯ä»¥ç›´æ¥åˆ›å»ºå½“å‰è¿›ç¨‹çš„å®ä¾‹å¯¹è±¡ï¼Œå…¶å±æ€§pidå³ä¸ºå½“å‰è¿›ç¨‹id</span><br><span class="line">print(multiprocessing.current_process().pid)</span><br><span class="line"></span><br><span class="line">time.sleep(5)</span><br></pre></td></tr></table></figure>

<h3 id="2-å­è¿›ç¨‹çš„åˆ›å»º1"><a href="#2-å­è¿›ç¨‹çš„åˆ›å»º1" class="headerlink" title="2. å­è¿›ç¨‹çš„åˆ›å»º1"></a>2. å­è¿›ç¨‹çš„åˆ›å»º1</h3><blockquote>
<p><strong>ä¸ºä»€ä¹ˆè¦åœ¨ if __name__ &#x3D;&#x3D; â€˜__main__â€˜: æ¡ä»¶ä¸‹æ‰§è¡Œä»£ç ï¼Ÿ</strong></p>
<p>è§£é‡Šï¼š<strong>å½“åœ¨ Python ä¸­ä½¿ç”¨å¤šè¿›ç¨‹ç¼–ç¨‹æ—¶ï¼Œç”±äºæ“ä½œç³»ç»Ÿåœ¨åˆ›å»ºå­è¿›ç¨‹æ—¶ä¼šå¤åˆ¶ä¸»è¿›ç¨‹çš„å†…å­˜ç©ºé—´ï¼ŒåŒ…æ‹¬æ‰€æœ‰å·²å¯¼å…¥çš„æ¨¡å—å’Œå…¨å±€å˜é‡ï¼Œå½“å­è¿›ç¨‹è¢«åˆ›å»ºæ—¶ï¼Œå®ƒä¼šé‡æ–°æ‰§è¡Œæ•´ä¸ªè„šæœ¬ï¼Œå¯¼è‡´å¯¼å…¥çš„æ¨¡å—è¢«é‡å¤å¯¼å…¥ï¼Œå…¨å±€å˜é‡è¢«é‡æ–°åˆå§‹åŒ–ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸æ­£ç¡®çš„æ‰§è¡Œç»“æœ</strong>ã€‚åœ¨ __name__ &#x3D;&#x3D; â€˜__main__â€˜ çš„æ¡ä»¶ä¸‹æ‰§è¡Œä»£ç çš„ä½œç”¨æ˜¯ä»…å½“ä½ çš„è„šæœ¬ç›´æ¥è¿è¡Œæ—¶ï¼ˆå³ä½œä¸ºä¸»ç¨‹åºæ‰§è¡Œæ—¶ï¼‰ï¼Œæ‰ä¼šæ‰§è¡Œæ¡ä»¶å—ä¸­çš„ä»£ç ï¼Œå¦‚æœä½ çš„è„šæœ¬è¢«ä½œä¸ºæ¨¡å—å¯¼å…¥åˆ°å…¶ä»–è„šæœ¬ä¸­ï¼Œé‚£ä¹ˆæ¡ä»¶å—ä¸­çš„ä»£ç å°±ä¸ä¼šæ‰§è¡Œã€‚</p>
</blockquote>
<ul>
<li><p><strong>ä½¿ç”¨ç±»å¯¹è±¡ Process åˆ›å»ºå¹¶å¯åŠ¨å­è¿›ç¨‹ï¼š</strong>æ ‡å‡†åº“æ¨¡å— multiprocessing ä¸­æä¾›äº†ä¸€ä¸ªç±»å¯¹è±¡ Processï¼Œç”¨äºè¡¨ç¤ºè¿›ç¨‹</p>
</li>
<li><p><strong>åº”ç”¨ï¼š</strong>æ ¹æ®ç±»å¯¹è±¡ Process åˆ›å»ºè¿›ç¨‹å®ä¾‹å¯¹è±¡ï¼Œè°ƒç”¨è¿›ç¨‹å®ä¾‹å¯¹è±¡çš„æ–¹æ³• start() å³å¯å¯åŠ¨è¿›ç¨‹ï¼ˆ<strong>è°ƒç”¨æ–¹æ³• start() åï¼Œå…ˆä¼šè‡ªåŠ¨è°ƒç”¨ Process ç±»ä¸­çš„ run() æ–¹æ³•ï¼Œæ–¹æ³• run() åˆä¼šè‡ªåŠ¨è°ƒç”¨å‚æ•° target æŒ‡å®šçš„å‡½æ•°</strong>ï¼‰</p>
</li>
<li><p><strong>åˆ›å»ºè¿›ç¨‹å®ä¾‹å¯¹è±¡æ—¶å¿…é¡»æŒ‡å®šå…³é”®å­—å®å‚ï¼š</strong></p>
<ul>
<li>å…¶æ„é€ æ–¹æ³•å®šä¹‰ä¸ºï¼š<strong>__init__(self, group&#x3D;None, target&#x3D;None, name&#x3D;None, args&#x3D;(), kwargs&#x3D;{}, *, daemon&#x3D;None)</strong></li>
</ul>
<ol>
<li><strong>å‚æ•° groupï¼š</strong>ç”¨äºæŒ‡å®šè¿›ç¨‹å®ä¾‹å¯¹è±¡æ‰€å±çš„è¿›ç¨‹ç»„ï¼Œé»˜è®¤ä¸å±äºä»»ä½•è¿›ç¨‹ç»„</li>
<li><strong>å‚æ•° targetï¼š</strong>ç”¨äºæŒ‡å®šè¢«æ–¹æ³•run()è°ƒç”¨çš„å‡½æ•°ï¼Œé»˜è®¤æ²¡æœ‰å‡½æ•°è¢«è°ƒç”¨</li>
<li><strong>å‚æ•° nameï¼š</strong>ç”¨äºæŒ‡å®šåˆ›å»ºçš„è¿›ç¨‹å®ä¾‹å¯¹è±¡çš„åç§°ï¼Œç¬¬nä¸ªå­è¿›ç¨‹çš„é»˜è®¤åç§°ä¸ºâ€™Process-nâ€™</li>
<li><strong>å‚æ•° argsï¼š</strong>ç”¨äºæŒ‡å®štargetæ¥æ”¶çš„ä½ç½®å‚æ•°ï¼Œç”¨å…ƒç»„è¡¨ç¤ºï¼Œé»˜è®¤ä¸æ¥æ”¶ä½ç½®å‚æ•°</li>
<li><strong>å‚æ•° kwargsï¼š</strong>ç”¨äºæŒ‡å®štargetæ¥æ”¶çš„å…³é”®å­—å‚æ•°ï¼Œç”¨å­—å…¸è¡¨ç¤ºï¼Œé»˜è®¤ä¸æ¥æ”¶å…³é”®å­—å‚æ•°</li>
<li><strong>å‚æ•° daemonï¼š</strong>ç”¨äºæŒ‡å®šè¿›ç¨‹å®ä¾‹å¯¹è±¡æ˜¯å¦æ˜¯å®ˆæŠ¤è¿›ç¨‹ï¼Œé»˜è®¤ä¸æ˜¯å®ˆæŠ¤è¿›ç¨‹</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">from multiprocessing import Process, current_process</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">current_pid = current_process().pid</span><br><span class="line">current_name = current_process().name</span><br><span class="line"></span><br><span class="line">def do_sth(arg1, arg2):</span><br><span class="line">    print(&#x27;å­è¿›ç¨‹å¯åŠ¨(%d--%s)&#x27; % (current_pid, current_name))</span><br><span class="line">    time.sleep(2)</span><br><span class="line">    print(&#x27;arg1 = %d, arg2 = %d&#x27; % (arg1, arg2))</span><br><span class="line">    print(&#x27;å­è¿›ç¨‹ç»“æŸ(%d--%s)&#x27; % (current_pid, current_name))</span><br><span class="line"></span><br><span class="line"># ç¡®ä¿åœ¨å¤šè¿›ç¨‹ç¯å¢ƒä¸­ï¼Œä¸»è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´ä¸ä¼šç›¸äº’å¹²æ‰°ï¼Œä¿æŒä»£ç çš„é¢„æœŸè¡Œä¸º</span><br><span class="line"># pythoné»˜è®¤ä½¿ç”¨forkçš„æ–¹å¼æˆåˆ›å»ºè¿›ç¨‹ï¼ŒmacOSå’Œwindowså¿…é¡»è¦å†™å‡½æ•°å…¥å£ï¼Œè€Œlinuxä¸ç”¨</span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    print(&#x27;çˆ¶è¿›ç¨‹å¯åŠ¨(%d--%s)&#x27; % (current_pid, current_name))</span><br><span class="line">    process = Process(target=do_sth, args=(5, 8), name=&quot;childProcess&quot;)</span><br><span class="line">    process.start()</span><br><span class="line">    # is_alive()æ–¹æ³•ç”¨äºæ£€æŸ¥ä¸€ä¸ªè¿›ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€</span><br><span class="line">    print(process.is_alive())</span><br><span class="line">    time.sleep(5)</span><br><span class="line">    print(process.is_alive())</span><br><span class="line">    print(&#x27;çˆ¶è¿›ç¨‹ç»“æŸ(%d--%s)&#x27; % (current_pid, current_name))</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">çˆ¶è¿›ç¨‹å¯åŠ¨(15936--MainProcess)</span><br><span class="line">True</span><br><span class="line">å­è¿›ç¨‹å¯åŠ¨(15938--childProcess)</span><br><span class="line">arg1 = 5, arg2 = 8</span><br><span class="line">å­è¿›ç¨‹ç»“æŸ(15938--childProcess)</span><br><span class="line">False</span><br><span class="line">çˆ¶è¿›ç¨‹ç»“æŸ(15936--MainProcess)</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="3-å­è¿›ç¨‹çš„åˆ›å»º2"><a href="#3-å­è¿›ç¨‹çš„åˆ›å»º2" class="headerlink" title="3. å­è¿›ç¨‹çš„åˆ›å»º2"></a>3. å­è¿›ç¨‹çš„åˆ›å»º2</h3><ul>
<li><p><strong>è‡ªå®šä¹‰ç»§æ‰¿è‡ª Process çš„ç±»å¯¹è±¡ï¼š</strong>é‡å†™ __init__() å’Œ run() æ–¹æ³•ï¼Œä½¿ç”¨è‡ªå®šä¹‰ç±»å¯¹è±¡åˆ›å»ºå¹¶å¯åŠ¨å­è¿›ç¨‹</p>
</li>
<li><p><strong>åº”ç”¨ï¼š</strong>æ ¹æ®è‡ªå®šä¹‰çš„ç±»å¯¹è±¡åˆ›å»ºè¿›ç¨‹å®ä¾‹å¯¹è±¡ï¼Œè°ƒç”¨è¿›ç¨‹å®ä¾‹å¯¹è±¡çš„æ–¹æ³• start() å¯åŠ¨è¿›ç¨‹ï¼ˆ<strong>è°ƒç”¨æ–¹æ³• start() åï¼Œä¼šè‡ªåŠ¨è°ƒç”¨é‡å†™åçš„ run() æ–¹æ³•</strong>ï¼‰</p>
</li>
<li><p><strong>ä¸å­è¿›ç¨‹çš„åˆ›å»º 1 çš„åŒºåˆ«ï¼š</strong></p>
<ul>
<li><p><strong>åœ¨åˆ›å»ºè¿›ç¨‹å®ä¾‹å¯¹è±¡æ—¶æ— éœ€å†æŒ‡å®šå‚æ•° target</strong>ï¼Œå‚æ•° target æŒ‡å®šçš„å‡½æ•°çš„å‡½æ•°ä½“è½¬ç§»åˆ°äº†æ–¹æ³• run() ä¸­</p>
</li>
<li><p>ç¬¬ 1 ç§æ–¹å¼åˆ›å»ºè¿›ç¨‹å®ä¾‹å¯¹è±¡æ—¶æŒ‡å®šçš„å…¶å®ƒå‚æ•°ï¼Œåœ¨ç¬¬ 2 ç§æ–¹å¼ä¸­å¯ä»¥ä¼ é€’ç»™é‡å†™åçš„ç‰¹æ®Šæ–¹æ³•__init__()</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">from multiprocessing import Process, current_process</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">current_pid = current_process().pid</span><br><span class="line">current_name = current_process().name</span><br><span class="line"></span><br><span class="line">class MyProcess(Process):</span><br><span class="line">    def __init__(self, name, args):</span><br><span class="line">        super().__init__(name=name)</span><br><span class="line">        self.args = args</span><br><span class="line"></span><br><span class="line">    def run(self):</span><br><span class="line">        print(&#x27;å­è¿›ç¨‹å¯åŠ¨(%d--%s)&#x27; % (current_pid, current_name))</span><br><span class="line">        time.sleep(2)</span><br><span class="line">        print(&#x27;arg1 = %d, arg2 = %d&#x27; % self.args)</span><br><span class="line">        print(&#x27;å­è¿›ç¨‹ç»“æŸ(%d--%s)&#x27; % (current_pid, current_name))</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    print(&#x27;çˆ¶è¿›ç¨‹å¯åŠ¨(%d--%s)&#x27; % (current_pid, current_name))</span><br><span class="line"></span><br><span class="line">    mp = MyProcess(name=&#x27;myprocess&#x27;, args=(5, 8))</span><br><span class="line">    mp.start()</span><br><span class="line"></span><br><span class="line">    time.sleep(5)</span><br><span class="line">    print(&#x27;çˆ¶è¿›ç¨‹ç»“æŸ(%d--%s)&#x27; % (current_pid, current_name))</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">çˆ¶è¿›ç¨‹å¯åŠ¨(16074--MainProcess)</span><br><span class="line">å­è¿›ç¨‹å¯åŠ¨(16076--myprocess)</span><br><span class="line">arg1 = 5, arg2 = 8</span><br><span class="line">å­è¿›ç¨‹ç»“æŸ(16076--myprocess)</span><br><span class="line">çˆ¶è¿›ç¨‹ç»“æŸ(16074--MainProcess)</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="4-å­è¿›ç¨‹çš„åˆ›å»º3"><a href="#4-å­è¿›ç¨‹çš„åˆ›å»º3" class="headerlink" title="4. å­è¿›ç¨‹çš„åˆ›å»º3"></a>4. å­è¿›ç¨‹çš„åˆ›å»º3</h3><ul>
<li><strong>æ ‡å‡†åº“æ¨¡å— os ä¸­æä¾›äº†ä¸€ä¸ªå‡½æ•° fork()ï¼š</strong>ç”¨äºå°†å½“å‰è¿›ç¨‹å¤åˆ¶ä¸€ä»½ä¸ºå­è¿›ç¨‹ï¼Œè€Œåçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä»è°ƒç”¨ fork() å¤„å¼€å§‹åˆ†å‰ï¼Œforkçš„å«ä¹‰å³å…µåˆ†ä¸¤è·¯ï¼Œç»§ç»­å¹¶è¡Œè¿è¡Œåé¢çš„ç¨‹åº</li>
<li><strong>ä¸æ™®é€šå‡½æ•°ä¸åŒçš„æ˜¯ï¼Œå‡½æ•° fork() ä¼šè¿”å›ä¸¤æ¬¡ï¼Œåˆ†åˆ«åœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹å†…è¿”å›ã€‚è¿”å›å€¼æœ‰ä¸‰ç§æƒ…å†µï¼š</strong><ol>
<li>è¿”å›å€¼å°äº0ï¼Œè¡¨ç¤ºå¤åˆ¶å­è¿›ç¨‹å¤±è´¥</li>
<li>è¿”å›å€¼ç­‰äº0ï¼Œè¡¨ç¤ºå¤„åœ¨å­è¿›ç¨‹ä¸­</li>
<li>è¿”å›å€¼å¤§äº0ï¼Œè¡¨ç¤ºå¤„åœ¨çˆ¶è¿›ç¨‹ä¸­ï¼Œè¿”å›å€¼å°±æ˜¯å­è¿›ç¨‹çš„ id</li>
</ol>
</li>
<li><strong>æ³¨æ„ï¼šå‡½æ•° fork() ä¸æ˜¯è·¨å¹³å°çš„ï¼Œæ‰€ä»¥åœ¨ windows æ“ä½œç³»ç»Ÿä¸Šæ— æ³•è°ƒç”¨å‡½æ•° fork()ï¼Œè€Œæ¨¡å— multiprocessing æ˜¯è·¨å¹³å°çš„</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    flag = os.fork()</span><br><span class="line">except OSError:</span><br><span class="line">    print(&#x27;ä½ çš„æ“ä½œç³»ç»Ÿä¸æ”¯æŒè°ƒç”¨å‡½æ•°fork()&#x27;)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line">if flag &lt; 0:</span><br><span class="line">    print(&#x27;å¤åˆ¶å­è¿›ç¨‹å¤±è´¥&#x27;)</span><br><span class="line">elif flag == 0:</span><br><span class="line">    print(f&#x27;æˆ‘å¤„åœ¨å­è¿›ç¨‹ &#123;os.getpid()&#125; ä¸­ï¼Œçˆ¶è¿›ç¨‹idä¸º &#123;os.getppid()&#125;&#x27;)</span><br><span class="line">    # æˆ‘å¤„åœ¨å­è¿›ç¨‹ 2646 ä¸­ï¼Œçˆ¶è¿›ç¨‹idä¸º 2645</span><br><span class="line">else:</span><br><span class="line">    print(f&#x27;æˆ‘å¤„åœ¨çˆ¶è¿›ç¨‹ä¸­ï¼Œå­è¿›ç¨‹idä¸º &#123;flag&#125;&#x27;)</span><br><span class="line">    # æˆ‘å¤„åœ¨çˆ¶è¿›ç¨‹ä¸­ï¼Œå­è¿›ç¨‹idä¸º 2646</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€è¿›ç¨‹æ± ä¸çº¿ç¨‹æ± "><a href="#ä¸‰ã€è¿›ç¨‹æ± ä¸çº¿ç¨‹æ± " class="headerlink" title="ä¸‰ã€è¿›ç¨‹æ± ä¸çº¿ç¨‹æ± "></a>ä¸‰ã€è¿›ç¨‹æ± ä¸çº¿ç¨‹æ± </h2><h3 id="1-è¿›ç¨‹æ± Pool"><a href="#1-è¿›ç¨‹æ± Pool" class="headerlink" title="1. è¿›ç¨‹æ± Pool"></a>1. è¿›ç¨‹æ± Pool</h3><ul>
<li><strong>æ ‡å‡†åº“æ¨¡å— multiprocessing ä¸­æä¾›äº†ä¸€ä¸ªç±»å¯¹è±¡Poolï¼š</strong>ç”¨äºè¡¨ç¤ºè¿›ç¨‹æ± ï¼Œè¿›ç¨‹æ± ä¸­æ‰€èƒ½å®¹çº³çš„è¿›ç¨‹æ•°ç›®å¯ä»¥åœ¨åˆ›å»º Pool å®ä¾‹å¯¹è±¡æ—¶è¿›è¡ŒæŒ‡å®šï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤å¤§å°æ˜¯ CPU çš„æ ¸æ•°</li>
<li><strong>ä½œç”¨ï¼š</strong>å¦‚æœå¹¶å‘çš„ä»»åŠ¡æ•°è¿‡å¤šï¼Œä¸€æ¬¡æ€§åˆ›å»ºå¹¶å¯åŠ¨å¤§é‡çš„è¿›ç¨‹ä¼šç»™è®¡ç®—æœºå¸¦æ¥å¾ˆå¤§çš„å‹åŠ›ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨è¿›ç¨‹æ± å¯¹åˆ›å»ºä¸å¯åŠ¨çš„è¿›ç¨‹è¿›è¡Œé™åˆ¶å’Œç®¡ç†ï¼ˆ<strong>è¿›ç¨‹æ± ä¸­æ‰€èƒ½å®¹çº³çš„è¿›ç¨‹æ•°ç›®æ˜¯å›ºå®šçš„</strong>ï¼‰</li>
<li><strong>Pool è¿›ç¨‹æ± çš„å¸¸ç”¨æ–¹æ³•ï¼š</strong><ul>
<li><strong>apply_async()ï¼š</strong>è¡¨ç¤ºå¼‚æ­¥ï¼Œå­è¿›ç¨‹æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åå°±å„è‡ªå»æ‰§è¡Œäº†ã€‚ä½œç”¨ä¸æ–¹æ³• start() ç±»ä¼¼ï¼Œä½†åˆ›å»ºå¹¶å¯åŠ¨çš„æ˜¯ç”±è¿›ç¨‹æ± ç®¡ç†çš„å­è¿›ç¨‹</li>
<li>apply()ï¼šè¡¨ç¤ºåŒæ­¥ï¼Œå­è¿›ç¨‹ä»¬å°†ä¸€ä¸ªä¸€ä¸ªçš„æ‰§è¡Œï¼Œåä¸€ä¸ªå­è¿›ç¨‹çš„æ‰§è¡Œæ°¸è¿œä»¥å‰ä¸€ä¸ªå­è¿›ç¨‹çš„ç»“æŸä¸ºä¿¡å·ï¼Œå¼€å§‹æ‰§è¡Œ</li>
<li><strong>close()ï¼š</strong>å…³é—­è¿›ç¨‹æ± ï¼Œè‡³æ­¤è¿›ç¨‹æ± ä¸­ä¸å†æœ‰è¿›ç¨‹å¯ä»¥æ¥å—ä»»åŠ¡ï¼ˆè°ƒç”¨æ–¹æ³• join ä¹‹å‰å¿…é¡»å…ˆè°ƒç”¨æ–¹æ³• closeï¼‰</li>
<li>terminate()ï¼šç»“æŸå½“å‰è¿›ç¨‹æ± ä¸­çš„æ‰€æœ‰è¿›ç¨‹ï¼Œä¸å†å¤„ç†æœªå®Œæˆçš„ä»»åŠ¡ï¼Œä¸ç®¡æ‰§æ²¡æ‰§è¡Œ</li>
<li><strong>join()ï¼š</strong>é˜»å¡ä¸»è¿›ç¨‹ï¼Œç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå†ç»§ç»­æ‰§è¡Œä¸»è¿›ç¨‹</li>
</ul>
</li>
<li><strong>å„æ–¹æ³•æ‰§è¡Œé¡ºåºï¼šclose() &gt; terminate() &gt; join()ã€‚å…¶ä¸­ï¼Œterminateå’Œjoinæ–¹æ³•å¯ä»¥éƒ½ä¸æ‰§è¡Œï¼Œé‚£ä¹ˆå­è¿›ç¨‹å’Œä¸»è¿›ç¨‹å°±å„è‡ªæ‰§è¡Œå„è‡ªçš„ï¼Œæ— è®ºæ‰§è¡Œåˆ°å“ªé‡Œï¼Œå­è¿›ç¨‹ä¼šéšç€ä¸»è¿›ç¨‹çš„ç»“æŸè€Œç»“æŸ</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">from multiprocessing import Pool</span><br><span class="line">import time, random</span><br><span class="line"></span><br><span class="line">def do_sth(i):</span><br><span class="line">    print(&#x27;å­è¿›ç¨‹%då¯åŠ¨&#x27; % i)</span><br><span class="line">    start = time.time()</span><br><span class="line">    time.sleep(random.random() * 10)</span><br><span class="line">    end = time.time()</span><br><span class="line">    print(&#x27;å­è¿›ç¨‹%dç»“æŸï¼Œè€—æ—¶%.2fç§’&#x27; % (i, end - start))</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    print(&#x27;çˆ¶è¿›ç¨‹å¯åŠ¨&#x27;)</span><br><span class="line">    # å°†è¿›ç¨‹æ± æ‰€èƒ½å®¹çº³çš„æœ€å¤§è¿›ç¨‹æ•°æŒ‡å®šä¸º3</span><br><span class="line">    pp = Pool(3)</span><br><span class="line">    # å¼‚æ­¥æ‰§è¡Œå­è¿›ç¨‹</span><br><span class="line">    for i in range(1, 11):</span><br><span class="line">        pp.apply_async(do_sth, args=(i,))</span><br><span class="line"></span><br><span class="line">    pp.close()  # åœ¨joinä¹‹å‰å¿…é¡»å…³é—­è¿›ç¨‹æ± </span><br><span class="line">    time.sleep(5)</span><br><span class="line">    pp.terminate()  # 5ç§’åï¼Œç»ˆæ­¢çˆ¶è¿›ç¨‹å’Œè¿›ç¨‹æ± ä¸­çš„æ‰€æœ‰è¿›ç¨‹ï¼Œä¸”ä¸å—joiné™åˆ¶ï¼Œæ˜¯æ— æ•Œçš„</span><br><span class="line">    pp.join()  # å¦‚æœå¼€å¯ time.sleep(5) + pp.terminate()ï¼Œé‚£ä¹ˆjoinåœ¨æ­¤å¤„å·²ç»æ— æ•ˆäº†</span><br><span class="line">    print(&quot;çˆ¶è¿›ç¨‹ç»“æŸ&quot;)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">çˆ¶è¿›ç¨‹å¯åŠ¨</span><br><span class="line">å­è¿›ç¨‹1å¯åŠ¨</span><br><span class="line">å­è¿›ç¨‹2å¯åŠ¨</span><br><span class="line">å­è¿›ç¨‹3å¯åŠ¨</span><br><span class="line">å­è¿›ç¨‹3ç»“æŸï¼Œè€—æ—¶3.23ç§’</span><br><span class="line">å­è¿›ç¨‹4å¯åŠ¨</span><br><span class="line">å­è¿›ç¨‹1ç»“æŸï¼Œè€—æ—¶3.37ç§’</span><br><span class="line">å­è¿›ç¨‹5å¯åŠ¨</span><br><span class="line">å­è¿›ç¨‹4ç»“æŸï¼Œè€—æ—¶0.54ç§’</span><br><span class="line">å­è¿›ç¨‹6å¯åŠ¨</span><br><span class="line">çˆ¶è¿›ç¨‹ç»“æŸ</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="2-ProcessPoolExecutor"><a href="#2-ProcessPoolExecutor" class="headerlink" title="2. ProcessPoolExecutor"></a>2. ProcessPoolExecutor</h3><ul>
<li><strong>æ ‡å‡†åº“æ¨¡å— concurrent.futures ä¸­æä¾›äº†ä¸€ä¸ªç±»å¯¹è±¡ ProcessPoolExecutorï¼š</strong>ä¹Ÿç”¨äºè¡¨ç¤ºè¿›ç¨‹æ± ï¼Œä¸ Pool ç›¸æ¯”ï¼ŒProcessPoolExecutor çš„åŠŸèƒ½å’Œæ€§èƒ½æ›´åŠ å¼ºå¤§</li>
<li><strong>åº”ç”¨ï¼š</strong>ç±»å¯¹è±¡ ProcessPoolExecutor <strong>éµå®ˆäº†ä¸Šä¸‹æ–‡ç®¡ç†åè®®</strong>ï¼Œä½¿ç”¨ with è¯­å¥åœ¨ç¦»å¼€è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ä¼šè‡ªåŠ¨è°ƒç”¨ ppe.shutdown(wait&#x3D;True) æ–¹æ³•å…³é—­è¿›ç¨‹æ± </li>
<li><strong>ProcessPoolExecutor è¿›ç¨‹æ± çš„å¸¸ç”¨æ–¹æ³•ï¼š</strong><ul>
<li><strong>submit(func, *args, **kwargs)ï¼š</strong>ç”¨äºå°†å•ä¸ªä»»åŠ¡æäº¤åˆ°è¿›ç¨‹æ± ï¼Œå¹¶è¿”å›ä¸€ä¸ª Future å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä»£è¡¨äº†å°†æ¥ä¼šå®Œæˆçš„ä»»åŠ¡ï¼Œæ­¤åä¼šåˆ›å»ºå¹¶å¯åŠ¨ç”±è¿›ç¨‹æ± ç®¡ç†çš„å­è¿›ç¨‹</li>
<li><strong>map(func, iterable, timeout&#x3D;None)ï¼š</strong>ç”¨æ³•ä¸å†…ç½®å‡½æ•° map ç±»ä¼¼ï¼Œæ˜¯é˜»å¡çš„ï¼Œç”¨äºæ‰¹é‡æäº¤å¤šä¸ªä»»åŠ¡åˆ°è¿›ç¨‹æ± ï¼Œå¹¶è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œé€šè¿‡è¿­ä»£å™¨å¯ä»¥è·å–æ¯ä¸ªä»»åŠ¡çš„ç»“æœã€‚å…¶ç¬¬äºŒä¸ªå‚æ•°ä¸ºå¯è¿­ä»£å¯¹è±¡ï¼Œæ­¤åä¼šåˆ›å»ºå¹¶å¯åŠ¨ç”±è¿›ç¨‹æ± ç®¡ç†çš„å­è¿›ç¨‹</li>
<li><strong>shutdown()ï¼š</strong>é˜»å¡ä¸»è¿›ç¨‹ï¼Œå¾…è¿›ç¨‹æ± ç®¡ç†çš„æ‰€æœ‰å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œçˆ¶è¿›ç¨‹å†ä»è¢«é˜»å¡çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œï¼Œå¹¶ä¸”æŠŠè¿›ç¨‹æ± å…³é—­ï¼ˆ<strong>ç›¸å½“äº close + join æ–¹æ³•çš„ç»„åˆ</strong>ï¼‰</li>
</ul>
</li>
<li><strong>Futureå¯¹è±¡</strong>ï¼šåœ¨ ProcessPoolExecutor è¿›ç¨‹æ± ä¸­ï¼Œæ–¹æ³• submit() çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª Future å®ä¾‹å¯¹è±¡ï¼Œè¡¨ç¤ºå­è¿›ç¨‹æ‰€è°ƒç”¨çš„å‡½æ•°çš„æ‰§è¡Œï¼Œ<strong>å¯ä»¥è°ƒç”¨ Future çš„æ–¹æ³• result() å¾—åˆ°è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼</strong><ul>
<li><strong>result()ï¼šæ–¹æ³• result() æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æ¯ç›´åˆ°è¿™ä¸ªå‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œresult() æ‰ä¼šè¿”å›</strong></li>
<li><strong>cancel()ï¼šä»»åŠ¡å–æ¶ˆ</strong></li>
<li><strong>done()ï¼šè·å–å½“å‰ future å¯¹è±¡æ˜¯å¦å®Œæˆä»»åŠ¡çš„çŠ¶æ€</strong></li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">from concurrent.futures import ProcessPoolExecutor</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def do_sth(i):</span><br><span class="line">    time.sleep(2)</span><br><span class="line">    return i * i</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    # with ProcessPoolExecutor(max_workers=3) as ppe:</span><br><span class="line">    #     for i in range(1, 5):</span><br><span class="line">    #         future = ppe.submit(do_sth, i)</span><br><span class="line">    #         print(future.result())  # åŒæ­¥ï¼Œéœ€è¦ç­‰å¾…æ¯ä¸€ä¸ªå­è¿›ç¨‹çš„do_sthæ‰§è¡Œå®Œæ¯•</span><br><span class="line"></span><br><span class="line">    future_objs = []</span><br><span class="line">    start = time.time()</span><br><span class="line">    with ProcessPoolExecutor(max_workers=3) as ppe:</span><br><span class="line">        for i in range(1, 5):</span><br><span class="line">            future = ppe.submit(do_sth, i)</span><br><span class="line">            future_objs.append(future)  # å¼‚æ­¥ï¼Œå…ˆä¸è°ƒç”¨æ–¹æ³•result()ï¼Œåªæ˜¯å­˜è¿›åˆ—è¡¨</span><br><span class="line"></span><br><span class="line">    for obj in future_objs:</span><br><span class="line">        print(obj.result())</span><br><span class="line"></span><br><span class="line">    end = time.time()</span><br><span class="line">    print(&quot;å¼‚æ­¥æ‰§è¡Œæ€»è€—æ—¶ï¼š%.2fç§’&quot; % (end - start))  # å¼‚æ­¥æ‰§è¡Œæ€»è€—æ—¶ï¼š4.08ç§’</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">1</span><br><span class="line">4</span><br><span class="line">9</span><br><span class="line">16</span><br><span class="line">å¼‚æ­¥æ‰§è¡Œæ€»è€—æ—¶ï¼š4.07ç§’</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="3-çº¿ç¨‹æ± ThreadPool"><a href="#3-çº¿ç¨‹æ± ThreadPool" class="headerlink" title="3. çº¿ç¨‹æ± ThreadPool"></a>3. çº¿ç¨‹æ± ThreadPool</h3><ul>
<li><strong>ç¬¬ä¸‰æ–¹åº“ threadpool ä¸­æä¾›äº†ä¸€ä¸ªç±»å¯¹è±¡ ThreadPoolï¼š</strong>ç”¨äºè¡¨ç¤ºçº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± ä¸­æ‰€èƒ½å®¹çº³çš„çº¿ç¨‹æ•°ç›®å¯ä»¥åœ¨åˆ›å»º ThreadPool å®ä¾‹å¯¹è±¡æ—¶è¿›è¡ŒæŒ‡å®šï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤å¤§å°æ˜¯ CPU çš„æ ¸æ•°</li>
<li><strong>ä½œç”¨ï¼š</strong>å¦‚æœå¹¶å‘çš„ä»»åŠ¡æ•°è¿‡å¤šï¼Œä¸€æ¬¡æ€§åˆ›å»ºå¹¶å¯åŠ¨å¤§é‡çš„çº¿ç¨‹ä¼šç»™è®¡ç®—æœºå¸¦æ¥å¾ˆå¤§çš„å‹åŠ›ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± å¯¹åˆ›å»ºä¸å¯åŠ¨çš„çº¿ç¨‹è¿›è¡Œé™åˆ¶å’Œç®¡ç†ï¼ˆ<strong>çº¿ç¨‹æ± ä¸­æ‰€èƒ½å®¹çº³çš„çº¿ç¨‹æ•°ç›®æ˜¯å›ºå®šçš„</strong>ï¼‰</li>
<li><strong>ThreadPool çº¿ç¨‹æ± çš„å¸¸ç”¨æ–¹æ³•ï¼š</strong><ul>
<li><strong>makeRequests()ï¼š</strong>åˆ›å»ºéœ€è¦çº¿ç¨‹æ± å¤„ç†çš„ä»»åŠ¡ï¼Œè¿”å›ä¸€ä¸ªåˆ—è¡¨</li>
<li><strong>putRequest()ï¼š</strong>å°†éœ€è¦çº¿ç¨‹æ± å¤„ç†çš„ä»»åŠ¡å…¨éƒ¨äº¤ç»™çº¿ç¨‹æ± ï¼Œæ­¤åä¼šåˆ›å»ºå¹¶å¯åŠ¨ç”±çº¿ç¨‹æ± ç®¡ç†çš„å­çº¿ç¨‹</li>
<li><strong>wait()ï¼š</strong>é˜»å¡ä¸»çº¿ç¨‹ï¼Œå¾…çº¿ç¨‹æ± ç®¡ç†çš„æ‰€æœ‰å­çº¿ç¨‹æ‰§è¡Œå®Œåï¼Œçˆ¶çº¿ç¨‹å†ä»è¢«é˜»å¡çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œ</li>
</ul>
</li>
<li><strong>æ³¨æ„ï¼šwait() æ–¹æ³•ç­‰ä»· join() æ–¹æ³•ã€‚è™½ç„¶çº¿ç¨‹ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ join() æ–¹æ³•ï¼Œä½†é‚£æ˜¯ threading æ¨¡å—ä¸­çš„ Thread ç±»å¯¹è±¡ä¸­æ‰æœ‰çš„æ–¹æ³•ï¼Œè€Œæ­¤å¤„ threadpool æ¨¡å—ä¸­çš„ ThreadPool ç±»å¯¹è±¡ä¸­åªæœ‰ wait() æ–¹æ³•ç”¨äºé˜»å¡ä¸»çº¿ç¨‹</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">from threadpool import ThreadPool, makeRequests</span><br><span class="line">import time, random</span><br><span class="line"></span><br><span class="line"># ä¼ é€’ç»™å‡½æ•°çš„å®å‚åˆ—è¡¨</span><br><span class="line">args_list = [i for i in range(1, 11)]</span><br><span class="line"></span><br><span class="line">def do_sth(i):</span><br><span class="line">    print(&#x27;å­çº¿ç¨‹%då¯åŠ¨&#x27; % i)</span><br><span class="line">    start = time.time()</span><br><span class="line">    time.sleep(random.random() * 10)</span><br><span class="line">    end = time.time()</span><br><span class="line">    print(&#x27;å­çº¿ç¨‹%dç»“æŸï¼Œè€—æ—¶%.2fç§’&#x27; % (i, end - start))</span><br><span class="line"></span><br><span class="line">print(&#x27;çˆ¶çº¿ç¨‹å¯åŠ¨&#x27;)</span><br><span class="line">tp = ThreadPool(3)  # åˆ›å»ºèƒ½å®¹çº³çš„æœ€å¤§çº¿ç¨‹æ•°ä¸º3çš„çº¿ç¨‹æ± </span><br><span class="line">requests = makeRequests(do_sth, args_list)  # åˆ›å»ºéœ€è¦çº¿ç¨‹æ± å¤„ç†çš„ä»»åŠ¡åˆ—è¡¨</span><br><span class="line">for req in requests:  # å°†éœ€è¦çº¿ç¨‹æ± å¤„ç†çš„ä»»åŠ¡å…¨éƒ¨äº¤ç»™çº¿ç¨‹æ± </span><br><span class="line">    tp.putRequest(req)</span><br><span class="line">tp.wait()  # é˜»å¡ä¸»çº¿ç¨‹</span><br><span class="line">print(&#x27;çˆ¶çº¿ç¨‹ç»“æŸ&#x27;)</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">çˆ¶çº¿ç¨‹å¯åŠ¨</span><br><span class="line">å­çº¿ç¨‹1å¯åŠ¨</span><br><span class="line">å­çº¿ç¨‹2å¯åŠ¨</span><br><span class="line">å­çº¿ç¨‹3å¯åŠ¨</span><br><span class="line">å­çº¿ç¨‹1ç»“æŸï¼Œè€—æ—¶1.48ç§’</span><br><span class="line">å­çº¿ç¨‹4å¯åŠ¨</span><br><span class="line">å­çº¿ç¨‹4ç»“æŸï¼Œè€—æ—¶0.03ç§’</span><br><span class="line">å­çº¿ç¨‹5å¯åŠ¨</span><br><span class="line">å­çº¿ç¨‹5ç»“æŸï¼Œè€—æ—¶2.12ç§’</span><br><span class="line">å­çº¿ç¨‹6å¯åŠ¨</span><br><span class="line">å­çº¿ç¨‹2ç»“æŸï¼Œè€—æ—¶3.81ç§’</span><br><span class="line">å­çº¿ç¨‹7å¯åŠ¨</span><br><span class="line">å­çº¿ç¨‹6ç»“æŸï¼Œè€—æ—¶4.11ç§’</span><br><span class="line">å­çº¿ç¨‹8å¯åŠ¨</span><br><span class="line">å­çº¿ç¨‹8ç»“æŸï¼Œè€—æ—¶1.11ç§’</span><br><span class="line">å­çº¿ç¨‹9å¯åŠ¨</span><br><span class="line">å­çº¿ç¨‹3ç»“æŸï¼Œè€—æ—¶9.79ç§’</span><br><span class="line">å­çº¿ç¨‹10å¯åŠ¨</span><br><span class="line">å­çº¿ç¨‹9ç»“æŸï¼Œè€—æ—¶1.71ç§’</span><br><span class="line">å­çº¿ç¨‹7ç»“æŸï¼Œè€—æ—¶7.13ç§’</span><br><span class="line">å­çº¿ç¨‹10ç»“æŸï¼Œè€—æ—¶3.09ç§’</span><br><span class="line">çˆ¶çº¿ç¨‹ç»“æŸ</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="4-ThreadPoolExecutor"><a href="#4-ThreadPoolExecutor" class="headerlink" title="4. ThreadPoolExecutor"></a>4. ThreadPoolExecutor</h3><ul>
<li><p><strong>æ ‡å‡†åº“æ¨¡å— concurrent.futures ä¸­è¿˜æä¾›äº†ä¸€ä¸ªç±»å¯¹è±¡ ThreadPoolExecutorï¼š</strong>ç”¨äºå®ç°çº¿ç¨‹æ± ï¼Œç®¡ç†å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡</p>
</li>
<li><p><strong>åº”ç”¨ï¼š</strong>ç±»å¯¹è±¡ ThreadPoolExecutor <strong>éµå®ˆäº†ä¸Šä¸‹æ–‡ç®¡ç†åè®®</strong>ï¼Œä½¿ç”¨ with è¯­å¥åœ¨ç¦»å¼€è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ä¼šè‡ªåŠ¨è°ƒç”¨ tpe.shutdown() æ–¹æ³•å…³é—­çº¿ç¨‹æ± </p>
</li>
<li><p><strong>å…¶ä½™ç”¨æ³•ï¼šçº¿ç¨‹æ±  ThreadPoolExecutor ä¸è¿›ç¨‹æ±  ProcessPoolExecutor çš„æ‰€æœ‰ç”¨æ³•å‡ ä¹ä¸€è‡´</strong></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from concurrent.futures import ThreadPoolExecutor</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def square(x):</span><br><span class="line">    time.sleep(2)</span><br><span class="line">    return x * x</span><br><span class="line"></span><br><span class="line">with ThreadPoolExecutor(max_workers=2) as tpe:</span><br><span class="line">    # ä¸»çº¿ç¨‹æäº¤äº† 3 ä¸ªä»»åŠ¡å¹¶ç­‰å¾…å…¶å®Œæˆï¼Œåœ¨ç­‰å¾…çš„è¿‡ç¨‹ä¸­ï¼Œå‰é¢ä¸¤ä¸ªä»»åŠ¡å¯èƒ½å·²ç»å®Œæˆï¼Œå®ƒä»¬çš„ç»“æœä¼šç«‹å³è¢«æ‰“å°å‡ºæ¥</span><br><span class="line">    # 1. ä½¿ç”¨submitæ–¹æ³•æäº¤ä»»åŠ¡åˆ°çº¿ç¨‹æ± </span><br><span class="line">    future_objs = []</span><br><span class="line">    for i in range(2, 5):</span><br><span class="line">        future = tpe.submit(square, i)</span><br><span class="line">        future_objs.append(future)</span><br><span class="line"></span><br><span class="line">    for obj in future_objs:</span><br><span class="line">        print(obj.result())  # 4 9 16</span><br><span class="line"></span><br><span class="line">    # 2. ä½¿ç”¨mapæ–¹æ³•æ‰¹é‡æäº¤ä»»åŠ¡åˆ°çº¿ç¨‹æ± </span><br><span class="line">    # results = tpe.map(square, range(2, 5))</span><br><span class="line">    # for result in results:</span><br><span class="line">    #     print(result)  # 4 9 16</span><br></pre></td></tr></table></figure>

<h3 id="5-æ–¹æ³•waitä¸as-completed"><a href="#5-æ–¹æ³•waitä¸as-completed" class="headerlink" title="5. æ–¹æ³•waitä¸as_completed"></a>5. æ–¹æ³•waitä¸as_completed</h3><ul>
<li>**wait(fs, timeout&#x3D;None, return_when&#x3D;ALL_COMPLETED)**ï¼š<ul>
<li><strong>ä½œç”¨ï¼šç”¨äºç­‰å¾…ä¸€ç»„ä»»åŠ¡å®Œæˆï¼Œæ˜¯é˜»å¡çš„ï¼Œå¯æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ª Future å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œä¸€ç›´ç­‰å¾…ç›´åˆ°æ‰€æœ‰æŒ‡å®šçš„ Future å¯¹è±¡éƒ½æ»¡è¶³æŒ‡å®šçš„æ¡ä»¶</strong></li>
<li><strong>å‚æ•° fs</strong>ï¼šæ˜¯ä¸€ä¸ª Future å¯¹è±¡çš„åˆ—è¡¨ï¼Œè¡¨ç¤ºè¦ç­‰å¾…çš„ä»»åŠ¡é›†åˆ</li>
<li><strong>å‚æ•° timeout</strong>ï¼šæŒ‡å®šæœ€é•¿ç­‰å¾…æ—¶é—´ï¼Œåœ¨è¶…æ—¶æ—¶é—´å†…ç­‰å¾…ï¼Œè¶…æ—¶åˆ™ä¸å†ç­‰å¾…ï¼ˆå¦‚æœæŒ‡å®šä¸º None æˆ–ä¸æŒ‡å®šï¼Œåˆ™ä¸€ç›´ç­‰å¾…ï¼‰</li>
<li><strong>å‚æ•° return_when</strong>ï¼šæŒ‡å®šä½•æ—¶è¿”å›ï¼Œå–å€¼ä¸º<strong>FIRST_COMPLETED</strong>ï¼ˆå½“ç¬¬ä¸€ä¸ªFutureå®ä¾‹å¯¹è±¡å·²ç»å®Œæˆæˆ–å·²è¢«å–æ¶ˆæ—¶ï¼‰ã€<strong>FIRST_EXCEPTION</strong>ï¼ˆå½“ç¬¬ä¸€ä¸ªFutureå®ä¾‹å¯¹è±¡æŠ›å‡ºå¼‚å¸¸æ—¶ï¼‰å’Œ<strong>ALL_COMPLETED</strong>ï¼ˆå½“æ‰€æœ‰Futureå®ä¾‹å¯¹è±¡å·²ç»å®Œæˆæˆ–å·²è¢«å–æ¶ˆæ—¶ï¼‰</li>
<li><strong>è¿”å›å€¼ï¼šè¿”å›ä¸¤ä¸ªé›†åˆç»„æˆçš„ä¸€ä¸ªå…ƒç»„ï¼Œç¬¬ä¸€ä¸ªé›†åˆåŒ…å«å·²ç»å®Œæˆæˆ–å·²è¢«å–æ¶ˆçš„æ‰€æœ‰ Future å®ä¾‹å¯¹è±¡ï¼Œç¬¬äºŒä¸ªé›†åˆåŒ…å«æ²¡æœ‰å®Œæˆå¹¶ä¸”æ²¡æœ‰è¢«å–æ¶ˆçš„ Future å®ä¾‹å¯¹è±¡</strong></li>
</ul>
</li>
<li>**as_completed(fs, timeout&#x3D;None)**ï¼š<ul>
<li><strong>ä½œç”¨ï¼šç”¨äºè·å–ä¸€ç»„ä»»åŠ¡ä¸­å·²å®Œæˆçš„ä»»åŠ¡çš„ç»“æœï¼Œæ˜¯éé˜»å¡çš„ï¼Œç±»ä¼¼äºç”Ÿæˆå™¨ï¼Œå®ƒæ¥å—ä¸€ä¸ª Future å¯¹è±¡çš„åºåˆ—ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œé€šè¿‡éå†è¿­ä»£å™¨å¯ä»¥ç«‹å³è·å–å·²å®Œæˆçš„ä»»åŠ¡çš„ç»“æœ</strong></li>
<li><strong>å‚æ•°fs</strong>ï¼šæ˜¯ä¸€ä¸ª Future å¯¹è±¡çš„åºåˆ—ï¼Œè¡¨ç¤ºè¦è·å–ç»“æœçš„ä»»åŠ¡é›†åˆ</li>
<li><strong>å‚æ•°timeout</strong>ï¼šæŒ‡å®šæœ€é•¿ç­‰å¾…æ—¶é—´ï¼Œåœ¨è¶…æ—¶æ—¶é—´å†…è·å–å·²å®Œæˆçš„ä»»åŠ¡ï¼Œè¶…æ—¶åˆ™ä¸å†ç­‰å¾…ï¼ˆå¦‚æœæŒ‡å®šä¸º None æˆ–ä¸æŒ‡å®šï¼Œåˆ™ä¸ä¼šè¶…æ—¶ï¼‰</li>
<li><strong>è¿”å›å€¼ï¼šè¿”å›ä¸€ä¸ª Future å®ä¾‹å¯¹è±¡çš„è¿­ä»£å™¨ï¼Œå¯ä»¥é€šè¿‡ for å¾ªç¯éå†è·å–å·²å®Œæˆçš„ä»»åŠ¡çš„ç»“æœ</strong></li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line">import time</span><br><span class="line">from concurrent.futures import ProcessPoolExecutor, \</span><br><span class="line">    wait, FIRST_COMPLETED, as_completed</span><br><span class="line"></span><br><span class="line">def square(x):</span><br><span class="line">    time.sleep(random.random())</span><br><span class="line">    return x * x</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    with ProcessPoolExecutor(max_workers=1) as ppe:</span><br><span class="line">        futures = [ppe.submit(square, i) for i in range(1, 6)]</span><br><span class="line">        # 1. waitæ–¹æ³•é»˜è®¤ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ</span><br><span class="line">        # done, not_done = wait(futures)</span><br><span class="line">        # é˜»å¡ä¸»çº¿ç¨‹ï¼Œåªç­‰å¾…ç¬¬ä¸€ä¸ªä»»åŠ¡å®Œæˆ</span><br><span class="line">        # done, not_done = wait(futures, return_when=FIRST_COMPLETED)</span><br><span class="line">        # ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œå†è·å–å·²å®Œæˆçš„æ‰€æœ‰ä»»åŠ¡çš„ç»“æœ</span><br><span class="line">        # for future in done:</span><br><span class="line">        #     print(future.result())  # 4 9 25 1 16</span><br><span class="line"></span><br><span class="line">        # 2. as_completedæ–¹æ³•å¼‚æ­¥è·å–ä»»åŠ¡ç»“æœ</span><br><span class="line">        for future in as_completed(futures):</span><br><span class="line">            print(future.result())  # 1 4 9 16 25</span><br></pre></td></tr></table></figure>

<h2 id="å››ã€å¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹"><a href="#å››ã€å¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹" class="headerlink" title="å››ã€å¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹"></a>å››ã€å¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹</h2><h3 id="1-æ‰§è¡Œçš„ä¸ç¡®å®šæ€§"><a href="#1-æ‰§è¡Œçš„ä¸ç¡®å®šæ€§" class="headerlink" title="1. æ‰§è¡Œçš„ä¸ç¡®å®šæ€§"></a>1. æ‰§è¡Œçš„ä¸ç¡®å®šæ€§</h3><ul>
<li>ç®€ä»‹ï¼š<strong>æ— è®ºæ˜¯å¤šè¿›ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå¤šä¸ªè¿›ç¨‹æˆ–è€…å¤šä¸ªçº¿ç¨‹çš„æ‰§è¡Œé¡ºåºå’Œæ—¶é—´éƒ½æ˜¯ä¸ç¡®å®šçš„ï¼Œå®Œå…¨å–å†³äºæ“ä½œç³»ç»Ÿçš„è°ƒåº¦</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">from multiprocessing import Process, current_process</span><br><span class="line">from threading import Thread, current_thread</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def process_task():</span><br><span class="line">    for i in range(5):</span><br><span class="line">        print(&#x27;%s: %d&#x27; % (current_process().name, i))</span><br><span class="line">        time.sleep(2)</span><br><span class="line"></span><br><span class="line">def thread_task():</span><br><span class="line">    for i in range(5):</span><br><span class="line">        print(&#x27;%s: %d&#x27; % (current_thread().name, i))</span><br><span class="line">        time.sleep(2)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    for i in range(3):</span><br><span class="line">        Process(target=process_task).start()  # å¾ªç¯åˆ›å»º3ä¸ªå­è¿›ç¨‹</span><br><span class="line">        # Thread(target=thread_task).start()  # å¾ªç¯åˆ›å»º3ä¸ªå­çº¿ç¨‹</span><br><span class="line"></span><br><span class="line">    process_task()  # ä¸»è¿›ç¨‹</span><br><span class="line">    # thread_task()  # ä¸»çº¿ç¨‹</span><br><span class="line">&quot;&quot;&quot;ä»è¾“å‡ºç»“æœæ¥çœ‹ï¼Œå¤šè¿›ç¨‹çš„æ‰§è¡Œé¡ºåºå’Œæ—¶é—´éƒ½æ˜¯ä¸ç¡®å®šçš„</span><br><span class="line">MainProcess: 0</span><br><span class="line">Process-2: 0</span><br><span class="line">Process-1: 0</span><br><span class="line">Process-3: 0</span><br><span class="line">......</span><br><span class="line">MainProcess: 4</span><br><span class="line">Process-1: 4</span><br><span class="line">Process-3: 4</span><br><span class="line">Process-2: 4</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="2-å®ˆæŠ¤å±æ€§daemon"><a href="#2-å®ˆæŠ¤å±æ€§daemon" class="headerlink" title="2. å®ˆæŠ¤å±æ€§daemon"></a>2. å®ˆæŠ¤å±æ€§daemon</h3><blockquote>
<p><strong>ä½œç”¨ï¼š</strong>é˜²æ­¢å­è¿›ç¨‹&#x2F;å­çº¿ç¨‹å› ä¸ºä»»åŠ¡æ— æ³•é€€å‡ºé€ æˆæ•´ä¸ªç¨‹åºå¡æ­»ï¼ˆ<strong>ä½œç”¨äºåˆ›å»ºå­è¿›ç¨‹æˆ–å­çº¿ç¨‹çš„å¯¹è±¡ä¸Š</strong>ï¼‰</p>
<p><strong>è§£é‡Šï¼š</strong>åªè¦ä¸»ç¨‹åºçš„ä»£ç èµ°åˆ°äº†æœ€åä¸€è¡Œï¼Œä¸ç®¡é‡Œé¢çš„å­çº¿ç¨‹æˆ–å­è¿›ç¨‹çš„ä»»åŠ¡æœ‰æ²¡æœ‰å®Œæˆï¼Œéƒ½ä¼šéšç€ä¸»ç¨‹åºçš„é€€å‡ºè€Œé€€å‡º</p>
</blockquote>
<ul>
<li>ç®€ä»‹ï¼š<strong>daemon å±æ€§ç”¨äºæ ‡è¯†çº¿ç¨‹æˆ–è¿›ç¨‹æ˜¯å¦æ˜¯å®ˆæŠ¤çº¿ç¨‹æˆ–è¿›ç¨‹ï¼Œå…¶ä½œç”¨æ˜¯æ§åˆ¶çº¿ç¨‹æˆ–è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼ˆå®ˆæŠ¤çº¿ç¨‹æˆ–è¿›ç¨‹æ˜¯æŒ‡åœ¨ä¸»ç¨‹åºç»“æŸæ—¶ä¼šè¢«å¼ºåˆ¶é€€å‡ºçš„å­çº¿ç¨‹æˆ–å­è¿›ç¨‹ï¼‰</strong></li>
<li>ä½œç”¨ï¼š<ul>
<li><strong>å®ˆæŠ¤çº¿ç¨‹æˆ–è¿›ç¨‹çš„é€€å‡ºæ—¶æœºï¼š</strong>å½“ä¸»ç¨‹åºï¼ˆä¸»çº¿ç¨‹æˆ–ä¸»è¿›ç¨‹ï¼‰ç»“æŸæ—¶ï¼Œä¼šç­‰å¾…æ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹æˆ–è¿›ç¨‹å®Œæˆä»»åŠ¡åå†é€€å‡ºã€‚ä½†æ˜¯å¯¹äºå®ˆæŠ¤çº¿ç¨‹æˆ–è¿›ç¨‹ï¼Œä¸ç®¡ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œéƒ½ä¼šè¢«å¼ºåˆ¶é€€å‡ºï¼Œä¸ä¼šé˜»å¡ä¸»ç¨‹åºçš„é€€å‡º</li>
<li><strong>èµ„æºæ¸…ç†ï¼š</strong>å®ˆæŠ¤çº¿ç¨‹æˆ–è¿›ç¨‹åœ¨è¢«å¼ºåˆ¶é€€å‡ºæ—¶ï¼Œä¸ä¼šæ‰§è¡Œæ¸…ç†æ“ä½œï¼Œæ¯”å¦‚é‡Šæ”¾èµ„æºæˆ–å…³é—­æ–‡ä»¶ã€‚å› æ­¤ï¼Œå®ƒä»¬é€šå¸¸ç”¨äºæ‰§è¡Œä¸€äº›ä¸éœ€è¦åœ¨ç¨‹åºé€€å‡ºæ—¶åšæ¸…ç†çš„ä»»åŠ¡</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from multiprocessing import current_process, Process</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">class MyProcess(Process):</span><br><span class="line">    def run(self):</span><br><span class="line">        print(&#x27;å­è¿›ç¨‹%då¯åŠ¨&#x27; % current_process().pid)</span><br><span class="line">        time.sleep(2)</span><br><span class="line">        print(&#x27;å­è¿›ç¨‹%dç»“æŸ&#x27; % current_process().pid)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    print(&#x27;çˆ¶è¿›ç¨‹%då¯åŠ¨&#x27; % current_process().pid)</span><br><span class="line">    mp = MyProcess()</span><br><span class="line">    mp.daemon = True</span><br><span class="line">    mp.start()</span><br><span class="line"></span><br><span class="line">    time.sleep(1)</span><br><span class="line">    print(&#x27;çˆ¶è¿›ç¨‹%dç»“æŸ&#x27; % current_process().pid)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">çˆ¶è¿›ç¨‹17514å¯åŠ¨</span><br><span class="line">å­è¿›ç¨‹17516å¯åŠ¨</span><br><span class="line">çˆ¶è¿›ç¨‹17514ç»“æŸ</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="3-é˜»å¡æ–¹æ³•join"><a href="#3-é˜»å¡æ–¹æ³•join" class="headerlink" title="3. é˜»å¡æ–¹æ³•join()"></a>3. é˜»å¡æ–¹æ³•join()</h3><ul>
<li>ç®€ä»‹ï¼š<strong>join() æ–¹æ³•ç”¨äºç­‰å¾…ä¸€ä¸ªå¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹çš„ä»»åŠ¡å®Œæˆï¼Œå¸¸ç”¨äºè®©ä¸»çº¿ç¨‹æˆ–ä¸»è¿›ç¨‹ç­‰å¾…æŒ‡å®šçš„å­çº¿ç¨‹æˆ–å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œç„¶åå†ç»§ç»­æ‰§è¡Œä¸»çº¿ç¨‹æˆ–ä¸»è¿›ç¨‹çš„åç»­ä»£ç </strong></li>
<li>ä½œç”¨ï¼š<strong>ç­‰å¾…ä»»åŠ¡å®Œæˆå’Œé˜²æ­¢å¹¶å‘é—®é¢˜ã€‚åœ¨è°ƒç”¨æ–¹æ³• join() æ—¶ï¼Œå¯ä»¥æŒ‡å®šå‚æ•° timeoutï¼Œä»è€ŒæŒ‡å®šå­è¿›ç¨‹é˜»å¡çˆ¶è¿›ç¨‹çš„æ—¶é—´</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def worker():</span><br><span class="line">    print(&quot;å­çº¿ç¨‹å¯åŠ¨&quot;)</span><br><span class="line">    time.sleep(2)</span><br><span class="line">    print(&quot;å­çº¿ç¨‹ç»“æŸ&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    print(&quot;çˆ¶çº¿ç¨‹å¯åŠ¨&quot;)</span><br><span class="line">    thread = threading.Thread(target=worker)</span><br><span class="line">    thread.start()</span><br><span class="line">    thread.join(1)  # ç­‰å¾…å­çº¿ç¨‹å®Œæˆ</span><br><span class="line">    print(&quot;çˆ¶çº¿ç¨‹ç»“æŸ&quot;)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">çˆ¶çº¿ç¨‹å¯åŠ¨</span><br><span class="line">å­çº¿ç¨‹å¯åŠ¨</span><br><span class="line">çˆ¶çº¿ç¨‹ç»“æŸ</span><br><span class="line">å­çº¿ç¨‹ç»“æŸ</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="4-å…¨å±€å˜é‡è®¿é—®ä¸å…±äº«"><a href="#4-å…¨å±€å˜é‡è®¿é—®ä¸å…±äº«" class="headerlink" title="4. å…¨å±€å˜é‡è®¿é—®ä¸å…±äº«"></a>4. å…¨å±€å˜é‡è®¿é—®ä¸å…±äº«</h3><ul>
<li><strong>å…¨å±€å˜é‡åœ¨å¤šä¸ªè¿›ç¨‹ä¸­ä¸èƒ½å…±äº«</strong>ï¼šæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œä»è€Œå­è¿›ç¨‹çš„æ“ä½œä¸ä¼šå½±å“åˆ°çˆ¶è¿›ç¨‹ä¸­çš„å…¨å±€å˜é‡ï¼Œå®ƒä»¬ä¸æ˜¯å…±äº«åŒä¸€å—å†…å­˜</li>
<li><strong>çº¿ç¨‹ä¹‹é—´å…±äº«å…¨å±€å˜é‡</strong>ï¼šå­çº¿ç¨‹å¯ä»¥è®¿é—®å’Œä¿®æ”¹çˆ¶çº¿ç¨‹å®šä¹‰çš„å…¨å±€å˜é‡ï¼Œå› ä¸ºå®ƒä»¬åœ¨åŒä¸€è¿›ç¨‹å†…ï¼Œå…±äº«åŒä¸€å—å†…å­˜ç©ºé—´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½å…±äº«ç›¸åŒçš„å…¨å±€å˜é‡</li>
<li>æ³¨æ„ï¼š<strong>åœ¨å­è¿›ç¨‹ä¸­ä¿®æ”¹å…¨å±€å˜é‡ï¼Œå¯¹çˆ¶è¿›ç¨‹ä¸­çš„å…¨å±€å˜é‡æ²¡æœ‰å½±å“</strong>ï¼Œå› ä¸ºå­è¿›ç¨‹ä¸­åªæ˜¯å¯¹çˆ¶è¿›ç¨‹ä¸­çš„å…¨å±€å˜é‡åšäº†ä¸€ä»½æ‹·è´ï¼ŒåŒ…æ‹¬globaléƒ½è¢«æ‹·è´äº†çš„ï¼Œå­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹ä¸­çš„å…¨å±€å˜é‡æ˜¯å®Œå…¨ä¸åŒçš„ä¸¤ä¸ªå˜é‡</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">from multiprocessing import Process</span><br><span class="line">from threading import Thread</span><br><span class="line"></span><br><span class="line">nums = [11, 22]</span><br><span class="line"></span><br><span class="line">def work_1():</span><br><span class="line">    for i in range(3):</span><br><span class="line">        nums.append(i)</span><br><span class="line">    print(nums)</span><br><span class="line"></span><br><span class="line">def work_2():</span><br><span class="line">    print(nums)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    p1 = Process(target=work_1)</span><br><span class="line">    p2 = Process(target=work_2)</span><br><span class="line"></span><br><span class="line">    p1.start()  # [11, 22, 0, 1, 2]</span><br><span class="line">    p1.join()  # ç­‰å­è¿›ç¨‹p1å…ˆå°†å…ƒç´ å…¨éƒ¨æ·»åŠ åˆ°numsä¸­</span><br><span class="line">    print(f&quot;å­è¿›ç¨‹p1ä¸­ä¿®æ”¹numså€¼åï¼Œä¸»è¿›ç¨‹ä¸­numsçš„å€¼ä¸ºï¼š&#123;nums&#125;&quot;)  # [11, 22]</span><br><span class="line"></span><br><span class="line">    p2.start()  # [11, 22]ï¼Œè¯æ˜å­è¿›ç¨‹p1å’Œp2ä¸­çš„å…¨å±€å˜é‡numsç›¸äº’ç‹¬ç«‹</span><br><span class="line">    p2.join()</span><br><span class="line">    &quot;&quot;&quot;è¯æ˜æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œä¸»è¿›ç¨‹ã€å­è¿›ç¨‹p1å’Œp2æ˜¯3ä¸ªç›¸äº’ç‹¬ç«‹çš„è¿›ç¨‹&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    # å­çº¿ç¨‹ä¸­å…¨å±€å˜é‡å³ä¸ºä¸»çº¿ç¨‹çš„å…¨å±€å˜é‡</span><br><span class="line">    t1 = Thread(target=work_1)</span><br><span class="line">    t1.start()  # [11, 22, 0, 1, 2]</span><br><span class="line">    t1.join()</span><br><span class="line">    print(f&quot;å­çº¿ç¨‹t1ä¸­ä¿®æ”¹numså€¼åï¼Œä¸»çº¿ç¨‹ä¸­numsçš„å€¼ä¸ºï¼š&#123;nums&#125;&quot;)  # [11, 22, 0, 1, 2]</span><br></pre></td></tr></table></figure>

<h3 id="5-æ“ä½œæ•°æ®çš„ä¸å®‰å…¨æ€§"><a href="#5-æ“ä½œæ•°æ®çš„ä¸å®‰å…¨æ€§" class="headerlink" title="5. æ“ä½œæ•°æ®çš„ä¸å®‰å…¨æ€§"></a>5. æ“ä½œæ•°æ®çš„ä¸å®‰å…¨æ€§</h3><ul>
<li>ç®€ä»‹ï¼š<strong>å¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹æ“ä½œå…±äº«æ•°æ®æ˜¯ä¸å®‰å…¨çš„</strong>ï¼Œç”±äºå¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹çš„æ‰§è¡Œæ˜¯ä¸ç¡®å®šçš„ï¼Œå¯¼è‡´å¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹æ“ä½œå…±äº«æ•°æ®çš„ç»“æœæ˜¯ä¸å¯é¢„æœŸçš„ï¼Œå¸¸è¢«ç§°ä¸ºä¸å®‰å…¨çš„</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">from threading import Thread</span><br><span class="line"></span><br><span class="line">num = 0</span><br><span class="line"></span><br><span class="line">def add():</span><br><span class="line">    global num</span><br><span class="line">    for i in range(1000000):</span><br><span class="line">        # num = num + 1</span><br><span class="line">        # é¦–å…ˆè®¡ç®—num + 1ï¼Œå­˜å…¥ä¸´æ—¶å˜é‡ä¸­ï¼Œç„¶åå°†ä¸´æ—¶å˜é‡çš„å€¼èµ‹å€¼ç»™num</span><br><span class="line">        num += 1</span><br><span class="line"></span><br><span class="line">t1 = Thread(target=add)</span><br><span class="line">t2 = Thread(target=add)</span><br><span class="line"></span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line"></span><br><span class="line">t1.join()</span><br><span class="line">t2.join()</span><br><span class="line">print(num)  # 1691225</span><br><span class="line"># å½“çº¿ç¨‹1ä¸­è®¡ç®—å¥½num+1åï¼Œè¿˜æ²¡æœ‰å°†å…¶èµ‹å€¼ç»™numï¼Œcpuå°±è°ƒåº¦åˆ°äº†çº¿ç¨‹2ï¼Œæ­¤æ—¶numå€¼ä¾ç„¶ä¸º0</span><br><span class="line"># æ‰€ä»¥åœ¨çº¿ç¨‹2ä¸­è®¡ç®—å¥½num+1çš„å€¼å¹¶å­˜ä¸ºä¸´æ—¶å˜é‡ä¹Ÿä¸º1ï¼Œæœ€åcpuå†è°ƒåº¦å›çº¿ç¨‹1è¿›è¡Œèµ‹å€¼num=1ï¼Œ</span><br><span class="line"># ç„¶åè°ƒåº¦åˆ°çº¿ç¨‹2ä¹Ÿè¿›è¡Œèµ‹å€¼num=1ï¼Œè¿™æ ·æœ€ç»ˆä¸¤ä¸ªçº¿ç¨‹è™½ç„¶è¿›è¡Œäº†ä¸¤æ¬¡åŠ æ³•è¿ç®—ï¼Œä½†å¾—åˆ°çš„ç»“æœå´æ˜¯num=1</span><br></pre></td></tr></table></figure>

<h3 id="6-è¿›ç¨‹é—´é€šä¿¡ä¹‹å…±äº«å†…å­˜"><a href="#6-è¿›ç¨‹é—´é€šä¿¡ä¹‹å…±äº«å†…å­˜" class="headerlink" title="6. è¿›ç¨‹é—´é€šä¿¡ä¹‹å…±äº«å†…å­˜"></a>6. è¿›ç¨‹é—´é€šä¿¡ä¹‹å…±äº«å†…å­˜</h3><ul>
<li>ç®€ä»‹ï¼šæƒ³è¦å®ç°è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œå…±äº«å†…å­˜æ˜¯å¸¸è§çš„å®ç°æ–¹å¼ä¹‹ä¸€ï¼Œå®ƒå…è®¸å¤šä¸ªè¿›ç¨‹ç›´æ¥è®¿é—®åŒä¸€å—å†…å­˜ï¼ˆ<strong>å…±äº«å†…å­˜ä¸­å¯¹è±¡çš„ç±»å‹å¿…é¡»æ˜¯ctypesçš„ï¼Œctypesæ˜¯Cè¯­è¨€å…¼å®¹çš„æ•°æ®ç±»å‹</strong>ï¼‰</li>
<li>å®ç°å‡½æ•°ï¼š<ul>
<li>**Value(self, typecode_or_type, *args, lock&#x3D;True)**ï¼Œè¿”å›å€¼è¡¨ç¤ºä¸€ä¸ªæ•°å€¼</li>
<li>**Array(self, typecode_or_type, size_or_initializer, *, lock&#x3D;True)**ï¼Œè¿”å›å€¼è¡¨ç¤ºä¸€ä¸ªæ•°ç»„</li>
<li>å‚æ•°ï¼štypecode_or_typeç”¨äºæŒ‡å®šæ•°å€¼&#x2F;æ•°ç»„ä¸­å…ƒç´ çš„ç±»å‹ç æˆ–ctypesç±»å‹ï¼Œsize_or_initializerç”¨äºæŒ‡å®šæ•°ç»„çš„é•¿åº¦æˆ–Pythonä¸­çš„åºåˆ—</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">from multiprocessing import Process, Value, Array</span><br><span class="line">import ctypes</span><br><span class="line"></span><br><span class="line"># åœ¨å…±äº«å†…å­˜ä¸­åˆ›å»ºäº†ä¸€ä¸ªè¡¨ç¤ºæ•°å€¼çš„ctypeså¯¹è±¡</span><br><span class="line"># num = Value(ctypes.c_float, 2.3)</span><br><span class="line">num = Value(&#x27;d&#x27;, 2.3)</span><br><span class="line"></span><br><span class="line"># åœ¨å…±äº«å†…å­˜ä¸­åˆ›å»ºäº†ä¸€ä¸ªè¡¨ç¤ºæ•°ç»„çš„ctypeså¯¹è±¡</span><br><span class="line"># arr = Array(ctypes.c_int, range(1, 5))</span><br><span class="line">arr = Array(&#x27;i&#x27;, range(1, 5))</span><br><span class="line"></span><br><span class="line">def do_sth(num, arr):</span><br><span class="line">    num.value = 1.8</span><br><span class="line">    for i in range(len(arr)):</span><br><span class="line">        arr[i] = -arr[i]</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    p = Process(target=do_sth, args=(num, arr))</span><br><span class="line">    p.start()</span><br><span class="line">    p.join()</span><br><span class="line">    print(num.value, arr[:])  # 1.8 [-1, -2, -3, -4]</span><br></pre></td></tr></table></figure>

<h3 id="7-è¿›ç¨‹é—´é€šä¿¡ä¹‹é˜Ÿåˆ—"><a href="#7-è¿›ç¨‹é—´é€šä¿¡ä¹‹é˜Ÿåˆ—" class="headerlink" title="7. è¿›ç¨‹é—´é€šä¿¡ä¹‹é˜Ÿåˆ—"></a>7. è¿›ç¨‹é—´é€šä¿¡ä¹‹é˜Ÿåˆ—</h3><ul>
<li>ç®€ä»‹ï¼šé˜Ÿåˆ—æ˜¯ä¸€ç§çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„ï¼Œå¯ç”¨äºåœ¨ä¸åŒçš„è¿›ç¨‹ä¹‹é—´æˆä¼ é€’æ•°æ®å’Œæ¶ˆæ¯</li>
<li><strong>æ³¨æ„ï¼šè¿›ç¨‹æ± ä¸­æ•°æ®ä¼ é€’æ˜¯é€šè¿‡ Future å¯¹è±¡å¼‚æ­¥è·å–ä»»åŠ¡çš„ç»“æœï¼Œè¿›ç¨‹é—´çš„æ•°æ®ä¼ é€’æ›´ä¸ºæŠ½è±¡ï¼Œä¸ç›´æ¥ä½¿ç”¨é˜Ÿåˆ—</strong></li>
<li>æ–¹æ³•ï¼š<ul>
<li>put()ï¼šå°†æ•°æ®æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œæ˜¯é˜»å¡çš„ã€‚å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œput()æ“ä½œä¼šç­‰å¾…ç›´åˆ°é˜Ÿåˆ—æœ‰è¶³å¤Ÿçš„ç©ºé—´æ¥æ”¾å…¥æ•°æ®</li>
<li>get()ï¼šä»é˜Ÿåˆ—ä¸­è·å–æ•°æ®ï¼Œæ˜¯é˜»å¡çš„ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œget()æ“ä½œä¼šç­‰å¾…ç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰æ•°æ®å¯ä¾›è·å–</li>
<li>get_nowait()ï¼šä»é˜Ÿåˆ—ä¸­è·å–æ•°æ®ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™ä¸ä¼šç­‰å¾…è€Œæ˜¯ç›´æ¥æŠ›å‡ºå¼‚å¸¸</li>
<li>empty()ï¼šåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œè¿”å›å¸ƒå°”å€¼</li>
<li>full()ï¼šåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦å·²æ»¡ï¼Œè¿”å›å¸ƒå°”å€¼</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line">import time</span><br><span class="line">from multiprocessing import Queue, Process</span><br><span class="line">from concurrent.futures import ProcessPoolExecutor</span><br><span class="line"></span><br><span class="line">def write_data(queue):</span><br><span class="line">    for item in &#x27;ABC&#x27;:</span><br><span class="line">        queue.put(item)</span><br><span class="line">        time.sleep(random.random())</span><br><span class="line"></span><br><span class="line">def read_data(queue):</span><br><span class="line">    while True:</span><br><span class="line">        if not queue.empty():</span><br><span class="line">            item = queue.get()</span><br><span class="line">            time.sleep(random.random() * 2)</span><br><span class="line">            print(item)</span><br><span class="line">        else:</span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    queue = Queue()</span><br><span class="line"></span><br><span class="line">    p_write = Process(target=write_data, args=(queue,))</span><br><span class="line">    p_read = Process(target=read_data, args=(queue,))</span><br><span class="line"></span><br><span class="line">    p_write.start()</span><br><span class="line">    p_write.join()</span><br><span class="line"></span><br><span class="line">    p_read.start()  # A B C</span><br><span class="line">    p_read.join()</span><br></pre></td></tr></table></figure>

<h2 id="äº”ã€å¹¶å‘åŒæ­¥"><a href="#äº”ã€å¹¶å‘åŒæ­¥" class="headerlink" title="äº”ã€å¹¶å‘åŒæ­¥"></a>äº”ã€å¹¶å‘åŒæ­¥</h2><h3 id="1-Locké”"><a href="#1-Locké”" class="headerlink" title="1. Locké”"></a>1. Locké”</h3><ul>
<li>ç®€ä»‹ï¼š<strong>é”æ˜¯ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œç”¨äºæ§åˆ¶å¤šä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®ã€‚</strong>å½“å¤šä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´æˆ–é”™è¯¯çš„ç»“æœï¼Œä¸ºäº†ç¡®ä¿åœ¨ä»»ä½•æ—¶å€™åªæœ‰ä¸€ä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹å¯ä»¥è®¿é—®å…±äº«èµ„æºï¼Œå¯ä»¥ä½¿ç”¨é”ï¼ˆLockï¼‰æ¥åŒæ­¥çº¿ç¨‹æˆ–è¿›ç¨‹çš„è®¿é—®</li>
<li><strong>é”çš„ä¸¤ç§çŠ¶æ€ï¼šé”å®šï¼ˆè¢«æŸä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹å ç”¨ï¼‰å’Œæœªé”å®šï¼ˆå¯ä¾›å…¶ä»–çº¿ç¨‹æˆ–è¿›ç¨‹ä½¿ç”¨ï¼‰</strong></li>
<li><strong>æ³¨æ„ï¼šè¿‡åº¦ä½¿ç”¨é”å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œå› ä¸ºåŒ…å«é”çš„ç›¸å…³ä»£ç åªèƒ½ä»¥å•çº¿ç¨‹æ¨¡å¼æ‰§è¡Œï¼Œå› æ­¤æ•ˆç‡ä¼šå¤§å¤§é™ä½</strong></li>
<li>åº”ç”¨ï¼šæ ‡å‡†åº“æ¨¡å—multiprocessingå’Œthreadingä¸­å‡æä¾›äº†ä¸€ä¸ªç±»å¯¹è±¡Lockï¼Œç”¨äºè¡¨ç¤ºé”ï¼Œä»¥å®ç°å¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ã€‚<strong>ç”±äºç±»å¯¹è±¡Lockéµå®ˆäº†ä¸Šä¸‹æ–‡ç®¡ç†åè®®ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨withè¯­å¥è¿›è¡Œç®€åŒ–ï¼Œåœ¨è¿›å…¥è¿è¡Œæ—¶ä¸Šä¸‹æ–‡æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨æ–¹æ³•acquire()ï¼Œåœ¨ç¦»å¼€è¿è¡Œæ—¶ä¸Šä¸‹æ–‡æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨æ–¹æ³•release()</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">from threading import Thread, Lock</span><br><span class="line">from multiprocessing import Process, Lock, Value</span><br><span class="line"></span><br><span class="line">num = 0  # çº¿ç¨‹ä¸­å…¨å±€å˜é‡</span><br><span class="line"># num = Value(&#x27;i&#x27;, 0)  # è¿›ç¨‹ä¸­å…¨å±€å˜é‡</span><br><span class="line"></span><br><span class="line">lock = Lock()  # åˆ›å»ºlockå®ä¾‹å¯¹è±¡</span><br><span class="line"></span><br><span class="line">def add():</span><br><span class="line">    global num</span><br><span class="line">    for i in range(1000000):</span><br><span class="line">        &quot;&quot;&quot;1. è·å¾—é”ä¸é‡Šæ”¾é”</span><br><span class="line">        lock.acquire()</span><br><span class="line">        num += 1</span><br><span class="line">        lock.release()</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        &quot;&quot;&quot;2. ä¸ºäº†ç¡®ä¿è·å¾—é”çš„çº¿ç¨‹ç”¨å®Œåä¸€å®šè¦é‡Šæ”¾é”ï¼Œå¯ä»¥ä½¿ç”¨try...finallyè¯­å¥</span><br><span class="line">        lock.acquire()</span><br><span class="line">        try:</span><br><span class="line">            num += 1</span><br><span class="line">        finally:</span><br><span class="line">            lock.release()</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        # 3. ç±»å¯¹è±¡Lockéµå®ˆäº†ä¸Šä¸‹æ–‡ç®¡ç†åè®®ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨withè¯­å¥è¿›è¡Œç®€åŒ–</span><br><span class="line">        with lock:</span><br><span class="line">            num += 1</span><br><span class="line"></span><br><span class="line">t1 = Thread(target=add)</span><br><span class="line">t2 = Thread(target=add)</span><br><span class="line"></span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line"></span><br><span class="line">t1.join()</span><br><span class="line">t2.join()</span><br><span class="line">print(num)  # 2000000</span><br></pre></td></tr></table></figure>

<h3 id="2-æ­»é”"><a href="#2-æ­»é”" class="headerlink" title="2. æ­»é”"></a>2. æ­»é”</h3><ul>
<li>ç®€ä»‹ï¼šå¦‚æœæœ‰å¤šä¸ªå…±äº«æ•°æ®ï¼Œåœ¨å¤šä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹æ“ä½œè¿™å¤šä¸ªå…±äº«æ•°æ®æ—¶ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹åˆ†åˆ«é€šè¿‡åŠ é”å æœ‰ä¸€éƒ¨åˆ†å…±äº«æ•°æ®ï¼Œå¹¶ä¸”åŒæ—¶ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ä¸¤ä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹æ°¸è¿œç›¸äº’ç­‰å¾…è€Œäº§ç”Ÿæ­»é”ï¼Œå³<strong>å½“å¤šä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹åŒæ—¶æŒæœ‰ä¸€äº›èµ„æºå¹¶ä¸”è¯•å›¾è·å–å…¶ä»–èµ„æºæ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿæ­»é”</strong></li>
<li><strong>æ­»é”äº§ç”Ÿçš„å¿…è¦æ¡ä»¶ï¼š</strong><ol>
<li><strong>äº’æ–¥æ¡ä»¶</strong>ï¼šè‡³å°‘æœ‰ä¸€ä¸ªèµ„æºåŒæ—¶åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹å ç”¨</li>
<li><strong>è¯·æ±‚ä¸ä¿æŒæ¡ä»¶</strong>ï¼šçº¿ç¨‹æˆ–è¿›ç¨‹å·²ç»æŒæœ‰äº†ä¸€ä¸ªèµ„æºï¼ŒåŒæ—¶åˆè¯·æ±‚å…¶ä»–èµ„æº</li>
<li><strong>ä¸å¯å‰¥å¤ºæ¡ä»¶</strong>ï¼šèµ„æºåªèƒ½åœ¨æŒæœ‰è€…é‡Šæ”¾æ—¶æ‰èƒ½è¢«å…¶ä»–çº¿ç¨‹æˆ–è¿›ç¨‹è·å–ï¼Œä¸èƒ½è¢«å¼ºåˆ¶æ€§åœ°å‰¥å¤º</li>
<li><strong>ç¯è·¯ç­‰å¾…æ¡ä»¶</strong>ï¼šå­˜åœ¨ä¸€ç»„çº¿ç¨‹æˆ–è¿›ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…ä¸‹ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰çš„èµ„æº</li>
</ol>
</li>
<li><strong>é¿å…æ­»é”ï¼š</strong><ol>
<li><strong>åŠ é”é¡ºåº</strong>ï¼šå¼ºåˆ¶çº¿ç¨‹æŒ‰ç…§ç‰¹å®šçš„é¡ºåºè·å–é”ï¼Œä»è€Œæ¶ˆé™¤ç¯è·¯ç­‰å¾…æ¡ä»¶</li>
<li><strong>è¶…æ—¶</strong>ï¼šä¸ºè·å–é”è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œä¸€æ®µæ—¶é—´åå¦‚æœæœªè·å–åˆ°é”å°±æ”¾å¼ƒæˆ–è¿›è¡Œå…¶ä»–å¤„ç†</li>
<li><strong>èµ„æºåˆ†çº§</strong>ï¼šå°†èµ„æºåˆ†ä¸ºä¸åŒçš„çº§åˆ«ï¼Œè¦æ±‚çº¿ç¨‹åªèƒ½æŒ‰ç…§çº§åˆ«é¡ºåºè·å–èµ„æºï¼Œé¿å…ç›¸äº’ç­‰å¾…</li>
<li><strong>å‰¥å¤ºèµ„æº</strong>ï¼šåœ¨é€‚å½“çš„æ—¶æœºï¼Œå¼ºåˆ¶å‰¥å¤ºä¸€äº›çº¿ç¨‹çš„èµ„æºï¼Œä½¿å¾—å…¶ä»–çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œ</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import threading</span><br><span class="line"></span><br><span class="line">lock_a = threading.Lock()</span><br><span class="line">lock_b = threading.Lock()</span><br><span class="line"></span><br><span class="line">def thread_1():</span><br><span class="line">    with lock_a:</span><br><span class="line">        print(&quot;Thread 1 acquired lock a&quot;)  # æ­¤å¤„æ¨¡æ‹Ÿä¸€äº›å·¥ä½œ</span><br><span class="line">        with lock_b:  # æ­»é”å¯èƒ½å‘ç”Ÿåœ¨è¿™ï¼Œçº¿ç¨‹1åœ¨ç­‰å¾…çº¿ç¨‹2é‡Šæ”¾é”b</span><br><span class="line">            print(&quot;Thread 1 acquired lock b&quot;)</span><br><span class="line"></span><br><span class="line">def thread_2():</span><br><span class="line">    with lock_b:</span><br><span class="line">        print(&quot;Thread 2 acquired lock b&quot;)  # æ­¤å¤„æ¨¡æ‹Ÿä¸€äº›å·¥ä½œ</span><br><span class="line">        with lock_a:  # æ­»é”å¯èƒ½å‘ç”Ÿåœ¨è¿™ï¼Œçº¿ç¨‹2åœ¨ç­‰å¾…çº¿ç¨‹1é‡Šæ”¾é”a</span><br><span class="line">            print(&quot;Thread 2 acquired lock a&quot;)</span><br><span class="line"></span><br><span class="line">thread1 = threading.Thread(target=thread_1)</span><br><span class="line">thread2 = threading.Thread(target=thread_2)</span><br><span class="line">thread1.start()</span><br><span class="line">thread2.start()</span><br><span class="line">thread1.join()</span><br><span class="line">thread2.join()</span><br><span class="line">&quot;&quot;&quot;åœ¨æ»¡è¶³æ­»é”çš„å¿…è¦æ¡ä»¶æ—¶ï¼Œæ­»é”å¹¶ä¸æ˜¯ä¸€å®šå‘ç”Ÿçš„ï¼Œè¿™æ—¶æ­»é”çš„å‘ç”Ÿå–å†³äºæ“ä½œç³»ç»Ÿçš„è°ƒåº¦</span><br><span class="line">è¿è¡Œç¨‹åºè¾“å‡ºï¼š</span><br><span class="line">Thread 1 acquired lock a</span><br><span class="line">Thread 1 acquired lock b</span><br><span class="line">Thread 2 acquired lock b</span><br><span class="line">Thread 2 acquired lock a</span><br><span class="line">å¤šæ¬¡è¿è¡Œç¨‹åºå‡ºç°æ­»é”ï¼š</span><br><span class="line">Thread 1 acquired lock a</span><br><span class="line">Thread 2 acquired lock b</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="3-RLocké”"><a href="#3-RLocké”" class="headerlink" title="3. RLocké”"></a>3. RLocké”</h3><ul>
<li>å¼•å‡ºï¼šåœ¨åŒä¸€çº¿ç¨‹ä¸­ï¼Œå½“è°ƒç”¨äº†æ™®é€šé”Lockçš„æ–¹æ³•acquire()ä¹‹åï¼Œå¦‚æœåœ¨è°ƒç”¨æ–¹æ³•release()ä¹‹å‰å†æ¬¡è°ƒç”¨äº†æ–¹æ³•acquire()ï¼Œåˆ™ä¼šå¯¼è‡´æ­»é”</li>
<li>ç®€ä»‹ï¼š<strong>å¯é‡å…¥é” RLock æ˜¯ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œå®ƒå…è®¸åŒä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”çš„æƒ…å†µä¸‹å¤šæ¬¡è·å–åŒä¸€ä¸ªé”ï¼Œä»¥é¿å…æ­»é”ï¼Œè€Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…è¯¥çº¿ç¨‹é‡Šæ”¾æ‰€æœ‰å¯¹é”çš„æŒæœ‰ï¼Œä¸»è¦ç”¨äºè§£å†³é€’å½’å‡½æ•°è°ƒç”¨ä¸­çš„åŒæ­¥é—®é¢˜ã€‚</strong>RLockç»§æ‰¿è‡ªæ™®é€šé”Lockï¼Œå¹¶åœ¨å…¶åŸºç¡€ä¸Šå¢åŠ äº†é‡å…¥çš„ç‰¹æ€§</li>
<li>åº”ç”¨ï¼šæ ‡å‡†åº“æ¨¡å—threadingå’Œmultiprocessingä¸­æä¾›äº†ä¸€ä¸ªç”¨äºè¡¨ç¤ºé”çš„ç±»å¯¹è±¡RLockï¼ˆReentrant Lockï¼Œå¯é‡å…¥é”ï¼‰ã€‚<strong>åŒæ—¶ç±»å¯¹è±¡RLockä¹Ÿéµå¾ªäº†ä¸Šä¸‹æ–‡ç®¡ç†åè®®</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import threading</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºä¸€ä¸ªå¯é‡å…¥é”ï¼Œå¦‚æœåˆ›å»ºçš„æ˜¯æ™®é€šé”Lockï¼Œåˆ™æµ‹è¯•ä»£ç æ—¶ä¼šé€ æˆæ­»é”</span><br><span class="line">rlock = threading.RLock()</span><br><span class="line"></span><br><span class="line">def thread_1():</span><br><span class="line">    with rlock:</span><br><span class="line">        print(&quot;Inside thread_1&quot;)</span><br><span class="line">        thread_2()</span><br><span class="line"></span><br><span class="line">def thread_2():</span><br><span class="line">    with rlock:  # å¯é‡å…¥é”å¯ä»¥è¢«åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å–</span><br><span class="line">        print(&quot;Inside thread_2&quot;)</span><br><span class="line"></span><br><span class="line">thread1 = threading.Thread(target=thread_1)</span><br><span class="line">thread2 = threading.Thread(target=thread_2)</span><br><span class="line">thread1.start()</span><br><span class="line">thread2.start()</span><br><span class="line">thread1.join()</span><br><span class="line">thread2.join()</span><br><span class="line">&quot;&quot;&quot;å¦‚æœå°†Rlockæ”¹æˆæ™®é€šé”lockï¼Œåˆ™æ­»é”ä¸€å®šä¼šå‘ç”Ÿï¼Œ</span><br><span class="line">å› ä¸ºåœ¨thread_1ä¸­è°ƒç”¨äº†thread_2ï¼Œä¸€æŠŠé”è¢«é‡å¤è·å¾—ç¬¬äºŒæ¬¡ï¼Œè€Œç¬¬ä¸€æ¬¡è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œåˆ™ä¼šäº§ç”Ÿæ­»é”</span><br><span class="line">printæ‰“å°ï¼šInside thread_1</span><br><span class="line"></span><br><span class="line">è€Œå¦‚æœä½¿ç”¨Rlockå¯é‡å…¥é”ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿæ­»é”ï¼Œprintæ‰“å°ï¼š</span><br><span class="line">Inside thread_1</span><br><span class="line">Inside thread_2</span><br><span class="line">Inside thread_2</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h2 id="å…­ã€åç¨‹"><a href="#å…­ã€åç¨‹" class="headerlink" title="å…­ã€åç¨‹"></a>å…­ã€åç¨‹</h2><blockquote>
<p><strong>åç¨‹ï¼šåç¨‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œåœ¨åŒä¸€çº¿ç¨‹å†…ï¼Œå®ƒå¯ä»¥æš‚åœæ‰§è¡Œä»¥å…è®¸å…¶ä»–ä»£ç è¿è¡Œï¼Œç„¶åå†ä»æš‚åœçš„åœ°æ–¹ç»§ç»­æ‰§è¡Œï¼ˆåç¨‹è¿è¡ŒçŠ¶æ€äºå¤šçº¿ç¨‹ç±»ä¼¼ï¼‰</strong></p>
<p><strong>åç¨‹æ€ç»´ï¼šä¸€å¤„å¼‚æ­¥ï¼Œå¤„å¤„å¼‚æ­¥ï¼Œè¯­æ³•ç‰ˆæœ¬éœ€ç»Ÿä¸€ï¼Œ3.6è¯­æ³•ä¸3.7è¯­æ³•ä¸å¯ä»¥æ··ç”¨</strong></p>
<p><strong>åç¨‹ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>æ— éœ€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œåç¨‹é¿å…äº†æ— æ„ä¹‰çš„è°ƒåº¦ï¼Œå¯ä»¥æé«˜æ€§èƒ½</li>
<li>æ— éœ€åŸå­æ“ä½œé”å®šåŠåŒæ­¥å¼€é”€</li>
<li>æ–¹ä¾¿åˆ‡æ¢æ§åˆ¶æµï¼Œç®€åŒ–ç¼–ç¨‹æ¨¡å‹</li>
<li>é«˜å¹¶å‘ + é«˜æ‰©å±•æ€§ + ä½æˆæœ¬ï¼Œä¸€ä¸ªCPUç”šè‡³å¯ä»¥æ”¯æŒä¸Šä¸‡çš„åç¨‹ï¼Œé€‚åˆç”¨äºé«˜å¹¶å‘å¤„ç†</li>
</ul>
<p><strong>åç¨‹ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>è¿›è¡Œé˜»å¡æ“ä½œï¼ˆå¦‚IOæ—¶ï¼‰ä¼šé˜»å¡æ‰æ•´ä¸ªç¨‹åº</li>
<li>æ— æ³•åˆ©ç”¨å¤šæ ¸èµ„æºï¼Œåç¨‹çš„æœ¬è´¨æ—¶å•çº¿ç¨‹ï¼Œä¸èƒ½åŒæ—¶å°†å•ä¸ªCPUçš„å¤šä¸ªæ ¸ç”¨ä¸Šï¼Œåç¨‹éœ€è¦è¿›ç¨‹é…åˆæ‰èƒ½è¿è¡Œåœ¨å¤šCPUä¸Š</li>
</ul>
<p><strong>æœ€åŸå§‹çš„åç¨‹ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># æœ€åŸå§‹çš„ã€ç”¨ç”Ÿæˆå™¨å®ç°çš„åç¨‹</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def func_1():</span><br><span class="line">    while True:</span><br><span class="line">        print(&#x27;ç”Ÿæˆå™¨ä»»åŠ¡...&#x27;)</span><br><span class="line">        yield  # yieldè¯­å¥å…è®¸å‡½æ•°åœ¨ç”Ÿæˆä¸€ä¸ªå€¼åæš‚åœæ‰§è¡Œå¹¶ä¿å­˜å½“å‰çŠ¶æ€</span><br><span class="line">        time.sleep(1)  # ç„¶ååœ¨éœ€è¦æ—¶ç»§ç»­å¾€ä¸‹æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">def func_2(obj):</span><br><span class="line">    while True:</span><br><span class="line">        print(&#x27;æ™®é€šå‡½æ•°ä»»åŠ¡...&#x27;)</span><br><span class="line">        next(obj)</span><br><span class="line"></span><br><span class="line">generator = func_1()</span><br><span class="line">func_2(generator)</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="1-asyncioæ¨¡å—"><a href="#1-asyncioæ¨¡å—" class="headerlink" title="1. asyncioæ¨¡å—"></a>1. asyncioæ¨¡å—</h3><ul>
<li>ç®€ä»‹ï¼šasyncioæ˜¯Pythonæ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºç¼–å†™å¼‚æ­¥ã€éé˜»å¡çš„å¹¶å‘ä»£ç ã€‚<strong>asyncioçš„ç¼–ç¨‹æ¨¡å‹æ˜¯ä¸€ä¸ªæ¶ˆæ¯å¾ªç¯ï¼Œæˆ‘ä»¬ä»asyncioæ¨¡å—ä¸­ç›´æ¥è·å–ä¸€ä¸ªäº‹ä»¶å¾ªç¯EventLoopçš„å¼•ç”¨ï¼Œç„¶åæŠŠéœ€è¦æ‰§è¡Œçš„åç¨‹æ‰”åˆ°EventLoopä¸­æ‰§è¡Œï¼Œä»¥å®ç°å¼‚æ­¥IO</strong></li>
<li><strong>äº‹ä»¶å¾ªç¯EventLoopï¼š</strong>äº‹ä»¶å¾ªç¯æ˜¯asyncioçš„æ ¸å¿ƒï¼Œè´Ÿè´£å¤„ç†å’Œè°ƒåº¦å¼‚æ­¥ä»»åŠ¡å’Œäº‹ä»¶ã€‚ç¨‹åºä¼šå¼€å¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œå°†ä¸€äº›å‡½æ•°æ³¨å†Œåˆ°äº‹ä»¶å¾ªç¯ä¸Šï¼Œå½“æ»¡è¶³äº‹ä»¶å‘ç”Ÿçš„æ—¶å€™ï¼Œè°ƒç”¨ç›¸åº”çš„åç¨‹å‡½æ•°ã€‚äº‹ä»¶å¾ªç¯çš„åˆ‡æ¢åº•å±‚ä¾é <strong>ioè€—æ—¶åˆ¤æ–­</strong>ï¼Œå½“åˆ¤æ–­å‡ºæŸä¸ªä»»åŠ¡æ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œåˆ™æš‚åœå½“å‰ä»»åŠ¡åˆ‡æ¢åˆ°å¦ä¸€ä¸ªä»»åŠ¡</li>
<li><strong>åç¨‹Coroutinesï¼š</strong>åç¨‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œåç¨‹å¯ä»¥åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æš‚åœï¼Œå¹¶åœ¨éœ€è¦æ—¶æ¢å¤æ‰§è¡Œã€‚åç¨‹å‡½æ•°çš„è°ƒç”¨ä¸ä¼šç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªåç¨‹å¯¹è±¡ï¼Œåç¨‹å¯¹è±¡éœ€è¦æ³¨å†Œåˆ°äº‹ä»¶å¾ªç¯ï¼Œç”±äº‹ä»¶å¾ªç¯è°ƒç”¨</li>
<li><strong>Taskä»»åŠ¡å¯¹è±¡ï¼š</strong>ä»»åŠ¡æ˜¯åç¨‹çš„åŒ…è£…å™¨ï¼Œç”¨äºåœ¨äº‹ä»¶å¾ªç¯ä¸­å¹¶å‘è¿è¡Œåç¨‹ã€‚ä»»åŠ¡å¯¹è±¡å…è®¸è·Ÿè¸ªåç¨‹çš„çŠ¶æ€ï¼Œç­‰å¾…å®ƒå®Œæˆæˆ–å–æ¶ˆå®ƒ</li>
<li><strong>Futureå¯¹è±¡</strong>ï¼šç”¨äºè¡¨ç¤ºå°šæœªå®Œæˆçš„å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå…è®¸ç­‰å¾…å’Œå¤„ç†å¼‚æ­¥æ“ä½œçš„å®ŒæˆçŠ¶æ€ï¼Œä»¥åŠæ§åˆ¶å¼‚æ­¥æ“ä½œçš„ç»“æœæˆ–å¼‚å¸¸ï¼Œé€šå¸¸ä¸awaitä¸€èµ·ä½¿ç”¨ã€‚<strong>Taskä»»åŠ¡å¯¹è±¡æ˜¯Futureçš„å­ç±»ï¼Œä»»åŠ¡å¯¹è±¡Taskå…·æœ‰æ›´å¤šçš„åŠŸèƒ½ï¼Œå¯ä»¥ä»£è¡¨åç¨‹çš„æ‰§è¡ŒçŠ¶æ€å’Œç»“æœï¼Œå› æ­¤å®ƒä»¬æ˜¯ä¸€ç§ç‰¹æ®Šçš„Future</strong></li>
<li><strong>async&#x2F;awaitå…³é”®å­—ï¼š</strong>asyncå…³é”®å­—ç”¨äºå®šä¹‰åç¨‹ï¼Œå£°æ˜è¿™æ˜¯ä¸€ä¸ªåç¨‹å‡½æ•°ã€‚awaitå…³é”®å­—ç”¨äºæŒ‚èµ·åç¨‹çš„æ‰§è¡Œï¼Œç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆï¼Œé€šå¸¸ç”¨äºè°ƒç”¨å…¶ä»–å¼‚æ­¥å‡½æ•°æˆ–æ“ä½œ</li>
</ul>
<blockquote>
<p><strong>åç¨‹å‡½æ•°ï¼š</strong>åç¨‹å‡½æ•°æ˜¯ä½¿ç”¨<strong>async defå…³é”®å­—</strong>å®šä¹‰çš„ç‰¹æ®Šå‡½æ•°ï¼Œå®ƒå¯ä»¥åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æš‚åœå’Œæ¢å¤æ‰§è¡Œï¼Œé€šå¸¸ç”¨äºå®šä¹‰å¼‚æ­¥ä»»åŠ¡çš„é€»è¾‘</p>
<p><strong>åç¨‹å¯¹è±¡ï¼š</strong>åç¨‹å¯¹è±¡æ˜¯é€šè¿‡<strong>è°ƒç”¨åç¨‹å‡½æ•°æ¥åˆ›å»ºçš„</strong>ï¼Œå®ƒå®é™…ä¸Šæ˜¯åç¨‹å‡½æ•°çš„å®ä¾‹ï¼Œè¡¨ç¤ºä¸€ä¸ªå¯æ‰§è¡Œçš„å¼‚æ­¥ä»»åŠ¡ï¼Œå¯ä»¥æ·»åŠ åˆ°äº‹ä»¶å¾ªç¯ä¸­å¹¶æ‰§è¡Œ</p>
</blockquote>
<h3 id="2-asyncio-run"><a href="#2-asyncio-run" class="headerlink" title="2. asyncio.run()"></a>2. asyncio.run()</h3><ul>
<li><strong>ä½œç”¨</strong>ï¼šç”¨äºè¿è¡Œä¸€ä¸ªåç¨‹ï¼Œæ˜¯Python 3.7å¼•å…¥çš„æ–°æ–¹æ³•</li>
<li><strong>ç”¨æ³•</strong>ï¼šæ¥å—ä¸€ä¸ª<strong>åç¨‹å¯¹è±¡ï¼ˆä¸èƒ½æ˜¯ä»»åŠ¡å¯¹è±¡ï¼‰</strong>ä½œä¸ºå‚æ•°ï¼Œ<strong>æ­¤å‡½æ•°æ€»æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å¾ªç¯å¹¶è¿è¡Œåç¨‹</strong>ï¼Œç„¶åå…³é—­äº‹ä»¶å¾ªç¯</li>
<li><strong>è¿”å›å€¼</strong>ï¼šå³ä¸ºåç¨‹å‡½æ•°çš„è¿”å›å€¼ï¼Œå¦‚æœåç¨‹å‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼Œåˆ™è¿”å›None</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line"></span><br><span class="line"># å®šä¹‰åç¨‹å‡½æ•°</span><br><span class="line">async def my_coroutine():</span><br><span class="line">    await asyncio.sleep(1)</span><br><span class="line">    return &quot;åç¨‹å·²å®Œæˆ&quot;</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;asyncio.run()å†…éƒ¨åº•å±‚å®ç°</span><br><span class="line">if self._loop_factory is None:</span><br><span class="line">    self._loop = events.new_event_loop()</span><br><span class="line"></span><br><span class="line">å¯ä»¥çœ‹å‡ºå‡½æ•°æ€»æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å¾ªç¯ç”¨äºè¿è¡Œåç¨‹</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">result = asyncio.run(my_coroutine())</span><br><span class="line">print(result)  # åç¨‹å·²å®Œæˆ</span><br></pre></td></tr></table></figure>

<h3 id="3-asyncio-sleep"><a href="#3-asyncio-sleep" class="headerlink" title="3. asyncio.sleep()"></a>3. asyncio.sleep()</h3><ul>
<li><strong>ä½œç”¨</strong>ï¼šæŒ‚èµ·å½“å‰åç¨‹çš„æ‰§è¡Œï¼Œæ¨¡æ‹Ÿç­‰å¾…ä¸€æ®µæ—¶é—´</li>
<li><strong>ç”¨æ³•</strong>ï¼šæ¥å—ä¸€ä¸ªæµ®ç‚¹æ•°æˆ–æ•´æ•°ä½œä¸ºå‚æ•°ï¼Œè¡¨ç¤ºç­‰å¾…çš„ç§’æ•°</li>
<li><strong>è¿”å›å€¼</strong>ï¼šè¿”å›ä¸€ä¸ªFutureå¯¹è±¡ï¼Œè¡¨ç¤ºå¼‚æ­¥æ“ä½œçš„ç»“æœ</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line"></span><br><span class="line">async def my_coroutine():</span><br><span class="line">    print(&quot;å¼€å§‹æ‰§è¡Œ&quot;)</span><br><span class="line">    await asyncio.sleep(1)</span><br><span class="line">    print(&quot;ç­‰å¾…å®Œæˆ&quot;)</span><br><span class="line"></span><br><span class="line">asyncio.run(my_coroutine())</span><br></pre></td></tr></table></figure>

<h3 id="4-awaitå…³é”®å­—"><a href="#4-awaitå…³é”®å­—" class="headerlink" title="4. awaitå…³é”®å­—"></a>4. awaitå…³é”®å­—</h3><ul>
<li><strong>awaitå…³é”®å­—</strong>ï¼šawait æ˜¯ç”¨äºç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆçš„å…³é”®å­—ï¼Œå…¶ä½œç”¨æ˜¯åœ¨é‡åˆ°è€—æ—¶ä»»åŠ¡æ—¶è®©å‡ºæ§åˆ¶æƒï¼Œè®©äº‹ä»¶å¾ªç¯å»æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œä»è€Œä¿æŒæ•´ä¸ªç¨‹åºçš„å¼‚æ­¥æ‰§è¡Œ</li>
<li><strong>ç‰¹ç‚¹ï¼š</strong><ol>
<li><strong>åªèƒ½åœ¨å¼‚æ­¥å‡½æ•°å†…ä½¿ç”¨ï¼š</strong>await åªèƒ½åœ¨å¼‚æ­¥å‡½æ•°å†…ä½¿ç”¨ï¼Œè¿™äº›å‡½æ•°ä½¿ç”¨ async def å£°æ˜ï¼Œå‡½æ•°å†…éƒ¨çš„<strong>è€—æ—¶ä»»åŠ¡</strong>å¿…é¡»é€šè¿‡ await ä¿®é¥°ï¼ˆawait å¯ä»¥åœ¨ä¸€ä¸ªå¼‚æ­¥å‡½æ•°å†…å‡ºç°å¤šæ¬¡ï¼‰</li>
<li><strong>ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆï¼š</strong> await åé¢é€šå¸¸è·Ÿç€ä¸€ä¸ª<strong>å¯ç­‰å¾…å¯¹è±¡</strong>ï¼Œå¦‚åç¨‹å¯¹è±¡ã€Task å¯¹è±¡æˆ– Future å¯¹è±¡</li>
</ol>
</li>
<li><strong>awaitå¯ä»¥å°†ä»»åŠ¡è¿›è¡Œæäº¤åˆ°äº‹ä»¶å¾ªç¯ä¸­ï¼Œåªèƒ½æäº¤å¯ç­‰å¾…å¯¹è±¡ [coroutine, task, future]ï¼š</strong><ul>
<li><strong>å°†å¤šä¸ªä»»åŠ¡åˆ†æ¬¡æäº¤åˆ°äº‹ä»¶å¾ªç¯ä¸­ï¼š</strong>æ­¤æ—¶äº‹ä»¶å¾ªç¯å§‹ä¸­ç»ˆä¿æŒç€åªæœ‰ä¸€ä¸ªä»»åŠ¡çš„çŠ¶æ€ï¼Œæ¯ä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œéƒ½è¦ç­‰å¾…ä¸Šä¸€ä¸ª await ç­‰å¾…å®Œæ¯•å¹¶å¾—åˆ°è¿”å›å€¼ï¼Œæ‰èƒ½å°†ä¸‹ä¸€ä¸ªä»»åŠ¡æ·»åŠ åˆ°äº‹ä»¶å¾ªç¯ï¼Œæ‰€ä»¥æ˜¯<strong>åŒæ­¥æ‰§è¡Œ</strong></li>
<li><strong>å°†å¤šä¸ªä»»åŠ¡ä¸€æ¬¡æ€§å…¨éƒ¨æäº¤åˆ°äº‹ä»¶å¾ªç¯ä¸­ï¼š</strong>é€šå¸¸ä½¿ç”¨ asyncio.wait() æˆ– asyncio.gather() ç­‰å¾…ä¸€ç»„ä»»åŠ¡å®Œæˆï¼Œä½¿ç”¨ await å°†ä»»åŠ¡ä¸€æ¬¡æ€§å…¨éƒ¨æäº¤åˆ°äº‹ä»¶å¾ªç¯ä¸­ï¼Œä»¥<strong>å¹¶å‘æ‰§è¡Œ</strong></li>
</ul>
</li>
<li><strong>æ³¨æ„ï¼š</strong>Task å¯¹è±¡å’Œ Future å¯¹è±¡æœ¬èº«å°±æ˜¯å¯ä»¥è¢«ç­‰å¾…çš„å¯ç­‰å¾…å¯¹è±¡</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line"></span><br><span class="line">async def my_coroutine():</span><br><span class="line">    print(&quot;my_coroutineä»»åŠ¡å¯åŠ¨...&quot;)</span><br><span class="line">    await asyncio.sleep(2)</span><br><span class="line">    print(&quot;my_coroutineä»»åŠ¡ç»“æŸ...&quot;)</span><br><span class="line">    return &#x27;æ¨¡æ‹Ÿä¸€ä¸ªè¿”å›å€¼&#x27;</span><br><span class="line"></span><br><span class="line">async def main1():</span><br><span class="line">    print(&quot;æ‰§è¡Œmain1å‡½æ•°ä»»åŠ¡...&quot;)</span><br><span class="line">    # ä½¿ç”¨awaitå°†å•ä¸ªä»»åŠ¡æäº¤åˆ°äº‹ä»¶å¾ªç¯ï¼Œç›¸å½“äºä¸€æ¬¡åªæäº¤äº†ä¸€ä¸ªä»»åŠ¡åˆ°äº‹ä»¶å¾ªç¯ä¸­</span><br><span class="line">    result1 = await asyncio.create_task(my_coroutine())</span><br><span class="line">    # ç”±äºawaitçš„ä½œç”¨å°±æ˜¯ç­‰å¾…å¼‚æ­¥æ“ä½œçš„å®Œæˆï¼Œä½†æ­¤æ—¶äº‹ä»¶å¾ªç¯ä¸­å°±ä¸€ä¸ªä»»åŠ¡</span><br><span class="line">    # æ‰€ä»¥å®ƒå°±è¦ç­‰è¿™ä¸€ä¸ªä»»åŠ¡çš„å®Œæˆï¼Œå¹¶å¾—åˆ°å‡½æ•°è¿”å›å€¼åï¼Œæ‰ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œ</span><br><span class="line">    # é‚£è¿™æ ·å°±æ˜¯å˜å‘å µå¡äº†ï¼Œå¦‚æœä¸€ç›´æ‹¿ä¸åˆ°ç¬¬ä¸€ä¸ªä»»åŠ¡çš„è¿”å›å€¼ï¼Œç¨‹åºå°±ä¼šè¢«ä¸€ç›´å µå¡</span><br><span class="line">    # æ‰€ä»¥è¯´è¿™ç§å®ç°æ–¹å¼å¹¶æ²¡æœ‰å®ç°å¹¶å‘æ‰§è¡Œï¼Œè€Œæ˜¯åŒæ­¥æ‰§è¡Œäº†</span><br><span class="line">    result2 = await asyncio.create_task(my_coroutine())</span><br><span class="line">    print(result1, result2)</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">ç»“è®ºï¼šæ­¤æ—¶æ‰§è¡Œä¸ºåŒæ­¥æ‰§è¡Œï¼Œå› ä¸ºä»»åŠ¡æ˜¯ä¸€ä¸ªä¸€ä¸ªè¢«æäº¤åˆ°äº‹ä»¶å¾ªç¯ä¸­çš„ï¼Œ</span><br><span class="line">     æ‰€ä»¥äº‹ä»¶å¾ªç¯ä¸­ä¸€ç›´éƒ½åªæœ‰ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸èƒ½è¿›è¡Œä»»åŠ¡åˆ‡æ¢ï¼Œä¹Ÿå°±æ— æ³•å¹¶å‘æ‰§è¡Œ</span><br><span class="line">è§£å†³ï¼šå°†ä»»åŠ¡ä¸€æ¬¡æ€§å…¨éƒ¨æ·»åŠ åˆ°äº‹ä»¶å¾ªç¯ä¸­ï¼Œä¾¿å¯ä»¥åœ¨äº‹ä»¶å¾ªç¯ä¸­è¿›è¡Œä»»åŠ¡åˆ‡æ¢ï¼Œä»¥å®ç°å¹¶å‘</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">async def main2():</span><br><span class="line">    print(&quot;æ‰§è¡Œmain2å‡½æ•°ä»»åŠ¡...&quot;)</span><br><span class="line">    # ä½¿ç”¨asyncio.waitç­‰å¾…ä¸€ç»„ä»»åŠ¡å®Œæˆï¼Œå¹¶ä½¿ç”¨awaitå°†ä»»åŠ¡ä¸€æ¬¡æ€§å…¨éƒ¨æäº¤åˆ°äº‹ä»¶å¾ªç¯ä¸­</span><br><span class="line">    tasks = [</span><br><span class="line">        asyncio.create_task(my_coroutine()),</span><br><span class="line">        asyncio.create_task(my_coroutine())</span><br><span class="line">    ]</span><br><span class="line">    done, pedding = await asyncio.wait(tasks)</span><br><span class="line">    for item in done:</span><br><span class="line">        print(item.result())</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    asyncio.run(main1())</span><br><span class="line">    asyncio.run(main2())</span><br><span class="line"># æ­¤pyæ–‡ä»¶ä¸ºäº†æ¼”ç¤ºawaitçš„ä¸åŒæäº¤æ–¹å¼ä¹‹é—´çš„åŒºåˆ«ï¼Œåˆ›å»ºäº†ä¸¤ä¸ªäº‹ä»¶å¾ªç¯ï¼Œè¿™ä¼šé™ä½ä»£ç æ‰§è¡Œæ•ˆç‡ï¼Œå»ºè®®åªå¼€å¯ä¸€ä¸ªï¼</span><br></pre></td></tr></table></figure>

<h3 id="5-taskå¯¹è±¡"><a href="#5-taskå¯¹è±¡" class="headerlink" title="5. taskå¯¹è±¡"></a>5. taskå¯¹è±¡</h3><ul>
<li><p><strong>ä¸åŒç‰ˆæœ¬çš„æ–¹æ³•</strong>ï¼š</p>
<ul>
<li><strong>asyncio.create_task()ï¼š</strong>ä¼šè‡ªåŠ¨è·å–å½“å‰å­˜åœ¨çš„äº‹ä»¶å¾ªç¯ï¼ˆ<strong>python 3.7ä¹‹åçš„ç‰ˆæœ¬ä½¿ç”¨</strong>ï¼‰</li>
<li><strong>loop.create_task()ï¼š</strong>éœ€è¦ä½¿ç”¨å½“å‰çš„loopäº‹ä»¶å¾ªç¯å¯¹è±¡é©±åŠ¨ï¼ˆ<strong>python 3.6ä¹‹å‰çš„ç‰ˆæœ¬ä½¿ç”¨</strong>ï¼‰</li>
</ul>
</li>
<li><p><strong>ä½œç”¨</strong>ï¼šç”¨äºåˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼Œå°†åç¨‹åŒ…è£…ä¸ºä¸€ä¸ªä»»åŠ¡å¯¹è±¡ï¼Œä»¥ä¾¿åœ¨äº‹ä»¶å¾ªç¯ä¸­<strong>å¹¶å‘è¿è¡Œ</strong>ï¼ˆ<strong>æ”¯æŒå¹¶å‘æ‰§è¡Œï¼</strong>ï¼‰</p>
</li>
<li><p><strong>ç”¨æ³•</strong>ï¼šæ¥å—ä¸€ä¸ª<strong>åç¨‹å¯¹è±¡</strong>ä½œä¸ºå‚æ•°ï¼Œå°†åç¨‹åŒ…è£…ï¼Œè¿”å›ä¸€ä¸ª<strong>ä»»åŠ¡å¯¹è±¡</strong></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line"></span><br><span class="line">async def my_coroutine(name, address):</span><br><span class="line">    print(&quot;ä»»åŠ¡å¼€å§‹...&quot;)</span><br><span class="line">    await asyncio.sleep(2)</span><br><span class="line">    print(&quot;ä»»åŠ¡ç»“æŸ...&quot;)</span><br><span class="line">    return f&#x27;&#123;name&#125;,&#123;address&#125;&#x27;</span><br><span class="line"></span><br><span class="line"># python 3.6ä¹‹å‰ç‰ˆæœ¬çš„æ‰“åŒ…æ–¹å¼ -- å®Œæˆå¹¶å‘æ‰§è¡Œ</span><br><span class="line">async def main(loop=None):</span><br><span class="line">    task_1 = loop.create_task(my_coroutine(&#x27;me&#x27;, &#x27;å—äº¬&#x27;))</span><br><span class="line">    task_2 = loop.create_task(my_coroutine(&#x27;you&#x27;, &#x27;é‡åº†&#x27;))</span><br><span class="line"></span><br><span class="line">    result_1 = await task_1</span><br><span class="line">    result_2 = await task_2</span><br><span class="line">    print(result_1, result_2)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(main(loop))</span><br><span class="line"></span><br><span class="line"># python 3.7ä¹‹åç‰ˆæœ¬çš„æ‰“åŒ…æ–¹å¼ -- å®Œæˆå¹¶å‘æ‰§è¡Œ</span><br><span class="line">async def main():</span><br><span class="line">    # create_task()ä¼šè¿›è¡Œä»£ç é¢„å¤„ç†ï¼Œä¸€æ—¦é‡åˆ°awaitå°±ä¼šåœæ­¢</span><br><span class="line">    task_1 = asyncio.create_task(my_coroutine(&#x27;me&#x27;, &#x27;å—äº¬&#x27;))</span><br><span class="line">    task_2 = asyncio.create_task(my_coroutine(&#x27;you&#x27;, &#x27;é‡åº†&#x27;))</span><br><span class="line">    &quot;&quot;&quot;asyncio.create_task()å†…éƒ¨å®ç°ï¼šloop = events.get_running_loop()</span><br><span class="line">       å¯ä»¥çœ‹å‡ºasyncio.create_task()ä¼šè‡ªåŠ¨è·å–æ­£åœ¨è¿è¡Œçš„äº‹ä»¶å¾ªç¯</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    result_1 = await task_1</span><br><span class="line">    result_2 = await task_2</span><br><span class="line">    print(result_1, result_2)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br><span class="line"># æ­¤pyæ–‡ä»¶ä¸ºäº†æ¼”ç¤ºä¸åŒç‰ˆæœ¬ä¹‹é—´çš„çŸ¥è¯†ç‚¹ï¼Œåˆ›å»ºäº†ä¸¤ä¸ªäº‹ä»¶å¾ªç¯ï¼Œè¿™ä¼šé™ä½ä»£ç æ‰§è¡Œæ•ˆç‡ï¼Œå»ºè®®åªå¼€å¯ä¸€ä¸ªï¼</span><br></pre></td></tr></table></figure>

<h3 id="6-asyncio-wait"><a href="#6-asyncio-wait" class="headerlink" title="6. asyncio.wait()"></a>6. asyncio.wait()</h3><ul>
<li><strong>ä½œç”¨</strong>ï¼šç­‰å¾…ä¸€ç»„Futureå¯¹è±¡å®Œæˆï¼Œå¹¶ä¸”å¯ä»¥è·å–è¢«æäº¤çš„ä»»åŠ¡çš„è¿è¡ŒçŠ¶æ€å’Œè¿”å›å€¼ï¼ˆ<strong>å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ï¼ŒåŒæ­¥è·å–ç»“æœ</strong>ï¼‰</li>
<li><strong>ç”¨æ³•</strong>ï¼š<strong>å‚æ•°æ¥å—ä¸€ä¸ªå¯è¿­ä»£çš„Futureå¯¹è±¡é›†åˆï¼ˆä¸èƒ½æ¥å—åç¨‹å¯¹è±¡æˆ–è€…åç¨‹å¯¹è±¡é›†åˆï¼‰</strong></li>
<li><strong>è¿”å›å€¼</strong>ï¼šè¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„å…ƒç»„<ul>
<li><strong>done</strong>ï¼šåŒ…å«å·²ç»å®Œæˆçš„ä»»åŠ¡å¯¹è±¡çš„é›†åˆ</li>
<li><strong>pending</strong>ï¼šåŒ…å«æœªå®Œæˆå’Œæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡å¯¹è±¡çš„é›†åˆ</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line"></span><br><span class="line">async def work1():</span><br><span class="line">    print(&quot;ä»»åŠ¡1å¯åŠ¨...&quot;)</span><br><span class="line">    await asyncio.sleep(1)</span><br><span class="line">    print(&quot;ä»»åŠ¡1ç»“æŸ...&quot;)</span><br><span class="line">    return &quot;ä»»åŠ¡1&quot;</span><br><span class="line"></span><br><span class="line">async def work2():</span><br><span class="line">    print(&quot;ä»»åŠ¡2å¯åŠ¨...&quot;)</span><br><span class="line">    await asyncio.sleep(2)</span><br><span class="line">    print(&quot;ä»»åŠ¡2ç»“æŸ...&quot;)</span><br><span class="line">    return &quot;ä»»åŠ¡2&quot;</span><br><span class="line"></span><br><span class="line">async def main():</span><br><span class="line">    tasks = [</span><br><span class="line">        asyncio.create_task(work1()),</span><br><span class="line">        asyncio.create_task(work2())</span><br><span class="line">    ]</span><br><span class="line">    done, pending = await asyncio.wait(tasks, timeout=3)  # å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´timeout</span><br><span class="line">    print(&quot;done:&quot;, done)  # åœ¨doneå˜é‡ä¸­çš„å¯¹è±¡éƒ½æ˜¯å·²ç»å®Œæˆä»»åŠ¡çš„å¯¹è±¡</span><br><span class="line">    print(&quot;pending:&quot;, pending)  # pendingæ¥å—çš„æ˜¯æœªå®Œæˆå’Œæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡</span><br><span class="line">    for task in done:</span><br><span class="line">        print(&quot;å·²å®Œæˆçš„ä»»åŠ¡è¿”å›å€¼ï¼š&quot;, task.result())</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">ä»»åŠ¡1å¯åŠ¨...</span><br><span class="line">ä»»åŠ¡2å¯åŠ¨...</span><br><span class="line">ä»»åŠ¡1ç»“æŸ...</span><br><span class="line">ä»»åŠ¡2ç»“æŸ...</span><br><span class="line">done: &#123;&lt;Task finished name=&#x27;Task-2&#x27; coro=&lt;work1() done, defined at /Users/xfblog/PycharmProjects/pythonProject/ceshi.py:3&gt; result=&#x27;ä»»åŠ¡1&#x27;&gt;, </span><br><span class="line">&lt;Task finished name=&#x27;Task-3&#x27; coro=&lt;work2() done, defined at /Users/xfblog/PycharmProjects/pythonProject/ceshi.py:9&gt; result=&#x27;ä»»åŠ¡2&#x27;&gt;&#125;</span><br><span class="line">pending: set()</span><br><span class="line">å·²å®Œæˆçš„ä»»åŠ¡è¿”å›å€¼ï¼š ä»»åŠ¡1</span><br><span class="line">å·²å®Œæˆçš„ä»»åŠ¡è¿”å›å€¼ï¼š ä»»åŠ¡2</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="7-asyncio-gather"><a href="#7-asyncio-gather" class="headerlink" title="7. asyncio.gather()"></a>7. asyncio.gather()</h3><ul>
<li><strong>ä½œç”¨</strong>ï¼šåŒæ—¶æäº¤å¤šä¸ªä»»åŠ¡ï¼ˆtasksæˆ–coroutinesï¼‰åˆ°äº‹ä»¶å¾ªç¯ï¼Œå¹¶ç­‰å¾…å®ƒä»¬å…¨éƒ¨å®Œæˆåè·å–ç»“æœï¼Œè¿™ç§ç­‰å¾…æ˜¯åŒæ­¥çš„ï¼ˆ<strong>å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ï¼ŒåŒæ­¥è·å–ç»“æœ</strong>ï¼‰</li>
<li><strong>ç”¨æ³•</strong>ï¼šæ¥å—å•ä¸ªæˆ–å¤šä¸ª<strong>åç¨‹å¯¹è±¡æˆ–futureå¯¹è±¡</strong>ä½œä¸ºå‚æ•°ï¼Œå¤šä¸ªå¯¹è±¡å¯ä»¥ç›´æ¥ä¼ å…¥ï¼Œä½†<strong>ä¸èƒ½ä½œä¸ºè¿­ä»£å¯¹è±¡ä¼ å…¥</strong></li>
<li><strong>è¿”å›å€¼</strong>ï¼šè¿”å›ä¸€ä¸ªåŒ…å«äº†æ‰€æœ‰åç¨‹ç»“æœçš„<strong>åˆ—è¡¨</strong>ï¼Œç»“æœçš„é¡ºåºä¸ä¼ å…¥çš„åç¨‹é¡ºåºä¸€è‡´</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line"></span><br><span class="line">async def work1():</span><br><span class="line">    print(&quot;ä»»åŠ¡1å¯åŠ¨...&quot;)</span><br><span class="line">    await asyncio.sleep(1)</span><br><span class="line">    print(&quot;ä»»åŠ¡1ç»“æŸ...&quot;)</span><br><span class="line">    return &quot;ä»»åŠ¡1&quot;</span><br><span class="line"></span><br><span class="line">async def work2():</span><br><span class="line">    print(&quot;ä»»åŠ¡2å¯åŠ¨...&quot;)</span><br><span class="line">    await asyncio.sleep(2)</span><br><span class="line">    print(&quot;ä»»åŠ¡2ç»“æŸ...&quot;)</span><br><span class="line">    return &quot;ä»»åŠ¡2&quot;</span><br><span class="line"></span><br><span class="line">async def main():</span><br><span class="line">    # # 1. ä¼ å…¥å•ä¸ªæˆ–å¤šä¸ªåç¨‹å¯¹è±¡ï¼Œæˆ–å¯¹åç¨‹å¯¹è±¡åˆ—è¡¨è§£åŒ…</span><br><span class="line">    # # results = await asyncio.gather(work1(), work2())</span><br><span class="line">    # coroutines = [work1(), work2()]</span><br><span class="line">    # results = await asyncio.gather(*coroutines)</span><br><span class="line"></span><br><span class="line">    # 2. ä¼ å…¥å•ä¸ªæˆ–å¤šä¸ªtaskä»»åŠ¡å¯¹è±¡ï¼Œå³futureå¯¹è±¡ï¼Œæˆ–å¯¹futureå¯¹è±¡åˆ—è¡¨è§£åŒ…</span><br><span class="line">    # results = await asyncio.gather(asyncio.create_task(work1()), asyncio.gather(work2()))</span><br><span class="line">    tasks = [asyncio.create_task(work1()), asyncio.create_task(work2())]</span><br><span class="line">    results = await asyncio.gather(*tasks)</span><br><span class="line"></span><br><span class="line">    print(results)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">ä»»åŠ¡1å¯åŠ¨...</span><br><span class="line">ä»»åŠ¡2å¯åŠ¨...</span><br><span class="line">ä»»åŠ¡1ç»“æŸ...</span><br><span class="line">ä»»åŠ¡2ç»“æŸ...</span><br><span class="line">[&#x27;ä»»åŠ¡1&#x27;, &#x27;ä»»åŠ¡2&#x27;]</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="8-asyncio-as-completed"><a href="#8-asyncio-as-completed" class="headerlink" title="8. asyncio.as_completed()"></a>8. asyncio.as_completed()</h3><ul>
<li><strong>ä½œç”¨</strong>ï¼šè¿”å›ä¸€ä¸ª<strong>å¼‚æ­¥ç”Ÿæˆå™¨ï¼ˆasync generatorï¼‰</strong>ï¼ŒæŒ‰ç…§å®Œæˆçš„é¡ºåºäº§ç”ŸFutureå¯¹è±¡ï¼Œä¸€æ—¦æŸä¸ªä»»åŠ¡å®Œæˆï¼Œå°±ä¼šç«‹å³è¿”å›å®ƒï¼Œè€Œä¸éœ€è¦ç­‰å¾…å…¶ä»–ä»»åŠ¡å®Œæˆ</li>
<li><strong>ç”¨æ³•</strong>ï¼šä½¿ç”¨<strong>async forå¼‚æ­¥å¾ªç¯</strong>æ¥è¿­ä»£è¿™ä¸ªç”Ÿæˆå™¨ï¼Œè·å–å·²å®Œæˆçš„Futureå¯¹è±¡</li>
<li><strong>è¿”å›å€¼</strong>ï¼š<strong>è¿”å›ä¸€ä¸ªæŒ‰å®Œæˆé¡ºåºäº§ç”ŸFutureçš„ç”Ÿæˆå™¨</strong>ï¼Œé€šè¿‡è¿­ä»£ç”Ÿæˆå™¨ï¼Œä¸€æ—¦æŸä¸ªä»»åŠ¡å®Œæˆï¼Œå°±ä¼šç«‹å³<strong>è¿”å›ä¸€ä¸ªå¯awaitçš„ä»»åŠ¡å¯¹è±¡</strong>ï¼Œç„¶åå¯ä»¥ä½¿ç”¨awaitè·å–ä»»åŠ¡çš„ç»“æœ</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line"></span><br><span class="line">async def work1():</span><br><span class="line">    await asyncio.sleep(1)</span><br><span class="line">    return &quot;ä»»åŠ¡1è¿”å›å€¼&quot;</span><br><span class="line"></span><br><span class="line">async def work2():</span><br><span class="line">    await asyncio.sleep(2)</span><br><span class="line">    return &quot;ä»»åŠ¡2è¿”å›å€¼&quot;</span><br><span class="line"></span><br><span class="line">async def main():</span><br><span class="line">    tasks = [asyncio.create_task(work1()), asyncio.create_task(work2())]</span><br><span class="line"></span><br><span class="line">    # as_completed()è·å–è¿”å›å€¼æ˜¯å¼‚æ­¥çš„</span><br><span class="line">    for item in asyncio.as_completed(tasks):</span><br><span class="line">        res = await item</span><br><span class="line">        print(res)</span><br><span class="line"></span><br><span class="line">    return &quot;mainå‡½æ•°çš„è¿”å›å€¼&quot;</span><br><span class="line"></span><br><span class="line">main_res = asyncio.run(main())</span><br><span class="line">print(main_res)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">ä»»åŠ¡1è¿”å›å€¼</span><br><span class="line">ä»»åŠ¡2è¿”å›å€¼</span><br><span class="line">mainå‡½æ•°çš„è¿”å›å€¼</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸ƒã€åç¨‹è¿›é˜¶"><a href="#ä¸ƒã€åç¨‹è¿›é˜¶" class="headerlink" title="ä¸ƒã€åç¨‹è¿›é˜¶"></a>ä¸ƒã€åç¨‹è¿›é˜¶</h2><h3 id="1-asyncioçš„futureå¯¹è±¡"><a href="#1-asyncioçš„futureå¯¹è±¡" class="headerlink" title="1. asyncioçš„futureå¯¹è±¡"></a>1. asyncioçš„futureå¯¹è±¡</h3><ul>
<li>ç®€ä»‹ï¼šfutureç±»æ˜¯taskç±»çš„åŸºç±»ï¼Œtaskå¯¹è±¡åªæœ‰è¿ç®—å¾—åˆ°è¿”å›å€¼åï¼Œawaitçš„å¯¹è±¡æ‰èƒ½ä¼ å›å€¼å¹¶ä¸”å‘ä¸‹è¿è¡Œï¼Œè¿™ä¸ªåŠŸèƒ½æ˜¯futureå¯¹è±¡æ¥å®ç°å¹¶æä¾›çš„ã€‚<strong>futureæºç åº•å±‚ä¸­å­˜åœ¨ä¸€ä¸ª_stateçŠ¶æ€ï¼Œä¸€æ—¦_stateçŠ¶æ€å€¼å˜æˆfinishedï¼Œawaitå°±ä¸å†ç»§ç»­ç­‰å¾…ï¼ˆè§£å µå¡ï¼‰</strong></li>
<li>ç”¨æ³•ï¼šç”±äºfutureå¯¹è±¡åå‘äºåº•å±‚ï¼ˆå¸¸ç”¨äºpython 3.5ç‰ˆæœ¬ï¼‰ï¼Œæ–°ç‰ˆæœ¬ä¸­ä¸€èˆ¬ä¸ç›´æ¥ä½¿ç”¨ï¼Œè€Œæ˜¯ä½¿ç”¨taskå¯¹è±¡</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line"></span><br><span class="line"># è®©futureå¯¹è±¡è·å–ä¸åˆ°è¿”å›å€¼ä½¿awaitå µå¡</span><br><span class="line">async def main():</span><br><span class="line">    loop = asyncio.get_running_loop()  # è·å–ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„äº‹ä»¶å¾ªç¯</span><br><span class="line">    fut = loop.create_future()  # åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªfutureå¯¹è±¡ï¼Œå¹¶æ²¡æœ‰ç»‘å®šä»»åŠ¡</span><br><span class="line">    fut.set_result(&quot;æ¨¡æ‹Ÿè¿”å›å€¼...&quot;)  # è®¾ç½®è¿”å›å€¼åï¼Œåˆ™awaitè§£å µå¡</span><br><span class="line">    await fut</span><br><span class="line"></span><br><span class="line"># python3.7ä»¥ä¸‹ç‰ˆæœ¬åˆ›å»ºå¹¶è¿è¡Œäº‹ä»¶å¾ªç¯</span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(main())</span><br></pre></td></tr></table></figure>

<h3 id="2-asyncio-ensure-future"><a href="#2-asyncio-ensure-future" class="headerlink" title="2. asyncio.ensure_future()"></a>2. asyncio.ensure_future()</h3><ul>
<li><strong>ä½œç”¨</strong>ï¼šç±»ä¼¼<strong>asyncio.create_task()<strong>ä¹Ÿæ˜¯å°†ä¸€ä¸ªåç¨‹åŒ…è£…ä¸ºä¸€ä¸ªä»»åŠ¡å¯¹è±¡ï¼ˆ</strong>python 3.6ä¹‹å‰çš„ç‰ˆæœ¬ä½¿ç”¨ï¼Œå…¼å®¹é«˜ç‰ˆæœ¬</strong>ï¼‰</li>
<li><strong>ç”¨æ³•</strong>ï¼šæ¥å—ä¸€ä¸ª<strong>åç¨‹å¯¹è±¡</strong>ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ª<strong>ä»»åŠ¡å¯¹è±¡</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line"></span><br><span class="line">async def work():</span><br><span class="line">    print(&quot;åç¨‹å¯åŠ¨...&quot;)</span><br><span class="line">    await asyncio.sleep(1)</span><br><span class="line">    return &quot;æ¨¡æ‹Ÿä¸€ä¸ªè¿”å›å€¼&quot;</span><br><span class="line"></span><br><span class="line">async def main():</span><br><span class="line">    # futures = [asyncio.create_task(work()) for _ in range(2)]  # python 3.7+</span><br><span class="line">    futures = [asyncio.ensure_future(work()) for _ in range(2)`]  # python 3.7-</span><br><span class="line">    result = await asyncio.gather(*futures)</span><br><span class="line">    print(result)</span><br><span class="line"></span><br><span class="line"># asyncio.run(main())  # python 3.7ä»¥ä¸Šç‰ˆæœ¬è¿è¡Œäº‹ä»¶å¾ªç¯</span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(main())  # python 3.7ä»¥ä¸‹ç‰ˆæœ¬è¿è¡Œäº‹ä»¶å¾ªç¯</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">åç¨‹å¯åŠ¨...</span><br><span class="line">åç¨‹å¯åŠ¨...</span><br><span class="line">[&#x27;æ¨¡æ‹Ÿä¸€ä¸ªè¿”å›å€¼&#x27;, &#x27;æ¨¡æ‹Ÿä¸€ä¸ªè¿”å›å€¼&#x27;]</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="3-çº¿ç¨‹æ± ä¸­çš„futureå¯¹è±¡"><a href="#3-çº¿ç¨‹æ± ä¸­çš„futureå¯¹è±¡" class="headerlink" title="3. çº¿ç¨‹æ± ä¸­çš„futureå¯¹è±¡"></a>3. çº¿ç¨‹æ± ä¸­çš„futureå¯¹è±¡</h3><ul>
<li>å›é¡¾çº¿ç¨‹æ± ä¸è¿›ç¨‹æ± ä¸­çš„futureå¯¹è±¡ï¼Œå…·ä½“å‚è€ƒæœ¬ç¯‡ä¸­çš„<a class="link"   href="https://xfblog.cn/2023/06/01/Python_3_%E7%BA%BF%E7%A8%8B%E3%80%81%E8%BF%9B%E7%A8%8B%E4%B8%8E%E5%8D%8F%E7%A8%8B/#%E4%B8%89%E3%80%81%E8%BF%9B%E7%A8%8B%E6%B1%A0%E4%B8%8E%E7%BA%BF%E7%A8%8B%E6%B1%A0"  target="_blank" rel="noopener">ä¸‰ã€è¿›ç¨‹æ± ä¸çº¿ç¨‹æ± <i class="fas fa-external-link-alt"></i></a></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">from concurrent.futures import Future</span><br><span class="line">from concurrent.futures import ThreadPoolExecutor, as_completed</span><br><span class="line">from concurrent.futures import ProcessPoolExecutor</span><br><span class="line"></span><br><span class="line">def work(name):</span><br><span class="line">    print(&quot;ä»»åŠ¡å¯åŠ¨...&quot;)</span><br><span class="line">    time.sleep(1)</span><br><span class="line">    print(name)</span><br><span class="line">    return &quot;æ¨¡æ‹Ÿä¸€ä¸ªè¿”å›å€¼&quot;</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºçº¿ç¨‹æ± </span><br><span class="line">with ThreadPoolExecutor(max_workers=2) as tpe:</span><br><span class="line">    # eg1:</span><br><span class="line">    for _ in range(4):</span><br><span class="line">        # submitçš„è¿”å›å€¼ä¹Ÿæ˜¯futureå¯¹è±¡ï¼Œæœ‰stateçŠ¶æ€ï¼Œä½†ä¸åç¨‹ä¸­ä¸å¯æ··ä¸ºä¸€è°ˆ</span><br><span class="line">        future = tpe.submit(work, _)</span><br><span class="line">        &quot;&quot;&quot;print(future)</span><br><span class="line">        &lt;Future at 0x100a92750 state=running&gt;</span><br><span class="line">        &lt;Future at 0x100ae99d0 state=running&gt;</span><br><span class="line">        &lt;Future at 0x100ae9d50 state=pending&gt;</span><br><span class="line">        &lt;Future at 0x100ae9fd0 state=pending&gt;&quot;&quot;&quot;</span><br><span class="line">        print(future.result())</span><br><span class="line">        # ä½†ç”±äºæ–¹æ³•result()æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ï¼Œéœ€è¦ç­‰å¾…ä¸Šä¸€ä¸ªçº¿ç¨‹çš„è¿”å›å€¼è¿”å›åï¼Œ</span><br><span class="line">        # æ‰ä¼šç»§ç»­å¼€å¯ä¸‹ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™å°†å¯¼è‡´çº¿ç¨‹æ± å†…çš„çº¿ç¨‹ä¹Ÿæˆä¸ºåŒæ­¥ç¨‹åºäº†</span><br><span class="line"></span><br><span class="line">    # eg2:</span><br><span class="line">    # ä½¿ç”¨as_completedå¼‚æ­¥è·å–çº¿ç¨‹çš„è¿”å›å€¼ï¼Œä¼šè¿”å›ä¸€ä¸ªFutureå®ä¾‹å¯¹è±¡çš„è¿­ä»£å™¨ï¼Œæ˜¯éé˜»å¡çš„</span><br><span class="line">    # futures = [tpe.submit(work, _) for _ in range(4)]</span><br><span class="line">    # for future in as_completed(futures):</span><br><span class="line">    #     print(future.result())</span><br></pre></td></tr></table></figure>

<h3 id="4-çº¿ç¨‹ä¸åç¨‹äº¤å‰ç¼–ç¨‹"><a href="#4-çº¿ç¨‹ä¸åç¨‹äº¤å‰ç¼–ç¨‹" class="headerlink" title="4. çº¿ç¨‹ä¸åç¨‹äº¤å‰ç¼–ç¨‹"></a>4. çº¿ç¨‹ä¸åç¨‹äº¤å‰ç¼–ç¨‹</h3><ul>
<li>å¼•å…¥ï¼šåœ¨ç¼–ç¨‹æ—¶ï¼Œé‡åˆ°æŸä¸ªç¬¬ä¸‰æ–¹æ¨¡å—ä¸æ”¯æŒasyncioåç¨‹å¼‚æ­¥çš„æ—¶å€™ï¼Œåˆ™éœ€è¦çº¿ç¨‹ã€è¿›ç¨‹å’Œåç¨‹çš„ä¸¤ç§Futureäº¤å‰ä½¿ç”¨ã€‚è€Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ä¼šäº¤å‰ä½¿ç”¨ï¼Œè¦ä¹ˆä½¿ç”¨asyncioåç¨‹å¼å®ç°å¼‚æ­¥ï¼Œè¦ä¹ˆç»Ÿä¸€ç”¨è¿›ç¨‹æˆ–çº¿ç¨‹æ± æ¥å®ç°å¼‚æ­¥</li>
<li>æ¡ˆä¾‹ï¼šcrmé¡¹ç›®ä¸­80%æ˜¯åŸºäºåç¨‹å¼‚æ­¥ç¼–ç¨‹ + MySQLï¼Œè¿™ç§æƒ…å†µä¸‹åªæœ‰MySQLå†…éƒ¨ä¹Ÿæ”¯æŒasyncå¼‚æ­¥ï¼Œä¸¤è€…æ‰èƒ½å®ç°æ— ç¼è¡”æ¥ã€‚å‡å¦‚MySQLä¸æ”¯æŒåç¨‹ï¼Œåˆ™éœ€è¦è€ƒè™‘å¯¹æ­¤ç”¨çº¿ç¨‹ã€è¿›ç¨‹æ¥å®ç°äº†</li>
<li><strong>loop.run_in_executor()å®ç°åŸç†ï¼š</strong><ol>
<li>åœ¨çº¿ç¨‹æ± ä¸­ï¼Œå…ˆè°ƒç”¨çº¿ç¨‹æ± çš„submit()æ–¹æ³•å»çº¿ç¨‹ä¸­ç”³è¯·ä¸€ä¸ªfuncå‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªFutureå¯¹è±¡ï¼ˆ<strong>è¿™é‡Œçš„Futureå¯¹è±¡ä¸asyncioåç¨‹æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œæ˜¯concurrent.futures.Future</strong>ï¼‰</li>
<li>è°ƒç”¨futures.wrap_future()æ–¹æ³•å°†çº¿ç¨‹ä¸­çš„Futureå¯¹è±¡ï¼ˆ<strong>concurrent.futures.Future</strong>ï¼‰åŒ…è£…æˆåç¨‹ä¸­çš„Futureå¯¹è±¡ï¼ˆ<strong>asyncio.Future</strong>ï¼‰</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">image_url_list = [</span><br><span class="line">    &#x27;http://pic.bizhi360.com/bbpic/98/10798.jpg&#x27;,</span><br><span class="line">    &#x27;http://pic.bizhi360.com/bbpic/92/10792.jpg&#x27;,</span><br><span class="line">    &#x27;http://pic.bizhi360.com/bbpic/86/10386.jpg&#x27;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">async def get_image(image_url):</span><br><span class="line">    print(&quot;å¼€å§‹ä¸‹è½½ï¼š&quot;, image_url)</span><br><span class="line">    # è·å–ä¸€ä¸ªè¿è¡Œçš„äº‹ä»¶å¾ªç¯</span><br><span class="line">    loop = asyncio.get_running_loop()</span><br><span class="line">    # run_in_executoræ–¹æ³•é»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œç”¨äºæ‰§è¡Œä¸æ”¯æŒasyncå¼‚æ­¥çš„ä»»åŠ¡ï¼Œ</span><br><span class="line">    # run_in_executoråˆ›å»ºçš„çº¿ç¨‹æ± æ‰€è¿”å›çš„æ˜¯futureå¯¹è±¡ï¼Œ`&lt;class &#x27;_asyncio.Future&#x27;&gt;`</span><br><span class="line">    # è¿™ä¸ªfutureå¯¹è±¡æ˜¯asyncioä¸­çš„ï¼Œè€Œä¸æ˜¯çº¿ç¨‹æ± ä¸­çš„ï¼Œæ˜¯æ”¯æŒawaitçš„</span><br><span class="line">    future = loop.run_in_executor(None, requests.get, image_url)</span><br><span class="line">    &quot;&quot;&quot;run_in_executorå†…éƒ¨åº•å±‚å®ç°ï¼š</span><br><span class="line">        def run_in_executor(self, executor, func, *args):</span><br><span class="line">            if executor is None:</span><br><span class="line">                executor = concurrent.futures.ThreadPoolExecutor(</span><br><span class="line">                    thread_name_prefix=&#x27;asyncio&#x27;</span><br><span class="line">                )</span><br><span class="line">    executorç”¨äºç¡®å®šåˆ›å»ºè¿›ç¨‹æˆ–è€…çº¿ç¨‹æ± ï¼Œæ²¡æœ‰é»˜è®¤å€¼ï¼Œå¦‚æœä¼ å…¥Noneåˆ™é»˜è®¤åˆ›å»ºçº¿ç¨‹æ± </span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    response = await future</span><br><span class="line"></span><br><span class="line">    filename = image_url.rsplit(&#x27;/&#x27;)[-1]</span><br><span class="line">    with open(filename, &#x27;wb&#x27;) as fp:</span><br><span class="line">        fp.write(response.content)</span><br><span class="line"></span><br><span class="line">async def main():</span><br><span class="line">    tasks = [asyncio.create_task(get_image(url)) for url in image_url_list]</span><br><span class="line">    await asyncio.wait(tasks)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>

<h3 id="5-è‡ªå®šä¹‰å¼‚æ­¥è¿­ä»£å™¨ç±»"><a href="#5-è‡ªå®šä¹‰å¼‚æ­¥è¿­ä»£å™¨ç±»" class="headerlink" title="5. è‡ªå®šä¹‰å¼‚æ­¥è¿­ä»£å™¨ç±»"></a>5. è‡ªå®šä¹‰å¼‚æ­¥è¿­ä»£å™¨ç±»</h3><ul>
<li>åŸºæœ¬ç»“æ„ï¼š<ul>
<li>**__aiter__()**ï¼š å¿…é¡»è¿”å›ä¸€ä¸ªå¼‚æ­¥è¿­ä»£å™¨å¯¹è±¡è‡ªèº«ã€‚å®ƒä¸éœ€è¦ä½¿ç”¨ async å…³é”®å­—ï¼Œå› ä¸ºå®ƒé€šå¸¸ä¸æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œåªæ˜¯è¿”å›å¯¹è±¡æœ¬èº«</li>
<li>**__anext__()**ï¼šè´Ÿè´£å¼‚æ­¥è·å–ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶åœ¨è¿­ä»£ç»“æŸæ—¶å¼•å‘ StopAsyncIteration å¼‚å¸¸ã€‚å®ƒé€šå¸¸åŒ…å«å¼‚æ­¥æ“ä½œ</li>
</ul>
</li>
<li>ç”¨æ³•ï¼šä½¿ç”¨è‡ªå®šä¹‰çš„å¼‚æ­¥è¿­ä»£å™¨ï¼Œå¯ä»¥åœ¨å¼‚æ­¥å‡½æ•°ä¸­åˆ›å»ºå¼‚æ­¥è¿­ä»£å™¨å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨å¼‚æ­¥forå¾ªç¯æ¥éå†å…ƒç´ </li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line"></span><br><span class="line"># å¼‚æ­¥è¿­ä»£å™¨</span><br><span class="line">class MyAsyncIter:</span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.count = 0</span><br><span class="line"></span><br><span class="line">    async def iter_num(self):</span><br><span class="line">        await asyncio.sleep(1)</span><br><span class="line">        self.count += 1</span><br><span class="line">        if self.count == 100:</span><br><span class="line">            return None</span><br><span class="line">        return self.count</span><br><span class="line"></span><br><span class="line">    # å¼‚æ­¥è¿­ä»£åè®®</span><br><span class="line">    # æ— asyncä¿®é¥°ï¼Œå› ä¸º__aiter__åªè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”è¿”å›çš„å¯¹è±¡å¹¶ä¸è€—æ—¶</span><br><span class="line">    def __aiter__(self):</span><br><span class="line">        return self</span><br><span class="line"></span><br><span class="line">    async def __anext__(self):</span><br><span class="line">        value = await self.iter_num()</span><br><span class="line">        if value is None:</span><br><span class="line">            raise StopAsyncIteration</span><br><span class="line">        return value</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;async def main():</span><br><span class="line">    # å¼‚æ­¥å¾ªç¯è¿­ä»£å¿…é¡»è¦åœ¨åç¨‹å‡½æ•°å†…æ‰§è¡Œ</span><br><span class="line">    async for item in MyAsyncIter():</span><br><span class="line">        print(item)</span><br><span class="line"></span><br><span class="line">    # æƒ³è¦ä½¿ä¸¤ä¸ªå¼‚æ­¥å¾ªç¯åœ¨åŒä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­å¹¶å‘äº¤æ›¿æ‰§è¡Œï¼Œè¿™æ ·æ˜¯é”™è¯¯çš„è°ƒç”¨æ–¹å¼ï¼Œæ˜¯åŒæ­¥çš„ï¼</span><br><span class="line">    # async for item in MyAsyncIter():</span><br><span class="line">    #     print(item)</span><br><span class="line"></span><br><span class="line"># æ­¤æ—¶äº‹ä»¶å¾ªç¯ä¸­åªæœ‰ä¸€ä¸ªä»»åŠ¡è¿è¡Œï¼Œä¸Šé¢ä¸¤ä¸ªå¾ªç¯å‡å­˜åœ¨äºä¸€ä¸ªä»»åŠ¡ä¸­ï¼Œæ‰€ä»¥æ— æ³•è¿›è¡Œä»»åŠ¡åˆ‡æ¢ï¼Œä¹Ÿæ— æ³•å¹¶å‘æ‰§è¡Œ</span><br><span class="line">asyncio.run(main())&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">async def work():</span><br><span class="line">    # å¼‚æ­¥å¾ªç¯è¿­ä»£å¿…é¡»è¦åœ¨åç¨‹å‡½æ•°å†…æ‰§è¡Œ</span><br><span class="line">    async for item in MyAsyncIter():</span><br><span class="line">        print(item)</span><br><span class="line"></span><br><span class="line">async def main():</span><br><span class="line">    # åˆ›å»ºä¸¤ä¸ªtaskä»»åŠ¡å¯¹è±¡ï¼Œå¹¶æäº¤åˆ°äº‹ä»¶å¾ªç¯</span><br><span class="line">    tasks = [asyncio.create_task(work()) for _ in range(2)]</span><br><span class="line">    await asyncio.wait(tasks)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>

<h3 id="6-add-done-callback"><a href="#6-add-done-callback" class="headerlink" title="6. add_done_callback"></a>6. add_done_callback</h3><ul>
<li>ç®€ä»‹ï¼š<strong>add_done_callbackæ˜¯Pythonä¸­ asyncio.Future å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä¸»è¦ä½œç”¨æ˜¯åœ¨å¼‚æ­¥æ“ä½œå®Œæˆåæ‰§è¡Œä¸€ä¸ªå›è°ƒå‡½æ•°</strong></li>
<li>ä½œç”¨ï¼šç”¨äºæ·»åŠ ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰ï¼Œå½“è¯¥Futureå¯¹è±¡å®Œæˆæ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°</li>
<li>ç‰¹ç‚¹ï¼š<ol>
<li>å…è®¸åœ¨å¼‚æ­¥æ“ä½œå®Œæˆåæ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ï¼Œè¿™å¯¹äºå¤„ç†å¼‚æ­¥æ“ä½œçš„ç»“æœæˆ–æ‰§è¡Œæ¸…ç†æ“ä½œéå¸¸æœ‰ç”¨</li>
<li><strong>å…¶æ·»åŠ çš„å›è°ƒå‡½æ•°æ˜¯éé˜»å¡çš„</strong>ï¼Œå› æ­¤ä¸ä¼šå½±å“ä¸»äº‹ä»¶å¾ªç¯çš„æ‰§è¡Œ</li>
</ol>
</li>
<li><strong>æ³¨æ„ï¼šå®šä¹‰å›è°ƒå‡½æ•°æ—¶éœ€å®šä¹‰ä¸ºæ™®é€šå‡½æ•°ï¼Œè€Œä¸æ˜¯åç¨‹å‡½æ•°ï¼Œä¸èƒ½ç”¨asyncä¿®é¥°è¯¥å‡½æ•°</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line"></span><br><span class="line">async def work():</span><br><span class="line">    print(&quot;ä»»åŠ¡å¼€å§‹...&quot;)</span><br><span class="line">    await asyncio.sleep(1)</span><br><span class="line">    return &quot;æ¨¡æ‹Ÿä¸€ä¸ªè¿”å›å€¼&quot;</span><br><span class="line"></span><br><span class="line">def get_return(task):</span><br><span class="line">    # å¯ä»¥ç›´æ¥è°ƒç”¨taskå¯¹è±¡çš„result()æ–¹æ³•æ¥è·å–è¿”å›ç»“æœ</span><br><span class="line">    print(task.result())</span><br><span class="line"></span><br><span class="line">async def main():</span><br><span class="line">    tasks = [asyncio.create_task(work()) for _ in range(2)]</span><br><span class="line">    # å°†è·å–è¿”å›å€¼çš„å›è°ƒå‡½æ•°ç»‘å®šåˆ°taskå¯¹è±¡ä¸­ï¼Œä»»åŠ¡å®Œæˆæ—¶ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°</span><br><span class="line">    for task in tasks:</span><br><span class="line">        task.add_done_callback(get_return)</span><br><span class="line">    await asyncio.gather(*tasks)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">ä»»åŠ¡å¼€å§‹...</span><br><span class="line">ä»»åŠ¡å¼€å§‹...</span><br><span class="line">æ¨¡æ‹Ÿä¸€ä¸ªè¿”å›å€¼</span><br><span class="line">æ¨¡æ‹Ÿä¸€ä¸ªè¿”å›å€¼</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="7-å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨"><a href="#7-å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨" class="headerlink" title="7. å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨"></a>7. å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨</h3><ul>
<li>åŸºæœ¬ç»“æ„ï¼š<ul>
<li>**__aenter__**ï¼šåœ¨è¿›å…¥å¼‚æ­¥ä¸Šä¸‹æ–‡æ—¶æ‰§è¡Œï¼Œé€šå¸¸ç”¨äºè·å–å¼‚æ­¥èµ„æºï¼Œä¾‹å¦‚æ‰“å¼€æ–‡ä»¶æˆ–å»ºç«‹ç½‘ç»œè¿æ¥ã€‚å®ƒå¯ä»¥åŒ…å«å¼‚æ­¥æ“ä½œï¼Œå› æ­¤éœ€è¦asyncä¿®é¥°å‡½æ•°ä¸ºåç¨‹å‡½æ•°ï¼Œå¹¶ä¸”å‡½æ•°å†…éœ€è¦ä½¿ç”¨åˆ° await å…³é”®å­—</li>
<li>**__aexit__**ï¼šåœ¨é€€å‡ºå¼‚æ­¥ä¸Šä¸‹æ–‡æ—¶æ‰§è¡Œï¼Œé€šå¸¸ç”¨äºé‡Šæ”¾å¼‚æ­¥èµ„æºï¼Œä¾‹å¦‚å…³é—­æ–‡ä»¶æˆ–æ–­å¼€ç½‘ç»œè¿æ¥ã€‚å®ƒä¹Ÿå¯ä»¥åŒ…å«å¼‚æ­¥æ“ä½œï¼Œå› æ­¤éœ€è¦asyncä¿®é¥°å‡½æ•°ä¸ºåç¨‹å‡½æ•°ï¼Œå¹¶ä¸”å‡½æ•°å†…éœ€è¦ä½¿ç”¨åˆ° await å…³é”®å­—</li>
</ul>
</li>
<li>ç”¨æ³•ï¼šä½¿ç”¨ async with è¯­å¥åˆ›å»ºå¼‚æ­¥ä¸Šä¸‹æ–‡å’Œä½¿ç”¨å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œåœ¨å…¶ä¸­æ‰§è¡Œéœ€è¦å¼‚æ­¥èµ„æºçš„æ“ä½œ</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line"></span><br><span class="line">class AsyncContextManager:</span><br><span class="line">    def __init__(self, conn=None):</span><br><span class="line">        self.conn = conn</span><br><span class="line"></span><br><span class="line">    async def get_data(self):</span><br><span class="line">        await asyncio.sleep(1)</span><br><span class="line">        return &quot;æ¨¡æ‹Ÿæ•°æ®åº“è¿”å›äº†æ•°æ®&quot;</span><br><span class="line"></span><br><span class="line">    async def __aenter__(self):</span><br><span class="line">        # åœ¨è¿™é‡Œæ‰§è¡Œè·å–å¼‚æ­¥èµ„æºçš„æ“ä½œ</span><br><span class="line">        # æ¨¡æ‹Ÿæ•°æ®åº“è¿æ¥çš„è€—æ—¶æ“ä½œï¼Œå› ä¸ºè¿æ¥æ“ä½œæ˜¯å±äºç½‘ç»œIOçš„</span><br><span class="line">        self.conn = await asyncio.sleep(1, result=&quot;è¿æ¥æ•°æ®åº“æˆåŠŸ...&quot;)</span><br><span class="line">        print(self.conn)</span><br><span class="line">        return self</span><br><span class="line"></span><br><span class="line">    async def __aexit__(self, exc_type, exc_val, exc_tb):</span><br><span class="line">        # åœ¨è¿™é‡Œæ‰§è¡Œé‡Šæ”¾å¼‚æ­¥èµ„æºçš„æ“ä½œ</span><br><span class="line">        res = await asyncio.sleep(1, result=&quot;å…³é—­æ•°æ®åº“è¿æ¥æˆåŠŸ...&quot;)</span><br><span class="line">        print(res)</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨</span><br><span class="line">async def main():</span><br><span class="line">    # ä½¿ç”¨ async with è¯­å¥åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œæ˜¯ç”¨äºä¸å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ååŒå·¥ä½œçš„è¯­æ³•</span><br><span class="line">    async with AsyncContextManager() as fp:</span><br><span class="line">        # åœ¨æ­¤å¤„æ‰§è¡Œä¸èµ„æºç›¸å…³çš„å¼‚æ­¥æ“ä½œ</span><br><span class="line">        result = await fp.get_data()</span><br><span class="line">        print(result)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">è¿æ¥æ•°æ®åº“æˆåŠŸ...</span><br><span class="line">æ¨¡æ‹Ÿæ•°æ®åº“è¿”å›äº†æ•°æ®</span><br><span class="line">å…³é—­æ•°æ®åº“è¿æ¥æˆåŠŸ...</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="8-uvloop"><a href="#8-uvloop" class="headerlink" title="8. uvloop"></a>8. uvloop</h3><ul>
<li><p>ç®€ä»‹ï¼š<strong>åœ¨ Python ä¸­è¿›è¡Œå¼‚æ­¥ç¼–ç¨‹æ—¶ï¼Œäº‹ä»¶å¾ªç¯çš„æ€§èƒ½å’Œæ•ˆç‡å¯¹äºæ•´ä½“åº”ç”¨ç¨‹åºçš„æ€§èƒ½è‡³å…³é‡è¦ã€‚uvloopæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªé«˜æ€§èƒ½çš„äº‹ä»¶å¾ªç¯å®ç°ï¼Œä¸“é—¨ä¸º Python å¼‚æ­¥ç¼–ç¨‹è€Œè®¾è®¡</strong></p>
</li>
<li><p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li><strong>é«˜æ€§èƒ½äº‹ä»¶å¾ªç¯</strong>ï¼šuvloopåŸºäºlibuvï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„äº‹ä»¶é©±åŠ¨åº“ï¼Œå®ƒå¯ä»¥æä¾›éå¸¸å¿«é€Ÿçš„å¼‚æ­¥I&#x2F;Oæ“ä½œã€‚ç›¸å¯¹äºæ ‡å‡†çš„asyncioäº‹ä»¶å¾ªç¯ï¼Œuvloopæä¾›äº†æ›´å¥½çš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜è´Ÿè½½å’Œé«˜å¹¶å‘æƒ…å†µä¸‹</li>
<li><strong>100%å…¼å®¹asyncio</strong>ï¼šuvloopæ˜¯asyncioçš„æ›¿ä»£äº‹ä»¶å¾ªç¯å®ç°ï¼Œå®ƒä¸æ ‡å‡†åº“ä¸­çš„asyncioå®Œå…¨å…¼å®¹ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥å°†ç°æœ‰çš„asyncioä»£ç è¿ç§»åˆ°uvloopï¼Œå¹¶ä¸”ä¸éœ€è¦ä¿®æ”¹ä½ çš„ä»£ç ï¼Œåªéœ€å°†äº‹ä»¶å¾ªç¯çš„å®ç°åˆ‡æ¢ä¸ºuvloopå³å¯</li>
<li><strong>åç¨‹å’Œå¼‚æ­¥ä»£ç æ€§èƒ½æå‡</strong>ï¼šç”±äºuvloopæä¾›äº†æ›´å¿«çš„äº‹ä»¶å¾ªç¯ï¼Œå› æ­¤å®ƒå¯ä»¥æ”¹å–„åç¨‹å’Œå¼‚æ­¥ä»£ç çš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡å¹¶å‘æ“ä½œæ—¶</li>
</ul>
</li>
<li><p>ç”¨æ³•ï¼š<strong>ä½¿ç”¨ asyncio.set_event_loop_policy(uvloop.EventLoopPolicy()) å¯ä»¥å°†uvloopè®¾ç½®ä¸ºé»˜è®¤çš„äº‹ä»¶å¾ªç¯ç­–ç•¥ï¼Œæ˜¯å…¨å±€çš„ï¼Œæ‰€ä»¥ä¸èƒ½æ”¾åœ¨mainå‡½æ•°ä¸­</strong></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line">import uvloop</span><br><span class="line"></span><br><span class="line">async def work():</span><br><span class="line">    print(&quot;ä»»åŠ¡å¼€å§‹...&quot;)</span><br><span class="line">    await asyncio.sleep(1)</span><br><span class="line">    print(&quot;ä»»åŠ¡ç»“æŸ...&quot;)</span><br><span class="line">    return &quot;æ¨¡æ‹Ÿä¸€ä¸ªè¿”å›å€¼&quot;</span><br><span class="line"></span><br><span class="line"># è®¾ç½® uvloop ä½œä¸ºäº‹ä»¶å¾ªç¯ç­–ç•¥ï¼Œä¸€æ—¦è®¾ç½®äº†äº‹ä»¶å¾ªç¯ç­–ç•¥ï¼Œ</span><br><span class="line"># å®ƒå°†å½±å“æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰å¼‚æ­¥æ“ä½œ</span><br><span class="line"># å› æ­¤ï¼Œæœ€ä½³åšæ³•æ˜¯åœ¨åº”ç”¨ç¨‹åºçš„å¯åŠ¨é˜¶æ®µè®¾ç½®äº‹ä»¶å¾ªç¯ç­–ç•¥ï¼Œé€šå¸¸åœ¨å…¨å±€èŒƒå›´å†…è¿›è¡Œ</span><br><span class="line">asyncio.set_event_loop_policy(uvloop.EventLoopPolicy())</span><br><span class="line"></span><br><span class="line">async def main():</span><br><span class="line">    tasks = [asyncio.create_task(work()) for _ in range(2)]</span><br><span class="line">    await asyncio.wait(tasks)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>

<h3 id="9-aiomysqlå¼‚æ­¥é¢„å‘Š"><a href="#9-aiomysqlå¼‚æ­¥é¢„å‘Š" class="headerlink" title="9. aiomysqlå¼‚æ­¥é¢„å‘Š"></a>9. aiomysqlå¼‚æ­¥é¢„å‘Š</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line">import aiomysql</span><br><span class="line"></span><br><span class="line">async def execute(host, password):</span><br><span class="line">    # ç½‘ç»œIOæ“ä½œï¼Œè¿æ¥mysql</span><br><span class="line">    conn = await aiomysql.connect(host=host, port=3306, user=&#x27;root&#x27;, password=password, db=&#x27;asyncio&#x27;)</span><br><span class="line">    # ç½‘ç»œIOæ“ä½œï¼Œåˆ›å»ºcursor()</span><br><span class="line">    cur = await conn.cursor()</span><br><span class="line">    # ç½‘ç»œIOæ“ä½œï¼Œæ‰§è¡Œsqlè¯­å¥</span><br><span class="line">    await cur.execute(&#x27;SELECT * FROM user&#x27;)</span><br><span class="line">    # ç½‘ç»œIOæ“ä½œï¼Œè·å–sqlç»“æœï¼Œè¿”å›ä¸€ä¸ªFutureå¯¹è±¡ï¼Œ</span><br><span class="line">    # å¯ä»¥é€šè¿‡result()æ–¹æ³•ï¼Œè·å–sqlè¯­å¥çš„æŸ¥è¯¢ç»“æœï¼Œresult()æ–¹æ³•è¿”å›ä¸€ä¸ªå…ƒç»„</span><br><span class="line">    res = cur.fetchall()</span><br><span class="line">    &quot;&quot;&quot;print(res.result())</span><br><span class="line">((1, &#x27;wcf&#x27;, &#x27;22&#x27;, &#x27;ç¨‹åºå‘˜&#x27;), (2, &#x27;zxc&#x27;, &#x27;22&#x27;, &#x27;è´¢åŠ¡&#x27;), (3, &#x27;xfblog.cn&#x27;, &#x27;3&#x27;, &#x27;å°å‚…åšå®¢&#x27;))</span><br><span class="line">((1, &#x27;wcf&#x27;, &#x27;22&#x27;, &#x27;ç¨‹åºå‘˜&#x27;), (2, &#x27;zxc&#x27;, &#x27;22&#x27;, &#x27;è´¢åŠ¡&#x27;), (3, &#x27;xfblog.cn&#x27;, &#x27;3&#x27;, &#x27;å°å‚…åšå®¢&#x27;))&quot;&quot;&quot;</span><br><span class="line">    # ç½‘ç»œIOæ“ä½œï¼Œå…³é—­é“¾æ¥</span><br><span class="line">    await cur.close()</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line">async def main():</span><br><span class="line">    task_list = [</span><br><span class="line">        asyncio.create_task(execute(&#x27;127.0.0.1&#x27;, &#x27;123456&#x27;)),</span><br><span class="line">        asyncio.create_task(execute(&#x27;127.0.0.1&#x27;, &#x27;123456&#x27;))</span><br><span class="line">    ]</span><br><span class="line">    await asyncio.wait(task_list)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>
                    
                </div>

                
                        
<div class="post-copyright-info-container border-box">
    <div class="copyright-info-content border-box">
        <div class="copyright-info-top border-box">
            <div class="copyright-post-title border-box text-ellipsis">
                Python_3_çº¿ç¨‹ã€è¿›ç¨‹ä¸åç¨‹
            </div>

            <div class="copyright-post-link border-box text-ellipsis">
                2023/06/01/Python_3_çº¿ç¨‹ã€è¿›ç¨‹ä¸åç¨‹/
            </div>
        </div>

        <div class="copyright-info-bottom border-box">
            <div class="copyright-post-author bottom-item">
                <div class="type">
                    ä½œè€…
                </div>
                <div class="content">xfblog</div>
            </div>

            <div class="post-time bottom-item">
                <div class="type">
                    å‘å¸ƒäº
                </div>
                <div class="content">2023-06-01 00:00</div>
            </div>


            <div class="post-license bottom-item">
                <div class="type">
                    è®¸å¯
                </div>
                <div class="content tooltip" data-tooltip-content="CC BY-NC-SA 4.0">
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" target="_blank">
                        
                            <i class="fa-brands fa-creative-commons"></i>
                            <i class="fa-brands fa-creative-commons-by"></i>
                            <i class="fa-brands fa-creative-commons-nc"></i>
                            <i class="fa-brands fa-creative-commons-sa"></i>
                        
                    </a>
                </div>
            </div>
        </div>

        <i class="copyright-bg fa-solid fa-copyright"></i>
    </div>
    <div class="copy-copyright-info flex-center tooltip" data-tooltip-content="å¤åˆ¶ç‰ˆæƒä¿¡æ¯" data-tooltip-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/Python/">Python</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                            <div class="post-share-container border-box">
    <ul class="share-list-wrap border-box">
        <li class="qq share-item border-box flex-center tooltip"
            data-tooltip-content="åˆ†äº«åˆ° QQ"
        >
            <i class="fa-brands fa-qq"></i>
        </li>
        <li class="wechat share-item border-box flex-center tooltip tooltip-img"
            data-tooltip-content="åˆ†äº«åˆ°å¾®ä¿¡"
            data-tooltip-img-tip="å¾®ä¿¡æ‰«ä¸€æ‰«"
            data-tooltip-img-style="background-color: #fff; top: -10px; padding: 0.6rem 0.6rem 0.1rem 0.6rem;"
        >
            <i class="fa-brands fa-weixin"></i>
        </li>
        <li class="weibo share-item border-box flex-center tooltip"
            data-tooltip-content="åˆ†äº«åˆ°å¾®åš"
        >
            <i class="fa-brands fa-weibo"></i>
        </li>
    </ul>
</div>

                        
                    </div>
                </div>

                
                    

<div class="reward-author-container border-box flex-center">
    <div class="reward-btn border-box flex-center tooltip tooltip-img"
            data-tooltip-img-url="/images/zfb.webp"
            data-tooltip-img-trigger="click"
            data-tooltip-img-style="top: -6px;"
    >
        <i class="fa-solid fa-gift"></i>&nbsp;åˆ›ä½œä¸æ˜“ï¼Œæ‰“èµéšæ„ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘æ›´æ–°çš„åŠ¨åŠ›ğŸ’ªï¼
    </div>
</div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/2023/07/01/Python_4_%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"
                                   title="Python_4_æ­£åˆ™è¡¨è¾¾å¼"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">Python_4_æ­£åˆ™è¡¨è¾¾å¼</span>
                                        <span class="post-nav-item">ä¸Šä¸€ç¯‡</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2023/05/01/Python_2_%E9%AB%98%E7%BA%A7%E8%AF%AD%E6%B3%95/"
                                   title="Python_2_é«˜çº§è¯­æ³•"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">Python_2_é«˜çº§è¯­æ³•</span>
                                        <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
            <div class="pc-post-toc right-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B"><span class="nav-text">ä¸€ã€çº¿ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA%E4%B8%8E%E5%90%AF%E5%8A%A8%E7%9A%84%E7%BA%BF%E7%A8%8B"><span class="nav-text">1. è‡ªåŠ¨åˆ›å»ºä¸å¯åŠ¨çš„çº¿ç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AD%90%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA1"><span class="nav-text">2. å­çº¿ç¨‹çš„åˆ›å»º1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%AD%90%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA2"><span class="nav-text">3. å­çº¿ç¨‹çš„åˆ›å»º2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E8%BF%9B%E7%A8%8B"><span class="nav-text">äºŒã€è¿›ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA%E4%B8%8E%E5%90%AF%E5%8A%A8%E7%9A%84%E8%BF%9B%E7%A8%8B"><span class="nav-text">1. è‡ªåŠ¨åˆ›å»ºä¸å¯åŠ¨çš„è¿›ç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AD%90%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA1"><span class="nav-text">2. å­è¿›ç¨‹çš„åˆ›å»º1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%AD%90%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA2"><span class="nav-text">3. å­è¿›ç¨‹çš„åˆ›å»º2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%AD%90%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA3"><span class="nav-text">4. å­è¿›ç¨‹çš„åˆ›å»º3</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E8%BF%9B%E7%A8%8B%E6%B1%A0%E4%B8%8E%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="nav-text">ä¸‰ã€è¿›ç¨‹æ± ä¸çº¿ç¨‹æ± </span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E8%BF%9B%E7%A8%8B%E6%B1%A0Pool"><span class="nav-text">1. è¿›ç¨‹æ± Pool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-ProcessPoolExecutor"><span class="nav-text">2. ProcessPoolExecutor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%BA%BF%E7%A8%8B%E6%B1%A0ThreadPool"><span class="nav-text">3. çº¿ç¨‹æ± ThreadPool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-ThreadPoolExecutor"><span class="nav-text">4. ThreadPoolExecutor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%96%B9%E6%B3%95wait%E4%B8%8Eas-completed"><span class="nav-text">5. æ–¹æ³•waitä¸as_completed</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E5%A4%9A%E8%BF%9B%E7%A8%8B%E4%B8%8E%E5%A4%9A%E7%BA%BF%E7%A8%8B"><span class="nav-text">å››ã€å¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%89%A7%E8%A1%8C%E7%9A%84%E4%B8%8D%E7%A1%AE%E5%AE%9A%E6%80%A7"><span class="nav-text">1. æ‰§è¡Œçš„ä¸ç¡®å®šæ€§</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AE%88%E6%8A%A4%E5%B1%9E%E6%80%A7daemon"><span class="nav-text">2. å®ˆæŠ¤å±æ€§daemon</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%98%BB%E5%A1%9E%E6%96%B9%E6%B3%95join"><span class="nav-text">3. é˜»å¡æ–¹æ³•join()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E8%AE%BF%E9%97%AE%E4%B8%8E%E5%85%B1%E4%BA%AB"><span class="nav-text">4. å…¨å±€å˜é‡è®¿é—®ä¸å…±äº«</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E7%9A%84%E4%B8%8D%E5%AE%89%E5%85%A8%E6%80%A7"><span class="nav-text">5. æ“ä½œæ•°æ®çš„ä¸å®‰å…¨æ€§</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1%E4%B9%8B%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98"><span class="nav-text">6. è¿›ç¨‹é—´é€šä¿¡ä¹‹å…±äº«å†…å­˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1%E4%B9%8B%E9%98%9F%E5%88%97"><span class="nav-text">7. è¿›ç¨‹é—´é€šä¿¡ä¹‹é˜Ÿåˆ—</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E5%B9%B6%E5%8F%91%E5%90%8C%E6%AD%A5"><span class="nav-text">äº”ã€å¹¶å‘åŒæ­¥</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Lock%E9%94%81"><span class="nav-text">1. Locké”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%AD%BB%E9%94%81"><span class="nav-text">2. æ­»é”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-RLock%E9%94%81"><span class="nav-text">3. RLocké”</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E5%8D%8F%E7%A8%8B"><span class="nav-text">å…­ã€åç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-asyncio%E6%A8%A1%E5%9D%97"><span class="nav-text">1. asyncioæ¨¡å—</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-asyncio-run"><span class="nav-text">2. asyncio.run()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-asyncio-sleep"><span class="nav-text">3. asyncio.sleep()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-await%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">4. awaitå…³é”®å­—</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-task%E5%AF%B9%E8%B1%A1"><span class="nav-text">5. taskå¯¹è±¡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-asyncio-wait"><span class="nav-text">6. asyncio.wait()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-asyncio-gather"><span class="nav-text">7. asyncio.gather()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-asyncio-as-completed"><span class="nav-text">8. asyncio.as_completed()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E5%8D%8F%E7%A8%8B%E8%BF%9B%E9%98%B6"><span class="nav-text">ä¸ƒã€åç¨‹è¿›é˜¶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-asyncio%E7%9A%84future%E5%AF%B9%E8%B1%A1"><span class="nav-text">1. asyncioçš„futureå¯¹è±¡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-asyncio-ensure-future"><span class="nav-text">2. asyncio.ensure_future()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%B8%AD%E7%9A%84future%E5%AF%B9%E8%B1%A1"><span class="nav-text">3. çº¿ç¨‹æ± ä¸­çš„futureå¯¹è±¡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%8D%8F%E7%A8%8B%E4%BA%A4%E5%8F%89%E7%BC%96%E7%A8%8B"><span class="nav-text">4. çº¿ç¨‹ä¸åç¨‹äº¤å‰ç¼–ç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E6%AD%A5%E8%BF%AD%E4%BB%A3%E5%99%A8%E7%B1%BB"><span class="nav-text">5. è‡ªå®šä¹‰å¼‚æ­¥è¿­ä»£å™¨ç±»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-add-done-callback"><span class="nav-text">6. add_done_callback</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E5%BC%82%E6%AD%A5%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8"><span class="nav-text">7. å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-uvloop"><span class="nav-text">8. uvloop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-aiomysql%E5%BC%82%E6%AD%A5%E9%A2%84%E5%91%8A"><span class="nav-text">9. aiomysqlå¼‚æ­¥é¢„å‘Š</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
    Copyright&nbsp;&copy;&nbsp;<span>2021</span>&nbsp;-&nbsp;2024&nbsp;<a href="https://xfblog.cn/" target="_self">å°å‚…åšå®¢</a>&nbsp;-&nbsp;All&nbsp;rights&nbsp;reserved.&nbsp;&nbsp;&nbsp;&nbsp;
    
            <!-- &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">xfblog</a> -->
        
    </div>

    <!-- <div class="theme-info info-item">
        ç”±&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;é©±åŠ¨&nbsp;&&nbsp;ä¸»é¢˜&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div> -->

    

    

    
        <div class="record-info info-item">
            
                
                    <div class="record-item border-box">
                        <a class=""
                           target="_blank"
                           href="https://beian.miit.gov.cn"
                        >
                        
                            èœ€ICPå¤‡2021021033å·-1
                        </a>
                    </div>
                
            
                
                    <div class="record-item border-box">
                        <a class=""
                           target="_blank"
                           href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51138102000134"
                        >
                        
                            <!-- åœ¨ç¬¬äºŒä¸ª <a> æ ‡ç­¾å‰æ’å…¥å›¾ç‰‡ -->
                            <img src="http://xfblog.cn/images/icon.webp" style="vertical-align: top;">
                        
                            å·å…¬ç½‘å®‰å¤‡ 51138102000134å·
                        </a>
                    </div>
                
            
        </div>&nbsp;&nbsp;&nbsp;&nbsp;
        
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="æœç´¢..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B"><span class="nav-text">ä¸€ã€çº¿ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA%E4%B8%8E%E5%90%AF%E5%8A%A8%E7%9A%84%E7%BA%BF%E7%A8%8B"><span class="nav-text">1. è‡ªåŠ¨åˆ›å»ºä¸å¯åŠ¨çš„çº¿ç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AD%90%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA1"><span class="nav-text">2. å­çº¿ç¨‹çš„åˆ›å»º1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%AD%90%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA2"><span class="nav-text">3. å­çº¿ç¨‹çš„åˆ›å»º2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E8%BF%9B%E7%A8%8B"><span class="nav-text">äºŒã€è¿›ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA%E4%B8%8E%E5%90%AF%E5%8A%A8%E7%9A%84%E8%BF%9B%E7%A8%8B"><span class="nav-text">1. è‡ªåŠ¨åˆ›å»ºä¸å¯åŠ¨çš„è¿›ç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AD%90%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA1"><span class="nav-text">2. å­è¿›ç¨‹çš„åˆ›å»º1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%AD%90%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA2"><span class="nav-text">3. å­è¿›ç¨‹çš„åˆ›å»º2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%AD%90%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA3"><span class="nav-text">4. å­è¿›ç¨‹çš„åˆ›å»º3</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E8%BF%9B%E7%A8%8B%E6%B1%A0%E4%B8%8E%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="nav-text">ä¸‰ã€è¿›ç¨‹æ± ä¸çº¿ç¨‹æ± </span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E8%BF%9B%E7%A8%8B%E6%B1%A0Pool"><span class="nav-text">1. è¿›ç¨‹æ± Pool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-ProcessPoolExecutor"><span class="nav-text">2. ProcessPoolExecutor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%BA%BF%E7%A8%8B%E6%B1%A0ThreadPool"><span class="nav-text">3. çº¿ç¨‹æ± ThreadPool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-ThreadPoolExecutor"><span class="nav-text">4. ThreadPoolExecutor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%96%B9%E6%B3%95wait%E4%B8%8Eas-completed"><span class="nav-text">5. æ–¹æ³•waitä¸as_completed</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E5%A4%9A%E8%BF%9B%E7%A8%8B%E4%B8%8E%E5%A4%9A%E7%BA%BF%E7%A8%8B"><span class="nav-text">å››ã€å¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%89%A7%E8%A1%8C%E7%9A%84%E4%B8%8D%E7%A1%AE%E5%AE%9A%E6%80%A7"><span class="nav-text">1. æ‰§è¡Œçš„ä¸ç¡®å®šæ€§</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AE%88%E6%8A%A4%E5%B1%9E%E6%80%A7daemon"><span class="nav-text">2. å®ˆæŠ¤å±æ€§daemon</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%98%BB%E5%A1%9E%E6%96%B9%E6%B3%95join"><span class="nav-text">3. é˜»å¡æ–¹æ³•join()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E8%AE%BF%E9%97%AE%E4%B8%8E%E5%85%B1%E4%BA%AB"><span class="nav-text">4. å…¨å±€å˜é‡è®¿é—®ä¸å…±äº«</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E7%9A%84%E4%B8%8D%E5%AE%89%E5%85%A8%E6%80%A7"><span class="nav-text">5. æ“ä½œæ•°æ®çš„ä¸å®‰å…¨æ€§</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1%E4%B9%8B%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98"><span class="nav-text">6. è¿›ç¨‹é—´é€šä¿¡ä¹‹å…±äº«å†…å­˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1%E4%B9%8B%E9%98%9F%E5%88%97"><span class="nav-text">7. è¿›ç¨‹é—´é€šä¿¡ä¹‹é˜Ÿåˆ—</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E5%B9%B6%E5%8F%91%E5%90%8C%E6%AD%A5"><span class="nav-text">äº”ã€å¹¶å‘åŒæ­¥</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Lock%E9%94%81"><span class="nav-text">1. Locké”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%AD%BB%E9%94%81"><span class="nav-text">2. æ­»é”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-RLock%E9%94%81"><span class="nav-text">3. RLocké”</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E5%8D%8F%E7%A8%8B"><span class="nav-text">å…­ã€åç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-asyncio%E6%A8%A1%E5%9D%97"><span class="nav-text">1. asyncioæ¨¡å—</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-asyncio-run"><span class="nav-text">2. asyncio.run()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-asyncio-sleep"><span class="nav-text">3. asyncio.sleep()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-await%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">4. awaitå…³é”®å­—</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-task%E5%AF%B9%E8%B1%A1"><span class="nav-text">5. taskå¯¹è±¡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-asyncio-wait"><span class="nav-text">6. asyncio.wait()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-asyncio-gather"><span class="nav-text">7. asyncio.gather()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-asyncio-as-completed"><span class="nav-text">8. asyncio.as_completed()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E5%8D%8F%E7%A8%8B%E8%BF%9B%E9%98%B6"><span class="nav-text">ä¸ƒã€åç¨‹è¿›é˜¶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-asyncio%E7%9A%84future%E5%AF%B9%E8%B1%A1"><span class="nav-text">1. asyncioçš„futureå¯¹è±¡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-asyncio-ensure-future"><span class="nav-text">2. asyncio.ensure_future()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%B8%AD%E7%9A%84future%E5%AF%B9%E8%B1%A1"><span class="nav-text">3. çº¿ç¨‹æ± ä¸­çš„futureå¯¹è±¡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%8D%8F%E7%A8%8B%E4%BA%A4%E5%8F%89%E7%BC%96%E7%A8%8B"><span class="nav-text">4. çº¿ç¨‹ä¸åç¨‹äº¤å‰ç¼–ç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E6%AD%A5%E8%BF%AD%E4%BB%A3%E5%99%A8%E7%B1%BB"><span class="nav-text">5. è‡ªå®šä¹‰å¼‚æ­¥è¿­ä»£å™¨ç±»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-add-done-callback"><span class="nav-text">6. add_done_callback</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E5%BC%82%E6%AD%A5%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8"><span class="nav-text">7. å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-uvloop"><span class="nav-text">8. uvloop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-aiomysql%E5%BC%82%E6%AD%A5%E9%A2%84%E5%91%8A"><span class="nav-text">9. aiomysqlå¼‚æ­¥é¢„å‘Š</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>





<!-- common js -->
<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/toggle-theme.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/code-block.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/libs/anime.min.js"></script>

<!-- local search -->

    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/local-search.js"></script>


<!-- lazyload -->

    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/lazyload.js"></script>


<div class="pjax">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/post/post-helper.js"></script>

        <!-- toc -->
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/post/toc.js"></script>
        

        <!-- copyright-info -->
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/post/copyright-info.js"></script>
        

        <!-- share -->
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/post/share.js"></script>
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->

    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@4.2.5/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart()
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd()
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'))
            KEEP.initExecute()
        });
    });
</script>




    

</body>
</html>
